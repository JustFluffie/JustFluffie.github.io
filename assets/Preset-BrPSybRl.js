import{_ as G,r as _,c as W,s as R,W as F,a as h,o as u,e as n,d as N,z as v,n as x,f as y,w as S,b as k,C as T,F as z,A as L,B as q,a0 as j,a1 as H,D as Z,k as J,a2 as Q,Z as X,y as p,$ as Y,S as C,M as ee}from"./index-RyrZYN_Z.js";import{d as U}from"./vuedraggable.umd-DnOWu4sx.js";const te=["onClick"],le=["checked","onChange"],ne={class:"group-title"},oe={key:0,class:"option-list"},se=["onClick"],ae=["checked","onChange"],ie=["onClick"],re=["checked","onChange"],ce={__name:"MultiSelect",props:{modelValue:{type:[Array,String,Number],required:!0,default:()=>[]},options:{type:Array,default:()=>[]},multiple:{type:Boolean,default:!0},textAlign:{type:String,default:"right"},selectorWidth:{type:String,default:"auto"},dropdownWidth:{type:String,default:"auto"},labelKey:{type:String,default:"title"},valueKey:{type:String,default:"id"},childrenKey:{type:String,default:"entries"},placeholder:{type:String,default:"未选择"}},emits:["update:modelValue"],setup(s,{emit:d}){const t=s,A=d,f=_(!1),b=_([]),g=_(null),V=_({}),K=_("body"),D=W(()=>t.options.length>0&&t.childrenKey in t.options[0]),O=W(()=>{if(t.multiple)return!Array.isArray(t.modelValue)||t.modelValue.length===0?t.placeholder:`已选择 ${t.modelValue.length} 个条目`;if(t.modelValue===null||t.modelValue===void 0||t.modelValue==="")return t.placeholder;if(D.value)for(const e of t.options){const o=(e[t.childrenKey]||[]).find(l=>l[t.valueKey]===t.modelValue);if(o)return o[t.labelKey]}else{const e=t.options.find(o=>o[t.valueKey]===t.modelValue);if(e)return e[t.labelKey]}return t.modelValue}),$=e=>t.multiple?Array.isArray(t.modelValue)&&t.modelValue.includes(e):t.modelValue===e,E=e=>b.value.includes(e),P=e=>{E(e)?b.value=b.value.filter(o=>o!==e):b.value.push(e)},B=e=>{const l=(e[t.childrenKey]||[]).map(a=>a[t.valueKey]);return l.length>0&&l.every(a=>t.modelValue.includes(a))},M=(e,o)=>{const a=(e[t.childrenKey]||[]).map(I=>I[t.valueKey]);let w=[...t.modelValue];o?a.forEach(I=>{w.includes(I)||w.push(I)}):w=w.filter(I=>!a.includes(I)),A("update:modelValue",w)},r=(e,o)=>{if(t.multiple){let l=Array.isArray(t.modelValue)?[...t.modelValue]:[];o?l.includes(e)||l.push(e):l=l.filter(a=>a!==e),A("update:modelValue",l)}else A("update:modelValue",e),f.value=!1},c=()=>{if(g.value){const e=g.value.getBoundingClientRect();let o={};if(K.value===".phone-frame"){const l=document.querySelector(".phone-frame");if(l){const a=l.getBoundingClientRect();o={position:"absolute",top:`${e.bottom-a.top+4}px`},t.textAlign==="right"?o.right=`${a.right-e.right}px`:o.left=`${e.left-a.left}px`}}else o={position:"fixed",top:`${e.bottom+4}px`},t.textAlign==="right"?o.right=`${window.innerWidth-e.right}px`:o.left=`${e.left}px`;V.value={...o,minWidth:t.dropdownWidth==="auto"?`${e.width}px`:"none",width:t.dropdownWidth,zIndex:9999}}},i=async()=>{if(f.value)f.value=!1;else{const e=document.querySelector(".phone-frame");K.value=e?".phone-frame":"body",f.value=!0,await Z(),c()}},m=e=>{const o=g.value&&g.value.contains(e.target),l=e.target.closest(".custom-options");!o&&!l&&(f.value=!1)};return R(()=>{document.addEventListener("click",m,!0),window.addEventListener("scroll",c,!0),window.addEventListener("resize",c)}),F(()=>{document.removeEventListener("click",m,!0),window.removeEventListener("scroll",c,!0),window.removeEventListener("resize",c)}),(e,o)=>(u(),h("div",{class:"multi-select-wrapper",ref_key:"selectWrapper",ref:g,style:T({width:s.selectorWidth})},[n("div",{class:x(["custom-select-trigger",`text-${s.textAlign}`]),onClick:i},[n("span",null,v(O.value),1),n("div",{class:x(["arrow-icon",{open:f.value}])},[...o[1]||(o[1]=[n("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"3","stroke-linecap":"round","stroke-linejoin":"round"},[n("polyline",{points:"9 18 15 12 9 6"})],-1)])],2)],2),(u(),N(H,{to:K.value},[y(j,{name:"slide-fade"},{default:S(()=>[f.value?(u(),h("div",{key:0,class:"custom-options",style:T(V.value)},[D.value?(u(!0),h(z,{key:0},L(s.options,l=>(u(),h("div",{key:l[s.valueKey],class:"group-item"},[n("div",{class:"group-header",onClick:a=>P(l[s.valueKey])},[s.multiple?(u(),h("input",{key:0,type:"checkbox",checked:B(l),onChange:a=>M(l,a.target.checked),onClick:o[0]||(o[0]=q(()=>{},["stop"]))},null,40,le)):k("",!0),n("span",ne,v(l[s.labelKey]),1),(u(),h("svg",{class:x(["collapse-arrow",{collapsed:!E(l[s.valueKey])}]),xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"3","stroke-linecap":"round","stroke-linejoin":"round"},[...o[2]||(o[2]=[n("polyline",{points:"6 9 12 15 18 9"},null,-1)])],2))],8,te),E(l[s.valueKey])?(u(),h("div",oe,[(u(!0),h(z,null,L(l[s.childrenKey],a=>(u(),h("div",{key:a[s.valueKey],class:x(["option-item",{"is-selected":$(a[s.valueKey]),clickable:!s.multiple}]),onClick:w=>!s.multiple&&r(a[s.valueKey])},[s.multiple?(u(),h("input",{key:0,type:"checkbox",checked:$(a[s.valueKey]),onChange:w=>r(a[s.valueKey],w.target.checked)},null,40,ae)):k("",!0),n("span",null,v(a[s.labelKey]),1)],10,se))),128))])):k("",!0)]))),128)):(u(!0),h(z,{key:1},L(s.options,l=>(u(),h("div",{key:l[s.valueKey],class:x(["option-item flat-option",{"is-selected":$(l[s.valueKey]),clickable:!s.multiple}]),onClick:a=>!s.multiple&&r(l[s.valueKey])},[s.multiple?(u(),h("input",{key:0,type:"checkbox",checked:$(l[s.valueKey]),onChange:a=>r(l[s.valueKey],a.target.checked)},null,40,re)):k("",!0),n("span",null,v(l[s.labelKey]),1)],10,ie))),128))],4)):k("",!0)]),_:1})],8,["to"]))],4))}},de=G(ce,[["__scopeId","data-v-1ef86f36"]]),ue={class:"card"},pe={class:"card-header"},he={class:"book-drag-handle icon-btn"},me=["value","onInput","placeholder"],ye={class:"header-controls"},ve=["onClick"],fe={key:0,class:"card-content"},ge={class:"content-controls"},ke={class:"priority-selector"},be={class:"card-actions"},we=["onClick"],Ce=["onClick"],xe={class:"entry-header"},Ve={class:"entry-drag-handle icon-btn"},Ke=["value","onInput","placeholder"],$e={class:"entry-controls"},Se=["onClick"],_e=["onClick"],Ee={key:0,class:"entry-content"},Pe=["value","onInput","placeholder"],Ie=["value","onInput","placeholder"],Ae={key:0,class:"empty-state"},De={style:{"text-align":"center","padding-bottom":"25px"}},We={__name:"Preset",setup(s){const{t:d}=J(),t=Q(),{sortedPresets:A}=X(t),f=W(()=>[{value:"1",label:d("preset.priorityOptions.high")},{value:"2",label:d("preset.priorityOptions.medium")},{value:"3",label:d("preset.priorityOptions.low")}]),b=r=>{switch(String(r)){case"1":return{label:d("preset.priorityOptions.high"),color:"red"};case"2":return{label:d("preset.priorityOptions.medium"),color:"blue"};case"3":return{label:d("preset.priorityOptions.low"),color:"green"};default:return{label:"",color:""}}},g=W({get:()=>A.value,set:r=>{}}),V=_(!1),K=_({type:null,presetIndex:null,entryIndex:null}),D=(r,c,i=null)=>{K.value={type:r,presetIndex:c,entryIndex:i},V.value=!0},O=()=>{const{type:r,presetIndex:c,entryIndex:i}=K.value;r==="preset"?t.deletePreset(c):r==="entry"&&t.deleteEntry(c,i),$()},$=()=>{V.value=!1,K.value={type:null,presetIndex:null,entryIndex:null}},E=(r,c)=>{t.updatePreset(r,c)},P=(r,c,i)=>{t.updateEntry(r,c,i)},B=(r,c)=>{t.reorderEntries(r,{oldIndex:c.oldIndex,newIndex:c.newIndex})},M=r=>{t.onPresetDragEnd({oldIndex:r.oldIndex,newIndex:r.newIndex})};return(r,c)=>(u(),N(Y,{title:p(d)("preset.title")},{action:S(()=>[y(C,{name:"plus",onClick:p(t).addNewPreset,class:"header-action-icon"},null,8,["onClick"])]),default:S(()=>[y(p(U),{modelValue:g.value,"onUpdate:modelValue":c[0]||(c[0]=i=>g.value=i),"item-key":"id",handle:".book-drag-handle",onEnd:M},{item:S(({element:i,index:m})=>[n("div",ue,[n("div",pe,[n("button",he,[y(C,{name:"drag-handle"})]),b(i.priority).label?(u(),h("span",{key:0,style:T({color:b(i.priority).color,marginRight:"8px",fontWeight:"bold",fontSize:"1.2em"})},v(b(i.priority).label),5)):k("",!0),n("input",{type:"text",value:i.title,onInput:e=>E(m,{title:e.target.value}),placeholder:p(d)("preset.titlePlaceholder"),class:"book-title-input"},null,40,me),n("div",ye,[n("button",{onClick:e=>E(m,{collapsed:!i.collapsed}),class:"collapse-btn icon-btn"},[y(C,{name:"chevron-down",class:x(["collapse-arrow",{collapsed:i.collapsed}])},null,8,["class"])],8,ve)])]),i.collapsed?k("",!0):(u(),h("div",fe,[n("div",ge,[n("div",ke,[n("span",null,v(p(d)("preset.priority")),1),y(de,{class:"priority-custom-select",modelValue:String(i.priority),"onUpdate:modelValue":e=>p(t).setPriority(m,e),options:f.value,multiple:!1,labelKey:"label",valueKey:"value",textAlign:"center",selectorWidth:"70px"},null,8,["modelValue","onUpdate:modelValue","options"])]),n("div",be,[n("button",{onClick:e=>p(t).addNewEntry(m),class:"add-entry-btn icon-btn"},[y(C,{name:"plus"})],8,we),n("button",{onClick:e=>D("preset",m),class:"delete-btn icon-btn"},[y(C,{name:"trash"})],8,Ce)])]),y(p(U),{modelValue:i.entries,"onUpdate:modelValue":e=>i.entries=e,"item-key":"id",handle:".entry-drag-handle",onEnd:e=>B(m,e)},{item:S(({element:e,index:o})=>[n("div",{class:x(["entry-item",{disabled:!i.enabled}])},[n("div",xe,[n("button",Ve,[y(C,{name:"drag-handle"})]),n("input",{type:"text",value:e.title,onInput:l=>P(m,o,{title:l.target.value}),placeholder:p(d)("preset.entryTitlePlaceholder"),class:"entry-title-input"},null,40,Ke),n("div",$e,[n("button",{onClick:l=>D("entry",m,o),class:"delete-btn icon-btn"},[y(C,{name:"trash"})],8,Se),n("button",{onClick:l=>P(m,o,{collapsed:!e.collapsed}),class:"collapse-btn icon-btn"},[y(C,{name:"chevron-down",class:x(["collapse-arrow",{collapsed:e.collapsed}])},null,8,["class"])],8,_e)])]),e.collapsed?k("",!0):(u(),h("div",Ee,[n("input",{type:"text",value:e.notes,onInput:l=>P(m,o,{notes:l.target.value}),placeholder:p(d)("preset.notesPlaceholder"),class:"base-input"},null,40,Pe),n("textarea",{value:e.content,onInput:l=>P(m,o,{content:l.target.value}),placeholder:p(d)("preset.contentPlaceholder"),class:"base-input"},null,40,Ie)]))],2)]),_:2},1032,["modelValue","onUpdate:modelValue","onEnd"])]))])]),_:1},8,["modelValue"]),g.value.length?k("",!0):(u(),h("div",Ae,[n("p",null,v(p(d)("preset.empty")),1),n("p",null,v(p(d)("preset.emptyHint")),1)])),y(ee,{visible:V.value,"onUpdate:visible":c[1]||(c[1]=i=>V.value=i),title:p(d)("preset.confirmDelete")},{footer:S(()=>[n("button",{onClick:$,class:"modal-btn cancel"},v(p(d)("cancel")),1),n("button",{onClick:O,class:"modal-btn danger"},v(p(d)("delete")),1)]),default:S(()=>[n("div",De,v(p(d)("preset.confirmDeleteMsg")),1)]),_:1},8,["visible","title"])]),_:1},8,["title"]))}},Me=G(We,[["__scopeId","data-v-e0e315c9"]]);export{Me as default};
