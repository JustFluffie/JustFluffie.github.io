import{_ as W,m as q,q as J,u as K,s as O,r as c,x as Q,y as X,d,e as s,g as T,z as Y,w as V,A as $,B as n,t as l,F as Z,C as tt,i as m,M as b,j as et,o as u,D as g,n as at,E as st,f as ot,G as nt}from"./index-Dj1Fr4-t.js";import{C as lt}from"./ChatBottomNav-DopBuxRk.js";const it={class:"chat-page active"},rt={class:"chat-top-note"},ct=["placeholder"],dt={class:"chat-list"},ut={key:0,class:"empty-state"},pt={class:"empty-text"},ht={class:"empty-text",style:{"font-size":"12px"}},vt=["onMousedown","onMouseup","onTouchstart","onTouchend"],mt=["src"],ft={key:1,class:"default-avatar-text"},_t={class:"chat-info"},Ct={class:"chat-name"},gt={class:"chat-preview"},yt={class:"chat-meta"},wt={class:"chat-time"},Tt={key:0,class:"chat-unread-badge"},kt={class:"modal-options centered-text"},xt={class:"option-text"},bt={class:"option-text",style:{color:"inherit"}},Mt={class:"modal-options centered-text"},St={class:"option-text"},Nt={class:"option-text"},Pt=["placeholder"],Bt={__name:"ChatList",setup(Lt,{expose:A}){const{t:a}=q(),M=et(),f=J(),S=K(),i=O(),y=c(""),p=c(!1),_=c(!1),w=c(""),N=c(null),h=c(!1),v=c(null);let k=null,x=!0;Q(()=>{y.value=f.topNote}),X(_,o=>{o&&nt(()=>{var t;(t=N.value)==null||t.focus()})}),A({openAddModal:()=>{p.value=!0}});const z=()=>{f.saveTopNote(y.value)},D=o=>{const t=o.lastMessage;return t?t.type==="text"?t.content:t.type==="voice"?a("chat.messageTypes.voice"):t.type==="image"?a("chat.messageTypes.image"):t.type==="sticker"?a("chat.messageTypes.sticker"):t.type==="location"?a("chat.messageTypes.location"):t.type==="transfer"?a("chat.messageTypes.transfer"):t.type==="call_summary"?t.content:a("chat.messageTypes.unknown"):a("chat.start")},F=o=>{const t=o.lastMessage;if(!t)return"";const C=t.timestamp||t.time;if(!C)return"";const e=new Date(C);if(isNaN(e.getTime()))return"";const r=e.getHours().toString().padStart(2,"0"),R=e.getMinutes().toString().padStart(2,"0");return`${r}:${R}`},I=o=>{if(!o||!o.id){console.error("Attempted to open chat room with invalid session:",o),i.showToast(a("chat.toast.openChatFailed"),"error");return}o.type==="single"?M.push({name:"single-chat",params:{id:o.id}}):o.type==="group"&&i.showToast(a("chat.toast.groupChatWip"),"info")},U=()=>{p.value=!1,i.showToast(a("chat.toast.groupChatWip"),"info")},P=()=>{_.value=!1,w.value=""},E=()=>{const o=w.value.trim();if(!o){i.showToast(a("chat.enterCharacterName"),"info");return}const t=S.addCharacter(o);P(),M.push({name:"single-chat",params:{id:t}})},B=(o,t)=>{t.type==="mousedown"&&t.button!==0||(x=!0,k=setTimeout(()=>{x=!1,v.value=o,h.value=!0},800))},G=()=>{v.value&&(f.togglePin(v.value.id),h.value=!1)},j=()=>{h.value=!1;const o=v.value;o&&i.showConfirm(a("chat.deleteCharacterTitle"),a("chat.deleteCharacterConfirm",{name:o.name}),()=>{o.type==="single"?(S.deleteCharacter(o.id),i.showToast(a("chat.toast.deleteSuccess"),"success")):i.showToast("群组删除功能暂未开放","info")},{messageStyle:{whiteSpace:"pre-wrap",color:"#FF3B30"},confirmText:"delete"})},L=o=>{clearTimeout(k),x&&I(o)},H=()=>{clearTimeout(k)};return(o,t)=>{var C;return u(),d("div",it,[s("div",rt,[t[8]||(t[8]=Y('<div class="chat-top-note-icon" data-v-319f6636><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" data-v-319f6636><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z" data-v-319f6636></path><polyline points="3.27 6.96 12 12.01 20.73 6.96" data-v-319f6636></polyline><line x1="12" y1="22.08" x2="12" y2="12" data-v-319f6636></line></svg></div>',1)),V(s("input",{type:"text",class:"chat-top-note-input",placeholder:n(a)("chat.topNotePlaceholder"),"onUpdate:modelValue":t[0]||(t[0]=e=>y.value=e),onBlur:z},null,40,ct),[[$,y.value]])]),s("div",dt,[n(f).sessionList.length===0?(u(),d("div",ut,[s("div",pt,l(n(a)("chat.empty")),1),s("div",ht,l(n(a)("chat.emptyHint")),1)])):(u(!0),d(Z,{key:1},tt(n(f).sessionList,e=>(u(),d("div",{key:e.id,class:at(["chat-list-item",{pinned:e.isPinned}]),onMousedown:g(r=>B(e,r),["prevent"]),onMouseup:g(r=>L(e),["prevent"]),onMouseleave:g(H,["prevent"]),onTouchstart:g(r=>B(e,r),["prevent"]),onTouchend:g(r=>L(e),["prevent"])},[s("div",{class:"chat-avatar",style:st(e.avatar?"background: transparent;":"")},[e.avatar?(u(),d("img",{key:0,src:e.avatar,alt:""},null,8,mt)):(u(),d("span",ft,l(e.name[0]||"?"),1))],4),s("div",_t,[s("div",Ct,l(e.name),1),s("div",gt,l(D(e)),1)]),s("div",yt,[s("div",wt,l(F(e)),1),e.unreadCount>0?(u(),d("div",Tt,l(e.unreadCount),1)):ot("",!0)])],42,vt))),128))]),T(lt),T(b,{visible:h.value,"onUpdate:visible":t[2]||(t[2]=e=>h.value=e),title:(C=v.value)==null?void 0:C.name},{footer:m(()=>[s("button",{class:"modal-btn cancel",onClick:t[1]||(t[1]=e=>h.value=!1)},l(n(a)("cancel")),1)]),default:m(()=>{var e;return[s("div",kt,[s("div",{class:"modal-option",onClick:G},[s("span",xt,l((e=v.value)!=null&&e.isPinned?n(a)("chat.unpin"):n(a)("chat.pin")),1)]),s("div",{class:"modal-option btn-danger",onClick:j},[s("span",bt,l(n(a)("delete")),1)])])]}),_:1},8,["visible","title"]),T(b,{visible:p.value,"onUpdate:visible":t[5]||(t[5]=e=>p.value=e),title:n(a)("chat.newConversation")},{footer:m(()=>[s("button",{class:"modal-btn cancel",onClick:t[4]||(t[4]=e=>p.value=!1)},l(n(a)("cancel")),1)]),default:m(()=>[s("div",Mt,[s("div",{class:"modal-option",onClick:t[3]||(t[3]=e=>{_.value=!0,p.value=!1})},[s("span",St,l(n(a)("chat.createCharacter")),1)]),s("div",{class:"modal-option",onClick:U},[s("span",Nt,l(n(a)("chat.createGroup")),1)])])]),_:1},8,["visible","title"]),T(b,{visible:_.value,"onUpdate:visible":t[7]||(t[7]=e=>_.value=e),title:n(a)("chat.createCharacter")},{footer:m(()=>[s("button",{class:"modal-btn cancel",onClick:P},l(n(a)("cancel")),1),s("button",{class:"modal-btn confirm",onClick:E},l(n(a)("create")),1)]),default:m(()=>[V(s("input",{type:"text",class:"base-input","onUpdate:modelValue":t[6]||(t[6]=e=>w.value=e),placeholder:n(a)("chat.characterNamePlaceholder"),ref_key:"newCharInput",ref:N},null,8,Pt),[[$,w.value]])]),_:1},8,["visible","title"])])}}},At=W(Bt,[["__scopeId","data-v-319f6636"]]);export{At as default};
