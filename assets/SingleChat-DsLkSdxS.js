import{u as ee,z as de,r as C,G as se,H as nt,I as ot,a as at,J as we,L as lt,b as it,j as be,_ as G,x as ae,A as fe,d as S,o as b,k as _,f as U,g as F,e,T as me,t as $,q as w,i as Q,w as K,C as te,M as ue,c as E,F as Y,m as re,n as H,v as ke,E as ce,N as Ce,s as Te,B as W,S as ie,O as xe,D as Z,P as rt,Q as ct,R as dt,U as oe,V as ut,W as vt,X as gt,Y as ge,Z as mt}from"./index-uGEQI7W6.js";function ft(t){const k=ee(),s=de(),n=C(!1),r=C(new Set),m=C(!1),u=(o,g)=>{console.log("[useMessageSelection] enterSelectionMode triggered");let p=0,v=0;const l=document.querySelector(".message-list");g&&l&&(p=l.scrollTop,v=g.getBoundingClientRect().top),n.value=!0,r.value.clear(),o&&r.value.add(o),g&&l&&se(()=>{const i=document.querySelector(".selection-bar"),T=i?i.offsetHeight:0,B=g.getBoundingClientRect().top-v;l.scrollTop=p+B-T})},a=()=>{console.log("[useMessageSelection] exitSelectionMode triggered"),n.value=!1,r.value.clear()};return{isSelectionMode:n,selectedMessageIds:r,isForwarding:m,enterSelectionMode:u,exitSelectionMode:a,toggleMessageSelection:o=>{console.log(`[useMessageSelection] toggleMessageSelection for msgId: ${o}`),r.value.has(o)?r.value.delete(o):r.value.add(o)},handleBatchAction:o=>{if(console.log(`[useMessageSelection] handleBatchAction: ${o}`),r.value.size===0)return;const g=k.messages[t.value];if(o==="forward")m.value=!0;else if(o==="delete")s.showConfirm("删除消息","确定删除选中的消息吗？",()=>{console.log("[useMessageSelection] Deleting selected messages"),k.messages[t.value]=g.filter(p=>!r.value.has(p.id)),k.saveData(),a()});else if(o==="favorite"){const p=g.filter(v=>r.value.has(v.id));p.length>0&&(k.addToFavorites(t.value,p),s.showToast("已收藏","success")),a()}},handleConfirmForward:o=>{console.log("[useMessageSelection] handleConfirmForward triggered"),m.value=!1;const p=(k.messages[t.value]||[]).filter(v=>r.value.has(v.id));p.length!==0&&(o.forEach(v=>{k.messages[v]||(k.messages[v]=[]),p.forEach(l=>{const i={...l,id:Date.now().toString()+Math.random()};k.messages[v].push(i)})}),k.saveData(),s.showToast(`已转发 ${p.length} 条消息`),a())}}}const pt=(t,k,s)=>{const n=k.map(m=>`${m.role==="user"?"用户":t.name}: ${m.content}`).join(`
`),r=s.toString().padStart(2,"0");return`
你正在扮演角色“${t.name}”，你需要根据以下设定和最近的对话，生成一段角色的实时“心声”。
心声由多个部分组成，请严格按照下面的JSON格式返回，不要添加任何额外的解释或文字。

**角色人设:**
${t.charPersona}

**最近对话:**
${n}

**你的任务:**
生成符合当前情境和角色性格的内心活动。
- **情绪 (emotion)**: 描述角色当前的主要情绪，应在一定时间内保持稳定，5字以内。
- **穿着 (outfit)**: 描述角色当前的穿着，应在一定时间内保持稳定，10字以内。
- **姿态 (posture)**: 描述角色当前的姿态或小动作，应在一定时间内保持稳定，15字以内。
- **内心独白 (innerVoice)**: 角色此刻具体的内心想法，50字以内。
- **没说出口的话 (unspokenWords)**: 一句角色想说但没说出口的话，风格可以多变（如阴暗、腹黑、酸涩、色情等），必须符合人设，15字以内。
- **标题 (title)**: 为这次心声生成一个简短的小标题，格式固定为“#${r} 标题内容”，例如“#${r} 初次见面”。

**输出格式 (必须是可被解析的JSON):**
{
  "emotion": "...",
  "outfit": "...",
  "posture": "...",
  "innerVoice": "...",
  "unspokenWords": "...",
  "title": "#${r} ..."
}
`};function ht(t,k){const s=ee(),n=nt(),r=ot(),m=at(),u=be(),a=it(),c=C(!1),d=async()=>{console.log("[useAiResponder] triggerAiResponse triggered"),c.value=!0;try{const o=s.getCharacter(t.value),g=s.getPendingUserTransfers(t.value);console.log("[useAiResponder] Pending transfers to accept:",g.length);let p=await k.getChatCompletion(t.value);if(console.log("[useAiResponder] AI Response:",p),p){const v=/\[撤回\]/g;if(v.test(p)){const R=s.messages[t.value]||[];for(let j=R.length-1;j>=0;j--){const L=R[j];if(L.sender==="char"&&!L.isRevoked){s.revokeMessage(t.value,L.id),console.log(`[useAiResponder] Revoked message: ${L.id}`);break}}p=p.replace(v,"").trim()}const l=/\[互动朋友圈：(.+?)\]/g;let i;for(;(i=l.exec(p))!==null;)try{const R=JSON.parse(i[1]),{action:j,response:L}=R,q=m.moments.filter(V=>V.userId==="user");if(q.length>0){const V=q[0];j==="like"?(m.likeMoment(V.id,t.value),console.log(`[useAiResponder] Liked user's latest moment: ${V.id}`)):j==="comment"&&L&&(m.likeMoment(V.id,t.value),m.addComment(V.id,{userId:t.value,content:L,time:Date.now()}),console.log(`[useAiResponder] Commented on user's latest moment: ${V.id}`))}}catch(R){console.error("[useAiResponder] Failed to parse moment interaction data:",R)}p=p.replace(l,"").trim();const T=/\[朋友圈：(.+?)\]/g;let P;for(;(P=T.exec(p))!==null;)try{const R=JSON.parse(P[1]),{text:j,imageDescription:L}=R,q=[];L&&q.push({content:L,isTextGenerated:!0}),(j||q.length>0)&&(m.addMoment({userId:t.value,content:j||"",images:q,time:Date.now()}),console.log(`[useAiResponder] Added new moment for ${t.value}`))}catch(R){console.error("[useAiResponder] Failed to parse moment data from AI response:",R)}p=p.replace(T,"").trim();const B=/\[待办：(?:((?:\d{4}-\d{2}-\d{2}\s)?\d{1,2}:\d{2}|\d{4}-\d{2}-\d{2})\s)?(.+?)\]/g;let D;for(;(D=B.exec(p))!==null;){const R=D[1],j=D[2].trim();let L=new Date,q="";if(R)if(R.includes("-"))if(R.includes(":")){const[V,X]=R.split(/\s+/);L=new Date(V),q=X}else L=new Date(R),q="";else q=R;else{const V=new Date,X=[15,30,60],J=X[Math.floor(Math.random()*X.length)];V.setMinutes(V.getMinutes()+J);const ne=V.getHours().toString().padStart(2,"0"),le=V.getMinutes().toString().padStart(2,"0");q=`${ne}:${le}`}if(j){let V=j;V.length>18&&(V=V.substring(0,18)+"..."),r.addEvent({type:"todo",title:V,content:V,date:we(L,{representation:"date"}),done:!1,time:q}),console.log(`[useAiResponder] Added new todo: "${V}" at ${q} on ${we(L,{representation:"date"})}`)}}if(p=p.replace(B,"").trim(),!p){c.value=!1,y();return}s.messages[t.value]||(s.messages[t.value]=[]);const O=(o==null?void 0:o.isBlocked)||!1,A=/(?:\||\\\||｜)\s*(?:\||\\\||｜)\s*(?:\||\\\||｜)+/g;let h=p.replace(A,"|||").split("|||"),x=[];const z=/(\[(?:图片|表情包|语音|位置|转账)：.+?\])/g;h.forEach(R=>{const j=R.split(z).map(L=>L.trim()).filter(L=>L);x.push(...j)});for(let R=0;R<x.length;R++){const j=x[R];R>0&&await new Promise(J=>setTimeout(J,1e3+Math.random()*1e3));let{type:L,content:q}=lt(j),V={};if(L==="transfer_accepted"){await new Promise(J=>setTimeout(J,800+Math.random()*500)),s.autoAcceptPendingTransfers(t.value),console.log("[useAiResponder] Transfer acceptance message processed.");continue}if(L==="sticker"){const J=q,ne=s.stickers.find(le=>le.name===J);ne?(q=ne.url,V.name=J):(L="text",q=`[表情包：${J}]`)}let X=!1;L==="image"&&!q.startsWith("http")&&!q.startsWith("data:")&&(X=!0),s.addMessage(t.value,{id:Date.now().toString()+R,sender:"char",type:L,content:q,isTextGenerated:X,...V,time:Date.now(),blocked:O}),a.path!==`/chat/room/${t.value}`&&(s.incrementUnreadCount(t.value),n.triggerNotification(o.nickname||o.name,L==="text"?q:`[${L}]`,o.avatar,()=>{u.push(`/chat/room/${t.value}`)},3e3,L))}g.length>0&&s.getPendingUserTransfers(t.value).length>0&&(await new Promise(R=>setTimeout(R,800+Math.random()*500)),s.autoAcceptPendingTransfers(t.value),console.log("[useAiResponder] Fallback transfer acceptance executed at the end"))}}catch(o){console.error("[useAiResponder] triggerAiResponse failed:",o)}finally{c.value=!1,y()}},y=async()=>{try{const o=s.getCharacter(t.value);if(!o)return;const g=s.innerVoices[t.value]||[];let p=1;if(g.length>0){const T=g[0].title;if(T){const P=T.match(/#(\d+)/);P?p=parseInt(P[1],10)+1:p=g.length+1}else p=g.length+1}const v=s.getFormattedRecentMessages(t.value,10),l=pt(o,v,p),i=await k.getGenericCompletion([{role:"user",content:l}]);if(i){const T=i.indexOf("{"),P=i.lastIndexOf("}");if(T!==-1&&P!==-1){const B=i.substring(T,P+1),D=JSON.parse(B);s.addInnerVoice(t.value,D),console.log("[useAiResponder] Inner voice generated and saved:",D)}else console.warn("[useAiResponder] Failed to find JSON in inner voice response.")}}catch(o){console.error("[useAiResponder] Failed to generate inner voice:",o)}};return{isTyping:c,triggerAiResponse:d}}function kt(t,k,s){const n=C(null);return{editingMessageId:n,handleEditMessage:a=>{console.log("[useMessageEditing] handleEditMessage for msgId:",a),n.value=a},handleSaveEdit:({msgId:a,newContent:c})=>{console.log("[useMessageEditing] handleSaveEdit for msgId:",a);const y=t.messages[k.value].find(o=>o.id===a);y&&(y.content=c,t.saveData()),n.value=null},updateInputText:a=>{console.log("[useMessageEditing] updateInputText called"),s&&(s.value=a,se(()=>{const c=document.querySelector(".chat-input");c&&c.focus()}))}}}function bt(t,k,s,n,r={}){const m=C(""),u=C(null),a=(v,l,i={})=>{console.log(`[useMessageSender] sendMsg called with type: ${v}`);const T={...i};u.value&&(T.quote={id:u.value.id,sender:u.value.sender,content:u.value.content}),t.addMessage(k.value,{id:Date.now().toString()+Math.random(),sender:"user",type:v,content:l,timestamp:Date.now(),...T}),n&&(n.value=null),u.value=null};return{inputText:m,quotingMessage:u,sendMessage:()=>{console.log("[useMessageSender] sendMessage triggered");const v=m.value.trim();v&&(a("text",v),m.value="")},sendMsg:a,sendSticker:v=>{console.log("[useMessageSender] sendSticker triggered"),a("sticker",v.url,{name:v.name})},sendVoiceMessage:v=>{console.log("[useMessageSender] sendVoiceMessage triggered"),v&&a("voice",v)},handleSendImage:v=>{console.log("[useMessageSender] handleSendImage triggered"),v.isTextGenerated?a("image",v.description,{isTextGenerated:!0}):(v.type==="base64"||v.type==="url")&&a("image",v.content)},confirmSendLocation:(v,l)=>{if(console.log("[useMessageSender] confirmSendLocation triggered"),!v){s.showToast("请输入位置名称","info");return}a("location",v,{detail:l})},sendTransfer:(v,l)=>{console.log("[useMessageSender] sendTransfer triggered",v,l),a("transfer",v,{note:l,status:"pending"})}}}function yt(t){const k=C(null),s=C(!1),n=C({x:0,y:0}),r=(d,y)=>{console.log("[useMessageInteraction] showMenu triggered"),d.preventDefault();const o=d.target.closest(".msg-bubble, .system-message-wrapper");o&&(t.value={visible:!0,messageId:y,targetEl:o})};return{startLongPress:(d,y)=>{console.log("[useMessageInteraction] startLongPress triggered"),d.stopPropagation(),s.value=!1,clearTimeout(k.value),d.type.startsWith("touch")&&(n.value={x:d.touches[0].clientX,y:d.touches[0].clientY}),k.value=setTimeout(()=>{s.value=!0,r(d,y)},400)},cancelLongPress:()=>{console.log("[useMessageInteraction] cancelLongPress triggered"),clearTimeout(k.value)},handleTouchMove:d=>{console.log("[useMessageInteraction] handleTouchMove triggered");const y=d.touches[0],o=Math.abs(y.clientX-n.value.x),g=Math.abs(y.clientY-n.value.y);(o>10||g>10)&&clearTimeout(k.value)},wasClickAfterLongPress:()=>s.value?(s.value=!1,!0):!1}}const St={class:"header-title-area"},$t={key:0,class:"chat-room-title"},Mt={key:1,class:"typing-indicator"},wt={class:"right-icons-group"},Ct={style:{display:"flex",gap:"10px","margin-bottom":"10px"}},Tt=["placeholder"],xt=["placeholder"],It={__name:"SingleChatHeader",props:{charId:{type:String,required:!0},charName:{type:String,default:""},charStatus:{type:Object,default:()=>({})},isTyping:{type:Boolean,default:!1}},emits:["trigger-ai","open-settings"],setup(t,{emit:k}){const s=t,{t:n}=ae(),r=be(),m=ee(),u=de(),a=C(!1),c=C(""),d=C(""),y=C(!1);fe(()=>{y.value=!0});const o=()=>{const v=s.charStatus||{};c.value=v.icon||"✨",d.value=v.text||"",a.value=!0},g=()=>{const v=c.value.trim()||"✨",l=d.value.trim(),i=m.getCharacter(s.charId);i&&(l?i.status={icon:v,text:l}:i.status=null,m.saveData(),u.showToast(n("saveSuccess"))),a.value=!1},p=()=>{r.push({name:"memory-bank",params:{charId:s.charId}})};return(v,l)=>(b(),S("div",null,[y.value?(b(),_(me,{key:0,to:"#chatRoomLeftArea"},[e("div",{class:"btn-icon bell-btn",onClick:l[0]||(l[0]=i=>v.$emit("trigger-ai")),ref:"bellBtn"},[...l[6]||(l[6]=[e("svg",{class:"svg-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"}),e("path",{d:"M13.73 21a2 2 0 0 1-3.46 0"})],-1)])],512)])):U("",!0),y.value?(b(),_(me,{key:1,to:"#chatRoomTitleArea"},[e("div",St,[t.isTyping?(b(),S("div",Mt,[e("span",null,$(w(n)("chat.singleChat.typing")),1),l[7]||(l[7]=e("span",{class:"dots"},[e("span",null,"."),e("span",null,"."),e("span",null,".")],-1))])):(b(),S("div",$t,$(t.charName),1))]),e("div",{class:"chat-room-status",onClick:o},[e("span",null,$(t.charStatus.icon||"✨"),1),e("span",null,$(t.charStatus.text||w(n)("chat.singleChat.addStatus")),1)])])):U("",!0),y.value?(b(),_(me,{key:2,to:"#chatRoomActionArea"},[e("div",wt,[e("div",{class:"btn-icon memory-btn",onClick:p},[...l[8]||(l[8]=[e("svg",{class:"svg-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"}),e("polyline",{points:"14 2 14 8 20 8"}),e("line",{x1:"16",y1:"13",x2:"8",y2:"13"}),e("line",{x1:"16",y1:"17",x2:"8",y2:"17"}),e("polyline",{points:"10 9 9 9 8 9"})],-1)])]),e("div",{class:"btn-icon more-btn",onClick:l[1]||(l[1]=i=>v.$emit("open-settings"))},[...l[9]||(l[9]=[e("svg",{class:"svg-icon",viewBox:"0 0 24 24"},[e("circle",{cx:"12",cy:"12",r:"1"}),e("circle",{cx:"19",cy:"12",r:"1"}),e("circle",{cx:"5",cy:"12",r:"1"})],-1)])])])])):U("",!0),F(ue,{visible:a.value,"onUpdate:visible":l[5]||(l[5]=i=>a.value=i),title:w(n)("chat.singleChat.setStatus")},{footer:Q(()=>[e("button",{class:"modal-btn cancel",onClick:l[4]||(l[4]=i=>a.value=!1)},$(w(n)("cancel")),1),e("button",{class:"modal-btn confirm",onClick:g},$(w(n)("confirm")),1)]),default:Q(()=>[e("div",Ct,[K(e("input",{type:"text",class:"base-input","onUpdate:modelValue":l[2]||(l[2]=i=>c.value=i),placeholder:w(n)("chat.singleChat.statusIcon"),style:{width:"60px","text-align":"center"}},null,8,Tt),[[te,c.value]]),K(e("input",{type:"text",class:"base-input","onUpdate:modelValue":l[3]||(l[3]=i=>d.value=i),placeholder:w(n)("chat.singleChat.statusText"),style:{flex:"1"}},null,8,xt),[[te,d.value]])])]),_:1},8,["visible","title"])]))}},At=G(It,[["__scopeId","data-v-9265e8b0"]]),Pt={key:0,class:"chat-panel",id:"stickerPanel"},Rt={class:"sticker-panel-header"},Bt={class:"sticker-groups"},Lt=["onClick"],Vt={class:"sticker-panel-content"},Et=["onClick"],Dt=["src","alt"],Nt={class:"sticker-panel-footer"},qt={__name:"StickersPanel",props:{visible:Boolean},emits:["send-sticker","update:visible"],setup(t,{emit:k}){const s=k,n=ee(),r=de(),m=C("默认"),u=C(!1),a=C(new Set),c=C(!1),d=C(!1),y=C(""),o=E(()=>["默认",...new Set(n.stickers.map(f=>f.group).filter(Boolean).filter(f=>f!=="默认"))]),g=E(()=>n.stickers.filter(A=>A.group===m.value)),p=A=>{u.value?a.value.has(A.id)?a.value.delete(A.id):a.value.add(A.id):s("send-sticker",A)},v=({group:A,stickers:f})=>{const h=f.map(x=>({id:Date.now().toString()+Math.random().toString(36).substr(2,9),url:x.url,name:x.name,group:A}));n.stickers.push(...h),n.saveData(),r.showToast(`成功导入 ${h.length} 个表情包`,"success")},l=()=>{c.value=!0},i=()=>{a.value.size>0&&(d.value=!0)},T=()=>{u.value=!u.value,a.value.clear()},P=()=>{const A=g.value;A.every(h=>a.value.has(h.id))?A.forEach(h=>a.value.delete(h.id)):A.forEach(h=>a.value.add(h.id))},B=()=>{a.value.size!==0&&r.showConfirm("删除表情包","确定删除选中的表情包吗？",()=>{n.stickers=n.stickers.filter(A=>!a.value.has(A.id)),n.saveData(),a.value.clear()})},D=()=>{const A=y.value.trim();if(!A)return r.showToast("请输入目标分组","info");n.stickers.forEach(f=>{a.value.has(f.id)&&(f.group=A)}),n.saveData(),d.value=!1,y.value="",a.value.clear(),u.value=!1,m.value=A},O=()=>{if(a.value.size===0)return;const A=n.stickers.filter(z=>a.value.has(z.id)).map(z=>`${z.name} ${z.url}`).join(`
`),f=new Blob([A],{type:"text/plain"}),h=URL.createObjectURL(f),x=document.createElement("a");x.href=h,x.download=`stickers_export_${new Date().toISOString().slice(0,10)}.txt`,document.body.appendChild(x),x.click(),document.body.removeChild(x),URL.revokeObjectURL(h),a.value.clear(),u.value=!1};return(A,f)=>(b(),S("div",null,[t.visible?(b(),S("div",Pt,[e("div",Rt,[e("div",Bt,[(b(!0),S(Y,null,re(o.value,h=>(b(),S("div",{class:H(["sticker-group-tab",{active:m.value===h}]),key:h,onClick:x=>m.value=h},$(h),11,Lt))),128))])]),e("div",Vt,[(b(!0),S(Y,null,re(g.value,h=>(b(),S("div",{class:H(["sticker-item",{selected:a.value.has(h.id),"manage-mode":u.value}]),key:h.id,onClick:x=>p(h)},[e("img",{src:h.url,alt:h.name},null,8,Dt),e("span",null,$(h.name),1)],10,Et))),128))]),e("div",Nt,[K(e("div",{class:"sticker-add-btn",onClick:l},"＋",512),[[ke,!u.value]]),e("div",{class:"sticker-manage-btn",style:ce({color:u.value?"var(--danger-color)":"#576B95"}),onClick:T},$(u.value?"完成":"管理"),5)]),e("div",{class:H(["manage-bar",{active:u.value}])},[e("button",{class:"btn btn-secondary",onClick:l},"导入"),e("button",{class:"btn btn-secondary",onClick:P},"全选"),e("button",{class:"btn btn-secondary",onClick:i},"移动"),e("button",{class:"btn btn-secondary",onClick:O},"导出"),e("button",{class:"btn btn-danger",onClick:B},"删除")],2)])):U("",!0),F(Ce,{visible:c.value,"onUpdate:visible":f[0]||(f[0]=h=>c.value=h),type:"sticker-import",onImportSticker:v},null,8,["visible"]),F(ue,{visible:d.value,"onUpdate:visible":f[3]||(f[3]=h=>d.value=h),title:"移动到分组"},{footer:Q(()=>[e("button",{class:"modal-btn cancel",onClick:f[2]||(f[2]=h=>d.value=!1)},"取消"),e("button",{class:"modal-btn confirm",onClick:D},"确定")]),default:Q(()=>[K(e("input",{type:"text",class:"base-input","onUpdate:modelValue":f[1]||(f[1]=h=>y.value=h),placeholder:"输入目标分组名称"},null,512),[[te,y.value]])]),_:1},8,["visible"])]))}},Ut=G(qt,[["__scopeId","data-v-c6bef6fa"]]),Ft={class:"chat-panel",id:"morePanel"},zt={class:"more-panel-content"},jt={class:"more-label"},Ht={class:"more-label"},Ot={class:"more-label"},Wt={class:"more-label"},Gt={__name:"MorePanel",emits:["trigger-image-upload","start-video-call","send-location","send-transfer"],setup(t){const{t:k}=ae();return(s,n)=>(b(),S("div",Ft,[e("div",zt,[e("div",{class:"more-item",onClick:n[0]||(n[0]=r=>s.$emit("trigger-image-upload"))},[n[4]||(n[4]=Te('<div class="more-icon" data-v-d00cc944><svg class="svg-icon" viewBox="0 0 24 24" data-v-d00cc944><rect x="3" y="3" width="18" height="18" rx="2" ry="2" data-v-d00cc944></rect><circle cx="8.5" cy="8.5" r="1.5" data-v-d00cc944></circle><polyline points="21 15 16 10 5 21" data-v-d00cc944></polyline></svg></div>',1)),e("span",jt,$(w(k)("chat.morePanel.image")),1)]),e("div",{class:"more-item",onClick:n[1]||(n[1]=r=>s.$emit("start-video-call"))},[n[5]||(n[5]=e("div",{class:"more-icon"},[e("svg",{class:"svg-icon",viewBox:"0 0 24 24"},[e("polygon",{points:"23 7 16 12 23 17 23 7"}),e("rect",{x:"1",y:"5",width:"15",height:"14",rx:"2",ry:"2"})])],-1)),e("span",Ht,$(w(k)("chat.morePanel.videoCall")),1)]),e("div",{class:"more-item",onClick:n[2]||(n[2]=r=>s.$emit("send-location"))},[n[6]||(n[6]=e("div",{class:"more-icon"},[e("svg",{class:"svg-icon",viewBox:"0 0 24 24"},[e("path",{d:"M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"}),e("circle",{cx:"12",cy:"10",r:"3"})])],-1)),e("span",Ot,$(w(k)("chat.morePanel.location")),1)]),e("div",{class:"more-item",onClick:n[3]||(n[3]=r=>s.$emit("send-transfer"))},[n[7]||(n[7]=e("div",{class:"more-icon"},[e("svg",{class:"svg-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"M8 5 L4 9 H20 M16 19 L20 15 H4"})])],-1)),e("span",Wt,$(w(k)("chat.morePanel.transfer")),1)])])]))}},Jt=G(Gt,[["__scopeId","data-v-d00cc944"]]),Yt={class:"chat-footer"},Kt={key:0,class:"quote-preview"},Qt={class:"quote-content"},Xt={class:"quote-sender"},Zt={class:"quote-text"},_t={class:"chat-input-row"},es={class:"chat-input-wrapper"},ts=["value","onKeydown"],ss={class:"svg-icon",viewBox:"0 0 24 24",style:{stroke:"white",width:"24px",height:"24px",position:"relative",top:"1px",left:"-1px"}},ns={__name:"ChatInputBar",props:{modelValue:{type:String,default:""},activePanel:{type:String,default:null},quotingMessage:{type:Object,default:null},charId:{type:String,required:!0}},emits:["update:modelValue","update:activePanel","cancel-quote","send-message","send-sticker","trigger-voice","trigger-image","trigger-video","trigger-location","trigger-transfer"],setup(t,{emit:k}){const{t:s}=ae(),n=ee(),r=t,m=k,u=C(r.activePanel);W(()=>r.activePanel,o=>{u.value=o}),W(u,o=>{m("update:activePanel",o)});const a=E(()=>{if(!r.quotingMessage)return"";if(r.quotingMessage.sender==="user")return s("chat.self");{const o=n.getCharacter(r.charId);return(o==null?void 0:o.nickname)||(o==null?void 0:o.name)||s("chat.other")}}),c=o=>{u.value===o?u.value=null:u.value=o},d=()=>{r.modelValue.trim()&&m("send-message")},y=o=>{m("send-sticker",o),u.value=null};return(o,g)=>(b(),S("div",Yt,[t.quotingMessage?(b(),S("div",Kt,[e("div",Qt,[e("span",Xt,$(a.value)+": ",1),e("span",Zt,$(t.quotingMessage.content),1)]),e("div",{class:"quote-close",onClick:g[0]||(g[0]=p=>o.$emit("cancel-quote"))},[...g[9]||(g[9]=[e("div",{class:"quote-close-icon"},[e("svg",{viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12"},[e("path",{d:"M576 512l277.333333 277.333333-64 64-277.333333-277.333333L234.666667 853.333333 170.666667 789.333333l277.333333-277.333333L170.666667 234.666667 234.666667 170.666667l277.333333 277.333333L789.333333 170.666667 853.333333 234.666667 576 512z",fill:"currentColor"})])],-1)])])])):U("",!0),e("div",_t,[e("div",{class:"chat-tool-btn",onClick:g[1]||(g[1]=p=>o.$emit("trigger-voice"))},[F(ie,{name:"voice-circle",class:"svg-icon"})]),e("div",es,[e("textarea",{class:"chat-input",value:t.modelValue,onInput:g[2]||(g[2]=p=>o.$emit("update:modelValue",p.target.value)),onKeydown:xe(Z(d,["exact","prevent"]),["enter"]),id:"messageInput",autocomplete:"off",rows:"1"},null,40,ts)]),e("div",{class:"chat-tool-btn",onClick:g[3]||(g[3]=p=>c("sticker"))},[F(ie,{name:"sticker",class:"svg-icon"})]),t.modelValue?(b(),S("div",{key:1,class:"send-btn-icon",onClick:d},[(b(),S("svg",ss,[...g[10]||(g[10]=[e("line",{x1:"22",y1:"2",x2:"11",y2:"13"},null,-1),e("polygon",{points:"22 2 15 22 11 13 2 9 22 2"},null,-1)])]))])):(b(),S("div",{key:0,class:"chat-tool-btn",onClick:g[4]||(g[4]=p=>c("more"))},[F(ie,{name:"plus-circle",class:"svg-icon"})]))]),F(Ut,{visible:u.value==="sticker",onSendSticker:y},null,8,["visible"]),u.value==="more"?(b(),_(Jt,{key:1,onTriggerImageUpload:g[5]||(g[5]=p=>o.$emit("trigger-image")),onStartVideoCall:g[6]||(g[6]=p=>o.$emit("trigger-video")),onSendLocation:g[7]||(g[7]=p=>o.$emit("trigger-location")),onSendTransfer:g[8]||(g[8]=p=>o.$emit("trigger-transfer"))})):U("",!0)]))}},os=G(ns,[["__scopeId","data-v-3da6a910"]]),as={class:"menu-grid"},ls={__name:"MessageMenu",props:{visible:{type:Boolean,default:!1},targetEl:{type:Object,default:null},messageId:{type:String,default:null},charId:{type:String,required:!0}},emits:["close","enter-selection-mode","trigger-ai-response","quote-message","edit-message"],setup(t,{emit:k}){const s=t,n=k,r=rt("phoneScreenRef"),{t:m}=ae(),u=ee(),a=de(),c=C(null),d=C({}),y=C(0),o=C("top");W(()=>s.visible,async v=>{v&&s.targetEl&&(await se(),g())});const g=()=>{const v=c.value;if(!v)return;const l=s.targetEl.getBoundingClientRect(),i=v.offsetWidth,T=v.offsetHeight,P=8,B=r.value,D=B?B.getBoundingClientRect():{top:0,left:0,width:window.innerWidth};o.value="top";let O=l.top-T-P;O<D.top+P&&(o.value="bottom",O=l.bottom+P);const A=l.left+l.width/2;let f=A-i/2;f<D.left+P&&(f=D.left+P),f+i>D.left+D.width-P&&(f=D.left+D.width-i-P);let h=A-f;const x=12,z=x/2+5,R=i-x/2-5;h=Math.max(z,Math.min(h,R)),d.value={top:`${O}px`,left:`${f}px`},y.value=h},p=v=>{const l=s.messageId;if(!l)return;const i=u.messages[s.charId],T=i.findIndex(D=>D.id===l),P=i[T],B={copy:()=>{P.content&&(navigator.clipboard.writeText(P.content),a.showToast(m("chat.messageMenu.toast.copied")))},favorite:()=>{u.addToFavorites(s.charId,P),a.showToast(m("chat.messageMenu.toast.favorited"))},delete:()=>{a.showConfirm(m("chat.messageMenu.confirmDelete"),m("chat.messageMenu.confirmDeleteMsg"),()=>{u.messages[s.charId].splice(T,1),u.saveData()})},revoke:()=>{P&&(P.type="revoked",u.saveData(),a.showToast(m("chat.messageMenu.toast.revoked")))},select:()=>n("enter-selection-mode",l,s.targetEl),quote:()=>n("quote-message",l),retry:()=>{P.sender!=="user"?u.messages[s.charId].splice(T,1):u.retryFromMessage(s.charId,l),u.saveData(),n("trigger-ai-response")},edit:()=>{P.type==="text"?n("edit-message",l):a.showToast(m("chat.messageMenu.toast.editTextOnly"),"info")}};B[v]&&B[v](),n("close")};return(v,l)=>t.visible?(b(),S("div",{key:0,ref_key:"menuRef",ref:c,class:H(["message-menu",{"menu-top":o.value==="top","menu-bottom":o.value==="bottom"}]),style:ce(d.value)},[e("div",as,[e("div",{class:"menu-item",onClick:l[0]||(l[0]=i=>p("copy"))},$(w(m)("copy")),1),e("div",{class:"menu-item",onClick:l[1]||(l[1]=i=>p("favorite"))},$(w(m)("favorite")),1),e("div",{class:"menu-item",onClick:l[2]||(l[2]=i=>p("delete"))},$(w(m)("delete")),1),e("div",{class:"menu-item",onClick:l[3]||(l[3]=i=>p("revoke"))},$(w(m)("revoke")),1),e("div",{class:"menu-item",onClick:l[4]||(l[4]=i=>p("select"))},$(w(m)("select")),1),e("div",{class:"menu-item",onClick:l[5]||(l[5]=i=>p("quote"))},$(w(m)("quote")),1),e("div",{class:"menu-item",onClick:l[6]||(l[6]=i=>p("retry"))},$(w(m)("retry")),1),e("div",{class:"menu-item",onClick:l[7]||(l[7]=i=>p("edit"))},$(w(m)("edit")),1)]),e("div",{class:"menu-arrow",style:ce({left:y.value+"px"})},null,4)],6)):U("",!0)}},is=G(ls,[["__scopeId","data-v-611c1739"]]),rs={class:"chat-action-row"},cs={__name:"SelectionBar",emits:["action","cancel"],setup(t){const{t:k}=ae();return(s,n)=>(b(),S("div",rs,[e("div",{class:"action-btn",onClick:n[0]||(n[0]=r=>s.$emit("action","favorite"))},[n[4]||(n[4]=e("div",{class:"action-btn-icon"},[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round"},[e("polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"})])],-1)),e("span",null,$(w(k)("favorite")),1)]),e("div",{class:"action-btn",onClick:n[1]||(n[1]=r=>s.$emit("action","forward"))},[n[5]||(n[5]=e("div",{class:"action-btn-icon"},[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"M18 8L22 12L18 16"}),e("path",{d:"M2 12H22"})])],-1)),e("span",null,$(w(k)("forward")),1)]),e("div",{class:"action-btn",onClick:n[2]||(n[2]=r=>s.$emit("action","delete"))},[n[6]||(n[6]=e("div",{class:"action-btn-icon"},[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round"},[e("polyline",{points:"3 6 5 6 21 6"}),e("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})])],-1)),e("span",null,$(w(k)("delete")),1)]),e("div",{class:"action-btn",onClick:n[3]||(n[3]=r=>s.$emit("cancel"))},[n[7]||(n[7]=e("div",{class:"action-btn-icon"},[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round"},[e("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e("line",{x1:"6",y1:"6",x2:"18",y2:"18"})])],-1)),e("span",null,$(w(k)("done")),1)])]))}},ds=G(cs,[["__scopeId","data-v-be1a592f"]]),us=["src"],vs={class:"msg-content-wrapper"},gs={class:"msg-bubble-box"},ms={key:0,class:"quote-in-bubble"},fs={class:"quote-in-bubble-sender"},ps={class:"quote-in-bubble-text"},hs={key:1,class:"edit-view"},ks={key:0},bs={class:"description-placeholder"},ys=["src"],Ss={key:2,class:"sticker-msg"},$s=["src"],Ms={key:3,class:"voice-msg-wrapper"},ws={class:"voice-msg"},Cs={key:4,class:"location-msg"},Ts={class:"location-text"},xs={class:"msg-title"},Is={class:"transfer-content"},As={class:"transfer-icon"},Ps={key:0,viewBox:"0 0 24 24",fill:"currentColor"},Rs={key:1,viewBox:"0 0 24 24",stroke:"currentColor","stroke-width":"2",fill:"none","stroke-linecap":"round","stroke-linejoin":"round"},Bs={class:"transfer-info"},Ls={class:"transfer-amount"},Vs={class:"transfer-desc"},Es={class:"transfer-footer"},Ds={key:6,class:"call-summary-msg"},Ns={key:0,class:"blocked-icon"},qs={__name:"MessageItem",props:{msg:{type:Object,required:!0},charName:{type:String,default:""},charAvatar:{type:String,default:""},userAvatar:{type:String,default:""},bubbleStyle:{type:Object,default:()=>({})},isSelectionMode:{type:Boolean,default:!1},isSelected:{type:Boolean,default:!1},editingMessageId:{type:String,default:null}},emits:["save-edit","cancel-edit","toggle-selection","long-press","cancel-long-press","touch-move","click-msg","show-thought","accept-transfer"],setup(t,{emit:k}){const s=t,n=k,r=ct(),m=C(!1),u=C(!1),a=C(""),c=E(()=>s.editingMessageId===s.msg.id),d=E(()=>{const h=s.msg.type,x=h==="transfer"&&s.msg.status==="accepted";return{"no-style":["image","sticker","location","transfer"].includes(h),"has-location":h==="location","has-transfer":h==="transfer",accepted:x}}),y=E(()=>{if(s.msg.type!=="transfer")return{};const h=s.msg.status==="accepted",x=s.msg.sender==="user";return{"accepted-sender":h&&x,"accepted-receiver":h&&!x,pending:!h}}),o=E(()=>{if(s.msg.type!=="transfer")return"";const h=s.msg.sender==="user",x=s.msg.status==="accepted",z=s.msg.isReceived;return s.msg.note?s.msg.note:z?"已收款":x?"已被接收":h?"你发起了一笔转账":"请收款"}),g=E(()=>s.msg.type!=="transfer"?"":s.msg.isReceived?"已收款":s.msg.status==="accepted"?"已被接收":"微信转账");W(c,h=>{h&&(a.value=s.msg.content)});const p=h=>{n("long-press",h,s.msg.id)},v=()=>{n("cancel-long-press")},l=h=>{n("touch-move",h)},i=h=>{s.msg.type==="voice"&&P(),s.msg.type!=="image"&&n("click-msg",h,s.msg.id)},T=()=>{s.msg.sender!=="user"&&n("show-thought",s.msg.id)},P=()=>{m.value=!m.value},B=()=>{u.value=!u.value},D=()=>{a.value.trim()&&n("save-edit",{msgId:s.msg.id,newContent:a.value})},O=()=>{n("cancel-edit")},A=()=>s.msg.type==="notification"?s.msg.content:s.msg.type==="revoked"?`"${s.msg.sender==="user"?"你":s.charName}" 撤回了一条消息`:"",f=()=>{(s.msg.status==="pending"||s.msg.status===void 0)&&s.msg.sender!=="user"&&!s.isSelectionMode&&n("accept-transfer",s.msg.id)};return(h,x)=>(b(),S("div",{class:H(["message",{sent:t.msg.sender==="user",received:t.msg.sender!=="user",revoked:t.msg.type==="revoked"||t.msg.type==="notification","selection-mode-active":t.isSelectionMode}])},[t.msg.type==="revoked"||t.msg.type==="notification"?(b(),S(Y,{key:0},[e("div",{class:H(["message-checkbox",{checked:t.isSelected,visible:t.isSelectionMode}]),onClick:x[0]||(x[0]=Z(z=>h.$emit("toggle-selection",t.msg.id),["stop"]))},null,2),e("div",{class:"system-message-wrapper",onMousedown:p,onMouseup:v,onMouseleave:v,onTouchstart:p,onTouchend:v,onTouchmove:l,onClick:Z(i,["prevent"])},[e("div",{class:"system-message-text",onClick:x[1]||(x[1]=Z(z=>!t.isSelectionMode&&B(),["stop"]))},$(A()),1),t.msg.type==="revoked"?K((b(),S("div",{key:0,class:"revoked-content"},$(t.msg.sender==="user"?"我":t.charName)+"："+$(t.msg.content),513)),[[ke,u.value]]):U("",!0)],32)],64)):(b(),S(Y,{key:1},[e("div",{class:"msg-avatar",onClick:T},[(t.msg.sender==="user"?t.userAvatar:t.charAvatar)?(b(),S("img",{key:0,src:t.msg.sender==="user"?t.userAvatar:t.charAvatar,alt:"avatar"},null,8,us)):(b(),S("div",{key:1,class:H(["default-avatar",{user:t.msg.sender==="user"}])},null,2))]),e("div",vs,[e("div",gs,[e("div",{class:H(["msg-bubble",d.value]),style:ce(t.bubbleStyle),onMousedown:p,onMouseup:v,onMouseleave:v,onTouchstart:p,onTouchend:v,onTouchmove:l,onClick:Z(i,["prevent"])},[t.msg.quote?(b(),S("div",ms,[e("div",fs,$(t.msg.quote.sender==="user"?"你":t.charName)+":",1),e("div",ps,$(t.msg.quote.content),1)])):U("",!0),c.value?(b(),S("div",hs,[K(e("textarea",{"onUpdate:modelValue":x[2]||(x[2]=z=>a.value=z),class:"edit-textarea",rows:"3"},null,512),[[te,a.value]]),e("div",{class:"edit-actions"},[e("button",{onClick:O,class:"edit-btn cancel"},"取消"),e("button",{onClick:D,class:"edit-btn save"},"保存")])])):(b(),S(Y,{key:2},[t.msg.type==="text"?(b(),S("div",ks,$(t.msg.content),1)):t.msg.type==="image"?(b(),S(Y,{key:1},[t.msg.isTextGenerated||t.msg.sender!=="user"&&!t.msg.content.startsWith("http")&&!t.msg.content.startsWith("data:")?(b(),S("div",{key:0,class:"text-generated-image-container",onClick:x[3]||(x[3]=z=>w(r).preview(t.msg))},[e("div",bs,$(t.msg.content),1)])):(b(),S("div",{key:1,class:"image-msg",onClick:x[4]||(x[4]=z=>w(r).preview(t.msg))},[e("img",{src:t.msg.content,alt:"图片"},null,8,ys)]))],64)):t.msg.type==="sticker"?(b(),S("div",Ss,[e("img",{src:t.msg.content,alt:"表情包"},null,8,$s)])):t.msg.type==="voice"?(b(),S("div",Ms,[e("div",ws,[F(ie,{name:"voice-wave",class:H(["voice-icon-svg",{playing:m.value}])},null,8,["class"]),e("span",null,$(Math.min(60,Math.ceil(t.msg.content.length/2)))+'"',1)])])):t.msg.type==="location"?(b(),S("div",Cs,[e("div",Ts,[e("div",xs,$(t.msg.content||"位置信息"),1),x[6]||(x[6]=e("div",{class:"msg-desc"},"详细地址",-1))]),x[7]||(x[7]=Te('<div class="location-map" data-v-f762cd21><img src="https://files.catbox.moe/uryae6.png" alt="地图" data-v-f762cd21><div class="location-pin" data-v-f762cd21><svg viewBox="0 0 24 24" fill="currentColor" data-v-f762cd21><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z" data-v-f762cd21></path></svg></div></div>',1))])):t.msg.type==="transfer"?(b(),S("div",{key:5,class:H(["transfer-msg",y.value]),onClick:Z(f,["stop"])},[e("div",Is,[e("div",As,[t.msg.status==="accepted"||t.msg.isReceived?(b(),S("svg",Ps,[...x[8]||(x[8]=[e("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"},null,-1)])])):(b(),S("svg",Rs,[...x[9]||(x[9]=[e("path",{d:"M8 5 L4 9 H20 M16 19 L20 15 H4"},null,-1)])]))]),e("div",Bs,[e("div",Ls,"¥"+$(t.msg.content),1),e("div",Vs,$(o.value),1)])]),e("div",Es,$(g.value),1)],2)):t.msg.type==="call_summary"?(b(),S("div",Ds,[x[10]||(x[10]=e("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M12 9c-1.6 0-3.15.25-4.6.72v3.1c0 .39-.23.74-.56.9-.98.49-1.87 1.12-2.66 1.85-.18.18-.43.28-.7.28-.28 0-.53-.11-.71-.29L.29 13.08a.956.956 0 0 1 0-1.35c2.93-2.94 6.86-4.73 11.21-4.73s8.28 1.79 11.21 4.73c.38.38.38 1.02 0 1.4l-2.48 2.48c-.18.18-.43.29-.71.29-.27 0-.52-.11-.7-.28a11.27 11.27 0 0 0-2.66-1.85.995.995 0 0 1-.56-.9v-3.1C15.15 9.25 13.6 9 12 9z"})],-1)),e("span",null,$(t.msg.content),1)])):U("",!0)],64))],38),t.msg.blocked&&t.msg.sender!=="user"?(b(),S("div",Ns,[...x[11]||(x[11]=[e("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"})],-1)])])):U("",!0)]),t.msg.type==="voice"?K((b(),S("div",{key:0,class:"voice-text"},$(t.msg.content),513)),[[ke,m.value]]):U("",!0)]),e("div",{class:H(["message-checkbox",{checked:t.isSelected,visible:t.isSelectionMode}]),onClick:x[5]||(x[5]=Z(z=>h.$emit("toggle-selection",t.msg.id),["stop"]))},null,2)],64))],2))}},Us=G(qs,[["__scopeId","data-v-f762cd21"]]),Fs={key:0,class:"empty-message"},zs={key:0,class:"timestamp"},js={key:0,class:"blocked-overlay"},Hs={class:"blocked-content"},Os=5*60*1e3,Ws={__name:"MessageList",props:{messages:{type:Array,default:()=>[]},charName:String,charAvatar:String,userAvatar:String,bubbleStyle:Object,isSelectionMode:Boolean,selectedMessageIds:Set,isBlocked:Boolean,editingMessageId:String,activePanel:String},emits:["save-edit","cancel-edit","toggle-selection","long-press","cancel-long-press","touch-move","click-msg","unblock","show-text-content","show-thought","accept-transfer"],setup(t,{expose:k}){const s=t,n=C(null),r=a=>{if(a===0)return!0;const c=s.messages[a],d=s.messages[a-1];if(!c.timestamp||!d.timestamp)return!1;const y=new Date(c.timestamp).getTime(),o=new Date(d.timestamp).getTime();return y-o>Os},m=a=>{if(!a)return"";const c=new Date(a),d=new Date,y=new Date(d.getFullYear(),d.getMonth(),d.getDate()),o=new Date(y.getTime()-864e5),g=d.getDay()===0?7:d.getDay(),p=new Date(y.getTime()-(g-1)*864e5),v=c.getHours().toString().padStart(2,"0"),l=c.getMinutes().toString().padStart(2,"0"),i=`${v}:${l}`;if(c.getTime()>=y.getTime())return i;if(c.getTime()>=o.getTime())return`昨天 ${i}`;if(c.getTime()>=p.getTime())return`${["星期日","星期一","星期二","星期三","星期四","星期五","星期六"][c.getDay()]} ${i}`;{const T=c.getFullYear(),P=(c.getMonth()+1).toString(),B=c.getDate().toString();return T===d.getFullYear()?`${P}月${B}日 ${i}`:`${T}年${P}月${B}日 ${i}`}},u=()=>{n.value&&(n.value.scrollTop=n.value.scrollHeight)};return W(()=>s.messages,()=>{se(()=>{u()})},{deep:!0}),W(()=>s.activePanel,a=>{a&&se(()=>{u()})}),fe(()=>{u()}),k({scrollToBottom:u}),(a,c)=>(b(),S(Y,null,[e("div",{class:"chat-messages",ref_key:"messagesContainer",ref:n},[t.messages.length===0?(b(),S("div",Fs," 开始和 "+$(t.charName)+" 聊天吧~ ",1)):U("",!0),(b(!0),S(Y,null,re(t.messages,(d,y)=>(b(),S(Y,{key:d.id},[r(y)?(b(),S("div",zs,$(m(d.timestamp)),1)):U("",!0),F(Us,{msg:d,charName:t.charName,charAvatar:t.charAvatar,userAvatar:t.userAvatar,bubbleStyle:t.bubbleStyle,isSelectionMode:t.isSelectionMode,isSelected:t.selectedMessageIds.has(d.id),editingMessageId:t.editingMessageId,onSaveEdit:c[0]||(c[0]=o=>a.$emit("save-edit",o)),onCancelEdit:c[1]||(c[1]=o=>a.$emit("cancel-edit")),onToggleSelection:c[2]||(c[2]=o=>a.$emit("toggle-selection",o)),onLongPress:c[3]||(c[3]=(o,g)=>a.$emit("long-press",o,g)),onCancelLongPress:c[4]||(c[4]=o=>a.$emit("cancel-long-press")),onTouchMove:c[5]||(c[5]=o=>a.$emit("touch-move",o)),onClickMsg:c[6]||(c[6]=(o,g)=>a.$emit("click-msg",o,g)),onShowTextContent:c[7]||(c[7]=o=>a.$emit("show-text-content",o)),onShowThought:c[8]||(c[8]=o=>a.$emit("show-thought",o)),onAcceptTransfer:c[9]||(c[9]=o=>a.$emit("accept-transfer",o))},null,8,["msg","charName","charAvatar","userAvatar","bubbleStyle","isSelectionMode","isSelected","editingMessageId"])],64))),128))],512),t.isBlocked?(b(),S("div",js,[e("div",Hs,[c[11]||(c[11]=e("div",{class:"blocked-text"},"对方已被你拉黑",-1)),e("button",{class:"blocked-btn",onClick:c[10]||(c[10]=d=>a.$emit("unblock"))},"解除拉黑")])])):U("",!0)],64))}},Gs=G(Ws,[["__scopeId","data-v-deb1a117"]]),Js={__name:"VoiceInput",props:{visible:{type:Boolean,required:!0}},emits:["update:visible","confirm"],setup(t,{emit:k}){const s=t,n=k,r=E({get:()=>s.visible,set:a=>n("update:visible",a)}),m=C("");W(()=>s.visible,a=>{a&&(m.value="")});const u=()=>{const a=m.value.trim();n("confirm",a),r.value=!1};return(a,c)=>(b(),_(ue,{visible:r.value,"onUpdate:visible":c[2]||(c[2]=d=>r.value=d),title:"发送语音"},{footer:Q(()=>[e("button",{class:"modal-btn cancel",onClick:c[1]||(c[1]=d=>r.value=!1)},"取消"),e("button",{class:"modal-btn confirm",onClick:u},"发送")]),default:Q(()=>[K(e("input",{type:"text",class:"base-input","onUpdate:modelValue":c[0]||(c[0]=d=>m.value=d),placeholder:"输入语音内容..."},null,512),[[te,m.value]])]),_:1},8,["visible"]))}},Ys={__name:"LocationInput",props:{visible:{type:Boolean,required:!0}},emits:["update:visible","confirm"],setup(t,{emit:k}){const s=t,n=k,r=E({get:()=>s.visible,set:c=>n("update:visible",c)}),m=C(""),u=C("");W(()=>s.visible,c=>{c&&(m.value="",u.value="")});const a=()=>{const c=m.value.trim(),d=u.value.trim();c&&(n("confirm",{name:c,detail:d}),r.value=!1)};return(c,d)=>(b(),_(ue,{visible:r.value,"onUpdate:visible":d[3]||(d[3]=y=>r.value=y),title:"发送位置"},{footer:Q(()=>[e("button",{class:"modal-btn cancel",onClick:d[2]||(d[2]=Z(y=>r.value=!1,["stop"]))},"取消"),e("button",{class:"modal-btn confirm",onClick:a},"发送")]),default:Q(()=>[K(e("input",{type:"text",class:"base-input","onUpdate:modelValue":d[0]||(d[0]=y=>m.value=y),placeholder:"位置名称 (如: 广州塔)",autocomplete:"new-password"},null,512),[[te,m.value]]),K(e("input",{type:"text",class:"base-input","onUpdate:modelValue":d[1]||(d[1]=y=>u.value=y),placeholder:"详细地址 (可选)",style:{"margin-top":"10px"},autocomplete:"new-password"},null,512),[[te,u.value]])]),_:1},8,["visible"]))}},Ks={class:"chat-list-container"},Qs=["onClick"],Xs=["src"],Zs={class:"chat-info"},_s={class:"chat-name"},en=["disabled"],tn={__name:"ForwardSelection",props:{visible:{type:Boolean,default:!1}},emits:["close","confirm"],setup(t,{emit:k}){const s=t,n=k,r=ee(),m=C(s.visible),u=C(new Set),a=E(()=>r.characters);W(()=>s.visible,y=>{m.value=y,y||u.value.clear()});const c=y=>{u.value.has(y)?u.value.delete(y):u.value.add(y)},d=()=>{u.value.size>0&&n("confirm",Array.from(u.value))};return(y,o)=>(b(),_(ue,{visible:m.value,"onUpdate:visible":o[1]||(o[1]=g=>m.value=g),title:"选择聊天",onClose:o[2]||(o[2]=g=>y.$emit("close"))},{footer:Q(()=>[e("button",{class:"modal-btn cancel",onClick:o[0]||(o[0]=g=>y.$emit("close"))},"取消"),e("button",{class:"modal-btn confirm",disabled:u.value.size===0,onClick:d}," 确定 ("+$(u.value.size)+") ",9,en)]),default:Q(()=>[e("div",Ks,[(b(!0),S(Y,null,re(a.value,g=>(b(),S("div",{key:g.id,class:"chat-item",onClick:p=>c(g.id)},[e("img",{src:g.avatar,alt:"avatar",class:"avatar"},null,8,Xs),e("div",Zs,[e("div",_s,$(g.name),1)]),e("div",{class:H(["checkbox",{selected:u.value.has(g.id)}])},null,2)],8,Qs))),128))])]),_:1},8,["visible"]))}},sn=G(tn,[["__scopeId","data-v-00bcf675"]]),nn={class:"note-container"},on={key:0,class:"content-wrapper"},an={class:"note-header current-header"},ln=["src"],rn={key:1,class:"avatar-placeholder"},cn={class:"character-name"},dn={class:"status-section"},un={class:"status-row"},vn={class:"status-value"},gn={class:"status-row"},mn={class:"status-value"},fn={class:"status-row"},pn={class:"status-value"},hn={class:"inner-voice-section"},kn={class:"inner-voice-box"},bn={class:"unspoken-section"},yn={class:"unspoken-text"},Sn={key:1,class:"content-wrapper history-wrapper"},$n={class:"scroll-container"},Mn={class:"item-header"},wn={class:"header-left"},Cn=["onClick"],Tn={key:0,viewBox:"0 0 24 24",width:"16",height:"16",fill:"#f39c12",stroke:"#f39c12","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},xn={key:1,viewBox:"0 0 24 24",width:"16",height:"16",fill:"none",stroke:"#ccc","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},In={class:"item-date"},An={class:"prop-row"},Pn={class:"prop-row"},Rn={class:"prop-row"},Bn={class:"prop-row"},Ln={class:"prop-row"},Vn={__name:"SingleCharStatus",props:{visible:{type:Boolean,default:!1},name:{type:String,default:""},avatar:{type:String,default:""},charId:{type:String,required:!0}},emits:["close"],setup(t,{emit:k}){const s=t,n=ee(),{currentInnerVoice:r,innerVoices:m}=dt(n),u=E(()=>r.value[s.charId]||{emotion:"",outfit:"",posture:"",innerVoice:"",unspokenWords:""}),a=E(()=>m.value[s.charId]||[]),c=l=>n.favorites?n.favorites.some(i=>String(i.charId)===String(s.charId)&&i.type==="thoughts"&&i.originalId===l.id):!1,d=l=>{n.toggleThoughtFavorite(s.charId,l)},y=l=>l?new Date(l).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit"}).replace(/\//g,"."):"",o=k,g=C(!1),p=()=>{g.value=!g.value};W(()=>s.visible,l=>{l?(document.body.style.overflow="hidden",g.value=!1):document.body.style.overflow=""});const v=()=>{o("close")};return(l,i)=>t.visible?(b(),S("div",{key:0,class:"note-modal-mask",onClick:Z(v,["self"])},[e("div",nn,[e("div",{class:"tape-button",onClick:p}),e("div",{class:H(["note",{"history-mode":g.value}])},[i[13]||(i[13]=e("div",{class:"paper-texture"},null,-1)),g.value?(b(),S("div",Sn,[e("div",{class:"note-header history-header"},[i[5]||(i[5]=e("div",{class:"header-title"},"历史心声",-1)),e("button",{class:"close-btn",onClick:v},"✕")]),e("div",$n,[(b(!0),S(Y,null,re(a.value,T=>(b(),S("div",{key:T.id,class:"history-item"},[e("div",Mn,[e("div",wn,[e("button",{class:"star-btn",onClick:Z(P=>d(T),["stop"])},[c(T)?(b(),S("svg",Tn,[...i[6]||(i[6]=[e("polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"},null,-1)])])):(b(),S("svg",xn,[...i[7]||(i[7]=[e("polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"},null,-1)])]))],8,Cn),e("span",null,$(T.title),1)]),e("span",In,$(y(T.timestamp)),1)]),e("div",An,[i[8]||(i[8]=e("span",{class:"prop-label"},"情绪：",-1)),oe($(T.emotion),1)]),e("div",Pn,[i[9]||(i[9]=e("span",{class:"prop-label"},"穿着：",-1)),oe($(T.outfit),1)]),e("div",Rn,[i[10]||(i[10]=e("span",{class:"prop-label"},"姿态：",-1)),oe($(T.posture),1)]),e("div",Bn,[i[11]||(i[11]=e("span",{class:"prop-label"},"内心独白：",-1)),oe($(T.innerVoice),1)]),e("div",Ln,[i[12]||(i[12]=e("span",{class:"prop-label"},"没说出口的话：",-1)),oe($(T.unspokenWords),1)])]))),128))])])):(b(),S("div",on,[e("div",an,[t.avatar?(b(),S("img",{key:0,src:t.avatar,class:"avatar-img",alt:"avatar"},null,8,ln)):(b(),S("div",rn,$(t.name?t.name.charAt(0):"?"),1)),e("div",cn,$(t.name),1),e("button",{class:"close-btn",onClick:v},"✕")]),e("div",dn,[e("div",un,[i[0]||(i[0]=e("span",{class:"status-label"},"情绪",-1)),e("span",vn,$(u.value.emotion||"无"),1)]),e("div",gn,[i[1]||(i[1]=e("span",{class:"status-label"},"穿着",-1)),e("span",mn,$(u.value.outfit||"无"),1)]),e("div",fn,[i[2]||(i[2]=e("span",{class:"status-label"},"姿态",-1)),e("span",pn,$(u.value.posture||"无"),1)])]),e("div",hn,[i[3]||(i[3]=e("div",{class:"section-title"},"Inner Voice",-1)),e("div",kn,[e("p",null,$(u.value.innerVoice||"（没有内心独白）"),1)])]),e("div",bn,[i[4]||(i[4]=e("div",{class:"unspoken-title"},"没说出口的话",-1)),e("div",yn,$(u.value.unspokenWords||"（没有想说的话）"),1)])])),i[14]||(i[14]=e("div",{class:"torn-edge"},null,-1))],2)])])):U("",!0)}},En=G(Vn,[["__scopeId","data-v-34c4e096"]]),Dn={key:0,class:"transfer-modal"},Nn={class:"app-header transfer-header"},qn={class:"target-section"},Un={class:"target-info"},Fn={class:"target-text"},zn={class:"transfer-to"},jn=["src"],Hn={key:1,class:"target-avatar-placeholder"},On={class:"amount-card"},Wn={class:"amount-input-wrapper"},Gn={key:0,class:"cursor"},Jn={class:"note-section"},Yn={key:1,class:"note-input-row"},Kn={class:"number-keyboard"},Qn={class:"keyboard-grid"},Xn={__name:"MoneyPacket",props:{visible:{type:Boolean,default:!1},targetName:{type:String,default:""},targetAvatar:{type:String,default:""}},emits:["update:visible","confirm"],setup(t,{emit:k}){const s=t,n=k,r=C(""),m=C(""),u=C(!1),a=C(null),c=C(!0),d=C(!1),y=C(null),o=E(()=>!!a.value),g=E(()=>r.value),p=()=>(a.value=document.querySelector("#phone-screen-container"),!!a.value);fe(()=>{se(()=>{p()&&(u.value=!0)})}),ut(()=>{u.value=!1});const v=E(()=>{const A=parseFloat(r.value);return!isNaN(A)&&A>0});W(()=>s.visible,A=>{A&&(r.value="",m.value="",c.value=!0)});const l=()=>{n("update:visible",!1)},i=()=>{c.value=!0},T=()=>{d.value=!0,se(()=>{y.value&&y.value.focus()})},P=()=>{d.value=!1},B=A=>{if(A==="."){if(r.value.includes("."))return;if(r.value===""){r.value="0.";return}}if(r.value.includes(".")){const f=r.value.split(".");if(f[1]&&f[1].length>=2)return}if(!(!r.value.includes(".")&&A!=="."&&r.value.length>=8)){if(r.value==="0"&&A!=="."){r.value=A;return}r.value+=A}},D=()=>{r.value.length>0&&(r.value=r.value.slice(0,-1))},O=()=>{v.value&&(n("confirm",{amount:parseFloat(r.value).toFixed(2),note:m.value}),l())};return(A,f)=>u.value&&o.value?(b(),_(me,{key:0,to:"#phone-screen-container"},[F(vt,{name:"slide-up"},{default:Q(()=>[t.visible?(b(),S("div",Dn,[e("div",Nn,[e("div",{class:"back-btn",onClick:l},[F(ie,{name:"back-btn"})]),f[12]||(f[12]=e("div",{class:"title"},null,-1)),f[13]||(f[13]=e("div",{class:"action-btn"},null,-1))]),e("div",qn,[e("div",Un,[e("div",Fn,[e("div",zn,"转账给 "+$(t.targetName),1)])]),t.targetAvatar?(b(),S("img",{key:0,src:t.targetAvatar,class:"target-avatar"},null,8,jn)):(b(),S("div",Hn,[...f[14]||(f[14]=[e("svg",{viewBox:"0 0 24 24",width:"24",height:"24"},[e("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z",fill:"#999"})],-1)])]))]),e("div",On,[f[16]||(f[16]=e("div",{class:"amount-label"},"转账金额",-1)),e("div",Wn,[f[15]||(f[15]=e("span",{class:"currency-symbol"},"¥",-1)),e("div",{class:"amount-display",onClick:i},[oe($(g.value||"")+" ",1),c.value?(b(),S("span",Gn,"|")):U("",!0)])]),f[17]||(f[17]=e("div",{class:"amount-divider"},null,-1)),e("div",Jn,[d.value?(b(),S("div",Yn,[K(e("input",{type:"text","onUpdate:modelValue":f[0]||(f[0]=h=>m.value=h),class:"base-input note-input",placeholder:"添加转账说明",maxlength:"20",ref_key:"noteInputRef",ref:y,onBlur:P,onKeyup:xe(P,["enter"])},null,544),[[te,m.value]])])):(b(),S("div",{key:0,class:"note-label-row",onClick:T},[e("span",{class:H(["note-text",{"has-note":m.value}])},$(m.value||"添加转账说明"),3)]))])]),e("div",Kn,[e("div",Qn,[e("div",{class:"key-btn",onClick:f[1]||(f[1]=h=>B("1"))},"1"),e("div",{class:"key-btn",onClick:f[2]||(f[2]=h=>B("2"))},"2"),e("div",{class:"key-btn",onClick:f[3]||(f[3]=h=>B("3"))},"3"),e("div",{class:"key-btn delete-btn",onClick:D},[...f[18]||(f[18]=[e("svg",{viewBox:"0 0 24 24",width:"22",height:"22"},[e("path",{d:"M22 3H7c-.69 0-1.23.35-1.59.88L0 12l5.41 8.11c.36.53.9.89 1.59.89h15c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-3 12.59L17.59 17 14 13.41 10.41 17 9 15.59 12.59 12 9 8.41 10.41 7 14 10.59 17.59 7 19 8.41 15.41 12 19 15.59z",fill:"#333"})],-1)])]),e("div",{class:"key-btn",onClick:f[4]||(f[4]=h=>B("4"))},"4"),e("div",{class:"key-btn",onClick:f[5]||(f[5]=h=>B("5"))},"5"),e("div",{class:"key-btn",onClick:f[6]||(f[6]=h=>B("6"))},"6"),e("div",{class:H(["key-btn transfer-key",{disabled:!v.value}]),onClick:O}," 转账 ",2),e("div",{class:"key-btn",onClick:f[7]||(f[7]=h=>B("7"))},"7"),e("div",{class:"key-btn",onClick:f[8]||(f[8]=h=>B("8"))},"8"),e("div",{class:"key-btn",onClick:f[9]||(f[9]=h=>B("9"))},"9"),e("div",{class:"key-btn zero-btn",onClick:f[10]||(f[10]=h=>B("0"))},"0"),e("div",{class:"key-btn",onClick:f[11]||(f[11]=h=>B("."))},".")])])])):U("",!0)]),_:1})])):U("",!0)}},Zn=G(Xn,[["__scopeId","data-v-aeb4e21f"]]),_n={__name:"SingleChat",props:{charId:{type:String,required:!0}},setup(t){const k=t,s=be(),{t:n}=ae(),r=ee(),m=de(),u=gt(),a=C(null),c=C(null),d=C(null),y=C(!1),o=C({visible:!1,messageId:null,targetEl:null}),g=C(!1),p=C(!1),v=C(!1),l=C(!1);C("");const i=C(!1),T=E(()=>r.getCharacter(k.charId)),P=E(()=>{var M;return((M=T.value)==null?void 0:M.isBlocked)||!1}),B=E(()=>{var M,I;return((M=T.value)==null?void 0:M.nickname)||((I=T.value)==null?void 0:I.name)||n("chat.unknownCharacter")}),D=E(()=>{var M;return((M=T.value)==null?void 0:M.name)||n("chat.unknownCharacter")}),O=E(()=>{var M;return(M=T.value)==null?void 0:M.avatar}),A=E(()=>{var M;return((M=T.value)==null?void 0:M.status)||{}}),f=E(()=>{var M;return((M=T.value)==null?void 0:M.chatBackground)||""}),h=E(()=>{const M=T.value;if(!M||!M.userPersona)return"";const I=r.userPersonas.find(N=>N.id===M.userPersona);return(I==null?void 0:I.avatar)||""}),x=E(()=>r.messages[k.charId]||[]),z=E(()=>{var M;return((M=T.value)==null?void 0:M.bubbleSettings)||{}}),{isSelectionMode:R,selectedMessageIds:j,isForwarding:L,enterSelectionMode:q,exitSelectionMode:V,toggleMessageSelection:X,handleBatchAction:J,handleConfirmForward:ne}=ft(ge(k,"charId")),{isTyping:le,triggerAiResponse:ye}=ht(ge(k,"charId"),u),{inputText:ve,quotingMessage:pe,sendMessage:Ie,sendSticker:Ae,sendVoiceMessage:Pe,handleSendImage:Re,confirmSendLocation:Be,sendTransfer:Le}=bt(r,ge(k,"charId"),m,d),{editingMessageId:Se,handleEditMessage:Ve,handleSaveEdit:Ee,updateInputText:De}=kt(r,ge(k,"charId"),ve),{startLongPress:Ne,cancelLongPress:qe,handleTouchMove:Ue,wasClickAfterLongPress:Fe}=yt(o),ze=E(()=>{const M=z.value,I={fontSize:M.fontSize?`${M.fontSize}px`:"14px"};if(M.css){const N={};return M.css.split(";").forEach(st=>{const he=st.split(":");if(he.length>=2){const $e=he[0].trim(),Me=he.slice(1).join(":").trim();$e&&Me&&(N[$e]=Me)}}),{...I,...N}}return I});W(y,M=>{M&&(s.push({name:"single-chat-settings",params:{id:k.charId}}),y.value=!1)}),W(()=>{var M;return(M=r.messages[k.charId])==null?void 0:M.length},()=>{r.clearUnreadCount(k.charId)}),fe(()=>{r.clearUnreadCount(k.charId)});const je=()=>{T.value&&(T.value.isBlocked=!1,r.messages[k.charId]&&r.messages[k.charId].forEach(M=>{M.blocked&&(M.blocked=!1)}),r.saveData(),m.showToast(n("chat.toast.unblocked")))},He=M=>{const I=M.target;I.closest(".modal-overlay.active")||(d.value&&!I.closest(".chat-footer")&&(d.value=null),R.value&&!I.closest(".message")&&!I.closest(".chat-action-row")&&!I.closest(".message-checkbox")&&!I.closest(".message-menu")&&V(),o.value.visible&&!I.closest(".message-menu")&&(o.value.visible=!1))},Oe=(M,I)=>{if(Fe()){M.preventDefault(),M.stopPropagation();return}R.value&&X(I)},We=M=>{const I=x.value.find(N=>N.id===M);I&&(pe.value=I)},Ge=()=>{p.value=!0},Je=M=>{Pe(M),p.value=!1},Ye=()=>{d.value=null,g.value=!0},Ke=()=>{v.value=!0},Qe=({name:M,detail:I})=>{Be(M,I),v.value=!1},Xe=()=>{r.startVideoCall(k.charId,"user")},Ze=()=>{l.value=!0},_e=()=>{i.value=!0},et=({amount:M,note:I})=>{Le(M,I),i.value=!1},tt=M=>{r.acceptTransfer(k.charId,M)};return(M,I)=>(b(),S("div",{class:H(["chat-room active",{"selection-mode":w(R)}]),onClick:He,ref_key:"chatRoomRef",ref:c},[e("div",{class:"chat-bg",style:ce(f.value?{backgroundImage:`url(${f.value})`}:{})},null,4),F(At,{charId:k.charId,charName:B.value,charStatus:A.value,isTyping:w(le),onTriggerAi:w(ye),onOpenSettings:I[0]||(I[0]=N=>y.value=!0)},null,8,["charId","charName","charStatus","isTyping","onTriggerAi"]),F(Gs,{ref_key:"messageListRef",ref:a,messages:x.value,charName:B.value,charAvatar:O.value,userAvatar:h.value,bubbleStyle:ze.value,isSelectionMode:w(R),selectedMessageIds:w(j),isBlocked:P.value,editingMessageId:w(Se),activePanel:d.value,onSaveEdit:w(Ee),onCancelEdit:I[1]||(I[1]=N=>Se.value=null),onToggleSelection:w(X),onLongPress:w(Ne),onCancelLongPress:w(qe),onTouchMove:w(Ue),onClickMsg:Oe,onUnblock:je,onShowThought:Ze,onAcceptTransfer:tt},null,8,["messages","charName","charAvatar","userAvatar","bubbleStyle","isSelectionMode","selectedMessageIds","isBlocked","editingMessageId","activePanel","onSaveEdit","onToggleSelection","onLongPress","onCancelLongPress","onTouchMove"]),w(R)?U("",!0):(b(),_(os,{key:0,modelValue:w(ve),"onUpdate:modelValue":I[2]||(I[2]=N=>mt(ve)?ve.value=N:null),activePanel:d.value,"onUpdate:activePanel":I[3]||(I[3]=N=>d.value=N),charId:k.charId,quotingMessage:w(pe),onCancelQuote:I[4]||(I[4]=N=>pe.value=null),onSendMessage:w(Ie),onSendSticker:w(Ae),onTriggerVoice:Ge,onTriggerImage:Ye,onTriggerVideo:Xe,onTriggerLocation:Ke,onTriggerTransfer:_e},null,8,["modelValue","activePanel","charId","quotingMessage","onSendMessage","onSendSticker"])),w(R)?(b(),_(ds,{key:1,onAction:w(J),onCancel:w(V)},null,8,["onAction","onCancel"])):U("",!0),F(Js,{visible:p.value,"onUpdate:visible":I[5]||(I[5]=N=>p.value=N),onConfirm:Je},null,8,["visible"]),F(Ce,{visible:g.value,"onUpdate:visible":I[6]||(I[6]=N=>g.value=N),onSendImage:w(Re)},null,8,["visible","onSendImage"]),F(Ys,{visible:v.value,"onUpdate:visible":I[7]||(I[7]=N=>v.value=N),onConfirm:Qe},null,8,["visible"]),F(is,{visible:o.value.visible,targetEl:o.value.targetEl,messageId:o.value.messageId,charId:k.charId,isSelectionMode:w(R),selectedMessageIds:w(j),onClose:I[8]||(I[8]=N=>o.value.visible=!1),onEnterSelectionMode:w(q),onTriggerAiResponse:w(ye),"onUpdate:inputText":w(De),onQuoteMessage:We,onEditMessage:w(Ve)},null,8,["visible","targetEl","messageId","charId","isSelectionMode","selectedMessageIds","onEnterSelectionMode","onTriggerAiResponse","onUpdate:inputText","onEditMessage"]),F(sn,{visible:w(L),onClose:I[9]||(I[9]=N=>L.value=!1),onConfirm:w(ne)},null,8,["visible","onConfirm"]),F(En,{visible:l.value,name:D.value,avatar:O.value,charId:k.charId,onClose:I[10]||(I[10]=N=>l.value=!1)},null,8,["visible","name","avatar","charId"]),F(Zn,{visible:i.value,"onUpdate:visible":I[11]||(I[11]=N=>i.value=N),targetName:B.value,targetAvatar:O.value,onConfirm:et},null,8,["visible","targetName","targetAvatar"])],2))}},to=G(_n,[["__scopeId","data-v-3292bae6"]]);export{to as default};
