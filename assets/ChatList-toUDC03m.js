import{_ as W,k as j,l as q,m as J,q as K,r as c,s as O,t as Q,a as h,e as s,f as k,h as X,v as $,x as A,y as n,z as l,F as Y,A as Z,w as v,M as x,i as tt,o as m,B as g,n as et,C as at,D as st}from"./index-BA0dlbk5.js";const ot={class:"chat-page active"},nt={class:"chat-top-note"},lt=["placeholder"],it={class:"chat-list"},rt={key:0,class:"empty-state"},ct={class:"empty-text"},dt={class:"empty-text",style:{"font-size":"12px"}},ut=["onMousedown","onMouseup","onTouchstart","onTouchend"],pt=["src"],ht={key:1,class:"default-avatar-text"},vt={class:"chat-info"},mt={class:"chat-name"},ft={class:"chat-preview"},_t={class:"chat-meta"},yt={class:"chat-time"},gt={class:"modal-options centered-text"},Ct={class:"option-text"},wt={class:"option-text",style:{color:"inherit"}},Tt={class:"modal-options centered-text"},bt={class:"option-text"},kt={class:"option-text"},xt=["placeholder"],Mt={__name:"ChatList",setup(St,{expose:V}){const{t:a}=j(),M=tt(),f=q(),S=J(),i=K(),C=c(""),d=c(!1),_=c(!1),w=c(""),N=c(null),u=c(!1),p=c(null);let T=null,b=!0;O(()=>{C.value=f.topNote}),Q(_,o=>{o&&st(()=>{var t;(t=N.value)==null||t.focus()})}),V({openAddModal:()=>{d.value=!0}});const z=()=>{f.saveTopNote(C.value)},D=o=>{const t=o.lastMessage;return t?t.type==="text"?t.content:t.type==="voice"?a("chat.messageTypes.voice"):t.type==="image"?a("chat.messageTypes.image"):t.type==="sticker"?a("chat.messageTypes.sticker"):t.type==="location"?a("chat.messageTypes.location"):t.type==="transfer"?a("chat.messageTypes.transfer"):t.type==="call_summary"?t.content:a("chat.messageTypes.unknown"):a("chat.start")},F=o=>{const t=o.lastMessage;if(!t)return"";const y=new Date(t.time),e=y.getHours().toString().padStart(2,"0"),r=y.getMinutes().toString().padStart(2,"0");return`${e}:${r}`},I=o=>{if(!o||!o.id){console.error("Attempted to open chat room with invalid session:",o),i.showToast(a("chat.toast.openChatFailed"),"error");return}o.type==="single"?M.push({name:"single-chat",params:{id:o.id}}):o.type==="group"&&i.showToast(a("chat.toast.groupChatWip"),"info")},U=()=>{d.value=!1,i.showToast(a("chat.toast.groupChatWip"),"info")},P=()=>{_.value=!1,w.value=""},E=()=>{const o=w.value.trim();if(!o){i.showToast(a("chat.enterCharacterName"),"info");return}const t=S.addCharacter(o);P(),M.push({name:"single-chat",params:{id:t}})},B=(o,t)=>{t.type==="mousedown"&&t.button!==0||(b=!0,T=setTimeout(()=>{b=!1,p.value=o,u.value=!0},800))},G=()=>{p.value&&(f.togglePin(p.value.id),u.value=!1)},H=()=>{u.value=!1;const o=p.value;o&&i.showConfirm(a("chat.deleteCharacterTitle"),a("chat.deleteCharacterConfirm",{name:o.name}),()=>{o.type==="single"?(S.deleteCharacter(o.id),i.showToast(a("chat.toast.deleteSuccess"),"success")):i.showToast("群组删除功能暂未开放","info")},{messageStyle:{whiteSpace:"pre-wrap",color:"#FF3B30"},confirmText:"delete"})},L=o=>{clearTimeout(T),b&&I(o)},R=()=>{clearTimeout(T)};return(o,t)=>{var y;return m(),h("div",ot,[s("div",nt,[t[8]||(t[8]=X('<div class="chat-top-note-icon" data-v-5830b589><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" data-v-5830b589><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z" data-v-5830b589></path><polyline points="3.27 6.96 12 12.01 20.73 6.96" data-v-5830b589></polyline><line x1="12" y1="22.08" x2="12" y2="12" data-v-5830b589></line></svg></div>',1)),$(s("input",{type:"text",class:"chat-top-note-input",placeholder:n(a)("chat.topNotePlaceholder"),"onUpdate:modelValue":t[0]||(t[0]=e=>C.value=e),onBlur:z},null,40,lt),[[A,C.value]])]),s("div",it,[n(f).sessionList.length===0?(m(),h("div",rt,[s("div",ct,l(n(a)("chat.empty")),1),s("div",dt,l(n(a)("chat.emptyHint")),1)])):(m(!0),h(Y,{key:1},Z(n(f).sessionList,e=>(m(),h("div",{key:e.id,class:et(["chat-list-item",{pinned:e.isPinned}]),onMousedown:g(r=>B(e,r),["prevent"]),onMouseup:g(r=>L(e),["prevent"]),onMouseleave:g(R,["prevent"]),onTouchstart:g(r=>B(e,r),["prevent"]),onTouchend:g(r=>L(e),["prevent"])},[s("div",{class:"chat-avatar",style:at(e.avatar?"background: transparent;":"")},[e.avatar?(m(),h("img",{key:0,src:e.avatar,alt:""},null,8,pt)):(m(),h("span",ht,l(e.name[0]||"?"),1))],4),s("div",vt,[s("div",mt,l(e.name),1),s("div",ft,l(D(e)),1)]),s("div",_t,[s("div",yt,l(F(e)),1)])],42,ut))),128))]),k(x,{visible:u.value,"onUpdate:visible":t[2]||(t[2]=e=>u.value=e),title:(y=p.value)==null?void 0:y.name},{footer:v(()=>[s("button",{class:"modal-btn cancel",onClick:t[1]||(t[1]=e=>u.value=!1)},l(n(a)("cancel")),1)]),default:v(()=>{var e;return[s("div",gt,[s("div",{class:"modal-option",onClick:G},[s("span",Ct,l((e=p.value)!=null&&e.isPinned?n(a)("chat.unpin"):n(a)("chat.pin")),1)]),s("div",{class:"modal-option btn-danger",onClick:H},[s("span",wt,l(n(a)("delete")),1)])])]}),_:1},8,["visible","title"]),k(x,{visible:d.value,"onUpdate:visible":t[5]||(t[5]=e=>d.value=e),title:n(a)("chat.newConversation")},{footer:v(()=>[s("button",{class:"modal-btn cancel",onClick:t[4]||(t[4]=e=>d.value=!1)},l(n(a)("cancel")),1)]),default:v(()=>[s("div",Tt,[s("div",{class:"modal-option",onClick:t[3]||(t[3]=e=>{_.value=!0,d.value=!1})},[s("span",bt,l(n(a)("chat.createCharacter")),1)]),s("div",{class:"modal-option",onClick:U},[s("span",kt,l(n(a)("chat.createGroup")),1)])])]),_:1},8,["visible","title"]),k(x,{visible:_.value,"onUpdate:visible":t[7]||(t[7]=e=>_.value=e),title:n(a)("chat.createCharacter")},{footer:v(()=>[s("button",{class:"modal-btn cancel",onClick:P},l(n(a)("cancel")),1),s("button",{class:"modal-btn confirm",onClick:E},l(n(a)("create")),1)]),default:v(()=>[$(s("input",{type:"text",class:"base-input","onUpdate:modelValue":t[6]||(t[6]=e=>w.value=e),placeholder:n(a)("chat.characterNamePlaceholder"),ref_key:"newCharInput",ref:N},null,8,xt),[[A,w.value]])]),_:1},8,["visible","title"])])}}},Pt=W(Mt,[["__scopeId","data-v-5830b589"]]);export{Pt as default};
