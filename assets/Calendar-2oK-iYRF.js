import{ci as Z,cj as U,ck as j,cl as He,cm as we,cn as oe,co as k,cp as Ue,_ as z,I as se,a3 as fe,r as C,z as Be,b as h,e as Y,o as m,d as s,F,C as H,n as R,B as _,w as W,A as I,D as A,f as S,S as Q,q as Re,R as be,c as x,cq as Le,cr as ve,cs as me,ct as ke,h as X,j as V,M as De,E as Ge,U as te,J as K,O as Ve,G as Qe,a5 as Xe,cu as je,l as Ae,a6 as Je}from"./index-BZSuXrTR.js";function ne(n,e){return Z(n,{...e,weekStartsOn:1})}function _e(n,e){const t=U(n,e==null?void 0:e.in),a=t.getFullYear(),r=j(t,0);r.setFullYear(a+1,0,4),r.setHours(0,0,0,0);const u=ne(r),g=j(t,0);g.setFullYear(a,0,4),g.setHours(0,0,0,0);const D=ne(g);return t.getTime()>=u.getTime()?a+1:t.getTime()>=D.getTime()?a:a-1}function Ke(n,e){const t=_e(n,e),a=j(n,0);return a.setFullYear(t,0,4),a.setHours(0,0,0,0),ne(a)}function Ze(n){return n instanceof Date||typeof n=="object"&&Object.prototype.toString.call(n)==="[object Date]"}function ze(n){return!(!Ze(n)&&typeof n!="number"||isNaN(+U(n)))}function et(n,e){const t=U(n,e==null?void 0:e.in);return t.setFullYear(t.getFullYear(),0,1),t.setHours(0,0,0,0),t}function tt(n,e){const t=U(n,e==null?void 0:e.in);return He(t,et(t))+1}function nt(n,e){const t=U(n,e==null?void 0:e.in),a=+ne(t)-+Ke(t);return Math.round(a/we)+1}function xe(n,e){var T,f,o,y;const t=U(n,e==null?void 0:e.in),a=t.getFullYear(),r=oe(),u=(e==null?void 0:e.firstWeekContainsDate)??((f=(T=e==null?void 0:e.locale)==null?void 0:T.options)==null?void 0:f.firstWeekContainsDate)??r.firstWeekContainsDate??((y=(o=r.locale)==null?void 0:o.options)==null?void 0:y.firstWeekContainsDate)??1,g=j((e==null?void 0:e.in)||n,0);g.setFullYear(a+1,0,u),g.setHours(0,0,0,0);const D=Z(g,e),w=j((e==null?void 0:e.in)||n,0);w.setFullYear(a,0,u),w.setHours(0,0,0,0);const d=Z(w,e);return+t>=+D?a+1:+t>=+d?a:a-1}function at(n,e){var D,w,d,T;const t=oe(),a=(e==null?void 0:e.firstWeekContainsDate)??((w=(D=e==null?void 0:e.locale)==null?void 0:D.options)==null?void 0:w.firstWeekContainsDate)??t.firstWeekContainsDate??((T=(d=t.locale)==null?void 0:d.options)==null?void 0:T.firstWeekContainsDate)??1,r=xe(n,e),u=j((e==null?void 0:e.in)||n,0);return u.setFullYear(r,0,a),u.setHours(0,0,0,0),Z(u,e)}function st(n,e){const t=U(n,e==null?void 0:e.in),a=+Z(t,e)-+at(t,e);return Math.round(a/we)+1}const q={y(n,e){const t=n.getFullYear(),a=t>0?t:1-t;return k(e==="yy"?a%100:a,e.length)},M(n,e){const t=n.getMonth();return e==="M"?String(t+1):k(t+1,2)},d(n,e){return k(n.getDate(),e.length)},a(n,e){const t=n.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return t.toUpperCase();case"aaa":return t;case"aaaaa":return t[0];case"aaaa":default:return t==="am"?"a.m.":"p.m."}},h(n,e){return k(n.getHours()%12||12,e.length)},H(n,e){return k(n.getHours(),e.length)},m(n,e){return k(n.getMinutes(),e.length)},s(n,e){return k(n.getSeconds(),e.length)},S(n,e){const t=e.length,a=n.getMilliseconds(),r=Math.trunc(a*Math.pow(10,t-3));return k(r,e.length)}},G={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},he={G:function(n,e,t){const a=n.getFullYear()>0?1:0;switch(e){case"G":case"GG":case"GGG":return t.era(a,{width:"abbreviated"});case"GGGGG":return t.era(a,{width:"narrow"});case"GGGG":default:return t.era(a,{width:"wide"})}},y:function(n,e,t){if(e==="yo"){const a=n.getFullYear(),r=a>0?a:1-a;return t.ordinalNumber(r,{unit:"year"})}return q.y(n,e)},Y:function(n,e,t,a){const r=xe(n,a),u=r>0?r:1-r;if(e==="YY"){const g=u%100;return k(g,2)}return e==="Yo"?t.ordinalNumber(u,{unit:"year"}):k(u,e.length)},R:function(n,e){const t=_e(n);return k(t,e.length)},u:function(n,e){const t=n.getFullYear();return k(t,e.length)},Q:function(n,e,t){const a=Math.ceil((n.getMonth()+1)/3);switch(e){case"Q":return String(a);case"QQ":return k(a,2);case"Qo":return t.ordinalNumber(a,{unit:"quarter"});case"QQQ":return t.quarter(a,{width:"abbreviated",context:"formatting"});case"QQQQQ":return t.quarter(a,{width:"narrow",context:"formatting"});case"QQQQ":default:return t.quarter(a,{width:"wide",context:"formatting"})}},q:function(n,e,t){const a=Math.ceil((n.getMonth()+1)/3);switch(e){case"q":return String(a);case"qq":return k(a,2);case"qo":return t.ordinalNumber(a,{unit:"quarter"});case"qqq":return t.quarter(a,{width:"abbreviated",context:"standalone"});case"qqqqq":return t.quarter(a,{width:"narrow",context:"standalone"});case"qqqq":default:return t.quarter(a,{width:"wide",context:"standalone"})}},M:function(n,e,t){const a=n.getMonth();switch(e){case"M":case"MM":return q.M(n,e);case"Mo":return t.ordinalNumber(a+1,{unit:"month"});case"MMM":return t.month(a,{width:"abbreviated",context:"formatting"});case"MMMMM":return t.month(a,{width:"narrow",context:"formatting"});case"MMMM":default:return t.month(a,{width:"wide",context:"formatting"})}},L:function(n,e,t){const a=n.getMonth();switch(e){case"L":return String(a+1);case"LL":return k(a+1,2);case"Lo":return t.ordinalNumber(a+1,{unit:"month"});case"LLL":return t.month(a,{width:"abbreviated",context:"standalone"});case"LLLLL":return t.month(a,{width:"narrow",context:"standalone"});case"LLLL":default:return t.month(a,{width:"wide",context:"standalone"})}},w:function(n,e,t,a){const r=st(n,a);return e==="wo"?t.ordinalNumber(r,{unit:"week"}):k(r,e.length)},I:function(n,e,t){const a=nt(n);return e==="Io"?t.ordinalNumber(a,{unit:"week"}):k(a,e.length)},d:function(n,e,t){return e==="do"?t.ordinalNumber(n.getDate(),{unit:"date"}):q.d(n,e)},D:function(n,e,t){const a=tt(n);return e==="Do"?t.ordinalNumber(a,{unit:"dayOfYear"}):k(a,e.length)},E:function(n,e,t){const a=n.getDay();switch(e){case"E":case"EE":case"EEE":return t.day(a,{width:"abbreviated",context:"formatting"});case"EEEEE":return t.day(a,{width:"narrow",context:"formatting"});case"EEEEEE":return t.day(a,{width:"short",context:"formatting"});case"EEEE":default:return t.day(a,{width:"wide",context:"formatting"})}},e:function(n,e,t,a){const r=n.getDay(),u=(r-a.weekStartsOn+8)%7||7;switch(e){case"e":return String(u);case"ee":return k(u,2);case"eo":return t.ordinalNumber(u,{unit:"day"});case"eee":return t.day(r,{width:"abbreviated",context:"formatting"});case"eeeee":return t.day(r,{width:"narrow",context:"formatting"});case"eeeeee":return t.day(r,{width:"short",context:"formatting"});case"eeee":default:return t.day(r,{width:"wide",context:"formatting"})}},c:function(n,e,t,a){const r=n.getDay(),u=(r-a.weekStartsOn+8)%7||7;switch(e){case"c":return String(u);case"cc":return k(u,e.length);case"co":return t.ordinalNumber(u,{unit:"day"});case"ccc":return t.day(r,{width:"abbreviated",context:"standalone"});case"ccccc":return t.day(r,{width:"narrow",context:"standalone"});case"cccccc":return t.day(r,{width:"short",context:"standalone"});case"cccc":default:return t.day(r,{width:"wide",context:"standalone"})}},i:function(n,e,t){const a=n.getDay(),r=a===0?7:a;switch(e){case"i":return String(r);case"ii":return k(r,e.length);case"io":return t.ordinalNumber(r,{unit:"day"});case"iii":return t.day(a,{width:"abbreviated",context:"formatting"});case"iiiii":return t.day(a,{width:"narrow",context:"formatting"});case"iiiiii":return t.day(a,{width:"short",context:"formatting"});case"iiii":default:return t.day(a,{width:"wide",context:"formatting"})}},a:function(n,e,t){const r=n.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return t.dayPeriod(r,{width:"abbreviated",context:"formatting"});case"aaa":return t.dayPeriod(r,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return t.dayPeriod(r,{width:"narrow",context:"formatting"});case"aaaa":default:return t.dayPeriod(r,{width:"wide",context:"formatting"})}},b:function(n,e,t){const a=n.getHours();let r;switch(a===12?r=G.noon:a===0?r=G.midnight:r=a/12>=1?"pm":"am",e){case"b":case"bb":return t.dayPeriod(r,{width:"abbreviated",context:"formatting"});case"bbb":return t.dayPeriod(r,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return t.dayPeriod(r,{width:"narrow",context:"formatting"});case"bbbb":default:return t.dayPeriod(r,{width:"wide",context:"formatting"})}},B:function(n,e,t){const a=n.getHours();let r;switch(a>=17?r=G.evening:a>=12?r=G.afternoon:a>=4?r=G.morning:r=G.night,e){case"B":case"BB":case"BBB":return t.dayPeriod(r,{width:"abbreviated",context:"formatting"});case"BBBBB":return t.dayPeriod(r,{width:"narrow",context:"formatting"});case"BBBB":default:return t.dayPeriod(r,{width:"wide",context:"formatting"})}},h:function(n,e,t){if(e==="ho"){let a=n.getHours()%12;return a===0&&(a=12),t.ordinalNumber(a,{unit:"hour"})}return q.h(n,e)},H:function(n,e,t){return e==="Ho"?t.ordinalNumber(n.getHours(),{unit:"hour"}):q.H(n,e)},K:function(n,e,t){const a=n.getHours()%12;return e==="Ko"?t.ordinalNumber(a,{unit:"hour"}):k(a,e.length)},k:function(n,e,t){let a=n.getHours();return a===0&&(a=24),e==="ko"?t.ordinalNumber(a,{unit:"hour"}):k(a,e.length)},m:function(n,e,t){return e==="mo"?t.ordinalNumber(n.getMinutes(),{unit:"minute"}):q.m(n,e)},s:function(n,e,t){return e==="so"?t.ordinalNumber(n.getSeconds(),{unit:"second"}):q.s(n,e)},S:function(n,e){return q.S(n,e)},X:function(n,e,t){const a=n.getTimezoneOffset();if(a===0)return"Z";switch(e){case"X":return pe(a);case"XXXX":case"XX":return B(a);case"XXXXX":case"XXX":default:return B(a,":")}},x:function(n,e,t){const a=n.getTimezoneOffset();switch(e){case"x":return pe(a);case"xxxx":case"xx":return B(a);case"xxxxx":case"xxx":default:return B(a,":")}},O:function(n,e,t){const a=n.getTimezoneOffset();switch(e){case"O":case"OO":case"OOO":return"GMT"+ge(a,":");case"OOOO":default:return"GMT"+B(a,":")}},z:function(n,e,t){const a=n.getTimezoneOffset();switch(e){case"z":case"zz":case"zzz":return"GMT"+ge(a,":");case"zzzz":default:return"GMT"+B(a,":")}},t:function(n,e,t){const a=Math.trunc(+n/1e3);return k(a,e.length)},T:function(n,e,t){return k(+n,e.length)}};function ge(n,e=""){const t=n>0?"-":"+",a=Math.abs(n),r=Math.trunc(a/60),u=a%60;return u===0?t+String(r):t+String(r)+e+k(u,2)}function pe(n,e){return n%60===0?(n>0?"-":"+")+k(Math.abs(n)/60,2):B(n,e)}function B(n,e=""){const t=n>0?"-":"+",a=Math.abs(n),r=k(Math.trunc(a/60),2),u=k(a%60,2);return t+r+e+u}const ye=(n,e)=>{switch(n){case"P":return e.date({width:"short"});case"PP":return e.date({width:"medium"});case"PPP":return e.date({width:"long"});case"PPPP":default:return e.date({width:"full"})}},Te=(n,e)=>{switch(n){case"p":return e.time({width:"short"});case"pp":return e.time({width:"medium"});case"ppp":return e.time({width:"long"});case"pppp":default:return e.time({width:"full"})}},rt=(n,e)=>{const t=n.match(/(P+)(p+)?/)||[],a=t[1],r=t[2];if(!r)return ye(n,e);let u;switch(a){case"P":u=e.dateTime({width:"short"});break;case"PP":u=e.dateTime({width:"medium"});break;case"PPP":u=e.dateTime({width:"long"});break;case"PPPP":default:u=e.dateTime({width:"full"});break}return u.replace("{{date}}",ye(a,e)).replace("{{time}}",Te(r,e))},ot={p:Te,P:rt},it=/^D+$/,lt=/^Y+$/,ut=["D","DD","YY","YYYY"];function ct(n){return it.test(n)}function dt(n){return lt.test(n)}function ft(n,e,t){const a=vt(n,e,t);if(console.warn(a),ut.includes(n))throw new RangeError(a)}function vt(n,e,t){const a=n[0]==="Y"?"years":"days of the month";return`Use \`${n.toLowerCase()}\` instead of \`${n}\` (in \`${e}\`) for formatting ${a} to the input \`${t}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const mt=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,ht=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,gt=/^'([^]*?)'?$/,pt=/''/g,yt=/[a-zA-Z]/;function ae(n,e,t){var T,f,o,y;const a=oe(),r=a.locale??Ue,u=a.firstWeekContainsDate??((f=(T=a.locale)==null?void 0:T.options)==null?void 0:f.firstWeekContainsDate)??1,g=a.weekStartsOn??((y=(o=a.locale)==null?void 0:o.options)==null?void 0:y.weekStartsOn)??0,D=U(n,t==null?void 0:t.in);if(!ze(D))throw new RangeError("Invalid time value");let w=e.match(ht).map(l=>{const i=l[0];if(i==="p"||i==="P"){const b=ot[i];return b(l,r.formatLong)}return l}).join("").match(mt).map(l=>{if(l==="''")return{isToken:!1,value:"'"};const i=l[0];if(i==="'")return{isToken:!1,value:wt(l)};if(he[i])return{isToken:!0,value:l};if(i.match(yt))throw new RangeError("Format string contains an unescaped latin alphabet character `"+i+"`");return{isToken:!1,value:l}});r.localize.preprocessor&&(w=r.localize.preprocessor(D,w));const d={firstWeekContainsDate:u,weekStartsOn:g,locale:r};return w.map(l=>{if(!l.isToken)return l.value;const i=l.value;(dt(i)||ct(i))&&ft(i,e,String(n));const b=he[i[0]];return b(D,i,r.localize,d)}).join("")}function wt(n){const e=n.match(gt);return e?e[1].replace(pt,"'"):n}const bt={class:"modal-content"},kt={class:"form-group"},Dt={class:"type-selector"},_t=["onClick"],xt={key:0,class:"form-group"},Tt={key:1,class:"form-group"},Ot={key:2},Mt={class:"form-group"},$t={class:"datetime-group"},St={class:"form-group"},Ct={key:3,class:"form-group"},Et={class:"period-management-area"},Pt={class:"date-picker-row"},Yt={key:0,class:"record-list"},Ft={class:"record-dates"},Nt=["onClick"],Wt={__name:"EventFormModal",props:{visible:Boolean,selectedDate:Date},emits:["close","submit","submit-period"],setup(n,{emit:e}){const t=n,a=e,r=se(),u=[{label:"待办",value:"todo"},{label:"倒数日",value:"countdown"},{label:"纪念日",value:"anniversary"},{label:"经期",value:"period"}],g=fe({start:"",end:""}),D=C([]),w=()=>({type:"todo",title:"",date:t.selectedDate?t.selectedDate.toISOString().split("T")[0]:new Date().toISOString().split("T")[0],time:new Date().toTimeString().slice(0,5),details:"",content:""}),d=fe(w());Be(()=>t.visible,l=>{if(l){D.value=JSON.parse(JSON.stringify(r.periodHistory));const i=(t.selectedDate||new Date).toISOString().split("T")[0];d.date=i,g.start=i,g.end=i}});const T=()=>{if(!(!g.start||!g.end)){if(new Date(g.end)<new Date(g.start)){alert("结束日期不能早于开始日期");return}D.value.push({...g}),D.value.sort((l,i)=>new Date(l.start)-new Date(i.start))}},f=l=>{D.value.splice(l,1)},o=()=>{a("close"),Object.assign(d,w())},y=()=>{if(d.type==="period"){a("submit-period",D.value),o();return}const l={...d};if(l.type==="todo"){if(!l.details.trim()){alert("待办内容不能为空！");return}l.date=`${l.date}T${l.time}:00`,l.content=l.details,delete l.details,delete l.title,delete l.time}a("submit",l),o()};return(l,i)=>n.visible?(m(),h("div",{key:0,class:"event-modal-overlay",onClick:A(o,["self"])},[s("div",bt,[i[14]||(i[14]=s("h3",{class:"modal-title"},"添加事件",-1)),s("div",kt,[i[7]||(i[7]=s("label",null,"事件类型",-1)),s("div",Dt,[(m(),h(F,null,H(u,b=>s("button",{key:b.value,class:R({active:d.type===b.value}),onClick:M=>d.type=b.value},_(b.label),11,_t)),64))])]),d.type!=="period"&&d.type!=="todo"?(m(),h("div",xt,[i[8]||(i[8]=s("label",null,"标题",-1)),W(s("input",{type:"text","onUpdate:modelValue":i[0]||(i[0]=b=>d.title=b),placeholder:"例如：生日"},null,512),[[I,d.title]])])):Y("",!0),d.type==="countdown"||d.type==="anniversary"?(m(),h("div",Tt,[i[9]||(i[9]=s("label",null,"日期",-1)),W(s("input",{type:"date","onUpdate:modelValue":i[1]||(i[1]=b=>d.date=b)},null,512),[[I,d.date]])])):Y("",!0),d.type==="todo"?(m(),h("div",Ot,[s("div",Mt,[i[10]||(i[10]=s("label",null,"日期和时间",-1)),s("div",$t,[W(s("input",{type:"date","onUpdate:modelValue":i[2]||(i[2]=b=>d.date=b)},null,512),[[I,d.date]]),W(s("input",{type:"time","onUpdate:modelValue":i[3]||(i[3]=b=>d.time=b)},null,512),[[I,d.time]])])]),s("div",St,[i[11]||(i[11]=s("label",null,"待办内容",-1)),W(s("textarea",{"onUpdate:modelValue":i[4]||(i[4]=b=>d.details=b),placeholder:"记录需要做的事情..."},null,512),[[I,d.details]])])])):Y("",!0),d.type==="period"?(m(),h("div",Ct,[s("div",Et,[s("div",Pt,[W(s("input",{type:"date","onUpdate:modelValue":i[5]||(i[5]=b=>g.start=b)},null,512),[[I,g.start]]),i[12]||(i[12]=s("span",null,"-",-1)),W(s("input",{type:"date","onUpdate:modelValue":i[6]||(i[6]=b=>g.end=b)},null,512),[[I,g.end]]),s("button",{class:"btn btn-sm",onClick:T},"添加")]),D.value.length>0?(m(),h("div",Yt,[(m(!0),h(F,null,H(D.value,(b,M)=>(m(),h("div",{key:M,class:"record-item"},[s("span",Ft,_(b.start)+" ~ "+_(b.end),1),s("button",{class:"delete-record-btn",onClick:A(O=>f(M),["stop"])},[S(Q,{name:"x-mark",class:"delete-icon"})],8,Nt)]))),128))])):Y("",!0),i[13]||(i[13]=s("p",{class:"period-tip"},"管理您的经期记录（开始与结束日期），最多保留最近3条。",-1))])])):Y("",!0),s("div",{class:"modal-actions"},[s("button",{class:"btn-cancel",onClick:o},"取消"),s("button",{class:"btn-confirm",onClick:y},"确认")])])])):Y("",!0)}},It=z(Wt,[["__scopeId","data-v-841ee102"]]),qt={class:"period-item"},Ht=["disabled"],Ut=["disabled"],Bt=["title"],Rt={class:"content-wrapper"},Lt={key:0,class:"status-text"},Gt={class:"status-day-count"},Vt={key:1,class:"status-text"},Qt={key:2,class:"prediction-details"},Xt={class:"prediction-text"},jt={class:"stats-text"},At={__name:"PeriodTracker",props:{status:{type:String,required:!0},dayCount:{type:Number,default:null},selectedDate:{type:Date,required:!0}},setup(n){const e=n,{t}=Re(),a=se(),{periodHistory:r,ongoingPeriod:u,cycleStats:g,durationStats:D}=be(a),w=C({visible:!1,title:t("calendar.periodTracker.recordTitle"),message:t("calendar.periodTracker.recordMsg")}),d=x(()=>Le(r.value,u.value,2)),T=x(()=>{switch(e.status){case"actual":case"ongoing":return"var(--C-red)";case"predicted":return"var(--C-pink)";default:return"var(---text-tertiary)"}}),f=x(()=>u.value?t("calendar.periodTracker.end"):t("calendar.periodTracker.start")),o=x(()=>{if(d.value.length===0)return"暂无预测";const M=d.value[0],O=ae(ve(M.start),"M月d日"),E=ae(ve(M.end),"M月d日");return`下次预测: ${O} - ${E}`}),y=x(()=>{const{status:M,dayCount:O,selectedDate:E}=e;switch(M){case"actual":case"ongoing":return{prefix:"经期第",number:O,suffix:"天"};case"predicted":return{prefix:"预测第",number:O,suffix:"天"};default:if(d.value.length>0){const $=me(new Date(d.value[0].start)),L=me(E),P=ke($,L);if(P>0)return{prefix:"预计",number:P,suffix:"天后"}}return{prefix:"添加历史记录以开始预测",number:null,suffix:""}}}),l=()=>{w.value.visible=!0},i=()=>{const M=K(e.selectedDate,{representation:"date"});a.recordPeriod(M),w.value.visible=!1},b=()=>{const M=K(e.selectedDate,{representation:"date"});a.endPeriod(M),w.value.visible=!1};return(M,O)=>(m(),h("div",qt,[O[2]||(O[2]=s("div",{class:"washi-tape"},null,-1)),S(De,{visible:w.value.visible,title:w.value.title,"onUpdate:visible":O[0]||(O[0]=E=>w.value.visible=!1)},{footer:X(()=>[s("button",{class:"modal-btn",onClick:i,disabled:!!V(u)},_(M.$t("calendar.periodTracker.start")),9,Ht),s("button",{class:"modal-btn confirm",onClick:b,disabled:!V(u)},_(M.$t("calendar.periodTracker.end")),9,Ut)]),default:X(()=>[s("p",null,_(w.value.message),1)]),_:1},8,["visible","title"]),s("div",{class:"status-button",onClick:l,title:f.value},[s("div",{class:"status-indicator",style:Ge({backgroundColor:T.value})},null,4)],8,Bt),s("div",Rt,[O[1]||(O[1]=s("h3",{class:"item-title"},"Period",-1)),y.value.number!==null?(m(),h("p",Lt,[te(_(y.value.prefix)+" ",1),s("span",Gt,_(y.value.number),1),te(" "+_(y.value.suffix),1)])):(m(),h("p",Vt,_(y.value.prefix),1)),V(a).periodHistory.length>0?(m(),h("div",Qt,[s("p",Xt,_(o.value),1),s("p",jt," 平均周期 "+_(V(g).average)+" 天 · 平均经期 "+_(V(D).average)+" 天 ",1)])):Y("",!0)])]))}},Jt=z(At,[["__scopeId","data-v-fd83e02b"]]),Kt={key:0,class:"sticker-card todo-card"},Zt={class:"todo-list"},zt=["onClick"],en={key:0,class:"edit-container"},tn=["onClick"],nn={class:"todo-time"},an=["onClick"],sn={__name:"ToDoList",props:{todos:{type:Array,required:!0}},setup(n){const e=se(),t=C(null),a=C(null),r=C(!1),u=()=>{r.value=!0},g=f=>{const o=new Date(f.date);t.value={...f,time:o.toTimeString().slice(0,5)},Qe(()=>{var y,l;(l=(y=a.value)==null?void 0:y[0])==null||l.focus()})},D=()=>{if(r.value){r.value=!1;return}if(!t.value)return;if(!t.value.content.trim()){w(t.value.id);return}const f=new Date(t.value.date),[o,y]=t.value.time.split(":").map(Number);f.setHours(o,y);const l={...t.value,date:f.toISOString()};delete l.time,e.updateEvent(l),t.value=null},w=f=>{e.removeEvent(f),t.value=null},d=f=>{e.toggleTodoStatus(f)},T=f=>f?new Date(f).toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit",hour12:!1}):"";return(f,o)=>n.todos.length>0?(m(),h("div",Kt,[o[2]||(o[2]=s("h3",{class:"handwritten-title"},"To Do List",-1)),o[3]||(o[3]=s("div",{class:"tape-deco"},null,-1)),s("ul",Zt,[(m(!0),h(F,null,H(n.todos,y=>(m(),h("li",{key:y.id,class:R({done:y.done})},[s("div",{class:R(["checkbox",{checked:y.done}]),onClick:l=>d(y.id)},null,10,zt),t.value&&t.value.id===y.id?(m(),h("div",en,[W(s("input",{type:"time","onUpdate:modelValue":o[0]||(o[0]=l=>t.value.time=l),class:"base-input-mini",onMousedown:u},null,544),[[I,t.value.time]]),W(s("input",{type:"text","onUpdate:modelValue":o[1]||(o[1]=l=>t.value.content=l),onBlur:D,onKeyup:Ve(D,["enter"]),class:"base-input",ref_for:!0,ref_key:"editInputRef",ref:a},null,544),[[I,t.value.content]]),s("button",{class:"delete-btn",onMousedown:u,onClick:l=>w(y.id)},[S(Q,{name:"x-mark"})],40,tn)])):(m(),h(F,{key:1},[s("span",nn,_(T(y.date)),1),s("span",{class:"todo-content",onClick:l=>g(y)},_((y.content||"").trim()||"[空内容]"),9,an)],64))],2))),128))])])):Y("",!0)}},rn=z(sn,[["__scopeId","data-v-35d239c0"]]),on={class:"polaroid-wrapper"},ln=["src"],un={key:1,class:"placeholder"},cn={class:"caption"},dn=["value"],fn={class:"info"},vn={class:"label"},mn={class:"days-row"},hn={class:"big-num"},gn={class:"date-tag"},pn={class:"left"},yn={class:"title"},wn={class:"date"},bn={class:"days-block"},kn={class:"num"},Dn={__name:"DaysCount",props:{event:{type:Object,required:!0},selectedDate:{type:Date,default:()=>new Date}},emits:["update:polaroidText","delete","upload-photo"],setup(n,{emit:e}){const t=n,a=e;let r=null;const u=()=>{r=setTimeout(()=>{a("delete",t.event)},800)},g=()=>{r&&(clearTimeout(r),r=null)},D=x(()=>t.event.type==="anniversary"),w=x(()=>{if(!t.event.date)return 0;const f=new Date(t.event.date),o=new Date(t.selectedDate);return Math.abs(ke(o,f))}),d=x(()=>{if(!t.event.date)return"";const f=new Date(t.event.date);return ae(f,"yyyy.MM.dd")}),T=x(()=>{if(!t.event.date)return"";const f=new Date(t.event.date);return ae(f,"yyyy.MM.dd EEEE")});return(f,o)=>(m(),h("div",{class:R(["base-card",D.value?"anniversary-card":"countdown-card"]),onTouchstart:u,onTouchend:g,onTouchmove:g,onMousedown:u,onMouseup:g,onMouseleave:g},[D.value?(m(),h(F,{key:0},[s("div",on,[o[4]||(o[4]=s("div",{class:"tape"},null,-1)),s("div",{class:"photo-area",onClick:o[0]||(o[0]=A(y=>f.$emit("upload-photo",n.event),["stop"]))},[n.event.photoUrl?(m(),h("img",{key:0,src:n.event.photoUrl,class:"polaroid-img"},null,8,ln)):(m(),h("div",un,[...o[3]||(o[3]=[te("点击",-1),s("br",null,null,-1),te("上传",-1)])]))]),s("div",cn,[s("input",{type:"text",value:n.event.polaroidText,onInput:o[1]||(o[1]=y=>f.$emit("update:polaroidText",y.target.value)),placeholder:"写点什么...",onClick:o[2]||(o[2]=A(()=>{},["stop"]))},null,40,dn)])]),s("div",fn,[o[6]||(o[6]=s("div",{class:"tag"},"ANNIVERSARY",-1)),s("div",vn,_(n.event.title||"纪念日"),1),s("div",mn,[s("span",hn,_(w.value),1),o[5]||(o[5]=s("span",{class:"unit"},"Days",-1))]),s("span",gn,"Since "+_(d.value),1)])],64)):(m(),h(F,{key:1},[o[9]||(o[9]=s("div",{class:"corner-line"},null,-1)),o[10]||(o[10]=s("span",{class:"star-deco"},"✦",-1)),s("div",pn,[o[7]||(o[7]=s("div",{class:"tag-line"},[s("span",{class:"tag"},"COUNTDOWN"),s("span",{class:"line"})],-1)),s("h2",yn,_(n.event.title||"倒计时"),1),s("p",wn,_(T.value),1)]),s("div",bn,[s("span",kn,_(w.value),1),o[8]||(o[8]=s("span",{class:"unit"},"days",-1))])],64))],34))}},_n=z(Dn,[["__scopeId","data-v-31a9c63a"]]),xn={class:"page-container"},Tn={class:"calendar-section"},On={class:"cal-header"},Mn={class:"header-left"},$n={class:"m-en"},Sn={class:"m-cn"},Cn={class:"header-right"},En={key:0,class:"month-switcher"},Pn={key:0,class:"week-view"},Yn=["onClick"],Fn={class:"week-txt"},Nn={class:"day-num"},Wn={key:1,class:"month-view"},In={class:"grid-header"},qn={class:"grid-body"},Hn=["onClick"],Un={class:"events-display-section"},Bn={key:0,class:"period-tracker-container"},Rn={class:"cards-container"},Ln={key:1,class:"no-events-placeholder"},Gn={__name:"Calendar",setup(n){const e=se(),{ongoingPeriod:t}=be(e),a=C(!1),r=()=>{a.value=!0},u=c=>{e.addEvent(c)},g=c=>{e.setPeriodHistory(c)},D=(c,p)=>{const v={...c,polaroidText:p};e.updateEvent(v)},w=C(null),{triggerFileUpload:d}=Xe({onComplete:c=>{if(w.value){const p={...w.value,photoUrl:c.content};e.updateEvent(p),w.value=null}}}),T=c=>{w.value=c,d()},f=C(!1),o=C(null),y=c=>{o.value=c,f.value=!0},l=()=>{o.value&&(e.removeEvent(o.value.id),o.value=null),f.value=!1},i=["日","一","二","三","四","五","六"],b=["SUN","MON","TUE","WED","THU","FRI","SAT"],M=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],O=new Date,E=C(!1),$=C(new Date),L=C(new Date(O.getFullYear(),O.getMonth(),1)),P=x(()=>L.value.getFullYear()),N=x(()=>L.value.getMonth()),Oe=x(()=>M[N.value]),Me=x(()=>new Date(P.value,N.value+1,0).getDate()),$e=x(()=>new Date(P.value,N.value,1).getDay()),Se=x(()=>{const c=new Date($.value),p=[],v=c.getDay(),J=c.getDate()-v;for(let re=0;re<7;re++){let ee=new Date(c);ee.setDate(J+re),p.push({date:ee,day:ee.getDate(),week:b[ee.getDay()]})}return p}),ie=()=>{E.value=!E.value,E.value||($.value=new Date),L.value=new Date($.value.getFullYear(),$.value.getMonth(),1)},le=c=>L.value=new Date(P.value,N.value+c,1),ue=(c,p)=>c.getDate()===p.getDate()&&c.getMonth()===p.getMonth()&&c.getFullYear()===p.getFullYear(),Ce=c=>c===O.getDate()&&N.value===O.getMonth()&&P.value===O.getFullYear(),Ee=c=>c===$.value.getDate()&&N.value===$.value.getMonth()&&P.value===$.value.getFullYear(),Pe=c=>$.value=c,Ye=c=>$.value=new Date(P.value,N.value,c),Fe=x(()=>e.getEventsByDate($.value)),ce=x(()=>Fe.value.filter(c=>c.type==="todo")),Ne=x(()=>e.events.filter(c=>c.type==="countdown"||c.type==="anniversary")),de=x(()=>{const c=K($.value,{representation:"date"});return je(c,e.periodHistory,t.value)}),We=x(()=>{const c={};for(const p of e.events){if(!p.date)continue;const v=K(new Date(p.date),{representation:"date"});p.type==="period_day"?c[v]="event-dot actual-dot":p.type==="predicted_period_day"?c[v]!=="event-dot actual-dot"&&(c[v]="event-dot predicted-dot"):c[v]||(c[v]="event-dot normal-dot")}return c}),Ie=c=>{const p=K(c,{representation:"date"});return We.value[p]||""},qe=c=>{const p=new Date(P.value,N.value,c);return Ie(p)};return(c,p)=>(m(),Ae(Je,{title:"日历","no-padding":!0},{action:X(()=>[s("button",{class:"header-action-btn",onClick:r},[S(Q,{name:"plus"})])]),default:X(()=>[s("div",xn,[s("div",Tn,[s("div",On,[s("div",Mn,[s("div",{class:"month-display",onClick:ie},[s("span",$n,_(Oe.value),1),s("span",Sn,_(P.value)+"年"+_(N.value+1)+"月",1)])]),s("div",Cn,[E.value?(m(),h("div",En,[s("button",{onClick:p[0]||(p[0]=A(v=>le(-1),["stop"]))},[S(Q,{name:"chevron-left"})]),s("button",{onClick:p[1]||(p[1]=A(v=>le(1),["stop"]))},[S(Q,{name:"chevron-right"})])])):Y("",!0),s("button",{class:"toggle-btn",onClick:ie},[S(Q,{name:E.value?"chevron-up":"chevron-down",className:"cal-toggle-icon"},null,8,["name"])])])]),E.value?(m(),h("div",Wn,[s("div",In,[(m(),h(F,null,H(i,v=>s("span",{key:v},_(v),1)),64))]),s("div",qn,[(m(!0),h(F,null,H($e.value,v=>(m(),h("div",{key:"empty-"+v,class:"grid-cell empty"}))),128)),(m(!0),h(F,null,H(Me.value,v=>(m(),h("div",{key:v,class:R(["grid-cell",{active:Ee(v),today:Ce(v)}]),onClick:J=>Ye(v)},[s("span",null,_(v),1),s("div",{class:R(qe(v))},null,2)],10,Hn))),128))])])):(m(),h("div",Pn,[(m(!0),h(F,null,H(Se.value,v=>(m(),h("div",{key:v.date,class:R(["day-item",{active:ue(v.date,$.value),"is-today":ue(v.date,new Date)}]),onClick:J=>Pe(v.date)},[s("span",Fn,_(v.week),1),s("span",Nn,_(v.day),1)],10,Yn))),128))]))]),s("div",Un,[V(e).periodHistory.length>0?(m(),h("div",Bn,[S(Jt,{status:de.value.status,"day-count":de.value.dayCount,"selected-date":$.value},null,8,["status","day-count","selected-date"])])):Y("",!0),s("div",Rn,[(m(!0),h(F,null,H(Ne.value,v=>(m(),h("div",{key:v.id},[S(_n,{event:v,"selected-date":$.value,"onUpdate:polaroidText":J=>D(v,J),onDelete:y,onUploadPhoto:T},null,8,["event","selected-date","onUpdate:polaroidText"])]))),128)),S(rn,{todos:ce.value},null,8,["todos"])]),ce.value.length===0?(m(),h("div",Ln,[...p[5]||(p[5]=[s("p",null,"今天没有特别的安排",-1),s("span",null,"点击右上角按钮添加一个吧",-1)])])):Y("",!0)]),S(It,{visible:a.value,"selected-date":$.value,onClose:p[2]||(p[2]=v=>a.value=!1),onSubmit:u,onSubmitPeriod:g},null,8,["visible","selected-date"]),S(De,{visible:f.value,title:"确认删除","onUpdate:visible":p[4]||(p[4]=v=>f.value=v)},{footer:X(()=>[s("button",{class:"modal-btn cancel",onClick:p[3]||(p[3]=v=>f.value=!1)},"取消"),s("button",{class:"modal-btn danger",onClick:l},"删除")]),default:X(()=>[p[6]||(p[6]=s("p",{style:{padding:"10px 0",color:"#666"}},"确定要删除这个事件吗？",-1))]),_:1},8,["visible"])])]),_:1}))}},Qn=z(Gn,[["__scopeId","data-v-702792e1"]]);export{Qn as default};
