import{_ as St,m as Pt,s as xt,t as It,X as Bt,Y as Ut,R as Le,Z as Vt,U as Tt,$ as At,r as i,c as B,x as Re,v as Dt,k as Mt,b as v,f as e,g as r,A as o,j as l,n as b,S as U,w as C,a0 as w,N as Lt,M as $e,o as g,d as f,y as h,z as p,D as ze}from"./index-C-6dXFG9.js";import{C as Ie}from"./CustomSelect-BdJafvT_.js";import{M as Ne}from"./MultiSelect-X9wWgH0Z.js";const Rt={class:"chat-settings active"},$t={class:"app-header"},zt={class:"title"},Nt={class:"action-btn"},Ot={class:"app-content settings-content"},Et={class:"card"},Wt={key:"roleInfo"},jt={class:"card-content"},Ft={class:"role-header-layout"},Ht=["src"],qt={key:1,class:"role-avatar-placeholder"},Gt={class:"role-inputs-wrapper"},Kt=["placeholder"],Xt=["placeholder"],Yt={class:"form-item-vertical"},Zt={class:"label-main",style:{"margin-bottom":"5px"}},Jt=["placeholder"],Qt={class:"card"},es={key:"userInfo"},ts={class:"card-content"},ss={class:"settings-pure-item",style:{"border-bottom":"none"}},as={class:"settings-pure-label"},ls={class:"user-header-layout"},ns=["src"],os={key:1,class:"role-avatar-placeholder"},is={class:"user-inputs-wrapper"},cs={class:"user-actions-row"},ds=["placeholder"],rs={class:"form-item-vertical"},us={class:"label-main",style:{"margin-bottom":"5px"}},vs=["placeholder"],gs={class:"card"},hs={class:"card-title-remark"},ps={key:"backgroundActivity"},ms={class:"card-content"},bs={class:"settings-item-input"},_s={class:"label-col"},Cs={class:"label-main"},fs={class:"settings-pure-value"},ys={class:"settings-item-input"},ks={class:"label-col"},ws={class:"label-main"},Ss={class:"label-sub"},Ps={class:"mode-selector"},xs={key:0},Is={class:"settings-item-input"},Bs={class:"label-col"},Us={class:"label-main"},Vs={class:"label-sub"},Ts={class:"settings-item-input"},As={class:"label-col"},Ds={class:"label-main"},Ms={class:"label-sub"},Ls={class:"settings-item-input"},Rs={class:"label-col"},$s={class:"label-main"},zs={class:"label-sub"},Ns={class:"settings-item-input"},Os={class:"label-col"},Es={class:"label-main"},Ws={class:"label-sub"},js={class:"mode-selector"},Fs={key:0,class:"settings-item-input"},Hs={class:"label-col"},qs={class:"label-main"},Gs={class:"label-sub"},Ks={class:"card"},Xs={key:"modeSettings"},Ys={class:"card-content"},Zs={class:"settings-pure-item"},Js={class:"settings-pure-label"},Qs={class:"mode-selector"},ea={key:0,class:"settings-pure-item"},ta={class:"settings-pure-label"},sa={class:"settings-pure-item"},aa={class:"settings-pure-label"},la={class:"settings-item-input"},na={class:"label-col"},oa={class:"label-main"},ia={class:"label-sub"},ca={class:"reply-length-container"},da=["placeholder"],ra=["placeholder"],ua={class:"card"},va={key:"realtimeSense"},ga={class:"card-content"},ha={class:"settings-item-input"},pa={class:"settings-item-input"},ma={key:0},ba={class:"form-item-vertical"},_a={class:"location-input-group"},Ca={class:"location-display"},fa={class:"form-item-vertical"},ya={class:"location-input-group"},ka={class:"location-display"},wa={class:"card"},Sa={key:"summarySettings"},Pa={class:"card-content"},xa={class:"settings-item-input"},Ia={class:"label-col"},Ba={class:"label-main"},Ua={class:"label-sub"},Va={class:"form-item-vertical"},Ta={class:"label-main",style:{"margin-bottom":"5px"}},Aa=["placeholder"],Da={class:"settings-item-input"},Ma={class:"label-col"},La={class:"label-main"},Ra={class:"label-sub"},$a={class:"settings-btn-row flex-distribute-children",style:{padding:"15px 0","border-bottom":"1px solid #f5f5f5"}},za={class:"settings-item-input"},Na={class:"label-col"},Oa={class:"label-main"},Ea={class:"label-sub"},Wa={class:"settings-pure-item"},ja={class:"settings-pure-label"},Fa={class:"settings-pure-item"},Ha={class:"settings-pure-label"},qa={class:"settings-pure-value"},Ga={class:"settings-pure-item"},Ka={class:"settings-pure-label"},Xa={class:"settings-pure-value"},Ya={class:"card"},Za={key:"bubbleSettings"},Ja={class:"card-content"},Qa={class:"settings-section-title"},el={class:"settings-row-group"},tl={class:"settings-pure-label",style:{width:"60px"}},sl={style:{flex:"1",margin:"0 10px"}},al={class:"btn-group-mini"},ll=["disabled"],nl={class:"bubble-preview-container"},ol={class:"bubble-preview-area"},il={class:"preview-msg-row left"},cl={class:"preview-avatar char"},dl=["src"],rl={key:1,class:"default-avatar"},ul={class:"preview-msg-row right"},vl={class:"preview-avatar user"},gl=["src"],hl={key:1,class:"default-avatar"},pl={class:"settings-item-input"},ml={class:"label-col"},bl={class:"label-main"},_l={class:"slider-container gray-slider"},Cl={class:"slider-value"},fl={class:"form-item-vertical no-border"},yl={class:"label-main",style:{"margin-bottom":"5px"}},kl=["placeholder"],wl={class:"settings-section-title"},Sl={class:"settings-item-avatar",style:{"border-bottom":"none","margin-bottom":"0"}},Pl={class:"avatar-layout"},xl={class:"avatar-controls",style:{width:"100%"}},Il={class:"card"},Bl={key:"videoSettings"},Ul={class:"card-content"},Vl={class:"video-settings-container"},Tl={class:"video-setting-col"},Al={class:"settings-item-label center"},Dl=["src"],Ml={key:1,class:"default-avatar bg-placeholder"},Ll={class:"video-setting-col"},Rl={class:"settings-item-label center"},$l=["src"],zl={key:1,class:"default-avatar bg-placeholder"},Nl={class:"card"},Ol={key:"advancedSettings"},El={class:"card-content"},Wl={class:"settings-pure-item"},jl={class:"settings-pure-label"},Fl={class:"settings-pure-value"},Hl={class:"danger-zone"},ql={class:"danger-btn-content"},Gl={class:"danger-btn-title"},Kl={class:"danger-btn-desc"},Xl={class:"danger-btn-content"},Yl={class:"danger-btn-title"},Zl={class:"danger-btn-desc"},Jl={class:"danger-btn-content"},Ql={class:"danger-btn-title"},en={class:"danger-btn-desc"},tn={class:"modal-options centered-text"},sn={class:"option-text"},an={class:"option-text"},ln={class:"option-text"},nn=["placeholder"],on={__name:"SingleChatSettings",props:{id:{type:String,required:!0}},setup(Oe){const V=Oe,{t:s}=Pt(),Ce=Mt(),d=xt(),u=It(),Be=Bt(),Ee=Ut(),{sortedWorldBooks:We}=Le(Ee),je=Vt(),{sortedPresets:Fe}=Le(je);Tt();const{fetchLocationWeather:He}=At(),m=i({roleInfo:!1,userInfo:!1,backgroundActivity:!1,modeSettings:!1,realtimeSense:!1,summarySettings:!1,bubbleSettings:!1,videoSettings:!1,advancedSettings:!1}),T=i(!1),S=i(""),ae=i(""),le=i(""),ne=i(""),_=i("default"),W=i(""),G=i(""),P=i(""),y=i("default"),oe=i(5),ie=i(30),ce=i(10),z=i("always"),de=i(15),N=i(!0),re=i([]),ue=i([]),K=i(""),X=i(""),Y=i(!1),j=i(!1),Z=i(""),J=i(""),fe=i(""),Q=i(""),ee=i(""),ye=i(""),A=i({}),D=i({}),ve=i(20),ge=i(""),te=i(!1),he=i(10),O=i(!1),se=i(!1),pe=i(""),M=i(""),L=i(""),R=i(14),F=i(""),H=i(""),$=i(""),ke=i("default"),Ue=i(0),q=i(!1),we=i(0),me=i(0),k=B(()=>d.getCharacter(V.id)),be=B(()=>{var n;return((n=k.value)==null?void 0:n.name)||s("chat.unknownCharacter")}),_e=B(()=>{var n;return(n=k.value)==null?void 0:n.avatar}),qe=B(()=>[{value:"default",label:s("chat.singleChat.settings.defaultUserPersona")},...(d.userPersonas||[]).map(n=>({value:n.id,label:n.name}))]),Ge=B(()=>[{value:"default",label:s("chat.singleChat.settings.default")+"配置"},{value:"api1",label:"配置一"},{value:"api2",label:"配置二"}]),Ke=B(()=>[{value:"",label:s("chat.singleChat.settings.custom")},...(d.bubblePresets||[]).map(n=>({value:n.id,label:n.name}))]),Xe=B(()=>y.value==="on"?!0:y.value==="off"?!1:Be.globalBackgroundActivity),Ve=B(()=>{const n={fontSize:`${R.value}px`};if(!L.value)return n;const t={};return L.value.split(";").forEach(a=>{const c=a.split(":");if(c.length>=2){const I=c[0].trim(),E=c.slice(1).join(":").trim();I&&E&&(t[I]=E)}}),{...n,...t}}),Ye=B(()=>({avatar:s("chat.singleChat.settings.toast.setCharAvatar"),userPersonaAvatar:s("chat.singleChat.settings.toast.setUserAvatar"),chatBg:s("chat.singleChat.settings.toast.setChatBg"),videoBg:s("chat.singleChat.settings.toast.setCharImg"),userVideoImg:s("chat.singleChat.settings.toast.setUserImg")})[S.value]||s("chat.singleChat.settings.toast.upload"));Re(_,n=>{n&&xe(n)}),Re(M,n=>{n&&ot(n)}),Dt(()=>{if(!k.value){Se();return}at()});const x=n=>{m.value[n]=!m.value[n]},Se=()=>{Ce.back()},Ze=()=>{Ce.push({name:"memory-bank",params:{charId:V.id}})},Je=()=>{S.value="avatar",T.value=!0},Qe=()=>{S.value="userPersonaAvatar",T.value=!0},et=()=>{S.value="chatBg",T.value=!0},tt=()=>{S.value="videoBg",T.value=!0},st=()=>{S.value="userVideoImg",T.value=!0},at=()=>{var De;const n=k.value;ae.value=n.name,le.value=n.nickname||"",ne.value=n.charPersona||"",_.value=n.userPersona||"default",xe(_.value),y.value=n.backgroundActivityOverride||"default",oe.value=n.proactiveInterval||5,ie.value=n.proactiveCooldown||30,ce.value=n.proactiveDailyLimit||10,z.value=n.triggerMode||"always",de.value=n.proactiveIdleTime||15,N.value=n.isOnline!==!1,re.value=Array.isArray(n.preset)?n.preset:n.preset?[n.preset]:[],ue.value=n.worldbook||[];const[t,a]=(n.replyLength||(N.value?"10-50":"200-500")).split("-");K.value=t||"",X.value=a||"";const c=n.realtimeSettings||{timeEnabled:!1,weatherEnabled:!1,charLocation:{},userLocation:{}};Y.value=c.timeEnabled,j.value=c.weatherEnabled,A.value=c.charLocation||{},D.value=c.userLocation||{},Z.value=A.value.real||"",J.value=A.value.virtual||"",fe.value=A.value.shortDisplay||"",Q.value=D.value.real||"",ee.value=D.value.virtual||"",ye.value=D.value.shortDisplay||"",ve.value=n.summaryRange||20,ge.value=n.summaryPrompt||"",te.value=n.autoSummary||!1,he.value=n.memoryCount||10;const I=n.bubbleSettings||{};L.value=I.css||"",R.value=I.fontSize||14,F.value=n.chatBackground||"",H.value=n.videoBg||"",$.value=n.userVideoImg||"",ke.value=n.api||"default",Ue.value=((De=n.npc)==null?void 0:De.length)||0,q.value=n.isBlocked||!1;const E=d.messages[V.id]||[];me.value=E.length,we.value=Math.ceil(E.reduce((kt,wt)=>{var Me;return kt+(((Me=wt.content)==null?void 0:Me.length)||0)},0)*1.5)},Pe=()=>{const n=k.value;if(!n)return;const t=_.value;let a=d.userPersonas.find(c=>c.id===t);t==="default"&&(a||(a={id:"default",name:s("chat.singleChat.settings.defaultUserPersona"),avatar:"",description:"",videoImg:""},d.userPersonas.unshift(a))),a&&(a.id!=="default"&&W.value.trim()&&(a.name=W.value.trim()),a.description=G.value,a.avatar=P.value,a.videoImg=$.value),A.value.real=Z.value,A.value.virtual=J.value,D.value.real=Q.value,D.value.virtual=ee.value,Object.assign(n,{name:ae.value.trim()||n.name,nickname:le.value.trim(),charPersona:ne.value,userPersona:_.value,backgroundActivityOverride:y.value,proactiveInterval:oe.value,proactiveCooldown:ie.value,proactiveDailyLimit:ce.value,triggerMode:z.value,proactiveIdleTime:de.value,isOnline:N.value,preset:re.value,worldbook:ue.value,replyLength:`${K.value}-${X.value}`,realtimeSettings:{timeEnabled:Y.value,weatherEnabled:j.value,charLocation:A.value,userLocation:D.value},summaryRange:ve.value,summaryPrompt:ge.value,autoSummary:te.value,memoryCount:he.value,bubbleSettings:{css:L.value,fontSize:R.value},chatBackground:F.value,videoBg:H.value,isBlocked:q.value}),d.saveData(),u.showToast(s("theme.toast.saveSuccess"))},xe=n=>{const t=s("chat.singleChat.settings.defaultUserPersona");let a=d.userPersonas.find(c=>c.id===n)||{name:t,avatar:"",description:"",videoImg:""};W.value=a.name===t?"":a.name,G.value=a.description||"",P.value=a.avatar||"",n!=="default"&&($.value=a.videoImg||"")},lt=()=>{const n=W.value.trim();if(!n)return u.showToast(s("chat.singleChat.settings.toast.personaNameRequired"),"error");const t={id:_.value==="default"?Date.now().toString():_.value,name:n,description:G.value,avatar:P.value,videoImg:$.value};if(_.value==="default")d.userPersonas.push(t),_.value=t.id,u.showToast(s("chat.singleChat.settings.toast.personaSaved"));else{const a=d.userPersonas.findIndex(c=>c.id===_.value);a!==-1&&(d.userPersonas[a]=t,u.showToast(s("chat.singleChat.settings.toast.personaUpdated")))}d.saveData()},nt=()=>{if(_.value==="default")return u.showToast(s("chat.singleChat.settings.toast.defaultPersonaDelete"),"error");u.showConfirm(s("chat.singleChat.settings.toast.deletePersona"),s("chat.singleChat.settings.toast.confirmDeletePersona"),()=>{d.userPersonas=d.userPersonas.filter(n=>n.id!==_.value),d.characters.forEach(n=>{n.userPersona===_.value&&(n.userPersona="default")}),_.value="default",xe("default"),d.saveData()})},ot=n=>{if(!n)return;const t=d.bubblePresets.find(a=>a.id===n);t&&(L.value=t.css,R.value=t.fontSize)},it=()=>{const n=prompt(s("chat.singleChat.settings.toast.presetNameRequired"));if(!n)return;const t={id:Date.now().toString(),name:n,css:L.value,fontSize:R.value};d.bubblePresets.push(t),d.saveData(),M.value=t.id,u.showToast(s("chat.singleChat.settings.toast.presetSaved"))},ct=()=>{M.value&&u.showConfirm(s("chat.singleChat.settings.toast.deleteBubblePreset"),s("chat.singleChat.settings.toast.confirmDeleteBubblePreset"),()=>{d.bubblePresets=d.bubblePresets.filter(n=>n.id!==M.value),d.saveData(),M.value="",u.showToast(s("chat.singleChat.settings.toast.presetDeleted"))})},dt=n=>{const t=n.content;switch(S.value){case"avatar":k.value&&(k.value.avatar=t);break;case"userPersonaAvatar":P.value=t;break;case"chatBg":F.value=t;break;case"videoBg":H.value=t;break;case"userVideoImg":$.value=t;break}},rt=n=>{const t=n.content,a=S.value;if(a==="avatar"||a==="chatBg"||a==="videoBg"){const c={avatar:{obj:k.value,key:"avatar",toast:s("chat.singleChat.settings.toast.avatarUpdated")},chatBg:{obj:k.value,key:"chatBackground",toast:s("chat.singleChat.settings.toast.backgroundUpdated"),localRef:F},videoBg:{obj:k.value,key:"videoBg",toast:s("chat.singleChat.settings.toast.charImageUpdated"),localRef:H}};c[a]&&(c[a].obj[c[a].key]=t,c[a].localRef&&(c[a].localRef.value=t),d.saveData(),u.showToast(c[a].toast))}else(a==="userPersonaAvatar"||a==="userVideoImg")&&(a==="userPersonaAvatar"&&(P.value=t),a==="userVideoImg"&&($.value=t),u.showToast(s("chat.singleChat.settings.toast.imageReadyToSave")));T.value=!1},ut=()=>{if(!F.value)return u.showToast(s("chat.singleChat.settings.toast.noBgToApply"));u.showConfirm(s("chat.singleChat.settings.toast.applyBgToAll"),s("chat.singleChat.settings.toast.confirmApplyBgToAll"),()=>{d.applyChatBackgroundToAll(F.value),u.showToast(s("chat.singleChat.settings.toast.appliedToAll"))})},Te=n=>{N.value=n,[K.value,X.value]=n?["10","50"]:["200","500"]},vt=()=>{O.value=!0},gt=()=>{O.value=!1,se.value=!0},ht=async()=>{O.value=!1;const n=await d.summarizeMessages(V.id,{type:"recent"});u.showToast(n.message,n.success?"success":"error")},pt=async()=>{const[n,t]=pe.value.split("-").map(E=>E.trim()),a=parseInt(n,10),c=parseInt(t,10);if(isNaN(a)||isNaN(c)||a<=0||c<=0||a>c){u.showToast(s("chat.singleChat.settings.toast.invalidRange"),"error");return}const I=await d.summarizeMessages(V.id,{type:"range",start:a,end:c});u.showToast(I.message,I.success?"success":"error"),I.success&&(se.value=!1,pe.value="")},mt=async()=>{O.value=!1;const n=await d.summarizeMessages(V.id,{type:"video"});u.showToast(n.message,n.success?"success":"error")},Ae=async n=>{const t=n==="char"?Z.value:Q.value,a=n==="char"?J.value:ee.value,c=await He(t,a);c&&(n==="char"?(A.value=c,fe.value=c.shortDisplay):(D.value=c,ye.value=c.shortDisplay),u.showToast("位置和天气信息已更新","success"))},bt=()=>{u.showConfirm(s("chat.singleChat.settings.confirmBlockTitle",{name:be.value}),s("chat.singleChat.settings.confirmBlockMsg",{name:be.value}),()=>{q.value=!0,Pe(),u.showToast(s("chat.singleChat.settings.toast.blocked"))},{messageStyle:{color:"#FF3B30",whiteSpace:"pre-wrap"},confirmText:"chat.singleChat.settings.block"})},_t=()=>{q.value=!1,Pe(),u.showToast(s("chat.singleChat.settings.toast.unblocked"))},Ct=()=>{u.showConfirm(s("chat.singleChat.settings.confirmClearTitle"),s("chat.singleChat.settings.confirmClearMsg",{name:be.value}),()=>{d.clearChatHistory(V.id),u.showToast(s("chat.singleChat.settings.toast.historyCleared")),me.value=0,we.value=0},{messageStyle:{whiteSpace:"pre-wrap",color:"#FF3B30"},confirmText:"chat.singleChat.settings.clear"})},ft=()=>{q.value?_t():bt()},yt=()=>{u.showConfirm(s("chat.deleteCharacterTitle"),s("chat.deleteCharacterConfirm",{name:be.value}),()=>{d.deleteCharacter(V.id),u.showToast(s("chat.toast.deleteSuccess"),"success"),Se(),Ce.push({name:"chat-list"})},{messageStyle:{whiteSpace:"pre-wrap",color:"#FF3B30"},confirmText:"delete"})};return(n,t)=>(g(),v("div",Rt,[e("div",$t,[e("div",{class:"back-btn",onClick:Se},[...t[52]||(t[52]=[e("svg",{class:"svg-icon",viewBox:"0 0 24 24"},[e("polyline",{points:"15 18 9 12 15 6"})],-1)])]),e("div",zt,o(l(s)("chat.singleChat.settings.title")),1),e("div",Nt,[e("button",{class:"header-save-btn",onClick:Pe},o(l(s)("save")),1)])]),e("div",Ot,[e("div",Et,[e("div",{class:"card-title",onClick:t[0]||(t[0]=a=>x("roleInfo"))},[e("span",null,o(l(s)("chat.singleChat.settings.roleInfo")),1),e("div",{class:b(["collapse-arrow",{collapsed:m.value.roleInfo}])},[r(U,{name:"chevron-down"})],2)]),r(w,{name:"collapse"},{default:C(()=>[m.value.roleInfo?f("",!0):(g(),v("div",Wt,[e("div",jt,[e("div",Ft,[e("div",{class:"role-avatar-wrapper",onClick:Je},[_e.value?(g(),v("img",{key:0,src:_e.value,alt:"头像",class:"role-avatar-img"},null,8,Ht)):(g(),v("div",qt,o(l(s)("chat.singleChat.settings.uploadAvatar")),1))]),e("div",Gt,[h(e("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=a=>ae.value=a),class:"base-input",placeholder:l(s)("chat.singleChat.settings.roleNamePlaceholder")},null,8,Kt),[[p,ae.value]]),h(e("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=a=>le.value=a),class:"base-input",placeholder:l(s)("chat.singleChat.settings.roleNicknamePlaceholder")},null,8,Xt),[[p,le.value]])])]),e("div",Yt,[e("div",Zt,o(l(s)("chat.singleChat.settings.rolePersona")),1),h(e("textarea",{"onUpdate:modelValue":t[3]||(t[3]=a=>ne.value=a),class:"base-input",style:{height:"80px","min-height":"40px"},placeholder:l(s)("chat.singleChat.settings.rolePersonaPlaceholder")},null,8,Jt),[[p,ne.value]])])])]))]),_:1})]),e("div",Qt,[e("div",{class:"card-title",onClick:t[4]||(t[4]=a=>x("userInfo"))},[e("span",null,o(l(s)("chat.singleChat.settings.userInfo")),1),e("div",{class:b(["collapse-arrow",{collapsed:m.value.userInfo}])},[r(U,{name:"chevron-down"})],2)]),r(w,{name:"collapse"},{default:C(()=>[m.value.userInfo?f("",!0):(g(),v("div",es,[e("div",ts,[e("div",ss,[e("div",as,o(l(s)("chat.singleChat.settings.currentUserPersona")),1),r(Ie,{options:qe.value,modelValue:_.value,"onUpdate:modelValue":t[5]||(t[5]=a=>_.value=a)},null,8,["options","modelValue"])]),e("div",ls,[e("div",{class:"user-avatar-wrapper",onClick:Qe},[P.value?(g(),v("img",{key:0,src:P.value,alt:"User",class:"role-avatar-img"},null,8,ns)):(g(),v("div",os,o(l(s)("chat.singleChat.settings.uploadAvatar")),1))]),e("div",is,[e("div",cs,[e("button",{class:"btn btn-secondary btn-mini-grow",onClick:lt},o(l(s)("chat.singleChat.settings.savePersona")),1),e("button",{class:"btn btn-danger btn-mini-grow",onClick:nt},o(l(s)("chat.singleChat.settings.deletePersona")),1)]),h(e("input",{type:"text","onUpdate:modelValue":t[6]||(t[6]=a=>W.value=a),class:"base-input",placeholder:l(s)("chat.singleChat.settings.userNamePlaceholder")},null,8,ds),[[p,W.value]])])]),e("div",rs,[e("div",us,o(l(s)("chat.singleChat.settings.userPersona")),1),h(e("textarea",{"onUpdate:modelValue":t[7]||(t[7]=a=>G.value=a),class:"base-input",style:{height:"80px","min-height":"40px"},placeholder:l(s)("chat.singleChat.settings.userPersonaPlaceholder")},null,8,vs),[[p,G.value]])])])]))]),_:1})]),e("div",gs,[e("div",{class:"card-title",onClick:t[8]||(t[8]=a=>x("backgroundActivity"))},[e("span",null,o(l(s)("chat.singleChat.settings.backgroundActivity")),1),e("div",{class:b(["collapse-arrow",{collapsed:m.value.backgroundActivity}])},[r(U,{name:"chevron-down"})],2)]),e("div",hs,o(l(s)("chat.singleChat.settings.backgroundActivityWarning")),1),r(w,{name:"collapse"},{default:C(()=>[m.value.backgroundActivity?f("",!0):(g(),v("div",ps,[e("div",ms,[e("div",bs,[e("div",_s,[e("div",Cs,o(l(s)("chat.singleChat.settings.globalSettings")),1)]),e("div",fs,o(l(Be).globalBackgroundActivity?l(s)("chat.singleChat.settings.globalOn"):l(s)("chat.singleChat.settings.globalOff")),1)]),e("div",ys,[e("div",ks,[e("div",ws,o(l(s)("chat.singleChat.settings.overrideGlobal")),1),e("div",Ss,o(l(s)("chat.singleChat.settings.overrideGlobalDesc")),1)]),e("div",Ps,[e("div",{class:b(["mode-option",{active:y.value==="default"}]),onClick:t[9]||(t[9]=a=>y.value="default")},o(l(s)("chat.singleChat.settings.default")),3),e("div",{class:b(["mode-option",{active:y.value==="on"}]),onClick:t[10]||(t[10]=a=>y.value="on")},o(l(s)("chat.singleChat.settings.on")),3),e("div",{class:b(["mode-option",{active:y.value==="off"}]),onClick:t[11]||(t[11]=a=>y.value="off")},o(l(s)("chat.singleChat.settings.off")),3)])]),Xe.value?(g(),v("div",xs,[e("div",Is,[e("div",Bs,[e("div",Us,o(l(s)("chat.singleChat.settings.interval")),1),e("div",Vs,o(l(s)("chat.singleChat.settings.intervalDesc")),1)]),h(e("input",{type:"number","onUpdate:modelValue":t[12]||(t[12]=a=>oe.value=a),class:"base-input base-input-short",placeholder:"5"},null,512),[[p,oe.value,void 0,{number:!0}]])]),e("div",Ts,[e("div",As,[e("div",Ds,o(l(s)("chat.singleChat.settings.cooldown")),1),e("div",Ms,o(l(s)("chat.singleChat.settings.cooldownDesc")),1)]),h(e("input",{type:"number","onUpdate:modelValue":t[13]||(t[13]=a=>ie.value=a),class:"base-input base-input-short",placeholder:"30"},null,512),[[p,ie.value,void 0,{number:!0}]])]),e("div",Ls,[e("div",Rs,[e("div",$s,o(l(s)("chat.singleChat.settings.dailyLimit")),1),e("div",zs,o(l(s)("chat.singleChat.settings.dailyLimitDesc")),1)]),h(e("input",{type:"number","onUpdate:modelValue":t[14]||(t[14]=a=>ce.value=a),class:"base-input base-input-short",placeholder:"10"},null,512),[[p,ce.value,void 0,{number:!0}]])]),e("div",Ns,[e("div",Os,[e("div",Es,o(l(s)("chat.singleChat.settings.triggerMode")),1),e("div",Ws,o(l(s)("chat.singleChat.settings.triggerModeDesc")),1)]),e("div",js,[e("div",{class:b(["mode-option",{active:z.value==="idle"}]),onClick:t[15]||(t[15]=a=>z.value="idle")},o(l(s)("chat.singleChat.settings.idleMode")),3),e("div",{class:b(["mode-option",{active:z.value==="always"}]),onClick:t[16]||(t[16]=a=>z.value="always")},o(l(s)("chat.singleChat.settings.alwaysMode")),3)])]),z.value==="idle"?(g(),v("div",Fs,[e("div",Hs,[e("div",qs,o(l(s)("chat.singleChat.settings.idleTime")),1),e("div",Gs,o(l(s)("chat.singleChat.settings.idleTimeDesc")),1)]),h(e("input",{type:"number","onUpdate:modelValue":t[17]||(t[17]=a=>de.value=a),class:"base-input base-input-short",placeholder:"15"},null,512),[[p,de.value,void 0,{number:!0}]])])):f("",!0)])):f("",!0)])]))]),_:1})]),e("div",Ks,[e("div",{class:"card-title",onClick:t[18]||(t[18]=a=>x("modeSettings"))},[e("span",null,o(l(s)("chat.singleChat.settings.mode")),1),e("div",{class:b(["collapse-arrow",{collapsed:m.value.modeSettings}])},[r(U,{name:"chevron-down"})],2)]),r(w,{name:"collapse"},{default:C(()=>[m.value.modeSettings?f("",!0):(g(),v("div",Xs,[e("div",Ys,[e("div",Zs,[e("div",Js,o(l(s)("chat.singleChat.settings.modeSelect")),1),e("div",Qs,[e("div",{class:b(["mode-option",{active:N.value}]),onClick:t[19]||(t[19]=a=>Te(!0))},o(l(s)("chat.singleChat.settings.online")),3),e("div",{class:b(["mode-option",{active:!N.value}]),onClick:t[20]||(t[20]=a=>Te(!1))},o(l(s)("chat.singleChat.settings.offline")),3)])]),N.value?f("",!0):(g(),v("div",ea,[e("div",ta,o(l(s)("chat.singleChat.settings.linkPreset")),1),r(Ne,{modelValue:re.value,"onUpdate:modelValue":t[21]||(t[21]=a=>re.value=a),options:l(Fe),labelKey:"title",valueKey:"id",childrenKey:"entries",textAlign:"right",selectorWidth:"auto",dropdownWidth:"200px"},null,8,["modelValue","options"])])),e("div",sa,[e("div",aa,o(l(s)("chat.singleChat.settings.linkWorldbook")),1),r(Ne,{modelValue:ue.value,"onUpdate:modelValue":t[22]||(t[22]=a=>ue.value=a),options:l(We),"label-key":"title","value-key":"id","children-key":"entries",textAlign:"right",selectorWidth:"auto",dropdownWidth:"200px"},null,8,["modelValue","options"])]),e("div",la,[e("div",na,[e("div",oa,o(l(s)("chat.singleChat.settings.replyLength")),1),e("div",ia,o(l(s)("chat.singleChat.settings.replyLengthDesc")),1)]),e("div",ca,[h(e("input",{type:"number","onUpdate:modelValue":t[23]||(t[23]=a=>K.value=a),class:"base-input base-input-mini",placeholder:l(s)("chat.singleChat.settings.min")},null,8,da),[[p,K.value]]),t[53]||(t[53]=e("span",null,"-",-1)),h(e("input",{type:"number","onUpdate:modelValue":t[24]||(t[24]=a=>X.value=a),class:"base-input base-input-mini",placeholder:l(s)("chat.singleChat.settings.max")},null,8,ra),[[p,X.value]])])])])]))]),_:1})]),e("div",ua,[e("div",{class:"card-title",onClick:t[25]||(t[25]=a=>x("realtimeSense"))},[t[54]||(t[54]=e("span",null,"实时感知",-1)),e("div",{class:b(["collapse-arrow",{collapsed:m.value.realtimeSense}])},[r(U,{name:"chevron-down"})],2)]),r(w,{name:"collapse"},{default:C(()=>[m.value.realtimeSense?f("",!0):(g(),v("div",va,[e("div",ga,[e("div",ha,[t[55]||(t[55]=e("div",{class:"label-col"},[e("div",{class:"label-main"},"实时时间")],-1)),e("div",{class:b(["toggle-switch",{active:Y.value}]),onClick:t[26]||(t[26]=a=>Y.value=!Y.value)},null,2)]),e("div",pa,[t[56]||(t[56]=e("div",{class:"label-col"},[e("div",{class:"label-main"},"实时天气")],-1)),e("div",{class:b(["toggle-switch",{active:j.value}]),onClick:t[27]||(t[27]=a=>j.value=!j.value)},null,2)]),r(w,{name:"collapse"},{default:C(()=>[j.value?(g(),v("div",ma,[e("div",ba,[t[57]||(t[57]=e("div",{class:"label-main",style:{"margin-bottom":"5px"}},"角色所在地",-1)),e("div",_a,[h(e("input",{type:"text","onUpdate:modelValue":t[28]||(t[28]=a=>Z.value=a),class:"base-input",placeholder:"真实地名"},null,512),[[p,Z.value]]),h(e("input",{type:"text","onUpdate:modelValue":t[29]||(t[29]=a=>J.value=a),class:"base-input",placeholder:"虚拟地名 (可选)"},null,512),[[p,J.value]]),e("button",{class:"btn btn-secondary btn-sm",onClick:t[30]||(t[30]=a=>Ae("char"))},"确定")]),e("div",Ca,o(fe.value),1)]),e("div",fa,[t[58]||(t[58]=e("div",{class:"label-main",style:{"margin-bottom":"5px"}},"用户所在地",-1)),e("div",ya,[h(e("input",{type:"text","onUpdate:modelValue":t[31]||(t[31]=a=>Q.value=a),class:"base-input",placeholder:"真实地名"},null,512),[[p,Q.value]]),h(e("input",{type:"text","onUpdate:modelValue":t[32]||(t[32]=a=>ee.value=a),class:"base-input",placeholder:"虚拟地名 (可选)"},null,512),[[p,ee.value]]),e("button",{class:"btn btn-secondary btn-sm",onClick:t[33]||(t[33]=a=>Ae("user"))},"确定")]),e("div",ka,o(ye.value),1)])])):f("",!0)]),_:1})])]))]),_:1})]),e("div",wa,[e("div",{class:"card-title",onClick:t[34]||(t[34]=a=>x("summarySettings"))},[e("span",null,o(l(s)("chat.singleChat.settings.summary")),1),e("div",{class:b(["collapse-arrow",{collapsed:m.value.summarySettings}])},[r(U,{name:"chevron-down"})],2)]),r(w,{name:"collapse"},{default:C(()=>[m.value.summarySettings?f("",!0):(g(),v("div",Sa,[e("div",Pa,[e("div",xa,[e("div",Ia,[e("div",Ba,o(l(s)("chat.singleChat.settings.summaryRange")),1),e("div",Ua,o(l(s)("chat.singleChat.settings.summaryRangeDesc")),1)]),h(e("input",{type:"number","onUpdate:modelValue":t[35]||(t[35]=a=>ve.value=a),class:"base-input base-input-short",placeholder:"20"},null,512),[[p,ve.value,void 0,{number:!0}]])]),e("div",Va,[e("div",Ta,o(l(s)("chat.singleChat.settings.summaryPrompt")),1),h(e("textarea",{"onUpdate:modelValue":t[36]||(t[36]=a=>ge.value=a),class:"base-input",style:{height:"80px","min-height":"40px"},placeholder:l(s)("chat.singleChat.settings.summaryPromptPlaceholder")},null,8,Aa),[[p,ge.value]])]),e("div",Da,[e("div",Ma,[e("div",La,o(l(s)("chat.singleChat.settings.autoSummary")),1),e("div",Ra,o(l(s)("chat.singleChat.settings.autoSummaryDesc")),1)]),e("div",{class:b(["toggle-switch",{active:te.value}]),onClick:t[37]||(t[37]=a=>te.value=!te.value)},null,2)]),e("div",$a,[e("button",{class:"btn btn-secondary",onClick:vt},o(l(s)("chat.singleChat.settings.manualSummary")),1),e("button",{class:"btn btn-secondary",onClick:Ze},o(l(s)("chat.singleChat.settings.viewSummary")),1)]),e("div",za,[e("div",Na,[e("div",Oa,o(l(s)("chat.singleChat.settings.contextMemory")),1),e("div",Ea,o(l(s)("chat.singleChat.settings.contextMemoryDesc")),1)]),h(e("input",{type:"number","onUpdate:modelValue":t[38]||(t[38]=a=>he.value=a),class:"base-input base-input-short",placeholder:"10"},null,512),[[p,he.value,void 0,{number:!0}]])]),e("div",Wa,[e("div",ja,o(l(s)("chat.singleChat.settings.apiConfig")),1),r(Ie,{options:Ge.value,modelValue:ke.value,"onUpdate:modelValue":t[39]||(t[39]=a=>ke.value=a)},null,8,["options","modelValue"])]),e("div",Fa,[e("div",Ha,o(l(s)("chat.singleChat.settings.tokenCount")),1),e("div",qa,o(we.value),1)]),e("div",Ga,[e("div",Ka,o(l(s)("chat.singleChat.settings.msgCount")),1),e("div",Xa,o(me.value),1)])])]))]),_:1})]),e("div",Ya,[e("div",{class:"card-title",onClick:t[40]||(t[40]=a=>x("bubbleSettings"))},[e("span",null,o(l(s)("chat.singleChat.settings.beautification")),1),e("div",{class:b(["collapse-arrow",{collapsed:m.value.bubbleSettings}])},[r(U,{name:"chevron-down"})],2)]),r(w,{name:"collapse"},{default:C(()=>[m.value.bubbleSettings?f("",!0):(g(),v("div",Za,[e("div",Ja,[e("div",Qa,o(l(s)("chat.singleChat.settings.bubble")),1),e("div",el,[e("div",tl,o(l(s)("chat.singleChat.settings.bubblePreset")),1),e("div",sl,[r(Ie,{options:Ke.value,modelValue:M.value,"onUpdate:modelValue":t[41]||(t[41]=a=>M.value=a)},null,8,["options","modelValue"])]),e("div",al,[e("button",{class:"btn btn-secondary btn-mini",onClick:it},o(l(s)("save")),1),e("button",{class:"btn btn-danger btn-mini",disabled:!M.value,onClick:ct},o(l(s)("delete")),9,ll)])]),e("div",nl,[e("div",ol,[e("div",il,[e("div",cl,[_e.value?(g(),v("img",{key:0,src:_e.value,style:{width:"100%",height:"100%","object-fit":"cover"}},null,8,dl)):(g(),v("div",rl))]),e("div",{class:"preview-bubble char",style:ze(Ve.value)},o(l(s)("chat.singleChat.settings.bubblePreview")),5)]),e("div",ul,[e("div",{class:"preview-bubble user",style:ze(Ve.value)},o(l(s)("chat.singleChat.settings.bubblePreview")),5),e("div",vl,[P.value?(g(),v("img",{key:0,src:P.value,style:{width:"100%",height:"100%","object-fit":"cover"}},null,8,gl)):(g(),v("div",hl))])])])]),e("div",pl,[e("div",ml,[e("div",bl,o(l(s)("chat.singleChat.settings.fontSize")),1)]),e("div",_l,[h(e("input",{type:"range","onUpdate:modelValue":t[42]||(t[42]=a=>R.value=a),min:"10",max:"30",step:"1"},null,512),[[p,R.value,void 0,{number:!0}]]),e("span",Cl,o(R.value),1)])]),e("div",fl,[e("div",yl,o(l(s)("chat.singleChat.settings.bubbleCss")),1),h(e("textarea",{"onUpdate:modelValue":t[43]||(t[43]=a=>L.value=a),class:"base-input",placeholder:l(s)("chat.singleChat.settings.cssPlaceholder"),style:{"font-family":"monospace",height:"120px"}},null,8,kl),[[p,L.value]])]),t[59]||(t[59]=e("div",{class:"settings-divider"},null,-1)),e("div",wl,o(l(s)("chat.singleChat.settings.chatBackground")),1),e("div",Sl,[e("div",Pl,[e("div",xl,[e("button",{class:"btn btn-secondary",onClick:et},o(l(s)("chat.singleChat.settings.setChatBackground")),1),e("button",{class:"btn btn-secondary",onClick:ut,style:{"margin-top":"5px"}},o(l(s)("chat.singleChat.settings.applyToAll")),1)])])])])]))]),_:1})]),e("div",Il,[e("div",{class:"card-title",onClick:t[44]||(t[44]=a=>x("videoSettings"))},[e("span",null,o(l(s)("chat.singleChat.settings.videoCall")),1),e("div",{class:b(["collapse-arrow",{collapsed:m.value.videoSettings}])},[r(U,{name:"chevron-down"})],2)]),r(w,{name:"collapse"},{default:C(()=>[m.value.videoSettings?f("",!0):(g(),v("div",Bl,[e("div",Ul,[e("div",Vl,[e("div",Tl,[e("div",Al,o(l(s)("chat.singleChat.settings.characterImage")),1),e("div",{class:"video-preview",onClick:tt},[H.value?(g(),v("img",{key:0,src:H.value,class:"bg-img"},null,8,Dl)):(g(),v("div",Ml,o(l(s)("chat.singleChat.settings.setImage")),1))])]),e("div",Ll,[e("div",Rl,o(l(s)("chat.singleChat.settings.userImage")),1),e("div",{class:"video-preview",onClick:st},[$.value?(g(),v("img",{key:0,src:$.value,class:"bg-img"},null,8,$l)):(g(),v("div",zl,o(l(s)("chat.singleChat.settings.setImage")),1))])])])])]))]),_:1})]),e("div",Nl,[e("div",{class:"card-title",onClick:t[45]||(t[45]=a=>x("advancedSettings"))},[e("span",null,o(l(s)("chat.singleChat.settings.advanced")),1),e("div",{class:b(["collapse-arrow",{collapsed:m.value.advancedSettings}])},[r(U,{name:"chevron-down"})],2)]),r(w,{name:"collapse"},{default:C(()=>[m.value.advancedSettings?f("",!0):(g(),v("div",Ol,[e("div",El,[e("div",Wl,[e("div",jl,o(l(s)("chat.singleChat.settings.linkedNpc")),1),e("div",Fl,o(l(s)("chat.singleChat.settings.npcCount",{count:Ue.value})),1),t[60]||(t[60]=e("div",{class:"settings-pure-arrow"},"›",-1))])])]))]),_:1})]),e("div",Hl,[e("button",{class:"btn btn-danger big-btn",onClick:ft},[e("div",ql,[e("div",Gl,o(q.value?l(s)("chat.singleChat.settings.unblock"):l(s)("chat.singleChat.settings.blockCharacter")),1),e("div",Kl,o(l(s)("chat.singleChat.settings.blockCharacterDesc")),1)])]),e("button",{class:"btn btn-danger big-btn",onClick:Ct},[e("div",Xl,[e("div",Yl,o(l(s)("chat.singleChat.settings.clearHistory")),1),e("div",Zl,o(l(s)("chat.singleChat.settings.clearHistoryDesc")),1)])]),e("button",{class:"btn btn-danger big-btn",onClick:yt},[e("div",Jl,[e("div",Ql,o(l(s)("chat.deleteCharacterTitle")),1),e("div",en,o(l(s)("chat.deleteCharacterWarning")),1)])])])]),r(Lt,{visible:T.value,"onUpdate:visible":t[46]||(t[46]=a=>T.value=a),type:"basic","biz-type":S.value,title:Ye.value,onPreviewReady:dt,onUploadComplete:rt},null,8,["visible","biz-type","title"]),r($e,{visible:O.value,"onUpdate:visible":t[48]||(t[48]=a=>O.value=a),title:l(s)("chat.singleChat.settings.manualSummary")},{footer:C(()=>[e("button",{class:"modal-btn cancel",onClick:t[47]||(t[47]=a=>O.value=!1)},o(l(s)("cancel")),1)]),default:C(()=>[e("div",tn,[e("div",{class:"modal-option",onClick:ht},[e("span",sn,o(l(s)("chat.singleChat.settings.summarizeRecent")),1)]),e("div",{class:"modal-option",onClick:gt},[e("span",an,o(l(s)("chat.singleChat.settings.summarizeRange")),1)]),e("div",{class:"modal-option",onClick:mt},[e("span",ln,o(l(s)("chat.singleChat.settings.summarizeVideo")),1)])])]),_:1},8,["visible","title"]),r($e,{visible:se.value,"onUpdate:visible":t[51]||(t[51]=a=>se.value=a),title:l(s)("chat.singleChat.settings.summarizeRange")},{footer:C(()=>[e("button",{class:"modal-btn cancel",onClick:t[50]||(t[50]=a=>se.value=!1)},o(l(s)("cancel")),1),e("button",{class:"modal-btn confirm",onClick:pt},o(l(s)("confirm")),1)]),default:C(()=>[h(e("input",{type:"text",class:"base-input","onUpdate:modelValue":t[49]||(t[49]=a=>pe.value=a),placeholder:l(s)("chat.singleChat.settings.rangePlaceholder",{total:me.value})},null,8,nn),[[p,pe.value]])]),_:1},8,["visible","title"])]))}},un=St(on,[["__scopeId","data-v-0f07d5fc"]]);export{un as default};
