import{ci as me,r as m,D as F,cj as W,_ as be,u as ge,Z as fe,a2 as ke,k as we,B as _e,L as ye,C as xe,c as J,b as Pe,w as O,d as s,e as Se,o as x,i as e,f as z,t as i,p as I,F as $,g as S,h as U,G as Z,H as Q,c5 as Ce,j as H,M as X,ck as Te}from"./index-CJ72PdJe.js";import{C as Y}from"./CustomSelect-BADYUFc4.js";const Ie=me("backup",()=>{const k=m(localStorage.getItem("github_token")||""),o=m(localStorage.getItem("github_repo")||""),v=m(!1),f=m(!1),h=m(null);F(k,l=>{localStorage.setItem("github_token",l)}),F(o,l=>{localStorage.setItem("github_repo",l)});function M(l={chat:!0,characters:!0,settings:!0,appearance:!0,worldbook:!0,presets:!0}){return new Promise(n=>{setTimeout(()=>{const u={},b=localStorage.getItem("aiPhoneSingleChatData");if(b)try{const d=W.decompressFromUTF16(b),r=JSON.parse(d||b),p={};let g=!1;if(l.chat&&(p.messages=r.messages,g=!0),l.characters&&(p.characters=r.characters,p.userPersonas=r.userPersonas,p.favorites=r.favorites,g=!0),l.appearance&&(p.bubblePresets=r.bubblePresets,p.stickers=r.stickers,g=!0),g){const _=JSON.stringify(p),j=W.compressToUTF16(_);u.aiPhoneSingleChatData=j}}catch(d){console.error("Error processing single chat data for backup",d)}if(l.chat){const d=localStorage.getItem("aiPhoneMomentsData");d&&(u.aiPhoneMomentsData=d)}l.settings&&["api_imageHostProvider","api_imgbbApiKey","api_catboxUserHash","aiPhoneGlobalBackgroundActivity","aiPhoneGlobalProactiveScope","aiPhoneGlobalProactiveInterval","aiPhoneGlobalProactiveCooldown","aiPhoneGlobalProactiveDailyLimit","aiPhoneGlobalTriggerMode","aiPhoneGlobalProactiveIdleTime"].forEach(r=>{const p=localStorage.getItem(r);p!==null&&(u[r]=p)}),l.appearance&&["aiPhoneThemePresets","aiPhoneCurrentThemePreset","aiPhoneFontPresets","aiPhoneCurrentFontPreset","aiPhoneCssPresets","aiPhoneCurrentCssPreset"].forEach(r=>{const p=localStorage.getItem(r);p!==null&&(u[r]=p)}),l.worldbook&&["worldBooks","worldBookNextId"].forEach(r=>{const p=localStorage.getItem(r);p!==null&&(u[r]=p)}),l.presets&&["api_presets","api_activePresetName","prompt_presets","prompt_presetNextId"].forEach(r=>{const p=localStorage.getItem(r);p!==null&&(u[r]=p)}),n(JSON.stringify(u,null,2))},0)})}async function P(){if(k.value=localStorage.getItem("github_token")||"",!k.value){alert("请先设置 GitHub Token！");return}try{const l=await fetch("https://api.github.com/user/repos",{method:"POST",headers:{Authorization:`token ${k.value}`,Accept:"application/vnd.github.v3+json","Content-Type":"application/json"},body:JSON.stringify({name:"phone-backup",private:!0,description:"Backup for Phone Vue App"})});if(l.ok){const n=await l.json();o.value=n.full_name,alert(`仓库 ${n.full_name} 创建成功！即将开始备份...`),await B()}else{if(l.status===401){alert("创建仓库失败: GitHub Token 无效或过期 (401)。请检查设置。");return}const n=await l.json();if(n.errors&&n.errors[0].message==="name already exists on this account"){const u=await fetch("https://api.github.com/user",{headers:{Authorization:`token ${k.value}`}});if(u.ok){const b=await u.json();o.value=`${b.login}/phone-backup`,alert(`仓库已存在，已自动关联到 ${o.value}。即将开始备份...`),await B();return}}alert(`创建仓库失败: ${n.message}`)}}catch(l){console.error("Create repo failed:",l),alert(`创建仓库出错: ${l.message}`)}}async function T(){if(k.value=localStorage.getItem("github_token")||"",o.value=localStorage.getItem("github_repo")||"",!k.value)throw new Error("请先设置 GitHub Token！");if(!o.value)throw new Error("请先设置仓库地址！");try{const[l,n]=o.value.split("/");if(!l||!n)throw new Error("仓库地址格式不正确，应为 username/repo");const u=await fetch(`https://api.github.com/repos/${l}/${n}`,{headers:{Authorization:`token ${k.value}`,Accept:"application/vnd.github.v3+json"}});if(u.ok)return!0;throw u.status===401?new Error("GitHub Token 无效或过期 (401)"):u.status===404?new Error("仓库不存在或无权访问 (404)"):new Error(`验证失败: ${u.statusText}`)}catch(l){throw console.error("Verify repo failed:",l),l}}async function B(){if(k.value=localStorage.getItem("github_token")||"",o.value=localStorage.getItem("github_repo")||"",!k.value||!o.value){alert("请先设置 GitHub Token 和仓库地址！");return}if(v.value){alert("正在备份中，请稍候...");return}v.value=!0,alert("正在准备备份数据...");try{const l=await M();alert("数据准备完成，开始上传...");const n="phone_backup.json",[u,b]=o.value.split("/"),d=`https://api.github.com/repos/${u}/${b}/contents/${n}`;let r;try{const w=await fetch(d,{headers:{Authorization:`token ${k.value}`,Accept:"application/vnd.github.v3+json"}});if(w.status===401)throw new Error("GitHub Token 无效或过期 (401)。请检查设置。");w.status===404?console.log("备份文件不存在，将创建新文件。"):w.ok&&(r=(await w.json()).sha)}catch(w){if(w.message.includes("GitHub Token"))throw w}const p=`Backup from phone-vue-app: ${new Date().toISOString()}`,_=new TextEncoder().encode(l),j=Array.from(_).map(w=>String.fromCharCode(w)).join(""),N=btoa(j),A={message:p,content:N,sha:r},R=await fetch(d,{method:"PUT",headers:{Authorization:`token ${k.value}`,Accept:"application/vnd.github.v3+json","Content-Type":"application/json"},body:JSON.stringify(A)});if(R.ok)h.value=new Date,alert("备份成功！");else{if(R.status===401){alert("备份失败: GitHub Token 无效或过期 (401)。请检查设置。");return}const w=await R.json();console.error("GitHub API Error:",w),alert(`备份失败: ${w.message||"未知错误"}`)}}catch(l){console.error("Backup to GitHub failed:",l),alert(`备份过程中发生错误: ${l.message}`)}finally{v.value=!1}}async function G(){if(k.value=localStorage.getItem("github_token")||"",o.value=localStorage.getItem("github_repo")||"",!k.value||!o.value){alert("请先设置 GitHub Token 和仓库地址！");return}if(confirm("这将从 GitHub 覆盖所有当前数据，确定要恢复吗？此操作不可逆。")){f.value=!0,alert("正在从 GitHub 下载备份...");try{const l="phone_backup.json",[n,u]=o.value.split("/"),b=`https://api.github.com/repos/${n}/${u}/contents/${l}`,d=await fetch(b,{headers:{Authorization:`token ${k.value}`,Accept:"application/vnd.github.v3+json"}});if(d.status===401)throw new Error("GitHub Token 无效或过期 (401)。请检查设置。");if(d.status===404)throw new Error("在仓库中未找到备份文件 (phone_backup.json)。");if(!d.ok){const C=await d.json();throw new Error(`获取备份文件失败: ${C.message||"未知错误"}`)}const p=(await d.json()).content,g=atob(p),_=new Uint8Array(g.length);for(let C=0;C<g.length;C++)_[C]=g.charCodeAt(C);const N=new TextDecoder("utf-8").decode(_),A=JSON.parse(N),R=localStorage.getItem("github_token"),w=localStorage.getItem("github_repo");localStorage.clear();for(const C in A)Object.hasOwnProperty.call(A,C)&&localStorage.setItem(C,A[C]);R&&localStorage.setItem("github_token",R),w&&localStorage.setItem("github_repo",w),alert("数据恢复成功！请刷新页面以应用更改。")}catch(l){console.error("Restore from GitHub failed:",l),alert(`恢复过程中发生错误: ${l.message}`)}finally{f.value=!1}}}async function D(l){try{alert("正在生成备份文件...");const n=await M(l),u=new Blob([n],{type:"application/json"}),b=URL.createObjectURL(u),d=document.createElement("a");d.href=b,d.download=`JF-Phone_backup_${new Date().toISOString().slice(0,10)}.json`,document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(b),alert("备份文件已开始下载！")}catch(n){console.error("Export backup failed:",n),alert(`导出备份文件时出错: ${n.message}`)}}function E(){const l=document.createElement("input");l.type="file",l.accept="application/json",l.onchange=n=>{const u=n.target.files[0];if(!u)return;const b=new FileReader;b.onload=d=>{try{const r=JSON.parse(d.target.result);if(confirm("这将覆盖所有当前数据，确定要导入吗？")){localStorage.clear();for(const p in r)Object.hasOwnProperty.call(r,p)&&localStorage.setItem(p,r[p]);alert("数据导入成功！请刷新页面以应用更改。")}}catch(r){console.error("Import backup failed:",r),alert(`导入失败，请确保文件格式正确: ${r.message}`)}},b.readAsText(u)},l.click()}return{githubToken:k,githubRepo:o,isBackingUp:v,isRestoring:f,lastBackupTime:h,backupToGitHub:B,restoreFromGitHub:G,exportBackupFile:D,importBackupFile:E,createBackupRepo:P,verifyBackupRepo:T}}),Be={class:"card"},Ae={class:"card-title"},$e={class:"card-content"},Ue={class:"api-item-row"},He={style:{flex:"1","min-width":"0"}},je={class:"api-item-col"},Ge={class:"form-label",for:"api-url"},Ne=["placeholder"],De={class:"api-item-col"},Ee={class:"form-label",for:"api-key"},Re=["placeholder"],Me={class:"api-item-row"},Fe={class:"list-item-title",style:{"font-weight":"normal","white-space":"nowrap"}},Oe={style:{flex:"1",display:"flex",gap:"10px","align-items":"center","min-width":"0"}},Ve={style:{flex:"1","min-width":"0",position:"relative"}},Ke={key:0,value:"",disabled:""},Le=["value"],ze={class:"api-item-col"},Je={class:"form-label",for:"master-prompt"},Ze=["placeholder"],qe={class:"card"},We={class:"card-title"},Qe={class:"card-title-note",style:{padding:"0 16px 10px","margin-top":"-10px",color:"var(--danger-color)"}},Xe={class:"card-content"},Ye={class:"api-item-row"},et={class:"list-item-content"},tt={class:"list-item-title"},ot={class:"list-item-subtitle"},st={class:"api-item-row"},at={class:"list-item-content"},it={class:"list-item-title"},lt={class:"api-item-row"},nt={class:"list-item-content"},rt={class:"list-item-title"},ct={class:"api-item-row"},dt={class:"list-item-content"},pt={class:"list-item-title"},ut={class:"api-item-row"},vt={class:"list-item-content"},ht={class:"list-item-title"},mt={class:"api-item-row"},bt={class:"list-item-content"},gt={class:"list-item-title"},ft={class:"list-item-subtitle"},kt={class:"mode-selector"},wt={key:0,class:"api-item-row"},_t={class:"list-item-content"},yt={class:"list-item-title"},xt={class:"list-item-subtitle"},Pt={class:"card"},St={class:"card-title"},Ct={class:"card-content"},Tt={class:"api-item-row"},It={class:"list-item-content"},Bt={class:"list-item-title"},At={class:"list-item-subtitle"},$t={class:"api-item-row"},Ut={class:"list-item-content"},Ht={class:"list-item-title"},jt={class:"list-item-subtitle"},Gt={class:"card"},Nt={class:"card-title"},Dt={class:"card-content"},Et={class:"api-item-col"},Rt={class:"form-label",for:"github-token"},Mt={class:"input-hint"},Ft={style:{display:"flex",gap:"10px"}},Ot=["placeholder"],Vt={class:"api-item-col"},Kt={class:"form-label",for:"github-repo"},Lt={style:{display:"flex",gap:"10px"}},zt=["placeholder"],Jt=["disabled"],Zt={class:"api-item-row"},qt=["disabled"],Wt=["disabled"],Qt={key:0,style:{"font-size":"12px",color:"var(--text-tertiary)","margin-top":"10px"}},Xt={class:"card"},Yt={class:"card-title"},eo={class:"card-content"},to={class:"api-item-row"},oo={class:"list-item-content",style:{flex:"1","min-width":"0"}},so={class:"list-item-title"},ao={class:"list-item-subtitle"},io={style:{width:"120px","flex-shrink":"0"}},lo={class:"api-item-col"},no={class:"form-label",for:"imgbb-api-key"},ro={class:"input-hint"},co={style:{display:"flex",gap:"10px"}},po=["placeholder"],uo={class:"api-item-col"},vo={class:"form-label",for:"catbox-hash"},ho={class:"input-hint"},mo={style:{display:"flex",gap:"10px"}},bo=["placeholder"],go={class:"card"},fo={class:"card-title"},ko={class:"card-content"},wo={style:{"font-size":"13px",color:"var(--text-tertiary)","margin-bottom":"15px"}},_o={class:"api-item-row",style:{"border-bottom":"none","padding-bottom":"0"}},yo={class:"scope-list"},xo={key:0,xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"3","stroke-linecap":"round","stroke-linejoin":"round"},Po={key:0,xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"3","stroke-linecap":"round","stroke-linejoin":"round"},So={key:0,xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"3","stroke-linecap":"round","stroke-linejoin":"round"},Co={key:0,xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"3","stroke-linecap":"round","stroke-linejoin":"round"},To={key:0,xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"3","stroke-linecap":"round","stroke-linejoin":"round"},Io={class:"scope-list",style:{"max-height":"300px","overflow-y":"auto"}},Bo={key:0,xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"3","stroke-linecap":"round","stroke-linejoin":"round"},Ao={class:"scope-name"},$o=["onClick"],Uo={key:0,xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"3","stroke-linecap":"round","stroke-linejoin":"round"},Ho={class:"scope-name"},jo={__name:"API",setup(k){const{t:o}=ge(),v=fe(),f=ke(),h=Ie(),M=we(),P=_e(),T=ye(),B=m(""),G=m(""),D=m(""),E=m(""),l=m(!1),n=m([]),u=m(5),b=m(30),d=m(10),r=m("always"),p=m(15),g=m(""),_=m(""),j=m("catbox"),N=m(""),A=m(""),R=m([{value:"none",label:"无"},{value:"catbox",label:"Catbox"},{value:"imgbb",label:"ImgBB"}]);xe(()=>{l.value=f.globalBackgroundActivity,n.value=[...f.globalProactiveScope||[]],u.value=f.globalProactiveInterval,b.value=f.globalProactiveCooldown,d.value=f.globalProactiveDailyLimit,r.value=f.globalTriggerMode,p.value=f.globalProactiveIdleTime,g.value=localStorage.getItem("github_token")||"",_.value=localStorage.getItem("github_repo")||"",j.value=v.imageHostProvider,N.value=v.imgbbApiKey,A.value=v.catboxUserHash});const w=J(()=>v.presets.find(c=>c.name===v.activePresetName)||null);F(w,c=>{c&&(B.value=c.apiKey,G.value=c.apiUrl,D.value=c.model,E.value=c.masterPrompt||"")},{immediate:!0,deep:!0}),F([B,G,D,E],()=>{if(v.activePresetName){const c=v.getActivePreset();v.addPreset(v.activePresetName,{...c,apiKey:B.value,apiUrl:G.value,model:D.value,masterPrompt:E.value})}}),F([l,n,u,b,d,r,p],()=>{f.globalBackgroundActivity=l.value,f.globalProactiveScope=n.value,f.globalProactiveInterval=u.value,f.globalProactiveCooldown=b.value,f.globalProactiveDailyLimit=d.value,f.globalTriggerMode=r.value,f.globalProactiveIdleTime=p.value},{deep:!0}),F([g,_],()=>{h.githubToken=g.value,h.githubRepo=_.value,localStorage.setItem("github_token",g.value),localStorage.setItem("github_repo",_.value)}),F([j,N,A],()=>{v.imageHostProvider=j.value,v.imgbbApiKey=N.value,v.catboxUserHash=A.value},{deep:!0});function C(){P.showToast(o("api.toast.settingsSaved"))}function ee(){P.showInput(o("api.prompt.saveAsPreset"),"",c=>{c&&(v.addPreset(c,{apiKey:B.value,apiUrl:G.value,model:D.value,masterPrompt:E.value}),P.showToast(o("api.toast.presetSaved",{name:c})))},o("api.prompt.enterPresetName"))}function te(){P.showConfirm(o("api.confirm.deletePreset"),o("api.confirm.deletePresetMsg",{name:v.activePresetName}),()=>{v.deletePreset(v.activePresetName),P.showToast(o("api.toast.presetDeleted"))})}async function oe(){const c={apiUrl:G.value,apiKey:B.value};await v.fetchModels(c)}const se=J(()=>{switch(T.permission){case"granted":return o("api.notificationsGranted");case"denied":return o("api.notificationsDenied");default:return o("api.notificationsDefault")}}),ae=()=>{T.permission!=="granted"?T.requestPermission():T.desktopNotificationsEnabled=!T.desktopNotificationsEnabled},ie=()=>{if(!T.desktopNotificationsEnabled){P.showToast("请先开启“桌面通知”开关。","warning");return}if(T.permission!=="granted"){P.showToast("浏览器通知权限未授予，请点击开关重新授权。","warning");return}P.showToast("测试通知已发送，请检查系统通知。"),T.triggerNotification("测试通知","如果看到此消息，说明桌面通知功能正常。","/pwa-192x192.png",()=>{console.log("Test notification clicked!")})},le=async()=>{h.githubToken=g.value,await h.createBackupRepo(),_.value=h.githubRepo},ne=async()=>{h.githubToken=g.value,h.githubRepo=_.value,P.showToast(o("api.verifying"));try{await h.verifyBackupRepo(),P.showToast(o("api.verifySuccess"))}catch(c){P.showToast(c.message,"error")}},re=async()=>{h.githubToken=g.value,h.githubRepo=_.value,await h.backupToGitHub()};function ce(){window.open("https://github.com/settings/tokens/new?scopes=repo&description=Phone%20App%20Backup","_blank")}function de(){window.open("https://api.imgbb.com/","_blank")}function pe(){window.open("https://catbox.moe/user/","_blank")}function ue(){P.showConfirm("确认清除所有数据？","此操作将永久删除所有本地存储的数据（包括聊天记录、API设置、背景图片等）。应用将重置为初始状态。请确保您已备份重要数据。",async()=>{localStorage.clear();try{await Te.clear()}catch(c){console.error("Error clearing localforage:",c)}try{v.$reset(),f.$reset(),h.$reset(),M.$reset(),P.$reset(),T.$reset()}catch(c){console.error("Error resetting stores:",c)}window.location.reload()},{messageStyle:{color:"#FF3B30"},confirmText:"delete"})}const K=m(!1),y=m({chat:!0,characters:!0,settings:!0,appearance:!0,worldbook:!0,presets:!0});function V(c){if(c==="worldbook"){const t=!y.value.worldbook;y.value.worldbook=t,y.value.presets=t}else y.value[c]=!y.value[c]}function ve(){h.exportBackupFile(y.value),K.value=!1}const L=m(!1),he=J(()=>{const c=n.value||[];return c.includes("all")?o("api.scopeAll"):c.length===0?o("api.scopeNone"):o("api.scopeSelected",{count:c.length})});function q(c){const t=n.value;if(c==="all")t.includes("all")?n.value=[]:n.value=["all"];else if(t.includes("all"))n.value=[c];else{const a=t.indexOf(c);a>-1?t.splice(a,1):t.push(c),M.characters.length>0&&t.length===M.characters.length&&(n.value=["all"])}}return(c,t)=>(x(),Pe(Se,{title:s(o)("api.title")},{action:O(()=>[e("button",{class:"header-save-btn",onClick:C},i(s(o)("save")),1)]),default:O(()=>[e("div",Be,[e("div",Ae,i(s(o)("api.globalConfig")),1),e("div",$e,[e("div",Ue,[e("div",He,[z(Y,{"model-value":s(v).activePresetName,options:s(v).presets.map(a=>({value:a.name,label:a.name})),"onUpdate:modelValue":t[0]||(t[0]=a=>s(v).switchPreset(a)),textAlign:"left",style:{width:"100%"}},null,8,["model-value","options"])]),e("button",{class:"btn btn-secondary btn-sm",onClick:ee},i(s(o)("api.saveAs")),1),e("button",{class:"btn btn-danger-light btn-sm",onClick:te},i(s(o)("delete")),1)]),e("div",je,[e("label",Ge,i(s(o)("api.apiUrl")),1),I(e("input",{type:"text",id:"api-url",class:"base-input","onUpdate:modelValue":t[1]||(t[1]=a=>G.value=a),placeholder:s(o)("api.apiUrlPlaceholder"),autocomplete:"new-password"},null,8,Ne),[[$,G.value]])]),e("div",De,[e("label",Ee,i(s(o)("api.apiKey")),1),I(e("input",{type:"password",id:"api-key",class:"base-input","onUpdate:modelValue":t[2]||(t[2]=a=>B.value=a),placeholder:s(o)("api.apiKeyPlaceholder"),autocomplete:"new-password"},null,8,Re),[[$,B.value]])]),e("div",Me,[e("div",Fe,i(s(o)("api.model")),1),e("div",Oe,[e("div",Ve,[I(e("select",{class:"native-select","onUpdate:modelValue":t[3]||(t[3]=a=>D.value=a)},[s(v).models.length===0?(x(),S("option",Ke,i(s(o)("api.modelPlaceholder")),1)):U("",!0),(x(!0),S(Z,null,Q(s(v).models,a=>(x(),S("option",{key:a,value:a},i(a),9,Le))),128))],512),[[Ce,D.value]]),t[30]||(t[30]=e("div",{class:"select-arrow"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("polyline",{points:"6 9 12 15 18 9"})])],-1))]),e("button",{class:"btn btn-secondary btn-sm",onClick:oe,style:{"white-space":"nowrap"}},i(s(o)("api.fetch")),1)])]),e("div",ze,[e("label",Je,i(s(o)("api.masterPrompt")),1),I(e("textarea",{id:"master-prompt",class:"base-input","onUpdate:modelValue":t[4]||(t[4]=a=>E.value=a),placeholder:s(o)("api.masterPromptPlaceholder"),rows:"3",style:{resize:"vertical"}},null,8,Ze),[[$,E.value]])])])]),e("div",qe,[e("div",We,i(s(o)("api.backgroundActivity")),1),e("div",Qe,i(s(o)("api.backgroundActivityWarning")),1),e("div",Xe,[e("div",Ye,[e("div",et,[e("div",tt,i(s(o)("api.proactiveMessages")),1),e("div",ot,i(s(o)("api.proactiveMessagesDesc")),1)]),e("div",{class:H(["toggle-switch",{active:l.value}]),onClick:t[5]||(t[5]=a=>l.value=!l.value)},null,2)]),l.value?(x(),S(Z,{key:0},[e("div",st,[e("div",at,[e("div",it,i(s(o)("api.scope")),1)]),e("div",{class:"scope-selector",onClick:t[6]||(t[6]=a=>L.value=!0)},[e("span",null,i(he.value),1),t[31]||(t[31]=e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("polyline",{points:"9 18 15 12 9 6"})],-1))])]),e("div",lt,[e("div",nt,[e("div",rt,i(s(o)("api.interval")),1)]),I(e("input",{type:"number","onUpdate:modelValue":t[7]||(t[7]=a=>u.value=a),class:"base-input base-input-short",placeholder:"5",autocomplete:"new-password"},null,512),[[$,u.value,void 0,{number:!0}]])]),e("div",ct,[e("div",dt,[e("div",pt,i(s(o)("api.cooldown")),1)]),I(e("input",{type:"number","onUpdate:modelValue":t[8]||(t[8]=a=>b.value=a),class:"base-input base-input-short",placeholder:"30",autocomplete:"new-password"},null,512),[[$,b.value,void 0,{number:!0}]])]),e("div",ut,[e("div",vt,[e("div",ht,i(s(o)("api.dailyLimit")),1)]),I(e("input",{type:"number","onUpdate:modelValue":t[9]||(t[9]=a=>d.value=a),class:"base-input base-input-short",placeholder:"10",autocomplete:"new-password"},null,512),[[$,d.value,void 0,{number:!0}]])]),e("div",mt,[e("div",bt,[e("div",gt,i(s(o)("api.triggerMode")),1),e("div",ft,i(s(o)("api.triggerModeIdleHint")),1)]),e("div",kt,[e("div",{class:H(["mode-option",{active:r.value==="idle"}]),onClick:t[10]||(t[10]=a=>r.value="idle")},i(s(o)("api.triggerModeIdle")),3),e("div",{class:H(["mode-option",{active:r.value==="always"}]),onClick:t[11]||(t[11]=a=>r.value="always")},i(s(o)("api.triggerModeAlways")),3)])]),r.value==="idle"?(x(),S("div",wt,[e("div",_t,[e("div",yt,i(s(o)("api.idleTime")),1),e("div",xt,i(s(o)("api.idleTimeDesc")),1)]),I(e("input",{type:"number","onUpdate:modelValue":t[12]||(t[12]=a=>p.value=a),class:"base-input base-input-short",placeholder:"15",autocomplete:"new-password"},null,512),[[$,p.value,void 0,{number:!0}]])])):U("",!0)],64)):U("",!0)])]),e("div",Pt,[e("div",St,i(s(o)("api.notificationSettings")),1),e("div",Ct,[e("div",Tt,[e("div",It,[e("div",Bt,i(s(o)("api.desktopNotifications")),1),e("div",At,i(se.value),1)]),e("div",{class:H(["toggle-switch",{active:s(T).desktopNotificationsEnabled}]),onClick:ae},null,2)]),e("div",$t,[e("div",Ut,[e("div",Ht,i(s(o)("api.testNotification")),1),e("div",jt,i(s(o)("api.testNotificationDesc")),1)]),e("button",{class:"btn btn-secondary btn-sm",onClick:ie},i(s(o)("api.test")),1)])])]),e("div",Gt,[e("div",Nt,i(s(o)("api.githubBackup")),1),e("div",Dt,[e("div",Et,[e("label",Rt,i(s(o)("api.githubToken")),1),e("div",Mt,i(s(o)("api.githubTokenHint")),1),e("div",Ft,[I(e("input",{type:"password",id:"github-token",class:"base-input small-placeholder","onUpdate:modelValue":t[13]||(t[13]=a=>g.value=a),placeholder:s(o)("api.githubTokenPlaceholder"),style:{flex:"1"},autocomplete:"new-password"},null,8,Ot),[[$,g.value]]),e("button",{class:"btn btn-secondary btn-sm",onClick:ce},i(s(o)("api.getToken")),1)])]),e("div",Vt,[e("label",Kt,i(s(o)("api.repoAddress")),1),e("div",Lt,[I(e("input",{type:"text",id:"github-repo",class:"base-input","onUpdate:modelValue":t[14]||(t[14]=a=>_.value=a),placeholder:s(o)("api.repoAddressPlaceholder"),style:{flex:"1","min-width":"0"},autocomplete:"new-password"},null,8,zt),[[$,_.value]]),e("button",{class:"btn btn-secondary btn-sm",onClick:ne,style:{"white-space":"nowrap"}},i(s(o)("confirm")),1),e("button",{class:"btn btn-secondary btn-sm",onClick:le,disabled:!g.value,style:{"white-space":"nowrap"}},i(s(o)("api.createRepo")),9,Jt)])]),e("div",Zt,[e("button",{class:"btn btn-secondary",style:{flex:"1"},onClick:re,disabled:s(h).isBackingUp||s(h).isRestoring},i(s(h).isBackingUp?s(o)("api.backingUp"):s(o)("api.backupNow")),9,qt),e("button",{class:"btn btn-secondary",style:{flex:"1"},onClick:t[15]||(t[15]=(...a)=>s(h).restoreFromGitHub&&s(h).restoreFromGitHub(...a)),disabled:s(h).isBackingUp||s(h).isRestoring},i(s(h).isRestoring?s(o)("api.restoring"):s(o)("api.restoreBackup")),9,Wt)]),s(h).lastBackupTime?(x(),S("p",Qt,i(s(o)("api.lastBackup"))+" "+i(new Date(s(h).lastBackupTime).toLocaleString()),1)):U("",!0)])]),e("div",Xt,[e("div",Yt,i(s(o)("api.imageHost")),1),e("div",eo,[e("div",to,[e("div",oo,[e("div",so,i(s(o)("api.defaultImageHost")),1),e("div",ao,i(s(o)("api.defaultImageHostDesc")),1)]),e("div",io,[z(Y,{"model-value":j.value,options:R.value,"onUpdate:modelValue":t[16]||(t[16]=a=>j.value=a),textAlign:"right"},null,8,["model-value","options"])])]),e("div",lo,[e("label",no,i(s(o)("api.imgbbApiKey")),1),e("div",ro,i(s(o)("api.imgbbApiKeyHint")),1),e("div",co,[I(e("input",{type:"password",id:"imgbb-api-key",class:"base-input small-placeholder","onUpdate:modelValue":t[17]||(t[17]=a=>N.value=a),placeholder:s(o)("api.imgbbApiKeyPlaceholder"),style:{flex:"1"},autocomplete:"new-password"},null,8,po),[[$,N.value]]),e("button",{class:"btn btn-secondary btn-sm",onClick:de},i(s(o)("api.getImgbbApiKey")),1)])]),e("div",uo,[e("label",vo,i(s(o)("api.catboxUserHash")),1),e("div",ho,i(s(o)("api.catboxUserHashHint")),1),e("div",mo,[I(e("input",{type:"text",id:"catbox-hash",class:"base-input small-placeholder","onUpdate:modelValue":t[18]||(t[18]=a=>A.value=a),placeholder:s(o)("api.catboxUserHashPlaceholder"),style:{flex:"1"},autocomplete:"new-password"},null,8,bo),[[$,A.value]]),e("button",{class:"btn btn-secondary btn-sm",onClick:pe},i(s(o)("api.getCatboxUserHash")),1)])])])]),e("div",go,[e("div",fo,i(s(o)("api.dataBackup")),1),e("div",ko,[e("p",wo,i(s(o)("api.dataBackupDesc")),1),e("div",_o,[e("button",{class:"btn btn-secondary",style:{flex:"1"},onClick:t[19]||(t[19]=a=>K.value=!0)},i(s(o)("api.exportBackupFile")),1),e("button",{class:"btn btn-secondary",style:{flex:"1"},onClick:t[20]||(t[20]=(...a)=>s(h).importBackupFile&&s(h).importBackupFile(...a))},i(s(o)("api.importBackupFile")),1)])])]),e("div",{class:"danger-zone"},[e("button",{class:"btn btn-danger big-btn",onClick:ue},[...t[32]||(t[32]=[e("div",{class:"danger-btn-content"},[e("div",{class:"danger-btn-title"},"清除所有数据"),e("div",{class:"danger-btn-desc"},"此操作将清除所有聊天记录、设置和本地数据，且无法恢复")],-1)])])]),z(X,{visible:K.value,"onUpdate:visible":t[26]||(t[26]=a=>K.value=a),title:"导出选项",bodyClass:"no-padding"},{footer:O(()=>[e("button",{class:"modal-btn confirm",onClick:ve},"确认导出")]),default:O(()=>[e("div",yo,[e("div",{class:"scope-item",onClick:t[21]||(t[21]=a=>V("chat"))},[e("div",{class:H(["scope-checkbox",{checked:y.value.chat}])},[y.value.chat?(x(),S("svg",xo,[...t[33]||(t[33]=[e("polyline",{points:"20 6 9 17 4 12"},null,-1)])])):U("",!0)],2),t[34]||(t[34]=e("div",{class:"scope-content"},[e("span",{class:"scope-name"},"聊天数据"),e("span",{class:"scope-desc"},"包含聊天记录和朋友圈")],-1))]),e("div",{class:"scope-item",onClick:t[22]||(t[22]=a=>V("characters"))},[e("div",{class:H(["scope-checkbox",{checked:y.value.characters}])},[y.value.characters?(x(),S("svg",Po,[...t[35]||(t[35]=[e("polyline",{points:"20 6 9 17 4 12"},null,-1)])])):U("",!0)],2),t[36]||(t[36]=e("div",{class:"scope-content"},[e("span",{class:"scope-name"},"角色数据"),e("span",{class:"scope-desc"},"包含角色卡片、用户人设和收藏")],-1))]),e("div",{class:"scope-item",onClick:t[23]||(t[23]=a=>V("settings"))},[e("div",{class:H(["scope-checkbox",{checked:y.value.settings}])},[y.value.settings?(x(),S("svg",So,[...t[37]||(t[37]=[e("polyline",{points:"20 6 9 17 4 12"},null,-1)])])):U("",!0)],2),t[38]||(t[38]=e("div",{class:"scope-content"},[e("span",{class:"scope-name"},"应用设置"),e("span",{class:"scope-desc"},"包含图床、后台活动等设置")],-1))]),e("div",{class:"scope-item",onClick:t[24]||(t[24]=a=>V("appearance"))},[e("div",{class:H(["scope-checkbox",{checked:y.value.appearance}])},[y.value.appearance?(x(),S("svg",Co,[...t[39]||(t[39]=[e("polyline",{points:"20 6 9 17 4 12"},null,-1)])])):U("",!0)],2),t[40]||(t[40]=e("div",{class:"scope-content"},[e("span",{class:"scope-name"},"外观主题"),e("span",{class:"scope-desc"},"包含主题、字体、气泡样式")],-1))]),e("div",{class:"scope-item",onClick:t[25]||(t[25]=a=>V("worldbook"))},[e("div",{class:H(["scope-checkbox",{checked:y.value.worldbook}])},[y.value.worldbook?(x(),S("svg",To,[...t[41]||(t[41]=[e("polyline",{points:"20 6 9 17 4 12"},null,-1)])])):U("",!0)],2),t[42]||(t[42]=e("div",{class:"scope-content"},[e("span",{class:"scope-name"},"世界书/预设"),e("span",{class:"scope-desc"},"包含世界书和API预设")],-1))])])]),_:1},8,["visible"]),z(X,{visible:L.value,"onUpdate:visible":t[29]||(t[29]=a=>L.value=a),title:s(o)("api.selectScope"),bodyClass:"no-padding"},{footer:O(()=>[e("button",{class:"modal-btn confirm",onClick:t[28]||(t[28]=a=>L.value=!1)},i(s(o)("confirm")),1)]),default:O(()=>[e("div",Io,[e("div",{class:"scope-item",onClick:t[27]||(t[27]=a=>q("all"))},[e("div",{class:H(["scope-checkbox",{checked:n.value&&n.value.includes("all")}])},[n.value&&n.value.includes("all")?(x(),S("svg",Bo,[...t[43]||(t[43]=[e("polyline",{points:"20 6 9 17 4 12"},null,-1)])])):U("",!0)],2),e("span",Ao,i(s(o)("api.scopeAll")),1)]),(x(!0),S(Z,null,Q(s(M).characters,a=>(x(),S("div",{key:a.id,class:"scope-item",onClick:Go=>q(a.id)},[e("div",{class:H(["scope-checkbox",{checked:n.value&&n.value.includes(a.id)}])},[n.value&&n.value.includes(a.id)?(x(),S("svg",Uo,[...t[44]||(t[44]=[e("polyline",{points:"20 6 9 17 4 12"},null,-1)])])):U("",!0)],2),e("span",Ho,i(a.name),1)],8,$o))),128))])]),_:1},8,["visible","title"])]),_:1},8,["title"]))}},Eo=be(jo,[["__scopeId","data-v-29b0cb70"]]);export{Eo as default};
