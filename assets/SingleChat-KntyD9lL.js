import{m as ge,q as we,r as u,E as wt,G as Mt,u as $t,i as Fe,D as qe,_ as ae,H as nt,c as N,g as _t,a as k,o as f,f as T,w as z,e,z as a,F as ve,A as Ve,S as X,n as q,v as F,x as W,k as Me,y as s,h as Je,M as Ue,b as G,I as Xe,C as Se,J as Ze,t as le,d as ye,L as xt,N as It,O as Tt,P as st,Q as Pt,s as ot,T as fe,R as Bt,U as At,B as Ae,V as Ne,W as Vt}from"./index-CsqwSS8v.js";import{C as Ye}from"./CustomSelect-BLyEoJLU.js";import{M as at}from"./MultiSelect-LF5d9WZY.js";function Ut(n){const C=ge(),h=we(),l=u(!1),t=u(new Set),d=u(!1),o=w=>{console.log("[useMessageSelection] enterSelectionMode triggered"),l.value=!0,t.value.clear(),w&&t.value.add(w)},c=()=>{console.log("[useMessageSelection] exitSelectionMode triggered"),l.value=!1,t.value.clear()};return{isSelectionMode:l,selectedMessageIds:t,isForwarding:d,enterSelectionMode:o,exitSelectionMode:c,toggleMessageSelection:w=>{console.log(`[useMessageSelection] toggleMessageSelection for msgId: ${w}`),t.value.has(w)?t.value.delete(w):t.value.add(w)},handleBatchAction:w=>{if(console.log(`[useMessageSelection] handleBatchAction: ${w}`),t.value.size===0)return;const V=C.messages[n.value];w==="forward"?d.value=!0:w==="delete"?h.showConfirm("删除消息","确定删除选中的消息吗？",()=>{console.log("[useMessageSelection] Deleting selected messages"),C.messages[n.value]=V.filter(y=>!t.value.has(y.id)),C.saveData(),c()}):w==="favorite"&&(C.favorites||(C.favorites=[]),V.forEach(y=>{t.value.has(y.id)&&(C.favorites.some($=>$.id===y.id)||C.favorites.push(y))}),C.saveData(),h.showToast("已收藏","success"),c())},handleConfirmForward:w=>{console.log("[useMessageSelection] handleConfirmForward triggered"),d.value=!1;const y=(C.messages[n.value]||[]).filter($=>t.value.has($.id));y.length!==0&&(w.forEach($=>{C.messages[$]||(C.messages[$]=[]),y.forEach(S=>{const g={...S,id:Date.now().toString()+Math.random()};C.messages[$].push(g)})}),C.saveData(),h.showToast(`已转发 ${y.length} 条消息`),c())}}}function Dt(n,C){const h=ge(),l=wt(),t=Fe(),d=$t(),o=u(!1);return{isTyping:o,triggerAiResponse:async()=>{console.log("[useAiResponder] triggerAiResponse triggered"),o.value=!0;try{const b=h.getCharacter(n.value),v=await C.getChatCompletion(n.value);if(v){h.messages[n.value]||(h.messages[n.value]=[]);const r=(b==null?void 0:b.isBlocked)||!1;let w=v.split("|||"),V=[];const y=/(\[(?:图片|表情包|语音|位置|转账)：.+?\])/g;w.forEach($=>{const S=$.split(y).map(g=>g.trim()).filter(g=>g);V.push(...S)});for(let $=0;$<V.length;$++){const S=V[$];$>0&&await new Promise(M=>setTimeout(M,1e3+Math.random()*1e3));let{type:g,content:U}=Mt(S),E={};if(g==="sticker"){const M=U,O=h.stickers.find(D=>D.name===M);O?(U=O.url,E.name=M):(g="text",U=`[表情包：${M}]`)}let R=!1;g==="image"&&!U.startsWith("http")&&!U.startsWith("data:")&&(R=!0),h.messages[n.value].push({id:Date.now().toString()+$,sender:"char",type:g,content:U,isTextGenerated:R,...E,time:Date.now(),blocked:r}),h.saveData(),d.path!==`/chat/room/${n.value}`&&l.triggerNotification(b.nickname||b.name,g==="text"?U:`[${g}]`,b.avatar,()=>{t.push(`/chat/room/${n.value}`)},3e3,g)}}}catch(b){console.error("[useAiResponder] triggerAiResponse failed:",b)}finally{o.value=!1}}}}function Lt(n,C,h){const l=u(null);return{editingMessageId:l,handleEditMessage:c=>{console.log("[useMessageEditing] handleEditMessage for msgId:",c),l.value=c},handleSaveEdit:({msgId:c,newContent:b})=>{console.log("[useMessageEditing] handleSaveEdit for msgId:",c);const r=n.messages[C.value].find(w=>w.id===c);r&&(r.content=b,n.saveData()),l.value=null},updateInputText:c=>{console.log("[useMessageEditing] updateInputText called"),h&&(h.value=c,qe(()=>{const b=document.querySelector(".chat-input");b&&b.focus()}))}}}function Rt(n,C,h,l){const t=u(""),d=u(null),o=(y,$,S={})=>{console.log(`[useMessageSender] sendMsg called with type: ${y}`);const g={...S};d.value&&(g.quote={id:d.value.id,sender:d.value.sender,content:d.value.content}),n.messages[C.value]||(n.messages[C.value]=[]),n.messages[C.value].push({id:Date.now().toString()+Math.random(),sender:"user",type:y,content:$,time:Date.now(),...g}),n.saveData(),l&&(l.value=null),d.value=null};return{inputText:t,quotingMessage:d,sendMessage:()=>{console.log("[useMessageSender] sendMessage triggered");const y=t.value.trim();y&&(o("text",y),t.value="")},sendMsg:o,sendSticker:y=>{console.log("[useMessageSender] sendSticker triggered"),o("sticker",y.url,{name:y.name})},sendVoiceMessage:y=>{console.log("[useMessageSender] sendVoiceMessage triggered"),y&&o("voice",y)},handleSendImage:y=>{console.log("[useMessageSender] handleSendImage triggered"),y.isTextGenerated?o("image",y.description,{isTextGenerated:!0}):(y.type==="base64"||y.type==="url")&&o("image",y.content)},confirmSendLocation:(y,$)=>{if(console.log("[useMessageSender] confirmSendLocation triggered"),!y){h.showToast("请输入位置名称","info");return}o("location",y,{detail:$})},sendTransfer:()=>{console.log("[useMessageSender] sendTransfer triggered"),o("transfer","88.88")}}}function Et(n){const C=u(null),h=u(!1),l=u({x:0,y:0}),t=(v,r)=>{console.log("[useMessageInteraction] showMenu triggered"),v.preventDefault();const w=v.target.closest(".msg-bubble, .system-message-wrapper");w&&(n.value={visible:!0,messageId:r,targetEl:w})};return{startLongPress:(v,r)=>{console.log("[useMessageInteraction] startLongPress triggered"),v.stopPropagation(),h.value=!1,clearTimeout(C.value),v.type.startsWith("touch")&&(l.value={x:v.touches[0].clientX,y:v.touches[0].clientY}),C.value=setTimeout(()=>{h.value=!0,t(v,r)},400)},cancelLongPress:()=>{console.log("[useMessageInteraction] cancelLongPress triggered"),clearTimeout(C.value)},handleTouchMove:v=>{console.log("[useMessageInteraction] handleTouchMove triggered");const r=v.touches[0],w=Math.abs(r.clientX-l.value.x),V=Math.abs(r.clientY-l.value.y);(w>10||V>10)&&clearTimeout(C.value)},wasClickAfterLongPress:()=>h.value?(h.value=!1,!0):!1}}const Nt={class:"memory-bank-wrapper"},qt={class:"memory-scroll-container"},Ft={key:0,class:"empty-state"},zt={class:"empty-text"},Ot={key:1,class:"memory-list"},jt={class:"card-header-row"},Wt={class:"header-left"},Gt={class:"sort-buttons"},Ht=["onClick","disabled"],Kt=["onClick","disabled"],Qt={class:"char-info"},Yt={class:"char-name"},Xt={class:"save-time"},Jt={class:"header-right"},Zt=["onClick"],es=["onClick"],ts=["onClick","title"],ss={class:"card-content-row"},as={__name:"SingleMemoryBank",props:{visible:Boolean,charId:String},emits:["update:visible"],setup(n,{emit:C}){const h=n,l=C,t=ge(),d=we(),o=nt(),c=u(!1),b=u(!1),v=u(-1),r=u(""),w=u(!1),V=u(-1),y=u(!1),$=u(""),S=N(()=>t.getCharacter(h.charId)),g=N(()=>{var x;return((x=S.value)==null?void 0:x.memories)||[]}),U=N(()=>{var x;return((x=S.value)==null?void 0:x.name)||"角色"}),E=N(()=>c.value?g.value.filter(x=>x.isFavorite):g.value),R=()=>{l("update:visible",!1)},M=()=>{b.value=!1,r.value=""},O=()=>{w.value=!1,V.value=-1},D=()=>{y.value=!1},B=x=>{if(!x)return"";const P=new Date(x);return`${P.getFullYear()}/${(P.getMonth()+1).toString().padStart(2,"0")}/${P.getDate().toString().padStart(2,"0")} ${P.getHours().toString().padStart(2,"0")}:${P.getMinutes().toString().padStart(2,"0")}`},_=x=>g.value.indexOf(x),H=()=>{v.value=-1,r.value="",b.value=!0},J=x=>{v.value=x;const P=g.value[x];r.value=typeof P=="string"?P:P.content,b.value=!0},ne=()=>{if(!r.value.trim())return;const x=S.value;if(x.memories||(x.memories=[]),v.value>=0){const P=x.memories[v.value];typeof P=="string"?x.memories[v.value]={content:r.value,time:Date.now(),charName:x.name,isFavorite:!1}:P.content=r.value}else x.memories.unshift({content:r.value,time:Date.now(),charName:x.name,isFavorite:!1});t.saveData(),M()},ee=x=>{V.value=x,w.value=!0},me=()=>{V.value>=0&&(S.value.memories.splice(V.value,1),t.saveData()),O()},te=(x,P)=>{const K=x+P;if(K<0||K>=g.value.length)return;const L=S.value.memories[x];S.value.memories[x]=S.value.memories[K],S.value.memories[K]=L,t.saveData()},he=x=>{const P=g.value[x];typeof P=="string"?g.value[x]={content:P,time:Date.now(),charName:U.value,isFavorite:!0}:P.isFavorite=!P.isFavorite,t.saveData()},de=()=>{$.value=S.value.memorySummaryPrompt||"",y.value=!0},se=async()=>{const x=S.value;if(!x)return;x.memorySummaryPrompt=$.value,d.showToast("正在总结记忆...","info"),D();const P=g.value.map(Q=>Q.content).join(`
---
`),K=$.value||"请总结以下内容，提取关键信息。",L=[{role:"system",content:"你是一个记忆总结助手。"},{role:"user",content:`现有记忆如下：
${P}

请根据以下要求进行总结：
${K}`}];try{const Q=await o.getGenericCompletion(L);Q?(x.memories||(x.memories=[]),x.memories.unshift({content:`[记忆再总结] ${Q}`,time:Date.now(),charName:x.name,isFavorite:!1}),t.saveData(),d.showToast("记忆总结已完成","success")):d.showToast("总结失败，未收到有效回复","error")}catch(Q){console.error("记忆总结失败:",Q)}};return(x,P)=>{const K=_t("Modal");return f(),k("div",Nt,[T(K,{visible:n.visible,"onUpdate:visible":R,containerClass:"memory-bank-modal-container",teleportTo:"#phone-screen-container"},{header:z(()=>[e("div",{class:"modal-header-content"},[P[5]||(P[5]=e("h3",null,"长期记忆",-1)),e("div",{class:"header-actions"},[e("button",{class:"btn summary-btn",onClick:de},"总结")])])]),footer:z(()=>[e("button",{class:"modal-btn primary-text",onClick:H},"+ 新增"),e("button",{class:"modal-btn cancel",onClick:R},"关闭")]),default:z(()=>[e("div",qt,[!E.value||E.value.length===0?(f(),k("div",Ft,[e("div",zt,a(c.value?"暂无收藏记忆":"暂无长期记忆"),1)])):(f(),k("div",Ot,[(f(!0),k(ve,null,Ve(E.value,L=>(f(),k("div",{key:L.id||x.index,class:"card memory-card"},[e("div",jt,[e("div",Wt,[e("div",Gt,[e("button",{class:"icon-btn sort-btn",onClick:Q=>te(_(L),-1),disabled:_(L)===0||c.value,title:"上移"},[T(X,{name:"arrow-up"})],8,Ht),e("button",{class:"icon-btn sort-btn",onClick:Q=>te(_(L),1),disabled:_(L)===g.value.length-1||c.value,title:"下移"},[T(X,{name:"arrow-down"})],8,Kt)]),e("div",Qt,[e("span",Yt,a(L.charName||U.value),1),e("span",Xt,a(B(L.time)),1)])]),e("div",Jt,[e("button",{class:"icon-btn",onClick:Q=>J(_(L)),title:"编辑"},[T(X,{name:"pencil"})],8,Zt),e("button",{class:"icon-btn danger",onClick:Q=>ee(_(L)),title:"删除"},[T(X,{name:"trash"})],8,es),e("button",{class:"icon-btn favorite-btn",onClick:Q=>he(_(L)),title:L.isFavorite?"取消收藏":"收藏"},[T(X,{name:L.isFavorite?"heart-solid":"heart",class:q({"is-favorite":L.isFavorite})},null,8,["name","class"])],8,ts)])]),e("div",ss,a(L.content),1)]))),128))]))])]),_:1},8,["visible"]),T(K,{visible:b.value,"onUpdate:visible":P[1]||(P[1]=L=>b.value=L),title:v.value>=0?"编辑记忆":"新增记忆",class:"nested"},{footer:z(()=>[e("button",{class:"modal-btn cancel",onClick:M},"取消"),e("button",{class:"modal-btn confirm",onClick:ne},"确定")]),default:z(()=>[F(e("textarea",{class:"base-input modal-textarea","onUpdate:modelValue":P[0]||(P[0]=L=>r.value=L),placeholder:"输入希望AI记住的内容...",style:{height:"150px"}},null,512),[[W,r.value]])]),_:1},8,["visible","title"]),T(K,{visible:w.value,"onUpdate:visible":P[2]||(P[2]=L=>w.value=L),title:"确认删除",class:"nested"},{footer:z(()=>[e("button",{class:"modal-btn cancel",onClick:O},"取消"),e("button",{class:"modal-btn confirm danger",onClick:me},"确认删除")]),default:z(()=>[P[6]||(P[6]=e("p",{class:"confirm-text"},"确定要删除这条记忆吗？",-1))]),_:1},8,["visible"]),T(K,{visible:y.value,"onUpdate:visible":P[4]||(P[4]=L=>y.value=L),title:"记忆总结",class:"nested"},{footer:z(()=>[e("button",{class:"modal-btn cancel",onClick:D},"取消"),e("button",{class:"modal-btn confirm",onClick:se},"开始总结")]),default:z(()=>[P[7]||(P[7]=e("p",{class:"summary-tip"},"将对现有长期记忆进行再总结。",-1)),F(e("textarea",{class:"base-input modal-textarea","onUpdate:modelValue":P[3]||(P[3]=L=>$.value=L),placeholder:"输入总结提示词...",style:{height:"100px"}},null,512),[[W,$.value]])]),_:1},8,["visible"])])}}},lt=ae(as,[["__scopeId","data-v-6b1d3cd9"]]),ns={class:"chat-room-header"},os={class:"left-icons"},ls={class:"center-container"},is={class:"header-title-area"},cs={key:0,class:"chat-room-title"},rs={key:1,class:"typing-indicator"},ds={class:"right-icons"},us={style:{display:"flex",gap:"10px","margin-bottom":"10px"}},vs=["placeholder"],gs=["placeholder"],ms={__name:"SingleChatHeader",props:{charId:{type:String,required:!0},charName:{type:String,default:""},charStatus:{type:Object,default:()=>({})},isTyping:{type:Boolean,default:!1}},emits:["trigger-ai","open-settings"],setup(n,{emit:C}){const h=n,{t:l}=Me(),t=Fe(),d=ge(),o=we(),c=u(!1),b=u(""),v=u(""),r=u(!1),w=()=>{t.options.history.state.back?t.back():t.push("/chat")},V=()=>{const S=h.charStatus||{};b.value=S.icon||"✨",v.value=S.text||"",c.value=!0},y=()=>{const S=b.value.trim()||"✨",g=v.value.trim(),U=d.getCharacter(h.charId);U&&(g?U.status={icon:S,text:g}:U.status=null,d.saveData(),o.showToast(l("saveSuccess"))),c.value=!1},$=()=>{r.value=!0};return(S,g)=>(f(),k("div",ns,[e("div",os,[e("div",{class:"btn-icon back-btn",onClick:w},[...g[7]||(g[7]=[e("svg",{class:"svg-icon",viewBox:"0 0 24 24"},[e("polyline",{points:"15 18 9 12 15 6"})],-1)])]),e("div",{class:"btn-icon bell-btn",onClick:g[0]||(g[0]=U=>S.$emit("trigger-ai")),ref:"bellBtn"},[...g[8]||(g[8]=[e("svg",{class:"svg-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"}),e("path",{d:"M13.73 21a2 2 0 0 1-3.46 0"})],-1)])],512)]),e("div",ls,[e("div",is,[n.isTyping?(f(),k("div",rs,[e("span",null,a(s(l)("chat.singleChat.typing")),1),g[9]||(g[9]=e("span",{class:"dots"},[e("span",null,"."),e("span",null,"."),e("span",null,".")],-1))])):(f(),k("div",cs,a(n.charName),1))]),e("div",{class:"chat-room-status",onClick:V},[e("span",null,a(n.charStatus.icon||"✨"),1),e("span",null,a(n.charStatus.text||s(l)("chat.singleChat.addStatus")),1)])]),e("div",ds,[e("div",{class:"btn-icon memory-btn",onClick:$},[...g[10]||(g[10]=[Je('<svg class="svg-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-495576d3><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" data-v-495576d3></path><polyline points="14 2 14 8 20 8" data-v-495576d3></polyline><line x1="16" y1="13" x2="8" y2="13" data-v-495576d3></line><line x1="16" y1="17" x2="8" y2="17" data-v-495576d3></line><polyline points="10 9 9 9 8 9" data-v-495576d3></polyline></svg>',1)])]),e("div",{class:"btn-icon more-btn",onClick:g[1]||(g[1]=U=>S.$emit("open-settings"))},[...g[11]||(g[11]=[e("svg",{class:"svg-icon",viewBox:"0 0 24 24"},[e("circle",{cx:"12",cy:"12",r:"1"}),e("circle",{cx:"19",cy:"12",r:"1"}),e("circle",{cx:"5",cy:"12",r:"1"})],-1)])])]),T(Ue,{visible:c.value,"onUpdate:visible":g[5]||(g[5]=U=>c.value=U),title:s(l)("chat.singleChat.setStatus")},{footer:z(()=>[e("button",{class:"modal-btn cancel",onClick:g[4]||(g[4]=U=>c.value=!1)},a(s(l)("cancel")),1),e("button",{class:"modal-btn confirm",onClick:y},a(s(l)("confirm")),1)]),default:z(()=>[e("div",us,[F(e("input",{type:"text",class:"base-input","onUpdate:modelValue":g[2]||(g[2]=U=>b.value=U),placeholder:s(l)("chat.singleChat.statusIcon"),style:{width:"60px","text-align":"center"}},null,8,vs),[[W,b.value]]),F(e("input",{type:"text",class:"base-input","onUpdate:modelValue":g[3]||(g[3]=U=>v.value=U),placeholder:s(l)("chat.singleChat.statusText"),style:{flex:"1"}},null,8,gs),[[W,v.value]])])]),_:1},8,["visible","title"]),T(lt,{visible:r.value,"onUpdate:visible":g[6]||(g[6]=U=>r.value=U),charId:n.charId},null,8,["visible","charId"])]))}},hs=ae(ms,[["__scopeId","data-v-495576d3"]]),ps={key:0,class:"chat-panel",id:"stickerPanel"},bs={class:"sticker-panel-header"},fs={class:"sticker-groups"},ys=["onClick"],ks={class:"sticker-panel-content"},Cs=["onClick"],Ss=["src","alt"],ws={class:"sticker-panel-footer"},Ms={__name:"StickersPanel",props:{visible:Boolean},emits:["send-sticker","update:visible"],setup(n,{emit:C}){const h=C,l=ge(),t=we(),d=u("默认"),o=u(!1),c=u(new Set),b=u(!1),v=u(!1),r=u(""),w=N(()=>["默认",...new Set(l.stickers.map(B=>B.group).filter(Boolean).filter(B=>B!=="默认"))]),V=N(()=>l.stickers.filter(D=>D.group===d.value)),y=D=>{o.value?c.value.has(D.id)?c.value.delete(D.id):c.value.add(D.id):h("send-sticker",D)},$=({group:D,stickers:B})=>{const _=B.map(H=>({id:Date.now().toString()+Math.random().toString(36).substr(2,9),url:H.url,name:H.name,group:D}));l.stickers.push(..._),l.saveData(),t.showToast(`成功导入 ${_.length} 个表情包`,"success")},S=()=>{b.value=!0},g=()=>{c.value.size>0&&(v.value=!0)},U=()=>{o.value=!o.value,c.value.clear()},E=()=>{const D=V.value;D.every(_=>c.value.has(_.id))?D.forEach(_=>c.value.delete(_.id)):D.forEach(_=>c.value.add(_.id))},R=()=>{c.value.size!==0&&t.showConfirm("删除表情包","确定删除选中的表情包吗？",()=>{l.stickers=l.stickers.filter(D=>!c.value.has(D.id)),l.saveData(),c.value.clear()})},M=()=>{const D=r.value.trim();if(!D)return t.showToast("请输入目标分组","info");l.stickers.forEach(B=>{c.value.has(B.id)&&(B.group=D)}),l.saveData(),v.value=!1,r.value="",c.value.clear(),o.value=!1,d.value=D},O=()=>{if(c.value.size===0)return;const D=l.stickers.filter(J=>c.value.has(J.id)).map(J=>`${J.name} ${J.url}`).join(`
`),B=new Blob([D],{type:"text/plain"}),_=URL.createObjectURL(B),H=document.createElement("a");H.href=_,H.download=`stickers_export_${new Date().toISOString().slice(0,10)}.txt`,document.body.appendChild(H),H.click(),document.body.removeChild(H),URL.revokeObjectURL(_),c.value.clear(),o.value=!1};return(D,B)=>(f(),k("div",null,[n.visible?(f(),k("div",ps,[e("div",bs,[e("div",fs,[(f(!0),k(ve,null,Ve(w.value,_=>(f(),k("div",{class:q(["sticker-group-tab",{active:d.value===_}]),key:_,onClick:H=>d.value=_},a(_),11,ys))),128))])]),e("div",ks,[(f(!0),k(ve,null,Ve(V.value,_=>(f(),k("div",{class:q(["sticker-item",{selected:c.value.has(_.id),"manage-mode":o.value}]),key:_.id,onClick:H=>y(_)},[e("img",{src:_.url,alt:_.name},null,8,Ss),e("span",null,a(_.name),1)],10,Cs))),128))]),e("div",ws,[F(e("div",{class:"sticker-add-btn",onClick:S},"＋",512),[[Xe,!o.value]]),e("div",{class:"sticker-manage-btn",style:Se({color:o.value?"var(--danger-color)":"#576B95"}),onClick:U},a(o.value?"完成":"管理"),5)]),e("div",{class:q(["manage-bar",{active:o.value}])},[e("button",{class:"btn btn-secondary",onClick:S},"导入"),e("button",{class:"btn btn-secondary",onClick:E},"全选"),e("button",{class:"btn btn-secondary",onClick:g},"移动"),e("button",{class:"btn btn-secondary",onClick:O},"导出"),e("button",{class:"btn btn-danger",onClick:R},"删除")],2)])):G("",!0),T(Ze,{visible:b.value,"onUpdate:visible":B[0]||(B[0]=_=>b.value=_),type:"sticker-import",onImportSticker:$},null,8,["visible"]),T(Ue,{visible:v.value,"onUpdate:visible":B[3]||(B[3]=_=>v.value=_),title:"移动到分组"},{footer:z(()=>[e("button",{class:"modal-btn cancel",onClick:B[2]||(B[2]=_=>v.value=!1)},"取消"),e("button",{class:"modal-btn confirm",onClick:M},"确定")]),default:z(()=>[F(e("input",{type:"text",class:"base-input","onUpdate:modelValue":B[1]||(B[1]=_=>r.value=_),placeholder:"输入目标分组名称"},null,512),[[W,r.value]])]),_:1},8,["visible"])]))}},$s=ae(Ms,[["__scopeId","data-v-f9fb1def"]]),_s={class:"chat-panel",id:"morePanel"},xs={class:"more-panel-content"},Is={class:"more-label"},Ts={class:"more-label"},Ps={class:"more-label"},Bs={class:"more-label"},As={__name:"MorePanel",emits:["trigger-image-upload","start-video-call","send-location","send-transfer"],setup(n){const{t:C}=Me();return(h,l)=>(f(),k("div",_s,[e("div",xs,[e("div",{class:"more-item",onClick:l[0]||(l[0]=t=>h.$emit("trigger-image-upload"))},[l[4]||(l[4]=Je('<div class="more-icon" data-v-731b24d5><svg class="svg-icon" viewBox="0 0 24 24" data-v-731b24d5><rect x="3" y="3" width="18" height="18" rx="2" ry="2" data-v-731b24d5></rect><circle cx="8.5" cy="8.5" r="1.5" data-v-731b24d5></circle><polyline points="21 15 16 10 5 21" data-v-731b24d5></polyline></svg></div>',1)),e("span",Is,a(s(C)("chat.morePanel.image")),1)]),e("div",{class:"more-item",onClick:l[1]||(l[1]=t=>h.$emit("start-video-call"))},[l[5]||(l[5]=e("div",{class:"more-icon"},[e("svg",{class:"svg-icon",viewBox:"0 0 24 24"},[e("polygon",{points:"23 7 16 12 23 17 23 7"}),e("rect",{x:"1",y:"5",width:"15",height:"14",rx:"2",ry:"2"})])],-1)),e("span",Ts,a(s(C)("chat.morePanel.videoCall")),1)]),e("div",{class:"more-item",onClick:l[2]||(l[2]=t=>h.$emit("send-location"))},[l[6]||(l[6]=e("div",{class:"more-icon"},[e("svg",{class:"svg-icon",viewBox:"0 0 24 24"},[e("path",{d:"M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"}),e("circle",{cx:"12",cy:"10",r:"3"})])],-1)),e("span",Ps,a(s(C)("chat.morePanel.location")),1)]),e("div",{class:"more-item",onClick:l[3]||(l[3]=t=>h.$emit("send-transfer"))},[l[7]||(l[7]=e("div",{class:"more-icon"},[e("svg",{class:"svg-icon",viewBox:"0 0 24 24"},[e("line",{x1:"12",y1:"1",x2:"12",y2:"23"}),e("path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"})])],-1)),e("span",Bs,a(s(C)("chat.morePanel.transfer")),1)])])]))}},Vs=ae(As,[["__scopeId","data-v-731b24d5"]]),Us={class:"chat-footer"},Ds={key:0,class:"quote-preview"},Ls={class:"quote-content"},Rs={class:"quote-sender"},Es={class:"quote-text"},Ns={class:"chat-input-row"},qs={class:"chat-input-wrapper"},Fs=["value"],zs={class:"svg-icon",viewBox:"0 0 24 24",style:{stroke:"white",width:"21px",height:"21px",position:"relative",top:"1px",left:"-1px"}},Os={__name:"ChatInputBar",props:{modelValue:{type:String,default:""},activePanel:{type:String,default:null},quotingMessage:{type:Object,default:null}},emits:["update:modelValue","update:activePanel","cancel-quote","send-message","send-sticker","trigger-voice","trigger-image","trigger-video","trigger-location","trigger-transfer"],setup(n,{emit:C}){const{t:h}=Me(),l=n,t=C,d=u(l.activePanel);le(()=>l.activePanel,v=>{d.value=v}),le(d,v=>{t("update:activePanel",v)});const o=v=>{d.value===v?d.value=null:d.value=v},c=()=>{l.modelValue.trim()&&t("send-message")},b=v=>{t("send-sticker",v),d.value=null};return(v,r)=>(f(),k("div",Us,[n.quotingMessage?(f(),k("div",Ds,[e("div",Ls,[e("span",Rs,a(n.quotingMessage.sender==="user"?s(h)("chat.self"):s(h)("chat.other"))+": ",1),e("span",Es,a(n.quotingMessage.content),1)]),e("div",{class:"quote-close",onClick:r[0]||(r[0]=w=>v.$emit("cancel-quote"))},[...r[9]||(r[9]=[e("div",{class:"quote-close-icon"},[e("svg",{viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12"},[e("path",{d:"M576 512l277.333333 277.333333-64 64-277.333333-277.333333L234.666667 853.333333 170.666667 789.333333l277.333333-277.333333L170.666667 234.666667 234.666667 170.666667l277.333333 277.333333L789.333333 170.666667 853.333333 234.666667 576 512z",fill:"currentColor"})])],-1)])])])):G("",!0),e("div",Ns,[e("div",{class:"chat-tool-btn",onClick:r[1]||(r[1]=w=>v.$emit("trigger-voice"))},[T(X,{name:"voice-circle",class:"svg-icon"})]),e("div",qs,[e("input",{type:"text",class:"chat-input",value:n.modelValue,onInput:r[2]||(r[2]=w=>v.$emit("update:modelValue",w.target.value)),onKeypress:xt(c,["enter"]),id:"messageInput"},null,40,Fs)]),e("div",{class:"chat-tool-btn",onClick:r[3]||(r[3]=w=>o("sticker"))},[T(X,{name:"sticker",class:"svg-icon"})]),n.modelValue?(f(),k("div",{key:1,class:"send-btn-icon",onClick:c},[(f(),k("svg",zs,[...r[10]||(r[10]=[e("line",{x1:"22",y1:"2",x2:"11",y2:"13"},null,-1),e("polygon",{points:"22 2 15 22 11 13 2 9 22 2"},null,-1)])]))])):(f(),k("div",{key:0,class:"chat-tool-btn",onClick:r[4]||(r[4]=w=>o("more"))},[T(X,{name:"plus-circle",class:"svg-icon"})]))]),T($s,{visible:d.value==="sticker",onSendSticker:b},null,8,["visible"]),d.value==="more"?(f(),ye(Vs,{key:1,onTriggerImageUpload:r[5]||(r[5]=w=>v.$emit("trigger-image")),onStartVideoCall:r[6]||(r[6]=w=>v.$emit("trigger-video")),onSendLocation:r[7]||(r[7]=w=>v.$emit("trigger-location")),onSendTransfer:r[8]||(r[8]=w=>v.$emit("trigger-transfer"))})):G("",!0)]))}},js=ae(Os,[["__scopeId","data-v-df4db61b"]]),Ws={class:"chat-settings active"},Gs={class:"app-header"},Hs={class:"title"},Ks={class:"action-btn"},Qs={class:"app-content settings-content"},Ys={class:"card"},Xs={key:"roleInfo"},Js={class:"card-content"},Zs={class:"role-header-layout"},ea=["src"],ta={key:1,class:"role-avatar-placeholder"},sa={class:"role-inputs-wrapper"},aa=["placeholder"],na=["placeholder"],oa={class:"form-item-vertical"},la={class:"label-main",style:{"margin-bottom":"5px"}},ia=["placeholder"],ca={class:"card"},ra={key:"userInfo"},da={class:"card-content"},ua={class:"settings-pure-item",style:{"border-bottom":"none"}},va={class:"settings-pure-label"},ga={class:"user-header-layout"},ma=["src"],ha={key:1,class:"role-avatar-placeholder"},pa={class:"user-inputs-wrapper"},ba={class:"user-actions-row"},fa=["placeholder"],ya={class:"form-item-vertical"},ka={class:"label-main",style:{"margin-bottom":"5px"}},Ca=["placeholder"],Sa={class:"card"},wa={class:"card-title-remark"},Ma={key:"backgroundActivity"},$a={class:"card-content"},_a={class:"settings-item-input"},xa={class:"label-col"},Ia={class:"label-main"},Ta={class:"settings-pure-value"},Pa={class:"settings-item-input"},Ba={class:"label-col"},Aa={class:"label-main"},Va={class:"label-sub"},Ua={class:"mode-selector"},Da={key:0},La={class:"settings-item-input"},Ra={class:"label-col"},Ea={class:"label-main"},Na={class:"label-sub"},qa={class:"settings-item-input"},Fa={class:"label-col"},za={class:"label-main"},Oa={class:"label-sub"},ja={class:"settings-item-input"},Wa={class:"label-col"},Ga={class:"label-main"},Ha={class:"label-sub"},Ka={class:"settings-item-input"},Qa={class:"label-col"},Ya={class:"label-main"},Xa={class:"label-sub"},Ja={class:"mode-selector"},Za={key:0,class:"settings-item-input"},en={class:"label-col"},tn={class:"label-main"},sn={class:"label-sub"},an={class:"card"},nn={key:"modeSettings"},on={class:"card-content"},ln={class:"settings-pure-item"},cn={class:"settings-pure-label"},rn={class:"mode-selector"},dn={key:0,class:"settings-pure-item"},un={class:"settings-pure-label"},vn={class:"settings-pure-item"},gn={class:"settings-pure-label"},mn={class:"settings-item-input"},hn={class:"label-col"},pn={class:"label-main"},bn={class:"label-sub"},fn={class:"reply-length-container"},yn=["placeholder"],kn=["placeholder"],Cn={class:"card"},Sn={key:"summarySettings"},wn={class:"card-content"},Mn={class:"settings-item-input"},$n={class:"label-col"},_n={class:"label-main"},xn={class:"label-sub"},In={class:"form-item-vertical"},Tn={class:"label-main",style:{"margin-bottom":"5px"}},Pn=["placeholder"],Bn={class:"settings-item-input"},An={class:"label-col"},Vn={class:"label-main"},Un={class:"label-sub"},Dn={class:"settings-btn-row flex-distribute-children",style:{padding:"15px 0","border-bottom":"1px solid #f5f5f5"}},Ln={class:"settings-item-input"},Rn={class:"label-col"},En={class:"label-main"},Nn={class:"label-sub"},qn={class:"settings-pure-item"},Fn={class:"settings-pure-label"},zn={class:"settings-pure-item"},On={class:"settings-pure-label"},jn={class:"settings-pure-value"},Wn={class:"settings-pure-item"},Gn={class:"settings-pure-label"},Hn={class:"settings-pure-value"},Kn={class:"card"},Qn={key:"bubbleSettings"},Yn={class:"card-content"},Xn={class:"settings-section-title"},Jn={class:"settings-row-group"},Zn={class:"settings-pure-label",style:{width:"60px"}},eo={style:{flex:"1",margin:"0 10px"}},to={class:"btn-group-mini"},so=["disabled"],ao={class:"bubble-preview-container"},no={class:"bubble-preview-area"},oo={class:"preview-msg-row left"},lo={class:"preview-avatar char"},io=["src"],co={key:1,class:"default-avatar"},ro={class:"preview-msg-row right"},uo={class:"preview-avatar user"},vo=["src"],go={key:1,class:"default-avatar"},mo={class:"settings-item-input"},ho={class:"label-col"},po={class:"label-main"},bo={class:"slider-container gray-slider"},fo={class:"slider-value"},yo={class:"form-item-vertical no-border"},ko={class:"label-main",style:{"margin-bottom":"5px"}},Co=["placeholder"],So={class:"settings-section-title"},wo={class:"settings-item-avatar",style:{"border-bottom":"none","margin-bottom":"0"}},Mo={class:"avatar-layout"},$o={class:"avatar-controls",style:{width:"100%"}},_o={class:"card"},xo={key:"videoSettings"},Io={class:"card-content"},To={class:"video-settings-container"},Po={class:"video-setting-col"},Bo={class:"settings-item-label center"},Ao=["src"],Vo={key:1,class:"default-avatar bg-placeholder"},Uo={class:"video-setting-col"},Do={class:"settings-item-label center"},Lo=["src"],Ro={key:1,class:"default-avatar bg-placeholder"},Eo={class:"card"},No={key:"advancedSettings"},qo={class:"card-content"},Fo={class:"settings-pure-item"},zo={class:"settings-pure-label"},Oo={class:"settings-pure-value"},jo={class:"danger-zone"},Wo={class:"danger-btn-content"},Go={class:"danger-btn-title"},Ho={class:"danger-btn-desc"},Ko={class:"danger-btn-content"},Qo={class:"danger-btn-title"},Yo={class:"danger-btn-desc"},Xo={class:"danger-btn-content"},Jo={class:"danger-btn-title"},Zo={class:"danger-btn-desc"},el={__name:"SingleChatSettings",props:{visible:Boolean,charId:String},emits:["update:visible"],setup(n,{emit:C}){const h=n,l=C,{t}=Me(),d=Fe(),o=ge(),c=we(),b=It(),v=Tt(),{sortedWorldBooks:r}=st(v),w=Pt(),{sortedPresets:V}=st(w),y=u({roleInfo:!1,userInfo:!1,backgroundActivity:!1,modeSettings:!1,summarySettings:!1,bubbleSettings:!1,videoSettings:!1,advancedSettings:!1}),$=u(!1),S=u(!1),g=u(""),U=u(""),E=u(""),R=u(""),M=u("default"),O=u(""),D=u(""),B=u(""),_=u("default"),H=u(5),J=u(30),ne=u(10),ee=u("always"),me=u(15),te=u(!0),he=u([]),de=u([]),se=u(""),x=u(""),P=u(20),K=u(""),L=u(!1),Q=u(10),ie=u(""),ce=u(""),oe=u(14),ke=u(""),Ce=u(""),ue=u(""),_e=u("default"),De=u(0),pe=u(!1),xe=u(0),Ie=u(0),Z=N(()=>o.getCharacter(h.charId)),be=N(()=>{var m;return((m=Z.value)==null?void 0:m.name)||t("chat.unknownCharacter")}),$e=N(()=>{var m;return(m=Z.value)==null?void 0:m.avatar}),ze=N(()=>[{value:"default",label:t("chat.singleChat.settings.defaultUserPersona")},...(o.userPersonas||[]).map(m=>({value:m.id,label:m.name}))]),Oe=N(()=>[{value:"default",label:t("chat.singleChat.settings.default")+"配置"},{value:"api1",label:"配置一"},{value:"api2",label:"配置二"}]),je=N(()=>[{value:"",label:t("chat.singleChat.settings.custom")},...(o.bubblePresets||[]).map(m=>({value:m.id,label:m.name}))]),We=N(()=>_.value==="on"?!0:_.value==="off"?!1:b.globalBackgroundActivity),Le=N(()=>{const m={fontSize:`${oe.value}px`};if(!ce.value)return m;const i={};return ce.value.split(";").forEach(p=>{const Y=p.split(":");if(Y.length>=2){const Pe=Y[0].trim(),Be=Y.slice(1).join(":").trim();Pe&&Be&&(i[Pe]=Be)}}),{...m,...i}}),Ge=N(()=>({avatar:t("chat.singleChat.settings.toast.setCharAvatar"),userPersonaAvatar:t("chat.singleChat.settings.toast.setUserAvatar"),chatBg:t("chat.singleChat.settings.toast.setChatBg"),videoBg:t("chat.singleChat.settings.toast.setCharImg"),userVideoImg:t("chat.singleChat.settings.toast.setUserImg")})[g.value]||t("chat.singleChat.settings.toast.upload"));le(M,m=>{m&&Qe(m)}),le(ie,m=>{m&&dt(m)}),ot(()=>{if(!Z.value){A();return}it()});const re=m=>{y.value[m]=!y.value[m]},A=()=>{l("update:visible",!1)},I=()=>{$.value=!0},j=()=>{g.value="avatar",S.value=!0},He=()=>{g.value="userPersonaAvatar",S.value=!0},Te=()=>{g.value="chatBg",S.value=!0},Re=()=>{g.value="videoBg",S.value=!0},Ee=()=>{g.value="userVideoImg",S.value=!0},it=()=>{var Be;const m=Z.value;U.value=m.name,E.value=m.nickname||"",R.value=m.charPersona||"",M.value=m.userPersona||"default",Qe(M.value),_.value=m.backgroundActivityOverride||"default",H.value=m.proactiveInterval||5,J.value=m.proactiveCooldown||30,ne.value=m.proactiveDailyLimit||10,ee.value=m.triggerMode||"always",me.value=m.proactiveIdleTime||15,te.value=m.isOnline!==!1,he.value=Array.isArray(m.preset)?m.preset:m.preset?[m.preset]:[],de.value=m.worldbook||[];const[i,p]=(m.replyLength||(te.value?"10-50":"200-500")).split("-");se.value=i||"",x.value=p||"",P.value=m.summaryRange||20,K.value=m.summaryPrompt||"",L.value=m.autoSummary||!1,Q.value=m.memoryCount||10;const Y=m.bubbleSettings||{};ce.value=Y.css||"",oe.value=Y.fontSize||14,ke.value=m.chatBackground||"",Ce.value=m.videoBg||"",ue.value=m.userVideoImg||"",_e.value=m.api||"default",De.value=((Be=m.npc)==null?void 0:Be.length)||0,pe.value=m.isBlocked||!1;const Pe=o.messages[h.charId]||[];Ie.value=Pe.length,xe.value=Math.ceil(Pe.reduce((Ct,St)=>{var tt;return Ct+(((tt=St.content)==null?void 0:tt.length)||0)},0)*1.5)},Ke=()=>{const m=Z.value;m&&(Object.assign(m,{name:U.value.trim()||m.name,nickname:E.value.trim(),charPersona:R.value,userPersona:M.value,backgroundActivityOverride:_.value,proactiveInterval:H.value,proactiveCooldown:J.value,proactiveDailyLimit:ne.value,triggerMode:ee.value,proactiveIdleTime:me.value,isOnline:te.value,preset:he.value,worldbook:de.value,replyLength:`${se.value}-${x.value}`,summaryRange:P.value,summaryPrompt:K.value,autoSummary:L.value,memoryCount:Q.value,bubbleSettings:{css:ce.value,fontSize:oe.value},chatBackground:ke.value,videoBg:Ce.value,userVideoImg:ue.value,isBlocked:pe.value}),o.saveData(),c.showToast(t("theme.toast.saveSuccess")))},Qe=m=>{const i=t("chat.singleChat.settings.defaultUserPersona");let p=o.userPersonas.find(Y=>Y.id===m)||{name:i,avatar:"",description:"",videoImg:""};O.value=p.name===i?"":p.name,D.value=p.description||"",B.value=p.avatar||"",m!=="default"&&(ue.value=p.videoImg||"")},ct=()=>{const m=O.value.trim();if(!m)return c.showToast(t("chat.singleChat.settings.toast.personaNameRequired"),"error");const i={id:M.value==="default"?Date.now().toString():M.value,name:m,description:D.value,avatar:B.value,videoImg:ue.value};if(M.value==="default")o.userPersonas.push(i),M.value=i.id,c.showToast(t("chat.singleChat.settings.toast.personaSaved"));else{const p=o.userPersonas.findIndex(Y=>Y.id===M.value);p!==-1&&(o.userPersonas[p]=i,c.showToast(t("chat.singleChat.settings.toast.personaUpdated")))}o.saveData()},rt=()=>{if(M.value==="default")return c.showToast(t("chat.singleChat.settings.toast.defaultPersonaDelete"),"error");c.showConfirm(t("chat.singleChat.settings.toast.deletePersona"),t("chat.singleChat.settings.toast.confirmDeletePersona"),()=>{o.userPersonas=o.userPersonas.filter(m=>m.id!==M.value),o.characters.forEach(m=>{m.userPersona===M.value&&(m.userPersona="default")}),M.value="default",Qe("default"),o.saveData()})},dt=m=>{if(!m)return;const i=o.bubblePresets.find(p=>p.id===m);i&&(ce.value=i.css,oe.value=i.fontSize)},ut=()=>{const m=prompt(t("chat.singleChat.settings.toast.presetNameRequired"));if(!m)return;const i={id:Date.now().toString(),name:m,css:ce.value,fontSize:oe.value};o.bubblePresets.push(i),o.saveData(),ie.value=i.id,c.showToast(t("chat.singleChat.settings.toast.presetSaved"))},vt=()=>{ie.value&&c.showConfirm(t("chat.singleChat.settings.toast.deleteBubblePreset"),t("chat.singleChat.settings.toast.confirmDeleteBubblePreset"),()=>{o.bubblePresets=o.bubblePresets.filter(m=>m.id!==ie.value),o.saveData(),ie.value="",c.showToast(t("chat.singleChat.settings.toast.presetDeleted"))})},gt=m=>{const i=typeof m=="string"?m:m.content,p=g.value,Y={avatar:{obj:Z.value,key:"avatar",toast:t("chat.singleChat.settings.toast.avatarUpdated")},userPersonaAvatar:{obj:{value:B},key:"value",toast:t("chat.singleChat.settings.toast.avatarUrlSet")},chatBg:{obj:Z.value,key:"chatBackground",toast:t("chat.singleChat.settings.toast.backgroundUpdated"),localRef:ke},videoBg:{obj:Z.value,key:"videoBg",toast:t("chat.singleChat.settings.toast.charImageUpdated"),localRef:Ce},userVideoImg:{obj:Z.value,key:"userVideoImg",toast:t("chat.singleChat.settings.toast.userImageUpdated"),localRef:ue}};Y[p]&&(Y[p].obj[Y[p].key]=i,Y[p].localRef&&(Y[p].localRef.value=i),p!=="userPersonaAvatar"&&o.saveData(),c.showToast(Y[p].toast)),S.value=!1},mt=()=>{if(!ke.value)return c.showToast(t("chat.singleChat.settings.toast.noBgToApply"));c.showConfirm(t("chat.singleChat.settings.toast.applyBgToAll"),t("chat.singleChat.settings.toast.confirmApplyBgToAll"),()=>{o.applyChatBackgroundToAll(ke.value),c.showToast(t("chat.singleChat.settings.toast.appliedToAll"))})},et=m=>{te.value=m,[se.value,x.value]=m?["10","50"]:["200","500"]},ht=()=>{c.showConfirm(t("chat.singleChat.settings.confirmSummaryTitle"),t("chat.singleChat.settings.confirmSummaryMsg",{count:P.value}),()=>{const m=`[${t("chat.singleChat.settings.autoSummary")}] 与${be.value}进行了愉快的对话...`;Z.value.memories||(Z.value.memories=[]),Z.value.memories.unshift({content:m,time:Date.now(),charName:be.value}),o.saveData(),c.showToast(t("chat.singleChat.settings.toast.summaryDone")),$.value=!0})},pt=()=>{c.showConfirm(t("chat.singleChat.settings.confirmBlockTitle",{name:be.value}),t("chat.singleChat.settings.confirmBlockMsg",{name:be.value}),()=>{pe.value=!0,Ke(),c.showToast(t("chat.singleChat.settings.toast.blocked"))},{messageStyle:{color:"#FF3B30",whiteSpace:"pre-wrap"},confirmText:"chat.singleChat.settings.block"})},bt=()=>{pe.value=!1,Ke(),c.showToast(t("chat.singleChat.settings.toast.unblocked"))},ft=()=>{c.showConfirm(t("chat.singleChat.settings.confirmClearTitle"),t("chat.singleChat.settings.confirmClearMsg",{name:be.value}),()=>{o.clearChatHistory(h.charId),c.showToast(t("chat.singleChat.settings.toast.historyCleared")),Ie.value=0,xe.value=0},{messageStyle:{whiteSpace:"pre-wrap",color:"#FF3B30"},confirmText:"chat.singleChat.settings.clear"})},yt=()=>{pe.value?bt():pt()},kt=()=>{c.showConfirm(t("chat.deleteCharacterTitle"),t("chat.deleteCharacterConfirm",{name:be.value}),()=>{o.deleteCharacter(h.charId),c.showToast(t("chat.toast.deleteSuccess"),"success"),A(),d.push({name:"chat-list"})},{messageStyle:{whiteSpace:"pre-wrap",color:"#FF3B30"},confirmText:"delete"})};return(m,i)=>(f(),k("div",Ws,[e("div",Gs,[e("div",{class:"back-btn",onClick:A},[...i[39]||(i[39]=[e("svg",{class:"svg-icon",viewBox:"0 0 24 24"},[e("polyline",{points:"15 18 9 12 15 6"})],-1)])]),e("div",Hs,a(s(t)("chat.singleChat.settings.title")),1),e("div",Ks,[e("button",{class:"header-save-btn",onClick:Ke},a(s(t)("save")),1)])]),e("div",Qs,[e("div",Ys,[e("div",{class:"card-title",onClick:i[0]||(i[0]=p=>re("roleInfo"))},[e("span",null,a(s(t)("chat.singleChat.settings.roleInfo")),1),e("div",{class:q(["collapse-arrow",{collapsed:y.value.roleInfo}])},[T(X,{name:"chevron-down"})],2)]),T(fe,{name:"collapse"},{default:z(()=>[y.value.roleInfo?G("",!0):(f(),k("div",Xs,[e("div",Js,[e("div",Zs,[e("div",{class:"role-avatar-wrapper",onClick:j},[$e.value?(f(),k("img",{key:0,src:$e.value,alt:"头像",class:"role-avatar-img"},null,8,ea)):(f(),k("div",ta,a(s(t)("chat.singleChat.settings.uploadAvatar")),1))]),e("div",sa,[F(e("input",{type:"text","onUpdate:modelValue":i[1]||(i[1]=p=>U.value=p),class:"base-input",placeholder:s(t)("chat.singleChat.settings.roleNamePlaceholder")},null,8,aa),[[W,U.value]]),F(e("input",{type:"text","onUpdate:modelValue":i[2]||(i[2]=p=>E.value=p),class:"base-input",placeholder:s(t)("chat.singleChat.settings.roleNicknamePlaceholder")},null,8,na),[[W,E.value]])])]),e("div",oa,[e("div",la,a(s(t)("chat.singleChat.settings.rolePersona")),1),F(e("textarea",{"onUpdate:modelValue":i[3]||(i[3]=p=>R.value=p),class:"base-input",style:{height:"80px","min-height":"40px"},placeholder:s(t)("chat.singleChat.settings.rolePersonaPlaceholder")},null,8,ia),[[W,R.value]])])])]))]),_:1})]),e("div",ca,[e("div",{class:"card-title",onClick:i[4]||(i[4]=p=>re("userInfo"))},[e("span",null,a(s(t)("chat.singleChat.settings.userInfo")),1),e("div",{class:q(["collapse-arrow",{collapsed:y.value.userInfo}])},[T(X,{name:"chevron-down"})],2)]),T(fe,{name:"collapse"},{default:z(()=>[y.value.userInfo?G("",!0):(f(),k("div",ra,[e("div",da,[e("div",ua,[e("div",va,a(s(t)("chat.singleChat.settings.currentUserPersona")),1),T(Ye,{options:ze.value,modelValue:M.value,"onUpdate:modelValue":i[5]||(i[5]=p=>M.value=p)},null,8,["options","modelValue"])]),e("div",ga,[e("div",{class:"user-avatar-wrapper",onClick:He},[B.value?(f(),k("img",{key:0,src:B.value,alt:"User",class:"role-avatar-img"},null,8,ma)):(f(),k("div",ha,a(s(t)("chat.singleChat.settings.uploadAvatar")),1))]),e("div",pa,[e("div",ba,[e("button",{class:"btn btn-secondary btn-mini-grow",onClick:ct},a(s(t)("chat.singleChat.settings.savePersona")),1),e("button",{class:"btn btn-danger btn-mini-grow",onClick:rt},a(s(t)("chat.singleChat.settings.deletePersona")),1)]),F(e("input",{type:"text","onUpdate:modelValue":i[6]||(i[6]=p=>O.value=p),class:"base-input",placeholder:s(t)("chat.singleChat.settings.userNamePlaceholder")},null,8,fa),[[W,O.value]])])]),e("div",ya,[e("div",ka,a(s(t)("chat.singleChat.settings.userPersona")),1),F(e("textarea",{"onUpdate:modelValue":i[7]||(i[7]=p=>D.value=p),class:"base-input",style:{height:"80px","min-height":"40px"},placeholder:s(t)("chat.singleChat.settings.userPersonaPlaceholder")},null,8,Ca),[[W,D.value]])])])]))]),_:1})]),e("div",Sa,[e("div",{class:"card-title",onClick:i[8]||(i[8]=p=>re("backgroundActivity"))},[e("span",null,a(s(t)("chat.singleChat.settings.backgroundActivity")),1),e("div",{class:q(["collapse-arrow",{collapsed:y.value.backgroundActivity}])},[T(X,{name:"chevron-down"})],2)]),e("div",wa,a(s(t)("chat.singleChat.settings.backgroundActivityWarning")),1),T(fe,{name:"collapse"},{default:z(()=>[y.value.backgroundActivity?G("",!0):(f(),k("div",Ma,[e("div",$a,[e("div",_a,[e("div",xa,[e("div",Ia,a(s(t)("chat.singleChat.settings.globalSettings")),1)]),e("div",Ta,a(s(b).globalBackgroundActivity?s(t)("chat.singleChat.settings.globalOn"):s(t)("chat.singleChat.settings.globalOff")),1)]),e("div",Pa,[e("div",Ba,[e("div",Aa,a(s(t)("chat.singleChat.settings.overrideGlobal")),1),e("div",Va,a(s(t)("chat.singleChat.settings.overrideGlobalDesc")),1)]),e("div",Ua,[e("div",{class:q(["mode-option",{active:_.value==="default"}]),onClick:i[9]||(i[9]=p=>_.value="default")},a(s(t)("chat.singleChat.settings.default")),3),e("div",{class:q(["mode-option",{active:_.value==="on"}]),onClick:i[10]||(i[10]=p=>_.value="on")},a(s(t)("chat.singleChat.settings.on")),3),e("div",{class:q(["mode-option",{active:_.value==="off"}]),onClick:i[11]||(i[11]=p=>_.value="off")},a(s(t)("chat.singleChat.settings.off")),3)])]),We.value?(f(),k("div",Da,[e("div",La,[e("div",Ra,[e("div",Ea,a(s(t)("chat.singleChat.settings.interval")),1),e("div",Na,a(s(t)("chat.singleChat.settings.intervalDesc")),1)]),F(e("input",{type:"number","onUpdate:modelValue":i[12]||(i[12]=p=>H.value=p),class:"base-input base-input-short",placeholder:"5"},null,512),[[W,H.value,void 0,{number:!0}]])]),e("div",qa,[e("div",Fa,[e("div",za,a(s(t)("chat.singleChat.settings.cooldown")),1),e("div",Oa,a(s(t)("chat.singleChat.settings.cooldownDesc")),1)]),F(e("input",{type:"number","onUpdate:modelValue":i[13]||(i[13]=p=>J.value=p),class:"base-input base-input-short",placeholder:"30"},null,512),[[W,J.value,void 0,{number:!0}]])]),e("div",ja,[e("div",Wa,[e("div",Ga,a(s(t)("chat.singleChat.settings.dailyLimit")),1),e("div",Ha,a(s(t)("chat.singleChat.settings.dailyLimitDesc")),1)]),F(e("input",{type:"number","onUpdate:modelValue":i[14]||(i[14]=p=>ne.value=p),class:"base-input base-input-short",placeholder:"10"},null,512),[[W,ne.value,void 0,{number:!0}]])]),e("div",Ka,[e("div",Qa,[e("div",Ya,a(s(t)("chat.singleChat.settings.triggerMode")),1),e("div",Xa,a(s(t)("chat.singleChat.settings.triggerModeDesc")),1)]),e("div",Ja,[e("div",{class:q(["mode-option",{active:ee.value==="idle"}]),onClick:i[15]||(i[15]=p=>ee.value="idle")},a(s(t)("chat.singleChat.settings.idleMode")),3),e("div",{class:q(["mode-option",{active:ee.value==="always"}]),onClick:i[16]||(i[16]=p=>ee.value="always")},a(s(t)("chat.singleChat.settings.alwaysMode")),3)])]),ee.value==="idle"?(f(),k("div",Za,[e("div",en,[e("div",tn,a(s(t)("chat.singleChat.settings.idleTime")),1),e("div",sn,a(s(t)("chat.singleChat.settings.idleTimeDesc")),1)]),F(e("input",{type:"number","onUpdate:modelValue":i[17]||(i[17]=p=>me.value=p),class:"base-input base-input-short",placeholder:"15"},null,512),[[W,me.value,void 0,{number:!0}]])])):G("",!0)])):G("",!0)])]))]),_:1})]),e("div",an,[e("div",{class:"card-title",onClick:i[18]||(i[18]=p=>re("modeSettings"))},[e("span",null,a(s(t)("chat.singleChat.settings.mode")),1),e("div",{class:q(["collapse-arrow",{collapsed:y.value.modeSettings}])},[T(X,{name:"chevron-down"})],2)]),T(fe,{name:"collapse"},{default:z(()=>[y.value.modeSettings?G("",!0):(f(),k("div",nn,[e("div",on,[e("div",ln,[e("div",cn,a(s(t)("chat.singleChat.settings.modeSelect")),1),e("div",rn,[e("div",{class:q(["mode-option",{active:te.value}]),onClick:i[19]||(i[19]=p=>et(!0))},a(s(t)("chat.singleChat.settings.online")),3),e("div",{class:q(["mode-option",{active:!te.value}]),onClick:i[20]||(i[20]=p=>et(!1))},a(s(t)("chat.singleChat.settings.offline")),3)])]),te.value?G("",!0):(f(),k("div",dn,[e("div",un,a(s(t)("chat.singleChat.settings.linkPreset")),1),T(at,{modelValue:he.value,"onUpdate:modelValue":i[21]||(i[21]=p=>he.value=p),options:s(V),labelKey:"title",valueKey:"id",childrenKey:"entries",textAlign:"right",selectorWidth:"auto",dropdownWidth:"200px"},null,8,["modelValue","options"])])),e("div",vn,[e("div",gn,a(s(t)("chat.singleChat.settings.linkWorldbook")),1),T(at,{modelValue:de.value,"onUpdate:modelValue":i[22]||(i[22]=p=>de.value=p),options:s(r),"label-key":"title","value-key":"id","children-key":"entries",textAlign:"right",selectorWidth:"auto",dropdownWidth:"200px"},null,8,["modelValue","options"])]),e("div",mn,[e("div",hn,[e("div",pn,a(s(t)("chat.singleChat.settings.replyLength")),1),e("div",bn,a(s(t)("chat.singleChat.settings.replyLengthDesc")),1)]),e("div",fn,[F(e("input",{type:"number","onUpdate:modelValue":i[23]||(i[23]=p=>se.value=p),class:"base-input base-input-mini",placeholder:s(t)("chat.singleChat.settings.min")},null,8,yn),[[W,se.value]]),i[40]||(i[40]=e("span",null,"-",-1)),F(e("input",{type:"number","onUpdate:modelValue":i[24]||(i[24]=p=>x.value=p),class:"base-input base-input-mini",placeholder:s(t)("chat.singleChat.settings.max")},null,8,kn),[[W,x.value]])])])])]))]),_:1})]),e("div",Cn,[e("div",{class:"card-title",onClick:i[25]||(i[25]=p=>re("summarySettings"))},[e("span",null,a(s(t)("chat.singleChat.settings.summary")),1),e("div",{class:q(["collapse-arrow",{collapsed:y.value.summarySettings}])},[T(X,{name:"chevron-down"})],2)]),T(fe,{name:"collapse"},{default:z(()=>[y.value.summarySettings?G("",!0):(f(),k("div",Sn,[e("div",wn,[e("div",Mn,[e("div",$n,[e("div",_n,a(s(t)("chat.singleChat.settings.summaryRange")),1),e("div",xn,a(s(t)("chat.singleChat.settings.summaryRangeDesc")),1)]),F(e("input",{type:"number","onUpdate:modelValue":i[26]||(i[26]=p=>P.value=p),class:"base-input base-input-short",placeholder:"20"},null,512),[[W,P.value,void 0,{number:!0}]])]),e("div",In,[e("div",Tn,a(s(t)("chat.singleChat.settings.summaryPrompt")),1),F(e("textarea",{"onUpdate:modelValue":i[27]||(i[27]=p=>K.value=p),class:"base-input",style:{height:"80px","min-height":"40px"},placeholder:s(t)("chat.singleChat.settings.summaryPromptPlaceholder")},null,8,Pn),[[W,K.value]])]),e("div",Bn,[e("div",An,[e("div",Vn,a(s(t)("chat.singleChat.settings.autoSummary")),1),e("div",Un,a(s(t)("chat.singleChat.settings.autoSummaryDesc")),1)]),e("div",{class:q(["toggle-switch",{active:L.value}]),onClick:i[28]||(i[28]=p=>L.value=!L.value)},null,2)]),e("div",Dn,[e("button",{class:"btn btn-secondary",onClick:ht},a(s(t)("chat.singleChat.settings.manualSummary")),1),e("button",{class:"btn btn-secondary",onClick:I},a(s(t)("chat.singleChat.settings.viewSummary")),1)]),e("div",Ln,[e("div",Rn,[e("div",En,a(s(t)("chat.singleChat.settings.contextMemory")),1),e("div",Nn,a(s(t)("chat.singleChat.settings.contextMemoryDesc")),1)]),F(e("input",{type:"number","onUpdate:modelValue":i[29]||(i[29]=p=>Q.value=p),class:"base-input base-input-short",placeholder:"10"},null,512),[[W,Q.value,void 0,{number:!0}]])]),e("div",qn,[e("div",Fn,a(s(t)("chat.singleChat.settings.apiConfig")),1),T(Ye,{options:Oe.value,modelValue:_e.value,"onUpdate:modelValue":i[30]||(i[30]=p=>_e.value=p)},null,8,["options","modelValue"])]),e("div",zn,[e("div",On,a(s(t)("chat.singleChat.settings.tokenCount")),1),e("div",jn,a(xe.value),1)]),e("div",Wn,[e("div",Gn,a(s(t)("chat.singleChat.settings.msgCount")),1),e("div",Hn,a(Ie.value),1)])])]))]),_:1})]),e("div",Kn,[e("div",{class:"card-title",onClick:i[31]||(i[31]=p=>re("bubbleSettings"))},[e("span",null,a(s(t)("chat.singleChat.settings.beautification")),1),e("div",{class:q(["collapse-arrow",{collapsed:y.value.bubbleSettings}])},[T(X,{name:"chevron-down"})],2)]),T(fe,{name:"collapse"},{default:z(()=>[y.value.bubbleSettings?G("",!0):(f(),k("div",Qn,[e("div",Yn,[e("div",Xn,a(s(t)("chat.singleChat.settings.bubble")),1),e("div",Jn,[e("div",Zn,a(s(t)("chat.singleChat.settings.bubblePreset")),1),e("div",eo,[T(Ye,{options:je.value,modelValue:ie.value,"onUpdate:modelValue":i[32]||(i[32]=p=>ie.value=p)},null,8,["options","modelValue"])]),e("div",to,[e("button",{class:"btn btn-secondary btn-mini",onClick:ut},a(s(t)("save")),1),e("button",{class:"btn btn-danger btn-mini",disabled:!ie.value,onClick:vt},a(s(t)("delete")),9,so)])]),e("div",ao,[e("div",no,[e("div",oo,[e("div",lo,[$e.value?(f(),k("img",{key:0,src:$e.value,style:{width:"100%",height:"100%","object-fit":"cover"}},null,8,io)):(f(),k("div",co))]),e("div",{class:"preview-bubble char",style:Se(Le.value)},a(s(t)("chat.singleChat.settings.bubblePreview")),5)]),e("div",ro,[e("div",{class:"preview-bubble user",style:Se(Le.value)},a(s(t)("chat.singleChat.settings.bubblePreview")),5),e("div",uo,[B.value?(f(),k("img",{key:0,src:B.value,style:{width:"100%",height:"100%","object-fit":"cover"}},null,8,vo)):(f(),k("div",go))])])])]),e("div",mo,[e("div",ho,[e("div",po,a(s(t)("chat.singleChat.settings.fontSize")),1)]),e("div",bo,[F(e("input",{type:"range","onUpdate:modelValue":i[33]||(i[33]=p=>oe.value=p),min:"10",max:"30",step:"1"},null,512),[[W,oe.value,void 0,{number:!0}]]),e("span",fo,a(oe.value),1)])]),e("div",yo,[e("div",ko,a(s(t)("chat.singleChat.settings.bubbleCss")),1),F(e("textarea",{"onUpdate:modelValue":i[34]||(i[34]=p=>ce.value=p),class:"base-input",placeholder:s(t)("chat.singleChat.settings.cssPlaceholder"),style:{"font-family":"monospace",height:"120px"}},null,8,Co),[[W,ce.value]])]),i[41]||(i[41]=e("div",{class:"settings-divider"},null,-1)),e("div",So,a(s(t)("chat.singleChat.settings.chatBackground")),1),e("div",wo,[e("div",Mo,[e("div",$o,[e("button",{class:"btn btn-secondary",onClick:Te},a(s(t)("chat.singleChat.settings.setChatBackground")),1),e("button",{class:"btn btn-secondary",onClick:mt,style:{"margin-top":"5px"}},a(s(t)("chat.singleChat.settings.applyToAll")),1)])])])])]))]),_:1})]),e("div",_o,[e("div",{class:"card-title",onClick:i[35]||(i[35]=p=>re("videoSettings"))},[e("span",null,a(s(t)("chat.singleChat.settings.videoCall")),1),e("div",{class:q(["collapse-arrow",{collapsed:y.value.videoSettings}])},[T(X,{name:"chevron-down"})],2)]),T(fe,{name:"collapse"},{default:z(()=>[y.value.videoSettings?G("",!0):(f(),k("div",xo,[e("div",Io,[e("div",To,[e("div",Po,[e("div",Bo,a(s(t)("chat.singleChat.settings.characterImage")),1),e("div",{class:"video-preview",onClick:Re},[Ce.value?(f(),k("img",{key:0,src:Ce.value,class:"bg-img"},null,8,Ao)):(f(),k("div",Vo,a(s(t)("chat.singleChat.settings.setImage")),1))])]),e("div",Uo,[e("div",Do,a(s(t)("chat.singleChat.settings.userImage")),1),e("div",{class:"video-preview",onClick:Ee},[ue.value?(f(),k("img",{key:0,src:ue.value,class:"bg-img"},null,8,Lo)):(f(),k("div",Ro,a(s(t)("chat.singleChat.settings.setImage")),1))])])])])]))]),_:1})]),e("div",Eo,[e("div",{class:"card-title",onClick:i[36]||(i[36]=p=>re("advancedSettings"))},[e("span",null,a(s(t)("chat.singleChat.settings.advanced")),1),e("div",{class:q(["collapse-arrow",{collapsed:y.value.advancedSettings}])},[T(X,{name:"chevron-down"})],2)]),T(fe,{name:"collapse"},{default:z(()=>[y.value.advancedSettings?G("",!0):(f(),k("div",No,[e("div",qo,[e("div",Fo,[e("div",zo,a(s(t)("chat.singleChat.settings.linkedNpc")),1),e("div",Oo,a(s(t)("chat.singleChat.settings.npcCount",{count:De.value})),1),i[42]||(i[42]=e("div",{class:"settings-pure-arrow"},"›",-1))])])]))]),_:1})]),e("div",jo,[e("button",{class:"btn btn-danger big-btn",onClick:yt},[e("div",Wo,[e("div",Go,a(pe.value?s(t)("chat.singleChat.settings.unblock"):s(t)("chat.singleChat.settings.blockCharacter")),1),e("div",Ho,a(s(t)("chat.singleChat.settings.blockCharacterDesc")),1)])]),e("button",{class:"btn btn-danger big-btn",onClick:ft},[e("div",Ko,[e("div",Qo,a(s(t)("chat.singleChat.settings.clearHistory")),1),e("div",Yo,a(s(t)("chat.singleChat.settings.clearHistoryDesc")),1)])]),e("button",{class:"btn btn-danger big-btn",onClick:kt},[e("div",Xo,[e("div",Jo,a(s(t)("chat.deleteCharacterTitle")),1),e("div",Zo,a(s(t)("chat.deleteCharacterWarning")),1)])])])]),T(lt,{visible:$.value,"onUpdate:visible":i[37]||(i[37]=p=>$.value=p),charId:h.charId},null,8,["visible","charId"]),T(Ze,{visible:S.value,"onUpdate:visible":i[38]||(i[38]=p=>S.value=p),type:"basic","biz-type":"avatar",title:Ge.value,onSendImage:gt},null,8,["visible","title"])]))}},tl=ae(el,[["__scopeId","data-v-95e76109"]]),sl={class:"menu-grid"},al={__name:"MessageMenu",props:{visible:{type:Boolean,default:!1},targetEl:{type:Object,default:null},messageId:{type:String,default:null},charId:{type:String,required:!0}},emits:["close","enter-selection-mode","trigger-ai-response","quote-message","edit-message"],setup(n,{emit:C}){const h=n,l=C,t=Bt("phoneScreenRef"),{t:d}=Me(),o=ge(),c=we(),b=u(null),v=u({}),r=u(0),w=u("top");le(()=>h.visible,async $=>{$&&h.targetEl&&(await qe(),V())});const V=()=>{const $=b.value;if(!$)return;const S=h.targetEl.getBoundingClientRect(),g=$.offsetWidth,U=$.offsetHeight,E=8,R=t.value,M=R?R.getBoundingClientRect():{top:0,left:0,width:window.innerWidth};w.value="top";let O=S.top-U-E;O<M.top+E&&(w.value="bottom",O=S.bottom+E);const D=S.left+S.width/2;let B=D-g/2;B<M.left+E&&(B=M.left+E),B+g>M.left+M.width-E&&(B=M.left+M.width-g-E);let _=D-B;const H=12,J=H/2+5,ne=g-H/2-5;_=Math.max(J,Math.min(_,ne)),v.value={top:`${O}px`,left:`${B}px`},r.value=_},y=$=>{const S=h.messageId;if(!S)return;const g=o.messages[h.charId],U=g.findIndex(M=>M.id===S),E=g[U],R={copy:()=>{E.content&&(navigator.clipboard.writeText(E.content),c.showToast(d("chat.messageMenu.toast.copied")))},favorite:()=>{o.favorites||(o.favorites=[]),o.favorites.some(M=>M.id===E.id)?c.showToast(d("chat.messageMenu.toast.alreadyFavorited")):(o.favorites.push(E),o.saveData(),c.showToast(d("chat.messageMenu.toast.favorited")))},delete:()=>{c.showConfirm(d("chat.messageMenu.confirmDelete"),d("chat.messageMenu.confirmDeleteMsg"),()=>{o.messages[h.charId].splice(U,1),o.saveData()})},revoke:()=>{E&&(E.type="revoked",o.saveData(),c.showToast(d("chat.messageMenu.toast.revoked")))},select:()=>l("enter-selection-mode",S),quote:()=>l("quote-message",S),retry:()=>{E.sender!=="user"?(o.messages[h.charId].splice(U,1),o.saveData(),l("trigger-ai-response")):c.showToast(d("chat.messageMenu.toast.retryAiOnly"),"info")},edit:()=>{E.type==="text"?l("edit-message",S):c.showToast(d("chat.messageMenu.toast.editTextOnly"),"info")}};R[$]&&R[$](),l("close")};return($,S)=>n.visible?(f(),k("div",{key:0,ref_key:"menuRef",ref:b,class:q(["message-menu",{"menu-top":w.value==="top","menu-bottom":w.value==="bottom"}]),style:Se(v.value)},[e("div",sl,[e("div",{class:"menu-item",onClick:S[0]||(S[0]=g=>y("copy"))},a(s(d)("copy")),1),e("div",{class:"menu-item",onClick:S[1]||(S[1]=g=>y("favorite"))},a(s(d)("favorite")),1),e("div",{class:"menu-item",onClick:S[2]||(S[2]=g=>y("delete"))},a(s(d)("delete")),1),e("div",{class:"menu-item",onClick:S[3]||(S[3]=g=>y("revoke"))},a(s(d)("revoke")),1),e("div",{class:"menu-item",onClick:S[4]||(S[4]=g=>y("select"))},a(s(d)("select")),1),e("div",{class:"menu-item",onClick:S[5]||(S[5]=g=>y("quote"))},a(s(d)("quote")),1),e("div",{class:"menu-item",onClick:S[6]||(S[6]=g=>y("retry"))},a(s(d)("retry")),1),e("div",{class:"menu-item",onClick:S[7]||(S[7]=g=>y("edit"))},a(s(d)("edit")),1)]),e("div",{class:"menu-arrow",style:Se({left:r.value+"px"})},null,4)],6)):G("",!0)}},nl=ae(al,[["__scopeId","data-v-9d6ff2c4"]]),ol={class:"chat-action-row"},ll={__name:"SelectionBar",emits:["action","cancel"],setup(n){const{t:C}=Me();return(h,l)=>(f(),k("div",ol,[e("div",{class:"action-btn",onClick:l[0]||(l[0]=t=>h.$emit("action","favorite"))},[l[4]||(l[4]=e("div",{class:"action-btn-icon"},[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round"},[e("polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"})])],-1)),e("span",null,a(s(C)("favorite")),1)]),e("div",{class:"action-btn",onClick:l[1]||(l[1]=t=>h.$emit("action","forward"))},[l[5]||(l[5]=e("div",{class:"action-btn-icon"},[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"M18 8L22 12L18 16"}),e("path",{d:"M2 12H22"})])],-1)),e("span",null,a(s(C)("forward")),1)]),e("div",{class:"action-btn",onClick:l[2]||(l[2]=t=>h.$emit("action","delete"))},[l[6]||(l[6]=e("div",{class:"action-btn-icon"},[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round"},[e("polyline",{points:"3 6 5 6 21 6"}),e("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})])],-1)),e("span",null,a(s(C)("delete")),1)]),e("div",{class:"action-btn",onClick:l[3]||(l[3]=t=>h.$emit("cancel"))},[l[7]||(l[7]=e("div",{class:"action-btn-icon"},[e("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round"},[e("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),e("line",{x1:"6",y1:"6",x2:"18",y2:"18"})])],-1)),e("span",null,a(s(C)("done")),1)])]))}},il=ae(ll,[["__scopeId","data-v-be1a592f"]]),cl={class:"msg-avatar"},rl=["src"],dl={class:"msg-content-wrapper"},ul={class:"msg-bubble-box"},vl={key:0,class:"quote-in-bubble"},gl={class:"quote-in-bubble-sender"},ml={class:"quote-in-bubble-text"},hl={key:1,class:"edit-view"},pl={key:0},bl={class:"description-placeholder"},fl=["src"],yl={key:2,class:"sticker-msg"},kl=["src"],Cl={key:3,class:"voice-msg-wrapper"},Sl={class:"voice-msg"},wl={key:4,class:"location-msg"},Ml={class:"location-text"},$l={class:"msg-title"},_l={key:5,class:"transfer-msg"},xl={class:"transfer-content"},Il={class:"transfer-info"},Tl={class:"transfer-amount"},Pl={class:"transfer-desc"},Bl={key:6,class:"call-summary-msg"},Al={key:0,class:"blocked-icon"},Vl={__name:"MessageItem",props:{msg:{type:Object,required:!0},charName:{type:String,default:""},charAvatar:{type:String,default:""},userAvatar:{type:String,default:""},bubbleStyle:{type:Object,default:()=>({})},isSelectionMode:{type:Boolean,default:!1},isSelected:{type:Boolean,default:!1},editingMessageId:{type:String,default:null}},emits:["save-edit","cancel-edit","toggle-selection","long-press","cancel-long-press","touch-move","click-msg"],setup(n,{emit:C}){const h=n,l=C,t=At(),d=u(!1),o=u(!1),c=u(""),b=N(()=>h.editingMessageId===h.msg.id),v=N(()=>{const R=h.msg.type;return{"no-style":["image","sticker","location","transfer"].includes(R),"has-location":R==="location","has-transfer":R==="transfer"}});le(b,R=>{R&&(c.value=h.msg.content)});const r=R=>{l("long-press",R,h.msg.id)},w=()=>{l("cancel-long-press")},V=R=>{l("touch-move",R)},y=R=>{h.msg.type==="voice"&&$(),h.msg.type!=="image"&&l("click-msg",R,h.msg.id)},$=()=>{d.value=!d.value},S=()=>{o.value=!o.value},g=()=>{c.value.trim()&&l("save-edit",{msgId:h.msg.id,newContent:c.value})},U=()=>{l("cancel-edit")},E=()=>h.msg.type==="notification"?h.msg.content:h.msg.type==="revoked"?`"${h.msg.sender==="user"?"你":h.charName}" 撤回了一条消息`:"";return(R,M)=>(f(),k("div",{class:q(["message",{sent:n.msg.sender==="user",received:n.msg.sender!=="user",revoked:n.msg.type==="revoked"||n.msg.type==="notification","selection-mode-active":n.isSelectionMode}])},[e("div",{class:q(["message-checkbox",{checked:n.isSelected,visible:n.isSelectionMode}]),onClick:M[0]||(M[0]=Ae(O=>R.$emit("toggle-selection",n.msg.id),["stop"]))},null,2),n.msg.type==="revoked"||n.msg.type==="notification"?(f(),k("div",{key:0,class:"system-message-wrapper",onMousedown:r,onMouseup:w,onMouseleave:w,onTouchstart:r,onTouchend:w,onTouchmove:V,onClick:Ae(y,["prevent"])},[e("div",{class:"system-message-text",onClick:M[1]||(M[1]=Ae(O=>!n.isSelectionMode&&S(),["stop"]))},a(E()),1),n.msg.type==="revoked"?F((f(),k("div",{key:0,class:"revoked-content"},a(n.msg.sender==="user"?"我":n.charName)+"："+a(n.msg.content),513)),[[Xe,o.value]]):G("",!0)],32)):(f(),k(ve,{key:1},[e("div",cl,[(n.msg.sender==="user"?n.userAvatar:n.charAvatar)?(f(),k("img",{key:0,src:n.msg.sender==="user"?n.userAvatar:n.charAvatar,alt:"avatar"},null,8,rl)):(f(),k("div",{key:1,class:q(["default-avatar",{user:n.msg.sender==="user"}])},null,2))]),e("div",dl,[e("div",ul,[e("div",{class:q(["msg-bubble",v.value]),style:Se(n.bubbleStyle),onMousedown:r,onMouseup:w,onMouseleave:w,onTouchstart:r,onTouchend:w,onTouchmove:V,onClick:Ae(y,["prevent"])},[n.msg.quote?(f(),k("div",vl,[e("div",gl,a(n.msg.quote.sender==="user"?"你":n.charName)+":",1),e("div",ml,a(n.msg.quote.content),1)])):G("",!0),b.value?(f(),k("div",hl,[F(e("textarea",{"onUpdate:modelValue":M[2]||(M[2]=O=>c.value=O),class:"edit-textarea",rows:"3"},null,512),[[W,c.value]]),e("div",{class:"edit-actions"},[e("button",{onClick:U,class:"edit-btn cancel"},"取消"),e("button",{onClick:g,class:"edit-btn save"},"保存")])])):(f(),k(ve,{key:2},[n.msg.type==="text"?(f(),k("div",pl,a(n.msg.content),1)):n.msg.type==="image"?(f(),k(ve,{key:1},[n.msg.isTextGenerated||n.msg.sender!=="user"&&!n.msg.content.startsWith("http")&&!n.msg.content.startsWith("data:")?(f(),k("div",{key:0,class:"text-generated-image-container",onClick:M[3]||(M[3]=O=>s(t).preview(n.msg))},[e("div",bl,a(n.msg.content),1)])):(f(),k("div",{key:1,class:"image-msg",onClick:M[4]||(M[4]=O=>s(t).preview(n.msg))},[e("img",{src:n.msg.content,alt:"图片"},null,8,fl)]))],64)):n.msg.type==="sticker"?(f(),k("div",yl,[e("img",{src:n.msg.content,alt:"表情包"},null,8,kl)])):n.msg.type==="voice"?(f(),k("div",Cl,[e("div",Sl,[T(X,{name:"voice-wave",class:q(["voice-icon-svg",{playing:d.value}])},null,8,["class"]),e("span",null,a(Math.min(60,Math.ceil(n.msg.content.length/2)))+'"',1)])])):n.msg.type==="location"?(f(),k("div",wl,[e("div",Ml,[e("div",$l,a(n.msg.content||"位置信息"),1),M[5]||(M[5]=e("div",{class:"msg-desc"},"详细地址",-1))]),M[6]||(M[6]=Je('<div class="location-map" data-v-8cb932da><img src="https://files.catbox.moe/uryae6.png" alt="地图" data-v-8cb932da><div class="location-pin" data-v-8cb932da><svg viewBox="0 0 24 24" fill="currentColor" data-v-8cb932da><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z" data-v-8cb932da></path></svg></div></div>',1))])):n.msg.type==="transfer"?(f(),k("div",_l,[e("div",xl,[M[7]||(M[7]=e("div",{class:"transfer-icon"},"¥",-1)),e("div",Il,[e("div",Tl,"¥"+a(n.msg.content),1),e("div",Pl,a(n.msg.sender==="user"?`转账给${n.charName}`:"转账给你"),1)])]),M[8]||(M[8]=e("div",{class:"transfer-footer"},"微信转账",-1))])):n.msg.type==="call_summary"?(f(),k("div",Bl,[M[9]||(M[9]=e("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M12 9c-1.6 0-3.15.25-4.6.72v3.1c0 .39-.23.74-.56.9-.98.49-1.87 1.12-2.66 1.85-.18.18-.43.28-.7.28-.28 0-.53-.11-.71-.29L.29 13.08a.956.956 0 0 1 0-1.35c2.93-2.94 6.86-4.73 11.21-4.73s8.28 1.79 11.21 4.73c.38.38.38 1.02 0 1.4l-2.48 2.48c-.18.18-.43.29-.71.29-.27 0-.52-.11-.7-.28a11.27 11.27 0 0 0-2.66-1.85.995.995 0 0 1-.56-.9v-3.1C15.15 9.25 13.6 9 12 9z"})],-1)),e("span",null,a(n.msg.content),1)])):G("",!0)],64))],38),n.msg.blocked&&n.msg.sender!=="user"?(f(),k("div",Al,[...M[10]||(M[10]=[e("svg",{viewBox:"0 0 24 24",fill:"currentColor"},[e("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"})],-1)])])):G("",!0)]),n.msg.type==="voice"?F((f(),k("div",{key:0,class:"voice-text"},a(n.msg.content),513)),[[Xe,d.value]]):G("",!0)])],64))],2))}},Ul=ae(Vl,[["__scopeId","data-v-8cb932da"]]),Dl={key:0,class:"empty-message"},Ll={key:0,class:"blocked-overlay"},Rl={class:"blocked-content"},El={__name:"MessageList",props:{messages:{type:Array,default:()=>[]},charName:String,charAvatar:String,userAvatar:String,bubbleStyle:Object,isSelectionMode:Boolean,selectedMessageIds:Set,isBlocked:Boolean,editingMessageId:String,activePanel:String},emits:["save-edit","cancel-edit","toggle-selection","long-press","cancel-long-press","touch-move","click-msg","unblock","show-text-content"],setup(n,{expose:C}){const h=n,l=u(null),t=()=>{l.value&&(l.value.scrollTop=l.value.scrollHeight)};return le(()=>h.messages,()=>{qe(()=>{t()})},{deep:!0}),le(()=>h.activePanel,d=>{d&&qe(()=>{t()})}),ot(()=>{t()}),C({scrollToBottom:t}),(d,o)=>(f(),k(ve,null,[e("div",{class:"chat-messages",ref_key:"messagesContainer",ref:l},[n.messages.length===0?(f(),k("div",Dl," 开始和 "+a(n.charName)+" 聊天吧~ ",1)):G("",!0),(f(!0),k(ve,null,Ve(n.messages,c=>(f(),ye(Ul,{key:c.id,msg:c,charName:n.charName,charAvatar:n.charAvatar,userAvatar:n.userAvatar,bubbleStyle:n.bubbleStyle,isSelectionMode:n.isSelectionMode,isSelected:n.selectedMessageIds.has(c.id),editingMessageId:n.editingMessageId,onSaveEdit:o[0]||(o[0]=b=>d.$emit("save-edit",b)),onCancelEdit:o[1]||(o[1]=b=>d.$emit("cancel-edit")),onToggleSelection:o[2]||(o[2]=b=>d.$emit("toggle-selection",b)),onLongPress:o[3]||(o[3]=(b,v)=>d.$emit("long-press",b,v)),onCancelLongPress:o[4]||(o[4]=b=>d.$emit("cancel-long-press")),onTouchMove:o[5]||(o[5]=b=>d.$emit("touch-move",b)),onClickMsg:o[6]||(o[6]=(b,v)=>d.$emit("click-msg",b,v)),onShowTextContent:o[7]||(o[7]=b=>d.$emit("show-text-content",b))},null,8,["msg","charName","charAvatar","userAvatar","bubbleStyle","isSelectionMode","isSelected","editingMessageId"]))),128))],512),n.isBlocked?(f(),k("div",Ll,[e("div",Rl,[o[9]||(o[9]=e("div",{class:"blocked-text"},"对方已被你拉黑",-1)),e("button",{class:"blocked-btn",onClick:o[8]||(o[8]=c=>d.$emit("unblock"))},"解除拉黑")])])):G("",!0)],64))}},Nl=ae(El,[["__scopeId","data-v-460d6803"]]),ql={__name:"VoiceInput",props:{visible:{type:Boolean,required:!0}},emits:["update:visible","confirm"],setup(n,{emit:C}){const h=n,l=C,t=N({get:()=>h.visible,set:c=>l("update:visible",c)}),d=u("");le(()=>h.visible,c=>{c&&(d.value="")});const o=()=>{const c=d.value.trim();l("confirm",c),t.value=!1};return(c,b)=>(f(),ye(Ue,{visible:t.value,"onUpdate:visible":b[2]||(b[2]=v=>t.value=v),title:"发送语音"},{footer:z(()=>[e("button",{class:"modal-btn cancel",onClick:b[1]||(b[1]=v=>t.value=!1)},"取消"),e("button",{class:"modal-btn confirm",onClick:o},"发送")]),default:z(()=>[F(e("input",{type:"text",class:"base-input","onUpdate:modelValue":b[0]||(b[0]=v=>d.value=v),placeholder:"输入语音内容..."},null,512),[[W,d.value]])]),_:1},8,["visible"]))}},Fl={__name:"LocationInput",props:{visible:{type:Boolean,required:!0}},emits:["update:visible","confirm"],setup(n,{emit:C}){const h=n,l=C,t=N({get:()=>h.visible,set:b=>l("update:visible",b)}),d=u(""),o=u("");le(()=>h.visible,b=>{b&&(d.value="",o.value="")});const c=()=>{const b=d.value.trim(),v=o.value.trim();b&&(l("confirm",{name:b,detail:v}),t.value=!1)};return(b,v)=>(f(),ye(Ue,{visible:t.value,"onUpdate:visible":v[3]||(v[3]=r=>t.value=r),title:"发送位置"},{footer:z(()=>[e("button",{class:"modal-btn cancel",onClick:v[2]||(v[2]=Ae(r=>t.value=!1,["stop"]))},"取消"),e("button",{class:"modal-btn confirm",onClick:c},"发送")]),default:z(()=>[F(e("input",{type:"text",class:"base-input","onUpdate:modelValue":v[0]||(v[0]=r=>d.value=r),placeholder:"位置名称 (如: 广州塔)"},null,512),[[W,d.value]]),F(e("input",{type:"text",class:"base-input","onUpdate:modelValue":v[1]||(v[1]=r=>o.value=r),placeholder:"详细地址 (可选)",style:{"margin-top":"10px"}},null,512),[[W,o.value]])]),_:1},8,["visible"]))}},zl={class:"chat-list-container"},Ol=["onClick"],jl=["src"],Wl={class:"chat-info"},Gl={class:"chat-name"},Hl=["disabled"],Kl={__name:"ForwardSelection",props:{visible:{type:Boolean,default:!1}},emits:["close","confirm"],setup(n,{emit:C}){const h=n,l=C,t=ge(),d=u(h.visible),o=u(new Set),c=N(()=>t.characters);le(()=>h.visible,r=>{d.value=r,r||o.value.clear()});const b=r=>{o.value.has(r)?o.value.delete(r):o.value.add(r)},v=()=>{o.value.size>0&&l("confirm",Array.from(o.value))};return(r,w)=>(f(),ye(Ue,{visible:d.value,"onUpdate:visible":w[1]||(w[1]=V=>d.value=V),title:"选择聊天",onClose:w[2]||(w[2]=V=>r.$emit("close"))},{footer:z(()=>[e("button",{class:"modal-btn cancel",onClick:w[0]||(w[0]=V=>r.$emit("close"))},"取消"),e("button",{class:"modal-btn confirm",disabled:o.value.size===0,onClick:v}," 确定 ("+a(o.value.size)+") ",9,Hl)]),default:z(()=>[e("div",zl,[(f(!0),k(ve,null,Ve(c.value,V=>(f(),k("div",{key:V.id,class:"chat-item",onClick:y=>b(V.id)},[e("img",{src:V.avatar,alt:"avatar",class:"avatar"},null,8,jl),e("div",Wl,[e("div",Gl,a(V.name),1)]),e("div",{class:q(["checkbox",{selected:o.value.has(V.id)}])},null,2)],8,Ol))),128))])]),_:1},8,["visible"]))}},Ql=ae(Kl,[["__scopeId","data-v-00bcf675"]]),Yl={__name:"SingleChat",props:{charId:{type:String,required:!0}},setup(n){const C=n;Fe();const{t:h}=Me(),l=ge(),t=we(),d=nt(),o=u(null),c=u(null),b=u(null),v=u(!1),r=u({visible:!1,messageId:null,targetEl:null}),w=u(!1),V=u(!1),y=u(!1),$=N(()=>l.getCharacter(C.charId)),S=N(()=>{var A;return((A=$.value)==null?void 0:A.isBlocked)||!1}),g=N(()=>{var A,I;return((A=$.value)==null?void 0:A.nickname)||((I=$.value)==null?void 0:I.name)||h("chat.unknownCharacter")}),U=N(()=>{var A;return(A=$.value)==null?void 0:A.avatar}),E=N(()=>{var A;return((A=$.value)==null?void 0:A.status)||{}}),R=N(()=>{var A;return((A=$.value)==null?void 0:A.chatBackground)||""}),M=N(()=>{var A;if((A=$.value)!=null&&A.userPersona&&$.value.userPersona!=="default"){const I=l.userPersonas.find(j=>j.id===$.value.userPersona);if(I&&I.avatar)return I.avatar}return localStorage.getItem("homeAvatar")||""}),O=N(()=>l.messages[C.charId]||[]),D=N(()=>{var A;return((A=$.value)==null?void 0:A.bubbleSettings)||{}}),{isSelectionMode:B,selectedMessageIds:_,isForwarding:H,enterSelectionMode:J,exitSelectionMode:ne,toggleMessageSelection:ee,handleBatchAction:me,handleConfirmForward:te}=Ut(Ne(C,"charId")),{isTyping:he,triggerAiResponse:de}=Dt(Ne(C,"charId"),d),{inputText:se,quotingMessage:x,sendMessage:P,sendSticker:K,sendVoiceMessage:L,handleSendImage:Q,confirmSendLocation:ie,sendTransfer:ce}=Rt(l,Ne(C,"charId"),t,b),{editingMessageId:oe,handleEditMessage:ke,handleSaveEdit:Ce,updateInputText:ue}=Lt(l,Ne(C,"charId"),se),{startLongPress:_e,cancelLongPress:De,handleTouchMove:pe,wasClickAfterLongPress:xe}=Et(r),Ie=N(()=>{const A=D.value,I={fontSize:A.fontSize?`${A.fontSize}px`:"14px"};if(A.css){const j={};return A.css.split(";").forEach(He=>{const Te=He.split(":");if(Te.length>=2){const Re=Te[0].trim(),Ee=Te.slice(1).join(":").trim();Re&&Ee&&(j[Re]=Ee)}}),{...I,...j}}return I}),Z=()=>{$.value&&($.value.isBlocked=!1,l.messages[C.charId]&&l.messages[C.charId].forEach(A=>{A.blocked&&(A.blocked=!1)}),l.saveData(),t.showToast(h("chat.toast.unblocked")))},be=A=>{const I=A.target;I.closest(".modal-overlay.active")||(b.value&&!I.closest(".chat-footer")&&(b.value=null),B.value&&!I.closest(".message")&&!I.closest(".chat-action-row")&&!I.closest(".message-checkbox")&&!I.closest(".message-menu")&&ne(),r.value.visible&&!I.closest(".message-menu")&&(r.value.visible=!1))},$e=(A,I)=>{if(xe()){A.preventDefault(),A.stopPropagation();return}B.value&&ee(I)},ze=A=>{const I=O.value.find(j=>j.id===A);I&&(x.value=I)},Oe=()=>{V.value=!0},je=A=>{L(A),V.value=!1},We=()=>{b.value=null,w.value=!0},Le=()=>{y.value=!0},Ge=({name:A,detail:I})=>{ie(A,I),y.value=!1},re=()=>{l.startVideoCall(C.charId)};return(A,I)=>(f(),k("div",{class:q(["chat-room active",{"selection-mode":s(B)}]),onClick:be,ref_key:"chatRoomRef",ref:c},[e("div",{class:"chat-bg",style:Se(R.value?{backgroundImage:`url(${R.value})`}:{})},null,4),T(hs,{charId:C.charId,charName:g.value,charStatus:E.value,isTyping:s(he),onTriggerAi:s(de),onOpenSettings:I[0]||(I[0]=j=>v.value=!0)},null,8,["charId","charName","charStatus","isTyping","onTriggerAi"]),T(Nl,{ref_key:"messageListRef",ref:o,messages:O.value,charName:g.value,charAvatar:U.value,userAvatar:M.value,bubbleStyle:Ie.value,isSelectionMode:s(B),selectedMessageIds:s(_),isBlocked:S.value,editingMessageId:s(oe),activePanel:b.value,onSaveEdit:s(Ce),onCancelEdit:I[1]||(I[1]=j=>oe.value=null),onToggleSelection:s(ee),onLongPress:s(_e),onCancelLongPress:s(De),onTouchMove:s(pe),onClickMsg:$e,onUnblock:Z},null,8,["messages","charName","charAvatar","userAvatar","bubbleStyle","isSelectionMode","selectedMessageIds","isBlocked","editingMessageId","activePanel","onSaveEdit","onToggleSelection","onLongPress","onCancelLongPress","onTouchMove"]),s(B)?G("",!0):(f(),ye(js,{key:0,modelValue:s(se),"onUpdate:modelValue":I[2]||(I[2]=j=>Vt(se)?se.value=j:null),activePanel:b.value,"onUpdate:activePanel":I[3]||(I[3]=j=>b.value=j),quotingMessage:s(x),onCancelQuote:I[4]||(I[4]=j=>x.value=null),onSendMessage:s(P),onSendSticker:s(K),onTriggerVoice:Oe,onTriggerImage:We,onTriggerVideo:re,onTriggerLocation:Le,onTriggerTransfer:s(ce)},null,8,["modelValue","activePanel","quotingMessage","onSendMessage","onSendSticker","onTriggerTransfer"])),s(B)?(f(),ye(il,{key:1,onAction:s(me),onCancel:s(ne)},null,8,["onAction","onCancel"])):G("",!0),T(ql,{visible:V.value,"onUpdate:visible":I[5]||(I[5]=j=>V.value=j),onConfirm:je},null,8,["visible"]),T(Ze,{visible:w.value,"onUpdate:visible":I[6]||(I[6]=j=>w.value=j),onSendImage:s(Q)},null,8,["visible","onSendImage"]),T(Fl,{visible:y.value,"onUpdate:visible":I[7]||(I[7]=j=>y.value=j),onConfirm:Ge},null,8,["visible"]),T(nl,{visible:r.value.visible,targetEl:r.value.targetEl,messageId:r.value.messageId,charId:C.charId,isSelectionMode:s(B),selectedMessageIds:s(_),onClose:I[8]||(I[8]=j=>r.value.visible=!1),onEnterSelectionMode:s(J),onTriggerAiResponse:s(de),"onUpdate:inputText":s(ue),onQuoteMessage:ze,onEditMessage:s(ke)},null,8,["visible","targetEl","messageId","charId","isSelectionMode","selectedMessageIds","onEnterSelectionMode","onTriggerAiResponse","onUpdate:inputText","onEditMessage"]),v.value?(f(),ye(tl,{key:2,visible:v.value,"onUpdate:visible":I[9]||(I[9]=j=>v.value=j),charId:C.charId},null,8,["visible","charId"])):G("",!0),T(Ql,{visible:s(H),onClose:I[10]||(I[10]=j=>H.value=!1),onConfirm:s(te)},null,8,["visible","onConfirm"])],2))}},ei=ae(Yl,[["__scopeId","data-v-d6f0a437"]]);export{ei as default};
