import{_ as ue,m as ve,O as re,q as de,N as pe,r as v,c as q,t as O,X as ce,a1 as ke,D as fe,a as o,b as i,e as t,v as $,x as I,n as ge,F as T,A as E,h as V,z as S,B as _,y,o as a,C as me}from"./index-BhBAuxlH.js";const we={key:0,class:"post-moment-modal"},be={class:"app-header"},ye={class:"action-btn"},he=["disabled"],Ce={class:"modal-body"},xe=["onClick"],Se=["src"],_e=["onClick"],Me=["onClick"],$e=["onClick"],Ie={class:"option-list"},Be={class:"option-value"},Le={key:0,class:"expanded-input-container"},Ue={class:"option-value"},Oe={class:"option-value"},Te={class:"popup-option-wrapper"},Ve={key:0,class:"expanded-input-container new-input-style"},Ne={class:"input-wrapper"},ze={class:"popup-option-wrapper"},Pe={key:0,class:"expanded-input-container new-input-style"},Re={class:"input-wrapper"},je={class:"app-header"},Ae={class:"title"},Fe={key:0},De={key:1},Ge={class:"selector-body"},He={key:0},Je={class:"custom-radio"},qe={key:0,class:"checked-icon",viewBox:"0 0 24 24"},Ee={class:"custom-radio"},We={key:0,class:"checked-icon",viewBox:"0 0 24 24"},Xe={key:1,class:"character-list"},Ke=["onClick"],Qe={class:"custom-checkbox"},Ye={key:0,class:"checked-icon-inner",viewBox:"0 0 24 24"},Ze=["src"],et={__name:"PostMoment",props:{show:Boolean},emits:["close","post"],setup(W,{emit:X}){const B=X,K=ve();re();const Q=de(),Y=pe(),{getImageUrl:N,preview:z}=Y,h=v(""),n=v([]),C=v(""),g=v([]),m=v({type:"public",allowed:[]}),M=v(!1),d=v(null),L=v(!1),p=v(!1),r=v(!1),c=v(""),k=v(""),w=v([]),u=v({type:"public",allowed:[]}),P=v([]),Z=q(()=>K.characters.filter(l=>l.id!=="user")),R=q(()=>!h.value.trim()&&n.value.length===0);O(p,l=>{l&&(w.value=[...g.value])}),O(r,l=>{l&&(u.value=JSON.parse(JSON.stringify(m.value)))}),O(()=>n.value.length,(l,e)=>{if(e===1&&l>1)n.value.forEach(s=>{s.isTextGenerated&&(s.aspectRatio="square")});else if(e>1&&l===1){const s=n.value[0];s.isTextGenerated&&(s.aspectRatio="rectangle")}J()}),ce(()=>{J()});const ee=()=>{R.value||(B("post",{content:h.value,images:n.value,location:C.value,remind:g.value,visibility:m.value}),j(),B("close"))},te=()=>{j(),B("close")},j=()=>{h.value="",n.value=[],C.value="",g.value=[],m.value={type:"public",allowed:[]},f()},f=()=>{M.value=!1,d.value=null,p.value=!1,r.value=!1,c.value="",k.value=""},A=l=>{d.value=d.value===l?null:l},F=()=>{d.value==="url"&&(c.value=""),d.value==="description"&&(k.value="")},le=()=>{L.value=!L.value},{createImageFromText:se,triggerFileUpload:D}=ke(oe);function oe(l){U(l),f()}const U=l=>{n.value.length<9&&n.value.push(l)},G=l=>{n.value.splice(l,1)},H=async()=>{if(d.value==="url"&&c.value){const l=new Image;l.onload=()=>{U({type:"url",content:c.value,width:l.naturalWidth,height:l.naturalHeight})},l.onerror=()=>{Q.showToast("无效的图片链接","error")},l.src=c.value}else if(d.value==="description"&&k.value){const l={aspectRatio:n.value.length>0?"square":"rectangle"},e=await se(k.value,l);e&&U(e)}f()},ae=()=>{p.value&&(g.value=[...w.value]),r.value&&(u.value.type==="public"&&(u.value.allowed=[]),m.value=JSON.parse(JSON.stringify(u.value))),f()},ie=l=>p.value?w.value.includes(l):r.value&&u.value.type==="partial"?u.value.allowed.includes(l):!1,ne=l=>{if(p.value){const e=w.value.indexOf(l);e>-1?w.value.splice(e,1):w.value.push(l)}else if(r.value&&u.value.type==="partial"){const e=u.value.allowed.indexOf(l);e>-1?u.value.allowed.splice(e,1):u.value.allowed.push(l)}},J=()=>{fe(()=>{P.value.forEach(l=>{l&&l.classList.toggle("is-overflowing",l.scrollHeight>l.clientHeight)})})};return(l,e)=>W.show?(a(),o("div",we,[t("div",{class:"modal-content",onClick:e[15]||(e[15]=_(()=>{},["stop"]))},[t("div",be,[t("div",{class:"back-btn",onClick:te},[...e[16]||(e[16]=[t("svg",{class:"svg-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("path",{d:"M15 18l-6-6 6-6"})],-1)])]),e[17]||(e[17]=t("div",{class:"title"},"发表动态",-1)),t("div",ye,[t("button",{onClick:ee,class:"header-save-btn",disabled:R.value},"发表",8,he)])]),t("div",Ce,[$(t("textarea",{"onUpdate:modelValue":e[0]||(e[0]=s=>h.value=s),placeholder:"这一刻的想法...",class:"post-moment-textarea"},null,512),[[I,h.value]]),t("div",{class:ge(["publish-images",{"single-image":n.value.length===1}])},[(a(!0),o(T,null,E(n.value,(s,b)=>(a(),o(T,{key:b},[n.value.length===1&&!s.isTextGenerated?(a(),o("div",{key:0,class:"publish-single-image-adaptive",onClick:x=>y(z)(s)},[t("img",{src:y(N)(s),alt:"publish preview"},null,8,Se),t("div",{class:"remove-img",onClick:_(x=>G(b),["stop"])},"×",8,_e)],8,xe)):(a(),o("div",{key:1,class:"publish-image-item",style:me({backgroundImage:`url(${y(N)(s)})`}),onClick:x=>y(z)(s)},[s.isTextGenerated?(a(),o("div",{key:0,class:"description-placeholder",ref_for:!0,ref:x=>P.value[b]=x},S(n.value.length>1?`第${b+1}张图片`:"一张图片"),513)):i("",!0),t("div",{class:"remove-img",onClick:_(x=>G(b),["stop"])},"×",8,$e)],12,Me))],64))),128)),n.value.length<9?(a(),o("div",{key:0,class:"add-image-btn",onClick:e[1]||(e[1]=s=>M.value=!0)},[...e[18]||(e[18]=[t("span",null,"+",-1)])])):i("",!0)],2),e[25]||(e[25]=t("div",{class:"spacer"},null,-1)),t("div",Ie,[t("div",{class:"option-row",onClick:le},[e[19]||(e[19]=V('<div class="option-icon" data-v-0e13f24a><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-0e13f24a><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z" data-v-0e13f24a></path><circle cx="12" cy="10" r="3" data-v-0e13f24a></circle></svg></div><div class="option-label" data-v-0e13f24a>所在位置</div>',2)),t("div",Be,S(C.value||""),1),e[20]||(e[20]=t("div",{class:"option-arrow"},">_",-1))]),L.value?(a(),o("div",Le,[$(t("input",{type:"text","onUpdate:modelValue":e[2]||(e[2]=s=>C.value=s),placeholder:"输入位置",class:"base-input"},null,512),[[I,C.value]])])):i("",!0),t("div",{class:"option-row",onClick:e[3]||(e[3]=s=>p.value=!0)},[e[21]||(e[21]=V('<div class="option-icon" data-v-0e13f24a><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-0e13f24a><circle cx="12" cy="12" r="4" data-v-0e13f24a></circle><path d="M16 8v5a3 3 0 0 0 6 0v-1a10 10 0 1 0-3.92 7.94" data-v-0e13f24a></path></svg></div><div class="option-label" data-v-0e13f24a>提醒谁看</div>',2)),t("div",Ue,S(g.value.length?`${g.value.length}个联系人`:""),1),e[22]||(e[22]=t("div",{class:"option-arrow"},">_",-1))]),t("div",{class:"option-row",onClick:e[4]||(e[4]=s=>r.value=!0)},[e[23]||(e[23]=V('<div class="option-icon" data-v-0e13f24a><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-0e13f24a><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" data-v-0e13f24a></path><circle cx="9" cy="7" r="4" data-v-0e13f24a></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87" data-v-0e13f24a></path><path d="M16 3.13a4 4 0 0 1 0 7.75" data-v-0e13f24a></path></svg></div><div class="option-label" data-v-0e13f24a>谁可以看</div>',2)),t("div",Oe,S(m.value.type==="public"?"公开":`${m.value.allowed.length}个联系人`),1),e[24]||(e[24]=t("div",{class:"option-arrow"},">_",-1))])])]),M.value?(a(),o("div",{key:0,class:"popup-overlay",onClick:f},[t("div",{class:"popup-content",onClick:e[11]||(e[11]=_(()=>{},["stop"]))},[t("div",Te,[t("div",{class:"popup-option",onClick:e[5]||(e[5]=s=>A("description"))},"文字描述"),d.value==="description"?(a(),o("div",Ve,[t("div",Ne,[$(t("textarea",{"onUpdate:modelValue":e[6]||(e[6]=s=>k.value=s),placeholder:"输入描述...",class:"base-input"},null,512),[[I,k.value]]),k.value?(a(),o("button",{key:0,onClick:F,class:"clear-input-btn"},"×")):i("",!0)]),t("button",{onClick:H,class:"btn btn-secondary btn-sm"},"确定")])):i("",!0)]),t("div",{class:"popup-option",onClick:e[7]||(e[7]=(...s)=>y(D)&&y(D)(...s))},"从相册选择"),t("div",ze,[t("div",{class:"popup-option",onClick:e[8]||(e[8]=s=>A("url"))},"输入图片链接"),d.value==="url"?(a(),o("div",Pe,[t("div",Re,[$(t("input",{type:"text","onUpdate:modelValue":e[9]||(e[9]=s=>c.value=s),placeholder:"https://...",class:"base-input"},null,512),[[I,c.value]]),c.value?(a(),o("button",{key:0,onClick:F,class:"clear-input-btn"},"×")):i("",!0)]),t("button",{onClick:H,class:"btn btn-secondary btn-sm"},"确定")])):i("",!0)]),e[26]||(e[26]=t("div",{class:"popup-separator"},null,-1)),t("div",{class:"popup-option",onClick:e[10]||(e[10]=s=>M.value=!1)},"取消")])])):i("",!0),p.value||r.value?(a(),o("div",{key:1,class:"popup-overlay selector-popup",onClick:f},[t("div",{class:"selector-content",onClick:e[14]||(e[14]=_(()=>{},["stop"]))},[t("div",je,[t("div",{class:"back-btn",onClick:f},[...e[27]||(e[27]=[t("svg",{class:"svg-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("path",{d:"M15 18l-6-6 6-6"})],-1)])]),t("div",Ae,[p.value?(a(),o("span",Fe,"选择提醒的人")):i("",!0),r.value?(a(),o("span",De,"选择可见范围")):i("",!0)]),t("div",{class:"action-btn"},[t("button",{onClick:ae,class:"header-save-btn"},"完成")])]),t("div",Ge,[r.value?(a(),o("div",He,[t("div",{class:"visibility-option",onClick:e[12]||(e[12]=s=>u.value.type="public")},[t("div",Je,[u.value.type==="public"?(a(),o("svg",qe,[...e[28]||(e[28]=[t("path",{fill:"currentColor",d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"},null,-1)])])):i("",!0)]),e[29]||(e[29]=t("label",null,"公开",-1))]),t("div",{class:"visibility-option",onClick:e[13]||(e[13]=s=>u.value.type="partial")},[t("div",Ee,[u.value.type==="partial"?(a(),o("svg",We,[...e[30]||(e[30]=[t("path",{fill:"currentColor",d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"},null,-1)])])):i("",!0)]),e[31]||(e[31]=t("label",null,"部分可见",-1))])])):i("",!0),!r.value||u.value.type==="partial"?(a(),o("div",Xe,[(a(!0),o(T,null,E(Z.value,s=>(a(),o("div",{key:s.id,class:"character-item",onClick:b=>ne(s.id)},[t("div",Qe,[ie(s.id)?(a(),o("svg",Ye,[...e[32]||(e[32]=[t("path",{fill:"white",d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"},null,-1)])])):i("",!0)]),t("img",{src:s.avatar,class:"char-avatar"},null,8,Ze),t("label",null,S(s.name),1)],8,Ke))),128))])):i("",!0)])])])):i("",!0)])])):i("",!0)}},lt=ue(et,[["__scopeId","data-v-0e13f24a"]]);export{lt as default};
