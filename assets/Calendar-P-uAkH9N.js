import{ck as Z,cl as L,cm as j,cn as Ue,co as we,cp as re,cq as D,cr as He,_ as z,I as ae,a3 as de,r as S,y as Re,d as h,f as E,o as m,e as s,F,C as H,n as R,t as x,w as N,A as I,D as J,g as C,S as V,m as Le,U as be,c as _,cs as Be,ct as fe,cu as ve,cv as ke,i as X,B as A,M as De,E as Ve,V as me,N as K,a6 as Ge,c1 as Qe,P as Ae,G as Xe,a7 as je,cw as Je,k as Ke,a9 as Ze}from"./index-v0eUz7Da.js";function te(n,e){return Z(n,{...e,weekStartsOn:1})}function xe(n,e){const t=L(n,e==null?void 0:e.in),a=t.getFullYear(),r=j(t,0);r.setFullYear(a+1,0,4),r.setHours(0,0,0,0);const l=te(r),g=j(t,0);g.setFullYear(a,0,4),g.setHours(0,0,0,0);const b=te(g);return t.getTime()>=l.getTime()?a+1:t.getTime()>=b.getTime()?a:a-1}function ze(n,e){const t=xe(n,e),a=j(n,0);return a.setFullYear(t,0,4),a.setHours(0,0,0,0),te(a)}function et(n){return n instanceof Date||typeof n=="object"&&Object.prototype.toString.call(n)==="[object Date]"}function tt(n){return!(!et(n)&&typeof n!="number"||isNaN(+L(n)))}function nt(n,e){const t=L(n,e==null?void 0:e.in);return t.setFullYear(t.getFullYear(),0,1),t.setHours(0,0,0,0),t}function at(n,e){const t=L(n,e==null?void 0:e.in);return Ue(t,nt(t))+1}function st(n,e){const t=L(n,e==null?void 0:e.in),a=+te(t)-+ze(t);return Math.round(a/we)+1}function _e(n,e){var T,d,o,y;const t=L(n,e==null?void 0:e.in),a=t.getFullYear(),r=re(),l=(e==null?void 0:e.firstWeekContainsDate)??((d=(T=e==null?void 0:e.locale)==null?void 0:T.options)==null?void 0:d.firstWeekContainsDate)??r.firstWeekContainsDate??((y=(o=r.locale)==null?void 0:o.options)==null?void 0:y.firstWeekContainsDate)??1,g=j((e==null?void 0:e.in)||n,0);g.setFullYear(a+1,0,l),g.setHours(0,0,0,0);const b=Z(g,e),w=j((e==null?void 0:e.in)||n,0);w.setFullYear(a,0,l),w.setHours(0,0,0,0);const f=Z(w,e);return+t>=+b?a+1:+t>=+f?a:a-1}function rt(n,e){var b,w,f,T;const t=re(),a=(e==null?void 0:e.firstWeekContainsDate)??((w=(b=e==null?void 0:e.locale)==null?void 0:b.options)==null?void 0:w.firstWeekContainsDate)??t.firstWeekContainsDate??((T=(f=t.locale)==null?void 0:f.options)==null?void 0:T.firstWeekContainsDate)??1,r=_e(n,e),l=j((e==null?void 0:e.in)||n,0);return l.setFullYear(r,0,a),l.setHours(0,0,0,0),Z(l,e)}function ot(n,e){const t=L(n,e==null?void 0:e.in),a=+Z(t,e)-+rt(t,e);return Math.round(a/we)+1}const U={y(n,e){const t=n.getFullYear(),a=t>0?t:1-t;return D(e==="yy"?a%100:a,e.length)},M(n,e){const t=n.getMonth();return e==="M"?String(t+1):D(t+1,2)},d(n,e){return D(n.getDate(),e.length)},a(n,e){const t=n.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return t.toUpperCase();case"aaa":return t;case"aaaaa":return t[0];case"aaaa":default:return t==="am"?"a.m.":"p.m."}},h(n,e){return D(n.getHours()%12||12,e.length)},H(n,e){return D(n.getHours(),e.length)},m(n,e){return D(n.getMinutes(),e.length)},s(n,e){return D(n.getSeconds(),e.length)},S(n,e){const t=e.length,a=n.getMilliseconds(),r=Math.trunc(a*Math.pow(10,t-3));return D(r,e.length)}},Q={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},he={G:function(n,e,t){const a=n.getFullYear()>0?1:0;switch(e){case"G":case"GG":case"GGG":return t.era(a,{width:"abbreviated"});case"GGGGG":return t.era(a,{width:"narrow"});case"GGGG":default:return t.era(a,{width:"wide"})}},y:function(n,e,t){if(e==="yo"){const a=n.getFullYear(),r=a>0?a:1-a;return t.ordinalNumber(r,{unit:"year"})}return U.y(n,e)},Y:function(n,e,t,a){const r=_e(n,a),l=r>0?r:1-r;if(e==="YY"){const g=l%100;return D(g,2)}return e==="Yo"?t.ordinalNumber(l,{unit:"year"}):D(l,e.length)},R:function(n,e){const t=xe(n);return D(t,e.length)},u:function(n,e){const t=n.getFullYear();return D(t,e.length)},Q:function(n,e,t){const a=Math.ceil((n.getMonth()+1)/3);switch(e){case"Q":return String(a);case"QQ":return D(a,2);case"Qo":return t.ordinalNumber(a,{unit:"quarter"});case"QQQ":return t.quarter(a,{width:"abbreviated",context:"formatting"});case"QQQQQ":return t.quarter(a,{width:"narrow",context:"formatting"});case"QQQQ":default:return t.quarter(a,{width:"wide",context:"formatting"})}},q:function(n,e,t){const a=Math.ceil((n.getMonth()+1)/3);switch(e){case"q":return String(a);case"qq":return D(a,2);case"qo":return t.ordinalNumber(a,{unit:"quarter"});case"qqq":return t.quarter(a,{width:"abbreviated",context:"standalone"});case"qqqqq":return t.quarter(a,{width:"narrow",context:"standalone"});case"qqqq":default:return t.quarter(a,{width:"wide",context:"standalone"})}},M:function(n,e,t){const a=n.getMonth();switch(e){case"M":case"MM":return U.M(n,e);case"Mo":return t.ordinalNumber(a+1,{unit:"month"});case"MMM":return t.month(a,{width:"abbreviated",context:"formatting"});case"MMMMM":return t.month(a,{width:"narrow",context:"formatting"});case"MMMM":default:return t.month(a,{width:"wide",context:"formatting"})}},L:function(n,e,t){const a=n.getMonth();switch(e){case"L":return String(a+1);case"LL":return D(a+1,2);case"Lo":return t.ordinalNumber(a+1,{unit:"month"});case"LLL":return t.month(a,{width:"abbreviated",context:"standalone"});case"LLLLL":return t.month(a,{width:"narrow",context:"standalone"});case"LLLL":default:return t.month(a,{width:"wide",context:"standalone"})}},w:function(n,e,t,a){const r=ot(n,a);return e==="wo"?t.ordinalNumber(r,{unit:"week"}):D(r,e.length)},I:function(n,e,t){const a=st(n);return e==="Io"?t.ordinalNumber(a,{unit:"week"}):D(a,e.length)},d:function(n,e,t){return e==="do"?t.ordinalNumber(n.getDate(),{unit:"date"}):U.d(n,e)},D:function(n,e,t){const a=at(n);return e==="Do"?t.ordinalNumber(a,{unit:"dayOfYear"}):D(a,e.length)},E:function(n,e,t){const a=n.getDay();switch(e){case"E":case"EE":case"EEE":return t.day(a,{width:"abbreviated",context:"formatting"});case"EEEEE":return t.day(a,{width:"narrow",context:"formatting"});case"EEEEEE":return t.day(a,{width:"short",context:"formatting"});case"EEEE":default:return t.day(a,{width:"wide",context:"formatting"})}},e:function(n,e,t,a){const r=n.getDay(),l=(r-a.weekStartsOn+8)%7||7;switch(e){case"e":return String(l);case"ee":return D(l,2);case"eo":return t.ordinalNumber(l,{unit:"day"});case"eee":return t.day(r,{width:"abbreviated",context:"formatting"});case"eeeee":return t.day(r,{width:"narrow",context:"formatting"});case"eeeeee":return t.day(r,{width:"short",context:"formatting"});case"eeee":default:return t.day(r,{width:"wide",context:"formatting"})}},c:function(n,e,t,a){const r=n.getDay(),l=(r-a.weekStartsOn+8)%7||7;switch(e){case"c":return String(l);case"cc":return D(l,e.length);case"co":return t.ordinalNumber(l,{unit:"day"});case"ccc":return t.day(r,{width:"abbreviated",context:"standalone"});case"ccccc":return t.day(r,{width:"narrow",context:"standalone"});case"cccccc":return t.day(r,{width:"short",context:"standalone"});case"cccc":default:return t.day(r,{width:"wide",context:"standalone"})}},i:function(n,e,t){const a=n.getDay(),r=a===0?7:a;switch(e){case"i":return String(r);case"ii":return D(r,e.length);case"io":return t.ordinalNumber(r,{unit:"day"});case"iii":return t.day(a,{width:"abbreviated",context:"formatting"});case"iiiii":return t.day(a,{width:"narrow",context:"formatting"});case"iiiiii":return t.day(a,{width:"short",context:"formatting"});case"iiii":default:return t.day(a,{width:"wide",context:"formatting"})}},a:function(n,e,t){const r=n.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return t.dayPeriod(r,{width:"abbreviated",context:"formatting"});case"aaa":return t.dayPeriod(r,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return t.dayPeriod(r,{width:"narrow",context:"formatting"});case"aaaa":default:return t.dayPeriod(r,{width:"wide",context:"formatting"})}},b:function(n,e,t){const a=n.getHours();let r;switch(a===12?r=Q.noon:a===0?r=Q.midnight:r=a/12>=1?"pm":"am",e){case"b":case"bb":return t.dayPeriod(r,{width:"abbreviated",context:"formatting"});case"bbb":return t.dayPeriod(r,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return t.dayPeriod(r,{width:"narrow",context:"formatting"});case"bbbb":default:return t.dayPeriod(r,{width:"wide",context:"formatting"})}},B:function(n,e,t){const a=n.getHours();let r;switch(a>=17?r=Q.evening:a>=12?r=Q.afternoon:a>=4?r=Q.morning:r=Q.night,e){case"B":case"BB":case"BBB":return t.dayPeriod(r,{width:"abbreviated",context:"formatting"});case"BBBBB":return t.dayPeriod(r,{width:"narrow",context:"formatting"});case"BBBB":default:return t.dayPeriod(r,{width:"wide",context:"formatting"})}},h:function(n,e,t){if(e==="ho"){let a=n.getHours()%12;return a===0&&(a=12),t.ordinalNumber(a,{unit:"hour"})}return U.h(n,e)},H:function(n,e,t){return e==="Ho"?t.ordinalNumber(n.getHours(),{unit:"hour"}):U.H(n,e)},K:function(n,e,t){const a=n.getHours()%12;return e==="Ko"?t.ordinalNumber(a,{unit:"hour"}):D(a,e.length)},k:function(n,e,t){let a=n.getHours();return a===0&&(a=24),e==="ko"?t.ordinalNumber(a,{unit:"hour"}):D(a,e.length)},m:function(n,e,t){return e==="mo"?t.ordinalNumber(n.getMinutes(),{unit:"minute"}):U.m(n,e)},s:function(n,e,t){return e==="so"?t.ordinalNumber(n.getSeconds(),{unit:"second"}):U.s(n,e)},S:function(n,e){return U.S(n,e)},X:function(n,e,t){const a=n.getTimezoneOffset();if(a===0)return"Z";switch(e){case"X":return pe(a);case"XXXX":case"XX":return B(a);case"XXXXX":case"XXX":default:return B(a,":")}},x:function(n,e,t){const a=n.getTimezoneOffset();switch(e){case"x":return pe(a);case"xxxx":case"xx":return B(a);case"xxxxx":case"xxx":default:return B(a,":")}},O:function(n,e,t){const a=n.getTimezoneOffset();switch(e){case"O":case"OO":case"OOO":return"GMT"+ge(a,":");case"OOOO":default:return"GMT"+B(a,":")}},z:function(n,e,t){const a=n.getTimezoneOffset();switch(e){case"z":case"zz":case"zzz":return"GMT"+ge(a,":");case"zzzz":default:return"GMT"+B(a,":")}},t:function(n,e,t){const a=Math.trunc(+n/1e3);return D(a,e.length)},T:function(n,e,t){return D(+n,e.length)}};function ge(n,e=""){const t=n>0?"-":"+",a=Math.abs(n),r=Math.trunc(a/60),l=a%60;return l===0?t+String(r):t+String(r)+e+D(l,2)}function pe(n,e){return n%60===0?(n>0?"-":"+")+D(Math.abs(n)/60,2):B(n,e)}function B(n,e=""){const t=n>0?"-":"+",a=Math.abs(n),r=D(Math.trunc(a/60),2),l=D(a%60,2);return t+r+e+l}const ye=(n,e)=>{switch(n){case"P":return e.date({width:"short"});case"PP":return e.date({width:"medium"});case"PPP":return e.date({width:"long"});case"PPPP":default:return e.date({width:"full"})}},Te=(n,e)=>{switch(n){case"p":return e.time({width:"short"});case"pp":return e.time({width:"medium"});case"ppp":return e.time({width:"long"});case"pppp":default:return e.time({width:"full"})}},it=(n,e)=>{const t=n.match(/(P+)(p+)?/)||[],a=t[1],r=t[2];if(!r)return ye(n,e);let l;switch(a){case"P":l=e.dateTime({width:"short"});break;case"PP":l=e.dateTime({width:"medium"});break;case"PPP":l=e.dateTime({width:"long"});break;case"PPPP":default:l=e.dateTime({width:"full"});break}return l.replace("{{date}}",ye(a,e)).replace("{{time}}",Te(r,e))},lt={p:Te,P:it},ut=/^D+$/,ct=/^Y+$/,dt=["D","DD","YY","YYYY"];function ft(n){return ut.test(n)}function vt(n){return ct.test(n)}function mt(n,e,t){const a=ht(n,e,t);if(console.warn(a),dt.includes(n))throw new RangeError(a)}function ht(n,e,t){const a=n[0]==="Y"?"years":"days of the month";return`Use \`${n.toLowerCase()}\` instead of \`${n}\` (in \`${e}\`) for formatting ${a} to the input \`${t}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const gt=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,pt=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,yt=/^'([^]*?)'?$/,wt=/''/g,bt=/[a-zA-Z]/;function ne(n,e,t){var T,d,o,y;const a=re(),r=a.locale??He,l=a.firstWeekContainsDate??((d=(T=a.locale)==null?void 0:T.options)==null?void 0:d.firstWeekContainsDate)??1,g=a.weekStartsOn??((y=(o=a.locale)==null?void 0:o.options)==null?void 0:y.weekStartsOn)??0,b=L(n,t==null?void 0:t.in);if(!tt(b))throw new RangeError("Invalid time value");let w=e.match(pt).map(c=>{const i=c[0];if(i==="p"||i==="P"){const k=lt[i];return k(c,r.formatLong)}return c}).join("").match(gt).map(c=>{if(c==="''")return{isToken:!1,value:"'"};const i=c[0];if(i==="'")return{isToken:!1,value:kt(c)};if(he[i])return{isToken:!0,value:c};if(i.match(bt))throw new RangeError("Format string contains an unescaped latin alphabet character `"+i+"`");return{isToken:!1,value:c}});r.localize.preprocessor&&(w=r.localize.preprocessor(b,w));const f={firstWeekContainsDate:l,weekStartsOn:g,locale:r};return w.map(c=>{if(!c.isToken)return c.value;const i=c.value;(vt(i)||ft(i))&&mt(i,e,String(n));const k=he[i[0]];return k(b,i,r.localize,f)}).join("")}function kt(n){const e=n.match(yt);return e?e[1].replace(wt,"'"):n}const Dt={class:"modal-content"},xt={class:"form-group"},_t={class:"type-selector"},Tt=["onClick"],Ot={key:0,class:"form-group"},$t={key:1,class:"form-group"},Mt={key:2},Ct={class:"form-group"},St={class:"datetime-group"},Et={class:"form-group"},Pt={key:3,class:"form-group"},Yt={class:"period-management-area"},Ft={class:"date-picker-row"},Nt={key:0,class:"record-list"},Wt={class:"record-dates"},qt=["onClick"],It={__name:"EventFormModal",props:{visible:Boolean,selectedDate:Date},emits:["close","submit","submit-period"],setup(n,{emit:e}){const t=n,a=e,r=ae(),l=[{label:"待办",value:"todo"},{label:"倒数日",value:"countdown"},{label:"纪念日",value:"anniversary"},{label:"经期",value:"period"}],g=de({start:"",end:""}),b=S([]),w=()=>({type:"todo",title:"",date:t.selectedDate?t.selectedDate.toISOString().split("T")[0]:new Date().toISOString().split("T")[0],time:new Date().toTimeString().slice(0,5),details:"",content:""}),f=de(w());Re(()=>t.visible,c=>{if(c){b.value=JSON.parse(JSON.stringify(r.periodHistory));const i=(t.selectedDate||new Date).toISOString().split("T")[0];f.date=i,g.start=i,g.end=i}});const T=()=>{if(!(!g.start||!g.end)){if(new Date(g.end)<new Date(g.start)){alert("结束日期不能早于开始日期");return}b.value.push({...g}),b.value.sort((c,i)=>new Date(c.start)-new Date(i.start))}},d=c=>{b.value.splice(c,1)},o=()=>{a("close"),Object.assign(f,w())},y=()=>{if(f.type==="period"){a("submit-period",b.value),o();return}const c={...f};if(c.type==="todo"){if(!c.details.trim()){alert("待办内容不能为空！");return}c.date=`${c.date}T${c.time}:00`,c.content=c.details,delete c.details,delete c.title,delete c.time}a("submit",c),o()};return(c,i)=>n.visible?(m(),h("div",{key:0,class:"event-modal-overlay",onClick:J(o,["self"])},[s("div",Dt,[i[14]||(i[14]=s("h3",{class:"modal-title"},"添加事件",-1)),s("div",xt,[i[7]||(i[7]=s("label",null,"事件类型",-1)),s("div",_t,[(m(),h(F,null,H(l,k=>s("button",{key:k.value,class:R({active:f.type===k.value}),onClick:$=>f.type=k.value},x(k.label),11,Tt)),64))])]),f.type!=="period"&&f.type!=="todo"?(m(),h("div",Ot,[i[8]||(i[8]=s("label",null,"标题",-1)),N(s("input",{type:"text","onUpdate:modelValue":i[0]||(i[0]=k=>f.title=k),placeholder:"例如：生日"},null,512),[[I,f.title]])])):E("",!0),f.type==="countdown"||f.type==="anniversary"?(m(),h("div",$t,[i[9]||(i[9]=s("label",null,"日期",-1)),N(s("input",{type:"date","onUpdate:modelValue":i[1]||(i[1]=k=>f.date=k)},null,512),[[I,f.date]])])):E("",!0),f.type==="todo"?(m(),h("div",Mt,[s("div",Ct,[i[10]||(i[10]=s("label",null,"日期和时间",-1)),s("div",St,[N(s("input",{type:"date","onUpdate:modelValue":i[2]||(i[2]=k=>f.date=k)},null,512),[[I,f.date]]),N(s("input",{type:"time","onUpdate:modelValue":i[3]||(i[3]=k=>f.time=k)},null,512),[[I,f.time]])])]),s("div",Et,[i[11]||(i[11]=s("label",null,"待办内容",-1)),N(s("textarea",{"onUpdate:modelValue":i[4]||(i[4]=k=>f.details=k),placeholder:"记录需要做的事情..."},null,512),[[I,f.details]])])])):E("",!0),f.type==="period"?(m(),h("div",Pt,[s("div",Yt,[s("div",Ft,[N(s("input",{type:"date","onUpdate:modelValue":i[5]||(i[5]=k=>g.start=k)},null,512),[[I,g.start]]),i[12]||(i[12]=s("span",null,"-",-1)),N(s("input",{type:"date","onUpdate:modelValue":i[6]||(i[6]=k=>g.end=k)},null,512),[[I,g.end]]),s("button",{class:"btn btn-sm",onClick:T},"添加")]),b.value.length>0?(m(),h("div",Nt,[(m(!0),h(F,null,H(b.value,(k,$)=>(m(),h("div",{key:$,class:"record-item"},[s("span",Wt,x(k.start)+" ~ "+x(k.end),1),s("button",{class:"delete-record-btn",onClick:J(O=>d($),["stop"])},[C(V,{name:"x-mark",class:"delete-icon"})],8,qt)]))),128))])):E("",!0),i[13]||(i[13]=s("p",{class:"period-tip"},"管理您的经期记录（开始与结束日期），最多保留最近3条。",-1))])])):E("",!0),s("div",{class:"modal-actions"},[s("button",{class:"btn-cancel",onClick:o},"取消"),s("button",{class:"btn-confirm",onClick:y},"确认")])])])):E("",!0)}},Ut=z(It,[["__scopeId","data-v-841ee102"]]),Ht={class:"period-item"},Rt=["disabled"],Lt=["disabled"],Bt=["title"],Vt={class:"content-wrapper"},Gt={key:0,class:"status-text"},Qt={class:"status-day-count"},At={key:1,class:"status-text"},Xt={key:2,class:"prediction-details"},jt={class:"prediction-text"},Jt={class:"stats-text"},Kt={__name:"PeriodTracker",props:{status:{type:String,required:!0},dayCount:{type:Number,default:null},selectedDate:{type:Date,required:!0}},setup(n){const e=n,{t}=Le(),a=ae(),{periodHistory:r,ongoingPeriod:l,cycleStats:g,durationStats:b}=be(a),w=S({visible:!1,title:t("calendar.periodTracker.recordTitle"),message:t("calendar.periodTracker.recordMsg")}),f=_(()=>Be(r.value,l.value,2)),T=_(()=>{switch(e.status){case"actual":case"ongoing":return"var(--C-red)";case"predicted":return"var(--C-pink)";default:return"var(---text-tertiary)"}}),d=_(()=>l.value?t("calendar.periodTracker.end"):t("calendar.periodTracker.start")),o=_(()=>{if(f.value.length===0)return"暂无预测";const $=f.value[0],O=ne(fe($.start),"M月d日"),P=ne(fe($.end),"M月d日");return`下次预测: ${O} - ${P}`}),y=_(()=>{const{status:$,dayCount:O,selectedDate:P}=e;switch($){case"actual":case"ongoing":return{prefix:"经期第",number:O,suffix:"天"};case"predicted":return{prefix:"预测第",number:O,suffix:"天"};default:if(f.value.length>0){const M=ve(new Date(f.value[0].start)),G=ve(P),Y=ke(M,G);if(Y>0)return{prefix:"预计",number:Y,suffix:"天后"}}return{prefix:"添加历史记录以开始预测",number:null,suffix:""}}}),c=()=>{w.value.visible=!0},i=()=>{const $=K(e.selectedDate,{representation:"date"});a.recordPeriod($),w.value.visible=!1},k=()=>{const $=K(e.selectedDate,{representation:"date"});a.endPeriod($),w.value.visible=!1};return($,O)=>(m(),h("div",Ht,[O[2]||(O[2]=s("div",{class:"washi-tape"},null,-1)),C(De,{visible:w.value.visible,title:w.value.title,"onUpdate:visible":O[0]||(O[0]=P=>w.value.visible=!1)},{footer:X(()=>[s("button",{class:"modal-btn",onClick:i,disabled:!!A(l)},x($.$t("calendar.periodTracker.start")),9,Rt),s("button",{class:"modal-btn confirm",onClick:k,disabled:!A(l)},x($.$t("calendar.periodTracker.end")),9,Lt)]),default:X(()=>[s("p",null,x(w.value.message),1)]),_:1},8,["visible","title"]),s("div",{class:"status-button",onClick:c,title:d.value},[s("div",{class:"status-indicator",style:Ve({backgroundColor:T.value})},null,4)],8,Bt),s("div",Vt,[O[1]||(O[1]=s("h3",{class:"item-title"},"Period",-1)),y.value.number!==null?(m(),h("p",Gt,[me(x(y.value.prefix)+" ",1),s("span",Qt,x(y.value.number),1),me(" "+x(y.value.suffix),1)])):(m(),h("p",At,x(y.value.prefix),1)),A(a).periodHistory.length>0?(m(),h("div",Xt,[s("p",jt,x(o.value),1),s("p",Jt," 平均周期 "+x(A(g).average)+" 天 · 平均经期 "+x(A(b).average)+" 天 ",1)])):E("",!0)])]))}},Zt=z(Kt,[["__scopeId","data-v-fd83e02b"]]),zt={key:0,class:"sticker-card todo-card"},en={class:"todo-list"},tn=["onClick"],nn={class:"all-day-label"},an=["onClick"],sn={class:"todo-time"},rn=["onClick"],on={__name:"ToDoList",props:{todos:{type:Array,required:!0}},setup(n){const e=ae(),t=S(null),a=S(null),r=S(null),l=d=>{var y;const o=(y=r.value)==null?void 0:y[0];o&&o.contains(d.target)||b()},g=d=>{t.value&&b(),t.value={...d,isAllDay:!d.time,time:d.time||new Date().toTimeString().slice(0,5)},Xe(()=>{var o,y;(y=(o=a.value)==null?void 0:o[0])==null||y.focus(),setTimeout(()=>{document.addEventListener("mousedown",l)},0)})},b=()=>{if(document.removeEventListener("mousedown",l),!t.value)return;if(!t.value.content.trim()){w(t.value.id);return}const d={...t.value,time:t.value.isAllDay?"":t.value.time};delete d.isAllDay,e.updateEvent(d),t.value=null},w=d=>{document.removeEventListener("mousedown",l),e.removeEvent(d),t.value=null},f=d=>{e.toggleTodoStatus(d)},T=d=>d.time?d.time:"全天";return Ge(()=>{document.removeEventListener("mousedown",l)}),(d,o)=>n.todos.length>0?(m(),h("div",zt,[o[4]||(o[4]=s("h3",{class:"handwritten-title"},"To Do List",-1)),o[5]||(o[5]=s("div",{class:"tape-deco"},null,-1)),s("ul",en,[(m(!0),h(F,null,H(n.todos,y=>(m(),h("li",{key:y.id,class:R({done:y.done})},[s("div",{class:R(["checkbox",{checked:y.done}]),onClick:c=>f(y.id)},null,10,tn),t.value&&t.value.id===y.id?(m(),h("div",{key:0,class:"edit-container",ref_for:!0,ref_key:"editContainerRef",ref:r},[s("label",nn,[N(s("input",{type:"checkbox","onUpdate:modelValue":o[0]||(o[0]=c=>t.value.isAllDay=c),class:"hidden-checkbox"},null,512),[[Qe,t.value.isAllDay]]),s("span",{class:R(["custom-checkbox",{checked:t.value.isAllDay}])},null,2),o[3]||(o[3]=s("span",{class:"checkbox-text"},"全天",-1))]),t.value.isAllDay?E("",!0):N((m(),h("input",{key:0,type:"time","onUpdate:modelValue":o[1]||(o[1]=c=>t.value.time=c),class:"base-input-mini"},null,512)),[[I,t.value.time]]),N(s("input",{type:"text","onUpdate:modelValue":o[2]||(o[2]=c=>t.value.content=c),onKeyup:Ae(b,["enter"]),class:"base-input",ref_for:!0,ref_key:"editInputRef",ref:a},null,544),[[I,t.value.content]]),s("button",{class:"delete-btn",onClick:c=>w(y.id)},[C(V,{name:"x-mark"})],8,an)],512)):(m(),h(F,{key:1},[s("span",sn,x(T(y)),1),s("span",{class:"todo-content",onClick:c=>g(y)},x((y.content||"").trim()||"[空内容]"),9,rn)],64))],2))),128))])])):E("",!0)}},ln=z(on,[["__scopeId","data-v-a4a8522a"]]),un={class:"polaroid-wrapper"},cn=["src"],dn={key:1,class:"placeholder"},fn={class:"caption"},vn=["value"],mn={class:"info"},hn={class:"label"},gn={class:"days-row"},pn={class:"big-num"},yn={class:"date-tag"},wn={class:"left"},bn={class:"title"},kn={class:"date"},Dn={class:"days-block"},xn={class:"num"},_n={__name:"DaysCount",props:{event:{type:Object,required:!0},selectedDate:{type:Date,default:()=>new Date}},emits:["update:polaroidText","delete","upload-photo"],setup(n,{emit:e}){const t=n,a=e;let r=null;const l=()=>{r=setTimeout(()=>{a("delete",t.event)},800)},g=()=>{r&&(clearTimeout(r),r=null)},b=_(()=>t.event.type==="anniversary"),w=_(()=>{if(!t.event.date)return 0;const d=new Date(t.event.date),o=new Date(t.selectedDate);return Math.abs(ke(o,d))}),f=_(()=>{if(!t.event.date)return"";const d=new Date(t.event.date);return ne(d,"yyyy.MM.dd")}),T=_(()=>{if(!t.event.date)return"";const d=new Date(t.event.date);return ne(d,"yyyy.MM.dd EEEE")});return(d,o)=>(m(),h("div",{class:R(["base-card",b.value?"anniversary-card":"countdown-card"]),onTouchstart:l,onTouchend:g,onTouchmove:g,onMousedown:l,onMouseup:g,onMouseleave:g},[b.value?(m(),h(F,{key:0},[s("div",un,[o[4]||(o[4]=s("div",{class:"tape"},null,-1)),s("div",{class:"photo-area",onClick:o[0]||(o[0]=J(y=>d.$emit("upload-photo",n.event),["stop"]))},[n.event.photoUrl?(m(),h("img",{key:0,src:n.event.photoUrl,class:"polaroid-img"},null,8,cn)):(m(),h("div",dn,[C(V,{name:"camera",className:"camera-icon"}),o[3]||(o[3]=s("span",{class:"upload-text"},"点击上传",-1))]))]),s("div",fn,[s("input",{type:"text",value:n.event.polaroidText,onInput:o[1]||(o[1]=y=>d.$emit("update:polaroidText",y.target.value)),placeholder:"写点什么...",onClick:o[2]||(o[2]=J(()=>{},["stop"]))},null,40,vn)])]),s("div",mn,[o[6]||(o[6]=s("div",{class:"tag"},"ANNIVERSARY",-1)),s("div",hn,x(n.event.title||"纪念日"),1),s("div",gn,[s("span",pn,x(w.value),1),o[5]||(o[5]=s("span",{class:"unit"},"Days",-1))]),s("span",yn,"Since "+x(f.value),1)])],64)):(m(),h(F,{key:1},[o[9]||(o[9]=s("div",{class:"corner-line"},null,-1)),o[10]||(o[10]=s("span",{class:"star-deco"},"✦",-1)),s("div",wn,[o[7]||(o[7]=s("div",{class:"tag-line"},[s("span",{class:"tag"},"COUNTDOWN"),s("span",{class:"line"})],-1)),s("h2",bn,x(n.event.title||"倒计时"),1),s("p",kn,x(T.value),1)]),s("div",Dn,[s("span",xn,x(w.value),1),o[8]||(o[8]=s("span",{class:"unit"},"days",-1))])],64))],34))}},Tn=z(_n,[["__scopeId","data-v-504720e0"]]),On={class:"page-container"},$n={class:"calendar-section"},Mn={class:"cal-header"},Cn={class:"header-left"},Sn={class:"m-en"},En={class:"m-cn"},Pn={class:"header-right"},Yn={key:0,class:"month-switcher"},Fn={key:0,class:"week-view"},Nn=["onClick"],Wn={class:"week-txt"},qn={class:"day-num"},In={key:1,class:"month-view"},Un={class:"grid-header"},Hn={class:"grid-body"},Rn=["onClick"],Ln={class:"events-display-section"},Bn={key:0,class:"period-tracker-container"},Vn={class:"cards-container"},Gn={key:1,class:"no-events-placeholder"},Qn={__name:"Calendar",setup(n){const e=ae(),{ongoingPeriod:t}=be(e),a=S(!1),r=()=>{a.value=!0},l=u=>{e.addEvent(u)},g=u=>{e.setPeriodHistory(u)},b=(u,p)=>{const v={...u,polaroidText:p};e.updateEvent(v)},w=S(null),{triggerFileUpload:f}=je({onComplete:u=>{if(w.value){const p={...w.value,photoUrl:u.content};e.updateEvent(p),w.value=null}}}),T=u=>{w.value=u,f()},d=S(!1),o=S(null),y=u=>{o.value=u,d.value=!0},c=()=>{o.value&&(e.removeEvent(o.value.id),o.value=null),d.value=!1},i=["日","一","二","三","四","五","六"],k=["SUN","MON","TUE","WED","THU","FRI","SAT"],$=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],O=new Date,P=S(!1),M=S(new Date),G=S(new Date(O.getFullYear(),O.getMonth(),1)),Y=_(()=>G.value.getFullYear()),W=_(()=>G.value.getMonth()),Oe=_(()=>$[W.value]),$e=_(()=>new Date(Y.value,W.value+1,0).getDate()),Me=_(()=>new Date(Y.value,W.value,1).getDay()),Ce=_(()=>{const u=new Date(M.value),p=[],v=u.getDay(),q=u.getDate()-v;for(let se=0;se<7;se++){let ee=new Date(u);ee.setDate(q+se),p.push({date:ee,day:ee.getDate(),week:k[ee.getDay()]})}return p}),oe=()=>{P.value=!P.value,P.value||(M.value=new Date),G.value=new Date(M.value.getFullYear(),M.value.getMonth(),1)},ie=u=>G.value=new Date(Y.value,W.value+u,1),le=(u,p)=>u.getDate()===p.getDate()&&u.getMonth()===p.getMonth()&&u.getFullYear()===p.getFullYear(),Se=u=>u===O.getDate()&&W.value===O.getMonth()&&Y.value===O.getFullYear(),Ee=u=>u===M.value.getDate()&&W.value===M.value.getMonth()&&Y.value===M.value.getFullYear(),Pe=u=>M.value=u,Ye=u=>M.value=new Date(Y.value,W.value,u),Fe=_(()=>e.getEventsByDate(M.value)),ue=_(()=>Fe.value.filter(u=>u.type==="todo")),Ne=_(()=>e.events.filter(u=>u.type==="countdown"||u.type==="anniversary")),ce=_(()=>{const u=K(M.value,{representation:"date"});return Je(u,e.periodHistory,t.value)}),We=_(()=>{const u={};for(const p of e.events){if(!p.date)continue;let v;try{const q=new Date(p.date);if(isNaN(q.getTime()))continue;v=K(q,{representation:"date"})}catch{console.warn("Skipping event with invalid date:",p);continue}p.type==="period_day"?u[v]="event-dot actual-dot":p.type==="predicted_period_day"?u[v]!=="event-dot actual-dot"&&(u[v]="event-dot predicted-dot"):u[v]||(u[v]="event-dot normal-dot")}return u}),qe=u=>{const p=K(u,{representation:"date"});return We.value[p]||""},Ie=u=>{const p=new Date(Y.value,W.value,u);return qe(p)};return(u,p)=>(m(),Ke(Ze,{title:"日历","no-padding":!0},{action:X(()=>[s("button",{class:"header-action-btn",onClick:r},[C(V,{name:"plus"})])]),default:X(()=>[s("div",On,[s("div",$n,[s("div",Mn,[s("div",Cn,[s("div",{class:"month-display",onClick:oe},[s("span",Sn,x(Oe.value),1),s("span",En,x(Y.value)+"年"+x(W.value+1)+"月",1)])]),s("div",Pn,[P.value?(m(),h("div",Yn,[s("button",{onClick:p[0]||(p[0]=J(v=>ie(-1),["stop"]))},[C(V,{name:"chevron-left"})]),s("button",{onClick:p[1]||(p[1]=J(v=>ie(1),["stop"]))},[C(V,{name:"chevron-right"})])])):E("",!0),s("button",{class:"toggle-btn",onClick:oe},[C(V,{name:P.value?"chevron-up":"chevron-down",className:"cal-toggle-icon"},null,8,["name"])])])]),P.value?(m(),h("div",In,[s("div",Un,[(m(),h(F,null,H(i,v=>s("span",{key:v},x(v),1)),64))]),s("div",Hn,[(m(!0),h(F,null,H(Me.value,v=>(m(),h("div",{key:"empty-"+v,class:"grid-cell empty"}))),128)),(m(!0),h(F,null,H($e.value,v=>(m(),h("div",{key:v,class:R(["grid-cell",{active:Ee(v),today:Se(v)}]),onClick:q=>Ye(v)},[s("span",null,x(v),1),s("div",{class:R(Ie(v))},null,2)],10,Rn))),128))])])):(m(),h("div",Fn,[(m(!0),h(F,null,H(Ce.value,v=>(m(),h("div",{key:v.date,class:R(["day-item",{active:le(v.date,M.value),"is-today":le(v.date,new Date)}]),onClick:q=>Pe(v.date)},[s("span",Wn,x(v.week),1),s("span",qn,x(v.day),1)],10,Nn))),128))]))]),s("div",Ln,[A(e).periodHistory.length>0?(m(),h("div",Bn,[C(Zt,{status:ce.value.status,"day-count":ce.value.dayCount,"selected-date":M.value},null,8,["status","day-count","selected-date"])])):E("",!0),s("div",Vn,[(m(!0),h(F,null,H(Ne.value,v=>(m(),h("div",{key:v.id},[C(Tn,{event:v,"selected-date":M.value,"onUpdate:polaroidText":q=>b(v,q),onDelete:y,onUploadPhoto:T},null,8,["event","selected-date","onUpdate:polaroidText"])]))),128)),C(ln,{todos:ue.value},null,8,["todos"])]),ue.value.length===0?(m(),h("div",Gn,[...p[5]||(p[5]=[s("p",null,"今天没有特别的安排",-1),s("span",null,"点击右上角按钮添加一个吧",-1)])])):E("",!0)]),C(Ut,{visible:a.value,"selected-date":M.value,onClose:p[2]||(p[2]=v=>a.value=!1),onSubmit:l,onSubmitPeriod:g},null,8,["visible","selected-date"]),C(De,{visible:d.value,title:"确认删除","onUpdate:visible":p[4]||(p[4]=v=>d.value=v)},{footer:X(()=>[s("button",{class:"modal-btn cancel",onClick:p[3]||(p[3]=v=>d.value=!1)},"取消"),s("button",{class:"modal-btn danger",onClick:c},"删除")]),default:X(()=>[p[6]||(p[6]=s("p",{style:{padding:"10px 0",color:"#666"}},"确定要删除这个事件吗？",-1))]),_:1},8,["visible"])])]),_:1}))}},Xn=z(Qn,[["__scopeId","data-v-b2834a9d"]]);export{Xn as default};
