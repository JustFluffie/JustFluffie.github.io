import{m as Ne,u as Re,s as Oe,Z as ze,$ as Ee,R as Q,a0 as je,V as We,a1 as Fe,a2 as X,r as O,c as A,y as Y,j as H,_ as D,d as p,o as h,e as t,g as v,t as l,B as e,n as w,S as N,i as U,f as L,w as I,A as P,a3 as T,E as ee,x as qe,N as Ke,M as j,F as te,C as se}from"./index-BkVVehS0.js";import{C as Z}from"./CustomSelect-DZirfZC5.js";import{M as ae}from"./MultiSelect-DQBH0OGF.js";function He(y){const{t:i}=Ne(),n=H(),s=Re(),d=Oe(),k=ze(),c=Ee(),{sortedWorldBooks:r}=Q(c),C=je(),{sortedPresets:u}=Q(C),b=We(),{fetchLocationWeather:m}=Fe(),f=X({roleInfo:!1,userInfo:!1,backgroundActivity:!1,modeSettings:!1,realtimeSense:!1,summarySettings:!1,bubbleSettings:!1,videoSettings:!1,advancedSettings:!1}),V=O(!1),z=O(""),$=O(!1),x=O(!1),W=O(""),ne=O(!1),oe=O(!1),a=X({charNameInput:"",charNicknameInput:"",charPersonaInput:"",currentUserPersonaId:"default",userPersonaNameInput:"",userPersonaDescInput:"",userPersonaAvatar:"",backgroundActivityOverride:"default",proactiveInterval:5,proactiveCooldown:30,proactiveDailyLimit:10,triggerMode:"always",proactiveIdleTime:15,isOnline:!0,preset:[],worldbook:[],replyLengthMin:"",replyLengthMax:"",realtimeTimeEnabled:!1,realtimeWeatherEnabled:!1,charLocationReal:"",charLocationVirtual:"",charLocationDisplay:"",userLocationReal:"",userLocationVirtual:"",userLocationDisplay:"",charLocationData:{},userLocationData:{},summaryRange:20,summaryPrompt:"",autoSummary:!1,memoryCount:10,currentBubblePresetId:"",bubbleCss:"",bubbleFontSize:14,chatBackground:"",videoBg:"",userVideoImg:"",apiConfig:"default",linkedNpcs:[],linkedCharacters:[],isBlocked:!1,npcCount:0,linkedCharCount:0,tokenCount:0,msgCount:0}),M=A(()=>s.getCharacter(y.id)),E=A(()=>{var o;return((o=M.value)==null?void 0:o.name)||i("chat.unknownCharacter")}),ie=A(()=>{var o;return(o=M.value)==null?void 0:o.avatar}),le=A(()=>[{value:"new",label:i("chat.singleChat.settings.newUserPersona")},...(s.userPersonas||[]).map(o=>({value:o.id,label:o.name}))]),re=A(()=>[{value:"default",label:i("chat.singleChat.settings.default")},...b.presets.map(o=>({value:o.name,label:o.name}))]),ce=A(()=>[{value:"",label:i("chat.singleChat.settings.custom")},...(s.bubblePresets||[]).map(o=>({value:o.id,label:o.name}))]),de=A(()=>s.characters.filter(o=>o.id!==y.id)),ue=A(()=>a.backgroundActivityOverride==="on"?!0:a.backgroundActivityOverride==="off"?!1:k.globalBackgroundActivity),ge=A(()=>{const o={fontSize:`${a.bubbleFontSize}px`};if(!a.bubbleCss)return o;const g={};return a.bubbleCss.split(";").forEach(_=>{const S=_.split(":");if(S.length>=2){const B=S[0].trim(),R=S.slice(1).join(":").trim();B&&R&&(g[B]=R)}}),{...o,...g}}),pe=A(()=>({avatar:i("chat.singleChat.settings.toast.setCharAvatar"),userPersonaAvatar:i("chat.singleChat.settings.toast.setUserAvatar"),chatBg:i("chat.singleChat.settings.toast.setChatBg"),videoBg:i("chat.singleChat.settings.toast.setCharImg"),userVideoImg:i("chat.singleChat.settings.toast.setUserImg")})[z.value]||i("chat.singleChat.settings.toast.upload")),F=o=>{if(o==="new"){a.userPersonaNameInput="",a.userPersonaDescInput="",a.userPersonaAvatar="",a.userVideoImg="";return}let g=s.userPersonas.find(_=>_.id===o);g?(a.userPersonaNameInput=g.name,a.userPersonaDescInput=g.description||"",a.userPersonaAvatar=g.avatar||"",a.userVideoImg=g.videoImg||""):a.currentUserPersonaId!=="new"&&(a.currentUserPersonaId="new")},he=()=>{const o=a.userPersonaNameInput.trim();if(!o)return d.showToast(i("chat.singleChat.settings.toast.personaNameRequired"),"error");const g=a.currentUserPersonaId==="new",_={id:g?Date.now().toString():a.currentUserPersonaId,name:o,description:a.userPersonaDescInput,avatar:a.userPersonaAvatar,videoImg:a.userVideoImg,isDefault:s.userPersonas.length===0};if(g)s.userPersonas.push(_),a.currentUserPersonaId=_.id,d.showToast(i("chat.singleChat.settings.toast.personaSaved"));else{const S=s.userPersonas.findIndex(B=>B.id===a.currentUserPersonaId);S!==-1&&(_.isDefault=s.userPersonas[S].isDefault,s.userPersonas[S]=_,d.showToast(i("chat.singleChat.settings.toast.personaUpdated")))}s.saveData()},me=()=>{a.currentUserPersonaId!=="new"&&d.showConfirm(i("chat.singleChat.settings.toast.deletePersona"),i("chat.singleChat.settings.toast.confirmDeletePersona"),()=>{s.userPersonas=s.userPersonas.filter(o=>o.id!==a.currentUserPersonaId),s.characters.forEach(o=>{o.userPersona===a.currentUserPersonaId&&(o.userPersona="")}),a.currentUserPersonaId="new",F("new"),s.saveData()})},ve=o=>{if(!o)return;const g=s.bubblePresets.find(_=>_.id===o);g&&(a.bubbleCss=g.css,a.bubbleFontSize=g.fontSize)},be=()=>{const o=prompt(i("chat.singleChat.settings.toast.presetNameRequired"));if(!o)return;const g={id:Date.now().toString(),name:o,css:a.bubbleCss,fontSize:a.bubbleFontSize};s.bubblePresets.push(g),s.saveData(),a.currentBubblePresetId=g.id,d.showToast(i("chat.singleChat.settings.toast.presetSaved"))},Ce=()=>{a.currentBubblePresetId&&d.showConfirm(i("chat.singleChat.settings.toast.deleteBubblePreset"),i("chat.singleChat.settings.toast.confirmDeleteBubblePreset"),()=>{s.bubblePresets=s.bubblePresets.filter(o=>o.id!==a.currentBubblePresetId),s.saveData(),a.currentBubblePresetId="",d.showToast(i("chat.singleChat.settings.toast.presetDeleted"))})},_e=o=>{const g=o.content;switch(z.value){case"avatar":M.value&&(M.value.avatar=g);break;case"userPersonaAvatar":a.userPersonaAvatar=g;break;case"chatBg":a.chatBackground=g;break;case"videoBg":a.videoBg=g;break;case"userVideoImg":a.userVideoImg=g;break}},ye=o=>{const g=o.content,_=z.value,S={avatar:{obj:M.value,key:"avatar",toast:i("chat.singleChat.settings.toast.avatarUpdated")},chatBg:{obj:M.value,key:"chatBackground",toast:i("chat.singleChat.settings.toast.backgroundUpdated"),localKey:"chatBackground"},videoBg:{obj:M.value,key:"videoBg",toast:i("chat.singleChat.settings.toast.charImageUpdated"),localKey:"videoBg"},userPersonaAvatar:{obj:null,key:"userPersonaAvatar",toast:i("chat.singleChat.settings.toast.avatarUpdated")},userVideoImg:{obj:null,key:"userVideoImg",toast:i("chat.singleChat.settings.toast.userImageUpdated")}};if(S[_]){const B=S[_];B.obj?(B.obj[B.key]=g,B.localKey&&(a[B.localKey]=g)):(_==="userPersonaAvatar"&&(a.userPersonaAvatar=g),_==="userVideoImg"&&(a.userVideoImg=g)),s.saveData(),d.showToast(B.toast)}V.value=!1},fe=()=>{if(!a.chatBackground)return d.showToast(i("chat.singleChat.settings.toast.noBgToApply"));d.showConfirm(i("chat.singleChat.settings.toast.applyBgToAll"),i("chat.singleChat.settings.toast.confirmApplyBgToAll"),()=>{s.applyChatBackgroundToAll(a.chatBackground),d.showToast(i("chat.singleChat.settings.toast.appliedToAll"))})},ke=()=>{if(!a.chatBackground){d.showToast("当前没有聊天背景");return}d.showConfirm("清除背景","你确定要清除当前背景吗？",()=>{a.chatBackground="",M.value&&(M.value.chatBackground="",s.saveData(),d.showToast("背景已清除"))})},Se=o=>{a.isOnline=o;const[g,_]=o?["10","50"]:["100","200"];a.replyLengthMin=g,a.replyLengthMax=_,M.value&&(M.value.isOnline=o,s.saveData(),d.showToast(`${i(o?"chat.singleChat.settings.online":"chat.singleChat.settings.offline")}模式已开启`,"success"))},$e=()=>{$.value=!0},we=()=>{$.value=!1,x.value=!0},Ie=async()=>{$.value=!1;const o=await s.summarizeMessages(y.id,{type:"recent"});d.showToast(o.message,o.success?"success":"error")},Pe=async()=>{const[o,g]=W.value.split("-").map(R=>R.trim()),_=parseInt(o,10),S=parseInt(g,10);if(isNaN(_)||isNaN(S)||_<=0||S<=0||_>S){d.showToast(i("chat.singleChat.settings.toast.invalidRange"),"error");return}const B=await s.summarizeMessages(y.id,{type:"range",start:_,end:S});d.showToast(B.message,B.success?"success":"error"),B.success&&(x.value=!1,W.value="")},Be=async()=>{$.value=!1;const o=await s.summarizeMessages(y.id,{type:"video"});d.showToast(o.message,o.success?"success":"error")},Ue=async o=>{const g=o==="char"?a.charLocationReal:a.userLocationReal,_=o==="char"?a.charLocationVirtual:a.userLocationVirtual,S=await m(g,_);S&&(o==="char"?(a.charLocationData=S,a.charLocationDisplay=S.shortDisplay):(a.userLocationData=S,a.userLocationDisplay=S.shortDisplay),d.showToast("位置和天气信息已更新","success"))},xe=o=>{const g=a.linkedNpcs.indexOf(o);g>-1?a.linkedNpcs.splice(g,1):a.linkedNpcs.push(o),a.npcCount=a.linkedNpcs.length},Le=o=>{const g=a.linkedCharacters.indexOf(o);g>-1?a.linkedCharacters.splice(g,1):a.linkedCharacters.push(o),a.linkedCharCount=a.linkedCharacters.length},Me=()=>{a.isBlocked?(a.isBlocked=!1,q(),d.showToast(i("chat.singleChat.settings.toast.unblocked"))):d.showConfirm(i("chat.singleChat.settings.confirmBlockTitle",{name:E.value}),i("chat.singleChat.settings.confirmBlockMsg",{name:E.value}),()=>{a.isBlocked=!0,q(),d.showToast(i("chat.singleChat.settings.toast.blocked"))},{messageStyle:{color:"#FF3B30",whiteSpace:"pre-wrap"},confirmText:"chat.singleChat.settings.block"})},De=()=>{d.showConfirm(i("chat.singleChat.settings.confirmClearTitle"),i("chat.singleChat.settings.confirmClearMsg",{name:E.value}),()=>{s.clearChatHistory(y.id),d.showToast(i("chat.singleChat.settings.toast.historyCleared")),a.msgCount=0,a.tokenCount=0},{messageStyle:{whiteSpace:"pre-wrap",color:"#FF3B30"},confirmText:"chat.singleChat.settings.clear"})},Ve=()=>{d.showConfirm(i("chat.deleteCharacterTitle"),i("chat.deleteCharacterConfirm",{name:E.value}),()=>{s.deleteCharacter(y.id),d.showToast(i("chat.toast.deleteSuccess"),"success"),n.back(),n.push({name:"chat-list"})},{messageStyle:{whiteSpace:"pre-wrap",color:"#FF3B30"},confirmText:"delete"})},Ae=()=>{const o=M.value;if(!o)return;a.charNameInput=o.name,a.charNicknameInput=o.nickname||"",a.charPersonaInput=o.charPersona||"";const g=s.userPersonas.find(K=>K.id===o.userPersona);a.currentUserPersonaId=g?g.id:"new",F(a.currentUserPersonaId),a.backgroundActivityOverride=o.backgroundActivityOverride||"default",a.proactiveInterval=o.proactiveInterval||5,a.proactiveCooldown=o.proactiveCooldown||30,a.proactiveDailyLimit=o.proactiveDailyLimit||10,a.triggerMode=o.triggerMode||"always",a.proactiveIdleTime=o.proactiveIdleTime||15,a.isOnline=o.isOnline!==!1,a.preset=Array.isArray(o.preset)?o.preset:o.preset?[o.preset]:[],a.worldbook=o.worldbook||[];const[_,S]=(o.replyLength||(a.isOnline?"10-50":"100-200")).split("-");a.replyLengthMin=_||"",a.replyLengthMax=S||"";const B=o.realtimeSettings||{timeEnabled:!1,weatherEnabled:!1,charLocation:{},userLocation:{}};a.realtimeTimeEnabled=B.timeEnabled,a.realtimeWeatherEnabled=B.weatherEnabled,a.charLocationData=B.charLocation||{},a.userLocationData=B.userLocation||{},a.charLocationReal=a.charLocationData.real||"",a.charLocationVirtual=a.charLocationData.virtual||"",a.charLocationDisplay=a.charLocationData.shortDisplay||"",a.userLocationReal=a.userLocationData.real||"",a.userLocationVirtual=a.userLocationData.virtual||"",a.userLocationDisplay=a.userLocationData.shortDisplay||"",a.summaryRange=o.summaryRange||20,a.summaryPrompt=o.summaryPrompt||"",a.autoSummary=o.autoSummary||!1,a.memoryCount=o.memoryCount||10;const R=o.bubbleSettings||{};a.bubbleCss=R.css||"",a.bubbleFontSize=R.fontSize||14,a.chatBackground=o.chatBackground||"",a.videoBg=o.videoBg||"",a.userVideoImg=o.userVideoImg||"",a.apiConfig=o.api||"default",a.linkedNpcs=o.linkedNpcs||[],a.npcCount=a.linkedNpcs.length,a.linkedCharacters=o.linkedCharacters||[],a.linkedCharCount=a.linkedCharacters.length,a.isBlocked=o.isBlocked||!1;const G=s.messages[y.id]||[];a.msgCount=G.length,a.tokenCount=Math.ceil(G.reduce((K,Te)=>{var J;return K+(((J=Te.content)==null?void 0:J.length)||0)},0)*1.5)},q=()=>{const o=M.value;if(!o)return;const g=a.currentUserPersonaId;let _=s.userPersonas.find(S=>S.id===g);g==="default"&&(_||(_={id:"default",name:i("chat.singleChat.settings.defaultUserPersona"),avatar:"",description:"",videoImg:""},s.userPersonas.unshift(_))),_&&(_.id!=="default"&&a.userPersonaNameInput.trim()&&(_.name=a.userPersonaNameInput.trim()),_.description=a.userPersonaDescInput,_.avatar=a.userPersonaAvatar,_.videoImg=a.userVideoImg),a.charLocationData.real=a.charLocationReal,a.charLocationData.virtual=a.charLocationVirtual,a.userLocationData.real=a.userLocationReal,a.userLocationData.virtual=a.userLocationVirtual,Object.assign(o,{name:a.charNameInput.trim()||o.name,nickname:a.charNicknameInput.trim(),charPersona:a.charPersonaInput,userPersona:a.currentUserPersonaId,backgroundActivityOverride:a.backgroundActivityOverride,proactiveInterval:a.proactiveInterval,proactiveCooldown:a.proactiveCooldown,proactiveDailyLimit:a.proactiveDailyLimit,triggerMode:a.triggerMode,proactiveIdleTime:a.proactiveIdleTime,isOnline:a.isOnline,preset:a.preset,worldbook:a.worldbook,replyLength:`${a.replyLengthMin}-${a.replyLengthMax}`,realtimeSettings:{timeEnabled:a.realtimeTimeEnabled,weatherEnabled:a.realtimeWeatherEnabled,charLocation:a.charLocationData,userLocation:a.userLocationData},summaryRange:a.summaryRange,summaryPrompt:a.summaryPrompt,autoSummary:a.autoSummary,memoryCount:a.memoryCount,bubbleSettings:{css:a.bubbleCss,fontSize:a.bubbleFontSize},chatBackground:a.chatBackground,videoBg:a.videoBg,linkedNpcs:a.linkedNpcs,linkedCharacters:a.linkedCharacters,isBlocked:a.isBlocked}),s.saveData(),d.showToast(i("theme.toast.saveSuccess"))};return Y(()=>a.currentUserPersonaId,o=>{o&&F(o)}),Y(()=>a.currentBubblePresetId,o=>{o&&ve(o)}),{t:i,singleStore:s,themeStore:d,backgroundStore:k,sortedWorldBooks:r,sortedPresets:u,collapsedStates:f,showImageUploadModal:V,currentUploadTarget:z,showSummaryModal:$,showRangeInputModal:x,summaryRangeInput:W,showNpcScopeModal:ne,showCharScopeModal:oe,formState:a,character:M,charName:E,charAvatar:ie,userPersonaOptions:le,apiConfigOptions:re,bubblePresetOptions:ce,availableCharacters:de,isBackgroundActivityEffective:ue,previewStyle:ge,uploadModalTitle:pe,loadSettings:Ae,saveSettings:q,saveUserPersona:he,deleteUserPersona:me,saveBubblePreset:be,deleteBubblePreset:Ce,handleImagePreview:_e,handleImageUploadConfirm:ye,applyBgToAll:fe,clearChatBackground:ke,setMode:Se,triggerManualSummary:$e,openRangeInputModal:we,handleSummarizeRecent:Ie,handleSummarizeRange:Pe,handleSummarizeVideo:Be,mapLocation:Ue,toggleNpcScope:xe,toggleCharScope:Le,handleBlockOrUnblock:Me,handleClearHistory:De,handleDeleteCharacter:Ve}}const Ze={class:"card"},Ge={key:"roleInfo"},Je={class:"card-content"},Qe={class:"role-header-layout"},Xe=["src"],Ye={key:1,class:"role-avatar-placeholder"},et={class:"role-inputs-wrapper"},tt=["placeholder"],st=["placeholder"],at={class:"form-item-vertical"},nt={class:"label-main",style:{"margin-bottom":"5px"}},ot=["placeholder"],it={__name:"SettingsCharCard",props:{settings:{type:Object,required:!0}},setup(y){const i=y,{t:n,collapsedStates:s,formState:d,charAvatar:k,currentUploadTarget:c,showImageUploadModal:r}=i.settings,C=i.settings.collapsedStates.roleInfo,u=()=>{i.settings.collapsedStates.roleInfo=!i.settings.collapsedStates.roleInfo},b=()=>{i.settings.currentUploadTarget.value="avatar",i.settings.showImageUploadModal.value=!0};return(m,f)=>(h(),p("div",Ze,[t("div",{class:"card-title",onClick:u},[t("span",null,l(e(n)("chat.singleChat.settings.roleInfo")),1),t("div",{class:w(["collapse-arrow",{collapsed:e(C)}])},[v(N,{name:"chevron-down"})],2)]),v(T,{name:"collapse"},{default:U(()=>[e(C)?L("",!0):(h(),p("div",Ge,[t("div",Je,[t("div",Qe,[t("div",{class:"role-avatar-wrapper",onClick:b},[e(k)?(h(),p("img",{key:0,src:e(k),alt:"头像",class:"role-avatar-img"},null,8,Xe)):(h(),p("div",Ye,l(e(n)("chat.singleChat.settings.uploadAvatar")),1))]),t("div",et,[I(t("input",{type:"text","onUpdate:modelValue":f[0]||(f[0]=V=>e(d).charNameInput=V),class:"base-input",placeholder:e(n)("chat.singleChat.settings.roleNamePlaceholder")},null,8,tt),[[P,e(d).charNameInput]]),I(t("input",{type:"text","onUpdate:modelValue":f[1]||(f[1]=V=>e(d).charNicknameInput=V),class:"base-input",placeholder:e(n)("chat.singleChat.settings.roleNicknamePlaceholder")},null,8,st),[[P,e(d).charNicknameInput]])])]),t("div",at,[t("div",nt,l(e(n)("chat.singleChat.settings.rolePersona")),1),I(t("textarea",{"onUpdate:modelValue":f[2]||(f[2]=V=>e(d).charPersonaInput=V),class:"base-input",style:{height:"80px","min-height":"40px"},placeholder:e(n)("chat.singleChat.settings.rolePersonaPlaceholder")},null,8,ot),[[P,e(d).charPersonaInput]])])])]))]),_:1})]))}},lt=D(it,[["__scopeId","data-v-53de1d1b"]]),rt={class:"card"},ct={key:"userInfo"},dt={class:"card-content"},ut={class:"settings-pure-item",style:{"border-bottom":"none"}},gt={class:"settings-pure-label"},pt={class:"user-header-layout"},ht=["src"],mt={key:1,class:"role-avatar-placeholder"},vt={class:"user-inputs-wrapper"},bt={class:"user-actions-row"},Ct=["placeholder"],_t={class:"form-item-vertical"},yt={class:"label-main",style:{"margin-bottom":"5px"}},ft=["placeholder"],kt={__name:"SettingsUserCard",props:{settings:{type:Object,required:!0}},setup(y){const i=y,{t:n,formState:s,userPersonaOptions:d,saveUserPersona:k,deleteUserPersona:c}=i.settings,r=i.settings.collapsedStates.userInfo,C=()=>{i.settings.collapsedStates.userInfo=!i.settings.collapsedStates.userInfo},u=()=>{i.settings.currentUploadTarget.value="userPersonaAvatar",i.settings.showImageUploadModal.value=!0};return(b,m)=>(h(),p("div",rt,[t("div",{class:"card-title",onClick:C},[t("span",null,l(e(n)("chat.singleChat.settings.userInfo")),1),t("div",{class:w(["collapse-arrow",{collapsed:e(r)}])},[v(N,{name:"chevron-down"})],2)]),v(T,{name:"collapse"},{default:U(()=>[e(r)?L("",!0):(h(),p("div",ct,[t("div",dt,[t("div",ut,[t("div",gt,l(e(n)("chat.singleChat.settings.currentUserPersona")),1),v(Z,{options:e(d),modelValue:e(s).currentUserPersonaId,"onUpdate:modelValue":m[0]||(m[0]=f=>e(s).currentUserPersonaId=f)},null,8,["options","modelValue"])]),t("div",pt,[t("div",{class:"user-avatar-wrapper",onClick:u},[e(s).userPersonaAvatar?(h(),p("img",{key:0,src:e(s).userPersonaAvatar,alt:"User",class:"role-avatar-img"},null,8,ht)):(h(),p("div",mt,l(e(n)("chat.singleChat.settings.uploadAvatar")),1))]),t("div",vt,[t("div",bt,[t("button",{class:"btn btn-secondary btn-mini-grow",onClick:m[1]||(m[1]=(...f)=>e(k)&&e(k)(...f))},l(e(n)("chat.singleChat.settings.savePersona")),1),t("button",{class:"btn btn-danger btn-mini-grow",onClick:m[2]||(m[2]=(...f)=>e(c)&&e(c)(...f))},l(e(n)("chat.singleChat.settings.deletePersona")),1)]),I(t("input",{type:"text","onUpdate:modelValue":m[3]||(m[3]=f=>e(s).userPersonaNameInput=f),class:"base-input",placeholder:e(n)("chat.singleChat.settings.userNamePlaceholder")},null,8,Ct),[[P,e(s).userPersonaNameInput]])])]),t("div",_t,[t("div",yt,l(e(n)("chat.singleChat.settings.userPersona")),1),I(t("textarea",{"onUpdate:modelValue":m[4]||(m[4]=f=>e(s).userPersonaDescInput=f),class:"base-input",style:{height:"80px","min-height":"40px"},placeholder:e(n)("chat.singleChat.settings.userPersonaPlaceholder")},null,8,ft),[[P,e(s).userPersonaDescInput]])])])]))]),_:1})]))}},St=D(kt,[["__scopeId","data-v-98de39d8"]]),$t={class:"card"},wt={class:"card-title-remark"},It={key:"backgroundActivity"},Pt={class:"card-content"},Bt={class:"settings-item-input"},Ut={class:"label-col"},xt={class:"label-main"},Lt={class:"settings-pure-value"},Mt={class:"settings-item-input"},Dt={class:"label-col"},Vt={class:"label-main"},At={class:"label-sub"},Tt={class:"mode-selector"},Nt={key:0},Rt={class:"settings-item-input"},Ot={class:"label-col"},zt={class:"label-main"},Et={class:"label-sub"},jt={class:"settings-item-input"},Wt={class:"label-col"},Ft={class:"label-main"},qt={class:"label-sub"},Kt={class:"settings-item-input"},Ht={class:"label-col"},Zt={class:"label-main"},Gt={class:"label-sub"},Jt={class:"settings-item-input"},Qt={class:"label-col"},Xt={class:"label-main"},Yt={class:"label-sub"},es={class:"mode-selector"},ts={key:0,class:"settings-item-input"},ss={class:"label-col"},as={class:"label-main"},ns={class:"label-sub"},os={__name:"SettingsBackgroundCard",props:{settings:{type:Object,required:!0}},setup(y){const i=y,{t:n,formState:s,backgroundStore:d,isBackgroundActivityEffective:k}=i.settings,c=i.settings.collapsedStates.backgroundActivity,r=()=>{i.settings.collapsedStates.backgroundActivity=!i.settings.collapsedStates.backgroundActivity};return(C,u)=>(h(),p("div",$t,[t("div",{class:"card-title",onClick:r},[t("span",null,l(e(n)("chat.singleChat.settings.backgroundActivity")),1),t("div",{class:w(["collapse-arrow",{collapsed:e(c)}])},[v(N,{name:"chevron-down"})],2)]),t("div",wt,l(e(n)("chat.singleChat.settings.backgroundActivityWarning")),1),v(T,{name:"collapse"},{default:U(()=>[e(c)?L("",!0):(h(),p("div",It,[t("div",Pt,[t("div",Bt,[t("div",Ut,[t("div",xt,l(e(n)("chat.singleChat.settings.globalSettings")),1)]),t("div",Lt,l(e(d).globalBackgroundActivity?e(n)("chat.singleChat.settings.globalOn"):e(n)("chat.singleChat.settings.globalOff")),1)]),t("div",Mt,[t("div",Dt,[t("div",Vt,l(e(n)("chat.singleChat.settings.overrideGlobal")),1),t("div",At,l(e(n)("chat.singleChat.settings.overrideGlobalDesc")),1)]),t("div",Tt,[t("div",{class:w(["mode-option",{active:e(s).backgroundActivityOverride==="default"}]),onClick:u[0]||(u[0]=b=>e(s).backgroundActivityOverride="default")},l(e(n)("chat.singleChat.settings.default")),3),t("div",{class:w(["mode-option",{active:e(s).backgroundActivityOverride==="on"}]),onClick:u[1]||(u[1]=b=>e(s).backgroundActivityOverride="on")},l(e(n)("chat.singleChat.settings.on")),3),t("div",{class:w(["mode-option",{active:e(s).backgroundActivityOverride==="off"}]),onClick:u[2]||(u[2]=b=>e(s).backgroundActivityOverride="off")},l(e(n)("chat.singleChat.settings.off")),3)])]),e(k)?(h(),p("div",Nt,[t("div",Rt,[t("div",Ot,[t("div",zt,l(e(n)("chat.singleChat.settings.interval")),1),t("div",Et,l(e(n)("chat.singleChat.settings.intervalDesc")),1)]),I(t("input",{type:"number","onUpdate:modelValue":u[3]||(u[3]=b=>e(s).proactiveInterval=b),class:"base-input base-input-short",placeholder:"5"},null,512),[[P,e(s).proactiveInterval,void 0,{number:!0}]])]),t("div",jt,[t("div",Wt,[t("div",Ft,l(e(n)("chat.singleChat.settings.cooldown")),1),t("div",qt,l(e(n)("chat.singleChat.settings.cooldownDesc")),1)]),I(t("input",{type:"number","onUpdate:modelValue":u[4]||(u[4]=b=>e(s).proactiveCooldown=b),class:"base-input base-input-short",placeholder:"30"},null,512),[[P,e(s).proactiveCooldown,void 0,{number:!0}]])]),t("div",Kt,[t("div",Ht,[t("div",Zt,l(e(n)("chat.singleChat.settings.dailyLimit")),1),t("div",Gt,l(e(n)("chat.singleChat.settings.dailyLimitDesc")),1)]),I(t("input",{type:"number","onUpdate:modelValue":u[5]||(u[5]=b=>e(s).proactiveDailyLimit=b),class:"base-input base-input-short",placeholder:"10"},null,512),[[P,e(s).proactiveDailyLimit,void 0,{number:!0}]])]),t("div",Jt,[t("div",Qt,[t("div",Xt,l(e(n)("chat.singleChat.settings.triggerMode")),1),t("div",Yt,l(e(n)("chat.singleChat.settings.triggerModeDesc")),1)]),t("div",es,[t("div",{class:w(["mode-option",{active:e(s).triggerMode==="idle"}]),onClick:u[6]||(u[6]=b=>e(s).triggerMode="idle")},l(e(n)("chat.singleChat.settings.idleMode")),3),t("div",{class:w(["mode-option",{active:e(s).triggerMode==="always"}]),onClick:u[7]||(u[7]=b=>e(s).triggerMode="always")},l(e(n)("chat.singleChat.settings.alwaysMode")),3)])]),e(s).triggerMode==="idle"?(h(),p("div",ts,[t("div",ss,[t("div",as,l(e(n)("chat.singleChat.settings.idleTime")),1),t("div",ns,l(e(n)("chat.singleChat.settings.idleTimeDesc")),1)]),I(t("input",{type:"number","onUpdate:modelValue":u[8]||(u[8]=b=>e(s).proactiveIdleTime=b),class:"base-input base-input-short",placeholder:"15"},null,512),[[P,e(s).proactiveIdleTime,void 0,{number:!0}]])])):L("",!0)])):L("",!0)])]))]),_:1})]))}},is=D(os,[["__scopeId","data-v-b403a7a0"]]),ls={class:"card"},rs={key:"modeSettings"},cs={class:"card-content"},ds={class:"settings-pure-item"},us={class:"settings-pure-label"},gs={class:"mode-selector"},ps={key:0,class:"settings-pure-item"},hs={class:"settings-pure-label"},ms={class:"settings-pure-item"},vs={class:"settings-pure-label"},bs={class:"settings-item-input"},Cs={class:"label-col"},_s={class:"label-main"},ys={class:"label-sub"},fs={class:"reply-length-container"},ks=["placeholder"],Ss=["placeholder"],$s={__name:"SettingsModeCard",props:{settings:{type:Object,required:!0}},setup(y){const i=y,{t:n,formState:s,sortedPresets:d,sortedWorldBooks:k,setMode:c}=i.settings,r=i.settings.collapsedStates.modeSettings,C=()=>{i.settings.collapsedStates.modeSettings=!i.settings.collapsedStates.modeSettings};return(u,b)=>(h(),p("div",ls,[t("div",{class:"card-title",onClick:C},[t("span",null,l(e(n)("chat.singleChat.settings.mode")),1),t("div",{class:w(["collapse-arrow",{collapsed:e(r)}])},[v(N,{name:"chevron-down"})],2)]),v(T,{name:"collapse"},{default:U(()=>[e(r)?L("",!0):(h(),p("div",rs,[t("div",cs,[t("div",ds,[t("div",us,l(e(n)("chat.singleChat.settings.modeSelect")),1),t("div",gs,[t("div",{class:w(["mode-option",{active:e(s).isOnline}]),onClick:b[0]||(b[0]=m=>e(c)(!0))},l(e(n)("chat.singleChat.settings.online")),3),t("div",{class:w(["mode-option",{active:!e(s).isOnline}]),onClick:b[1]||(b[1]=m=>e(c)(!1))},l(e(n)("chat.singleChat.settings.offline")),3)])]),e(s).isOnline?L("",!0):(h(),p("div",ps,[t("div",hs,l(e(n)("chat.singleChat.settings.linkPreset")),1),v(ae,{modelValue:e(s).preset,"onUpdate:modelValue":b[2]||(b[2]=m=>e(s).preset=m),options:e(d),labelKey:"title",valueKey:"id",childrenKey:"entries",textAlign:"right",selectorWidth:"auto",dropdownWidth:"200px"},null,8,["modelValue","options"])])),t("div",ms,[t("div",vs,l(e(n)("chat.singleChat.settings.linkWorldbook")),1),v(ae,{modelValue:e(s).worldbook,"onUpdate:modelValue":b[3]||(b[3]=m=>e(s).worldbook=m),options:e(k),"label-key":"title","value-key":"id","children-key":"entries",textAlign:"right",selectorWidth:"auto",dropdownWidth:"200px"},null,8,["modelValue","options"])]),t("div",bs,[t("div",Cs,[t("div",_s,l(e(n)("chat.singleChat.settings.replyLength")),1),t("div",ys,l(e(n)("chat.singleChat.settings.replyLengthDesc")),1)]),t("div",fs,[I(t("input",{type:"number","onUpdate:modelValue":b[4]||(b[4]=m=>e(s).replyLengthMin=m),class:"base-input base-input-mini",placeholder:e(n)("chat.singleChat.settings.min")},null,8,ks),[[P,e(s).replyLengthMin]]),b[6]||(b[6]=t("span",null,"-",-1)),I(t("input",{type:"number","onUpdate:modelValue":b[5]||(b[5]=m=>e(s).replyLengthMax=m),class:"base-input base-input-mini",placeholder:e(n)("chat.singleChat.settings.max")},null,8,Ss),[[P,e(s).replyLengthMax]])])])])]))]),_:1})]))}},ws=D($s,[["__scopeId","data-v-90f65bd2"]]),Is={class:"card"},Ps={key:"realtimeSense"},Bs={class:"card-content"},Us={class:"settings-item-input"},xs={class:"settings-item-input"},Ls={key:0},Ms={class:"form-item-vertical"},Ds={class:"location-input-group"},Vs={class:"location-display"},As={class:"form-item-vertical"},Ts={class:"location-input-group"},Ns={class:"location-display"},Rs={__name:"SettingsRealtimeCard",props:{settings:{type:Object,required:!0}},setup(y){const i=y,{formState:n,mapLocation:s}=i.settings,d=i.settings.collapsedStates.realtimeSense,k=()=>{i.settings.collapsedStates.realtimeSense=!i.settings.collapsedStates.realtimeSense};return(c,r)=>(h(),p("div",Is,[t("div",{class:"card-title",onClick:k},[r[8]||(r[8]=t("span",null,"实时感知",-1)),t("div",{class:w(["collapse-arrow",{collapsed:e(d)}])},[v(N,{name:"chevron-down"})],2)]),v(T,{name:"collapse"},{default:U(()=>[e(d)?L("",!0):(h(),p("div",Ps,[t("div",Bs,[t("div",Us,[r[9]||(r[9]=t("div",{class:"label-col"},[t("div",{class:"label-main"},"实时时间")],-1)),t("div",{class:w(["toggle-switch",{active:e(n).realtimeTimeEnabled}]),onClick:r[0]||(r[0]=C=>e(n).realtimeTimeEnabled=!e(n).realtimeTimeEnabled)},null,2)]),t("div",xs,[r[10]||(r[10]=t("div",{class:"label-col"},[t("div",{class:"label-main"},"实时天气")],-1)),t("div",{class:w(["toggle-switch",{active:e(n).realtimeWeatherEnabled}]),onClick:r[1]||(r[1]=C=>e(n).realtimeWeatherEnabled=!e(n).realtimeWeatherEnabled)},null,2)]),v(T,{name:"collapse"},{default:U(()=>[e(n).realtimeWeatherEnabled?(h(),p("div",Ls,[t("div",Ms,[r[11]||(r[11]=t("div",{class:"label-main",style:{"margin-bottom":"5px"}},"角色所在地",-1)),t("div",Ds,[I(t("input",{type:"text","onUpdate:modelValue":r[2]||(r[2]=C=>e(n).charLocationReal=C),class:"base-input",placeholder:"真实地名"},null,512),[[P,e(n).charLocationReal]]),I(t("input",{type:"text","onUpdate:modelValue":r[3]||(r[3]=C=>e(n).charLocationVirtual=C),class:"base-input",placeholder:"虚拟地名 (可选)"},null,512),[[P,e(n).charLocationVirtual]]),t("button",{class:"btn btn-secondary btn-sm",onClick:r[4]||(r[4]=C=>e(s)("char"))},"确定")]),t("div",Vs,l(e(n).charLocationDisplay),1)]),t("div",As,[r[12]||(r[12]=t("div",{class:"label-main",style:{"margin-bottom":"5px"}},"用户所在地",-1)),t("div",Ts,[I(t("input",{type:"text","onUpdate:modelValue":r[5]||(r[5]=C=>e(n).userLocationReal=C),class:"base-input",placeholder:"真实地名"},null,512),[[P,e(n).userLocationReal]]),I(t("input",{type:"text","onUpdate:modelValue":r[6]||(r[6]=C=>e(n).userLocationVirtual=C),class:"base-input",placeholder:"虚拟地名 (可选)"},null,512),[[P,e(n).userLocationVirtual]]),t("button",{class:"btn btn-secondary btn-sm",onClick:r[7]||(r[7]=C=>e(s)("user"))},"确定")]),t("div",Ns,l(e(n).userLocationDisplay),1)])])):L("",!0)]),_:1})])]))]),_:1})]))}},Os=D(Rs,[["__scopeId","data-v-e834be78"]]),zs={class:"card"},Es={key:"summarySettings"},js={class:"card-content"},Ws={class:"settings-item-input"},Fs={class:"label-col"},qs={class:"label-main"},Ks={class:"label-sub"},Hs={class:"form-item-vertical"},Zs={class:"label-main",style:{"margin-bottom":"5px"}},Gs=["placeholder"],Js={class:"settings-item-input"},Qs={class:"label-col"},Xs={class:"label-main"},Ys={class:"label-sub"},ea={class:"settings-btn-row flex-distribute-children",style:{padding:"15px 0","border-bottom":"1px solid #f5f5f5"}},ta={class:"settings-item-input"},sa={class:"label-col"},aa={class:"label-main"},na={class:"label-sub"},oa={class:"settings-pure-item"},ia={class:"settings-pure-label"},la={class:"settings-pure-item"},ra={class:"settings-pure-label"},ca={class:"settings-pure-value"},da={class:"settings-pure-item"},ua={class:"settings-pure-label"},ga={class:"settings-pure-value"},pa={__name:"SettingsSummaryCard",props:{settings:{type:Object,required:!0},charId:{type:String,required:!0}},setup(y){const i=y,{t:n,formState:s,apiConfigOptions:d,triggerManualSummary:k}=i.settings,c=H(),r=i.settings.collapsedStates.summarySettings,C=()=>{i.settings.collapsedStates.summarySettings=!i.settings.collapsedStates.summarySettings},u=()=>{c.push({name:"memory-bank",params:{charId:i.charId}})};return(b,m)=>(h(),p("div",zs,[t("div",{class:"card-title",onClick:C},[t("span",null,l(e(n)("chat.singleChat.settings.summary")),1),t("div",{class:w(["collapse-arrow",{collapsed:e(r)}])},[v(N,{name:"chevron-down"})],2)]),v(T,{name:"collapse"},{default:U(()=>[e(r)?L("",!0):(h(),p("div",Es,[t("div",js,[t("div",Ws,[t("div",Fs,[t("div",qs,l(e(n)("chat.singleChat.settings.summaryRange")),1),t("div",Ks,l(e(n)("chat.singleChat.settings.summaryRangeDesc")),1)]),I(t("input",{type:"number","onUpdate:modelValue":m[0]||(m[0]=f=>e(s).summaryRange=f),class:"base-input base-input-short",placeholder:"20"},null,512),[[P,e(s).summaryRange,void 0,{number:!0}]])]),t("div",Hs,[t("div",Zs,l(e(n)("chat.singleChat.settings.summaryPrompt")),1),I(t("textarea",{"onUpdate:modelValue":m[1]||(m[1]=f=>e(s).summaryPrompt=f),class:"base-input",style:{height:"80px","min-height":"40px"},placeholder:e(n)("chat.singleChat.settings.summaryPromptPlaceholder")},null,8,Gs),[[P,e(s).summaryPrompt]])]),t("div",Js,[t("div",Qs,[t("div",Xs,l(e(n)("chat.singleChat.settings.autoSummary")),1),t("div",Ys,l(e(n)("chat.singleChat.settings.autoSummaryDesc")),1)]),t("div",{class:w(["toggle-switch",{active:e(s).autoSummary}]),onClick:m[2]||(m[2]=f=>e(s).autoSummary=!e(s).autoSummary)},null,2)]),t("div",ea,[t("button",{class:"btn btn-secondary",onClick:m[3]||(m[3]=(...f)=>e(k)&&e(k)(...f))},l(e(n)("chat.singleChat.settings.manualSummary")),1),t("button",{class:"btn btn-secondary",onClick:u},l(e(n)("chat.singleChat.settings.viewSummary")),1)]),t("div",ta,[t("div",sa,[t("div",aa,l(e(n)("chat.singleChat.settings.contextMemory")),1),t("div",na,l(e(n)("chat.singleChat.settings.contextMemoryDesc")),1)]),I(t("input",{type:"number","onUpdate:modelValue":m[4]||(m[4]=f=>e(s).memoryCount=f),class:"base-input base-input-short",placeholder:"10"},null,512),[[P,e(s).memoryCount,void 0,{number:!0}]])]),t("div",oa,[t("div",ia,l(e(n)("chat.singleChat.settings.apiConfig")),1),v(Z,{options:e(d),modelValue:e(s).apiConfig,"onUpdate:modelValue":m[5]||(m[5]=f=>e(s).apiConfig=f)},null,8,["options","modelValue"])]),t("div",la,[t("div",ra,l(e(n)("chat.singleChat.settings.tokenCount")),1),t("div",ca,l(e(s).tokenCount),1)]),t("div",da,[t("div",ua,l(e(n)("chat.singleChat.settings.msgCount")),1),t("div",ga,l(e(s).msgCount),1)])])]))]),_:1})]))}},ha=D(pa,[["__scopeId","data-v-38c359f5"]]),ma={class:"card"},va={key:"bubbleSettings"},ba={class:"card-content"},Ca={class:"settings-section-title"},_a={class:"settings-row-group"},ya={class:"settings-pure-label",style:{width:"60px"}},fa={style:{flex:"1",margin:"0 10px"}},ka={class:"btn-group-mini"},Sa=["disabled"],$a={class:"bubble-preview-container"},wa={class:"bubble-preview-area"},Ia={class:"preview-msg-row left"},Pa={class:"preview-avatar char"},Ba=["src"],Ua={key:1,class:"default-avatar"},xa={class:"preview-msg-row right"},La={class:"preview-avatar user"},Ma=["src"],Da={key:1,class:"default-avatar"},Va={class:"settings-item-input"},Aa={class:"label-col"},Ta={class:"label-main"},Na={class:"slider-container gray-slider"},Ra={class:"slider-value"},Oa={class:"form-item-vertical no-border"},za={class:"label-main",style:{"margin-bottom":"5px"}},Ea=["placeholder"],ja={class:"settings-section-title"},Wa={class:"settings-item-avatar",style:{"border-bottom":"none","margin-bottom":"0"}},Fa={class:"avatar-layout"},qa={class:"avatar-controls",style:{width:"100%"}},Ka={__name:"SettingsBeautifyCard",props:{settings:{type:Object,required:!0}},setup(y){const i=y,{t:n,formState:s,charAvatar:d,bubblePresetOptions:k,previewStyle:c,saveBubblePreset:r,deleteBubblePreset:C,applyBgToAll:u,clearChatBackground:b}=i.settings,m=i.settings.collapsedStates.bubbleSettings,f=()=>{i.settings.collapsedStates.bubbleSettings=!i.settings.collapsedStates.bubbleSettings},V=()=>{i.settings.currentUploadTarget.value="chatBg",i.settings.showImageUploadModal.value=!0};return(z,$)=>(h(),p("div",ma,[t("div",{class:"card-title",onClick:f},[t("span",null,l(e(n)("chat.singleChat.settings.beautification")),1),t("div",{class:w(["collapse-arrow",{collapsed:e(m)}])},[v(N,{name:"chevron-down"})],2)]),v(T,{name:"collapse"},{default:U(()=>[e(m)?L("",!0):(h(),p("div",va,[t("div",ba,[t("div",Ca,l(e(n)("chat.singleChat.settings.bubble")),1),t("div",_a,[t("div",ya,l(e(n)("chat.singleChat.settings.bubblePreset")),1),t("div",fa,[v(Z,{options:e(k),modelValue:e(s).currentBubblePresetId,"onUpdate:modelValue":$[0]||($[0]=x=>e(s).currentBubblePresetId=x)},null,8,["options","modelValue"])]),t("div",ka,[t("button",{class:"btn btn-secondary btn-mini",onClick:$[1]||($[1]=(...x)=>e(r)&&e(r)(...x))},l(e(n)("save")),1),t("button",{class:"btn btn-danger btn-mini",disabled:!e(s).currentBubblePresetId,onClick:$[2]||($[2]=(...x)=>e(C)&&e(C)(...x))},l(e(n)("delete")),9,Sa)])]),t("div",$a,[t("div",wa,[t("div",Ia,[t("div",Pa,[e(d)?(h(),p("img",{key:0,src:e(d),style:{width:"100%",height:"100%","object-fit":"cover"}},null,8,Ba)):(h(),p("div",Ua))]),t("div",{class:"preview-bubble char",style:ee(e(c))},l(e(n)("chat.singleChat.settings.bubblePreview")),5)]),t("div",xa,[t("div",{class:"preview-bubble user",style:ee(e(c))},l(e(n)("chat.singleChat.settings.bubblePreview")),5),t("div",La,[e(s).userPersonaAvatar?(h(),p("img",{key:0,src:e(s).userPersonaAvatar,style:{width:"100%",height:"100%","object-fit":"cover"}},null,8,Ma)):(h(),p("div",Da))])])])]),t("div",Va,[t("div",Aa,[t("div",Ta,l(e(n)("chat.singleChat.settings.fontSize")),1)]),t("div",Na,[I(t("input",{type:"range","onUpdate:modelValue":$[3]||($[3]=x=>e(s).bubbleFontSize=x),min:"10",max:"30",step:"1"},null,512),[[P,e(s).bubbleFontSize,void 0,{number:!0}]]),t("span",Ra,l(e(s).bubbleFontSize),1)])]),t("div",Oa,[t("div",za,l(e(n)("chat.singleChat.settings.bubbleCss")),1),I(t("textarea",{"onUpdate:modelValue":$[4]||($[4]=x=>e(s).bubbleCss=x),class:"base-input",placeholder:e(n)("chat.singleChat.settings.cssPlaceholder"),style:{"font-family":"monospace",height:"120px"}},null,8,Ea),[[P,e(s).bubbleCss]])]),$[7]||($[7]=t("div",{class:"settings-divider"},null,-1)),t("div",ja,l(e(n)("chat.singleChat.settings.chatBackground")),1),t("div",Wa,[t("div",Fa,[t("div",qa,[t("button",{class:"btn btn-secondary",onClick:V},l(e(n)("chat.singleChat.settings.setChatBackground")),1),t("button",{class:"btn btn-secondary",onClick:$[5]||($[5]=(...x)=>e(u)&&e(u)(...x)),style:{"margin-top":"5px"}},l(e(n)("chat.singleChat.settings.applyToAll")),1),t("button",{class:"btn btn-danger",onClick:$[6]||($[6]=(...x)=>e(b)&&e(b)(...x)),style:{"margin-top":"5px"}},"清除当前背景")])])])])]))]),_:1})]))}},Ha=D(Ka,[["__scopeId","data-v-dbff836e"]]),Za={class:"card"},Ga={key:"videoSettings"},Ja={class:"card-content"},Qa={class:"video-settings-container"},Xa={class:"video-setting-col"},Ya={class:"settings-item-label center"},en=["src"],tn={key:1,class:"default-avatar bg-placeholder"},sn={class:"video-setting-col"},an={class:"settings-item-label center"},nn=["src"],on={key:1,class:"default-avatar bg-placeholder"},ln={__name:"SettingsVideoCard",props:{settings:{type:Object,required:!0}},setup(y){const i=y,{t:n,formState:s}=i.settings,d=i.settings.collapsedStates.videoSettings,k=()=>{i.settings.collapsedStates.videoSettings=!i.settings.collapsedStates.videoSettings},c=()=>{i.settings.currentUploadTarget.value="videoBg",i.settings.showImageUploadModal.value=!0},r=()=>{i.settings.currentUploadTarget.value="userVideoImg",i.settings.showImageUploadModal.value=!0};return(C,u)=>(h(),p("div",Za,[t("div",{class:"card-title",onClick:k},[t("span",null,l(e(n)("chat.singleChat.settings.videoCall")),1),t("div",{class:w(["collapse-arrow",{collapsed:e(d)}])},[v(N,{name:"chevron-down"})],2)]),v(T,{name:"collapse"},{default:U(()=>[e(d)?L("",!0):(h(),p("div",Ga,[t("div",Ja,[t("div",Qa,[t("div",Xa,[t("div",Ya,l(e(n)("chat.singleChat.settings.characterImage")),1),t("div",{class:"video-preview",onClick:c},[e(s).videoBg?(h(),p("img",{key:0,src:e(s).videoBg,class:"bg-img"},null,8,en)):(h(),p("div",tn,l(e(n)("chat.singleChat.settings.setImage")),1))])]),t("div",sn,[t("div",an,l(e(n)("chat.singleChat.settings.userImage")),1),t("div",{class:"video-preview",onClick:r},[e(s).userVideoImg?(h(),p("img",{key:0,src:e(s).userVideoImg,class:"bg-img"},null,8,nn)):(h(),p("div",on,l(e(n)("chat.singleChat.settings.setImage")),1))])])])])]))]),_:1})]))}},rn=D(ln,[["__scopeId","data-v-7b76e0ef"]]),cn={class:"card"},dn={key:"advancedSettings"},un={class:"card-content"},gn={class:"settings-pure-label"},pn={class:"settings-pure-value"},hn={class:"settings-pure-value"},mn={__name:"SettingsAdvancedCard",props:{settings:{type:Object,required:!0}},setup(y){const i=y,{t:n,formState:s,showNpcScopeModal:d,showCharScopeModal:k}=i.settings,c=i.settings.collapsedStates.advancedSettings,r=()=>{i.settings.collapsedStates.advancedSettings=!i.settings.collapsedStates.advancedSettings};return(C,u)=>(h(),p("div",cn,[t("div",{class:"card-title",onClick:r},[t("span",null,l(e(n)("chat.singleChat.settings.advanced")),1),t("div",{class:w(["collapse-arrow",{collapsed:e(c)}])},[v(N,{name:"chevron-down"})],2)]),v(T,{name:"collapse"},{default:U(()=>[e(c)?L("",!0):(h(),p("div",dn,[t("div",un,[t("div",{class:"settings-pure-item",onClick:u[0]||(u[0]=b=>e(d).value=!0)},[t("div",gn,l(e(n)("chat.singleChat.settings.linkedNpc")),1),t("div",pn,l(e(n)("chat.singleChat.settings.npcCount",{count:e(s).npcCount})),1),u[2]||(u[2]=t("div",{class:"settings-pure-arrow"},"›",-1))]),t("div",{class:"settings-pure-item",onClick:u[1]||(u[1]=b=>e(k).value=!0)},[u[3]||(u[3]=t("div",{class:"settings-pure-label"},"关联角色",-1)),t("div",hn,l(e(s).linkedCharCount)+"个",1),u[4]||(u[4]=t("div",{class:"settings-pure-arrow"},"›",-1))])])]))]),_:1})]))}},vn=D(mn,[["__scopeId","data-v-6bb7fdbe"]]),bn={class:"danger-zone"},Cn={class:"danger-btn-content"},_n={class:"danger-btn-title"},yn={class:"danger-btn-desc"},fn={class:"danger-btn-content"},kn={class:"danger-btn-title"},Sn={class:"danger-btn-desc"},$n={class:"danger-btn-content"},wn={class:"danger-btn-title"},In={class:"danger-btn-desc"},Pn={__name:"SettingsDangerZone",props:{settings:{type:Object,required:!0}},setup(y){const i=y,{t:n,formState:s,handleBlockOrUnblock:d,handleClearHistory:k,handleDeleteCharacter:c}=i.settings;return(r,C)=>(h(),p("div",bn,[t("button",{class:"btn btn-danger big-btn",onClick:C[0]||(C[0]=(...u)=>e(d)&&e(d)(...u))},[t("div",Cn,[t("div",_n,l(e(s).isBlocked?e(n)("chat.singleChat.settings.unblock"):e(n)("chat.singleChat.settings.blockCharacter")),1),t("div",yn,l(e(n)("chat.singleChat.settings.blockCharacterDesc")),1)])]),t("button",{class:"btn btn-danger big-btn",onClick:C[1]||(C[1]=(...u)=>e(k)&&e(k)(...u))},[t("div",fn,[t("div",kn,l(e(n)("chat.singleChat.settings.clearHistory")),1),t("div",Sn,l(e(n)("chat.singleChat.settings.clearHistoryDesc")),1)])]),t("button",{class:"btn btn-danger big-btn",onClick:C[2]||(C[2]=(...u)=>e(c)&&e(c)(...u))},[t("div",$n,[t("div",wn,l(e(n)("chat.deleteCharacterTitle")),1),t("div",In,l(e(n)("chat.deleteCharacterWarning")),1)])])]))}},Bn=D(Pn,[["__scopeId","data-v-81978127"]]),Un={class:"chat-settings active"},xn={class:"app-header"},Ln={class:"title"},Mn={class:"action-btn"},Dn={class:"app-content settings-content"},Vn={class:"modal-options centered-text"},An={class:"option-text"},Tn={class:"option-text"},Nn={class:"option-text"},Rn=["placeholder"],On={class:"scope-list",style:{"max-height":"300px","overflow-y":"auto"}},zn={key:0,class:"empty-state-mini"},En=["onClick"],jn={key:0,xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"3","stroke-linecap":"round","stroke-linejoin":"round"},Wn={class:"scope-name"},Fn={class:"scope-list",style:{"max-height":"300px","overflow-y":"auto"}},qn={key:0,class:"empty-state-mini"},Kn=["onClick"],Hn={key:0,xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"3","stroke-linecap":"round","stroke-linejoin":"round"},Zn={class:"scope-name"},Gn={__name:"SingleChatSettings",props:{id:{type:String,required:!0}},setup(y){const i=y,n=H(),s=He(i),d=()=>{n.back()};return qe(()=>{if(!s.character.value){d();return}s.loadSettings()}),(k,c)=>(h(),p("div",Un,[t("div",xn,[t("div",{class:"back-btn",onClick:d},[...c[15]||(c[15]=[t("svg",{class:"svg-icon",viewBox:"0 0 24 24"},[t("polyline",{points:"15 18 9 12 15 6"})],-1)])]),t("div",Ln,l(e(s).t("chat.singleChat.settings.title")),1),t("div",Mn,[t("button",{class:"header-save-btn",onClick:c[0]||(c[0]=(...r)=>e(s).saveSettings&&e(s).saveSettings(...r))},l(e(s).t("save")),1)])]),t("div",Dn,[v(lt,{settings:e(s)},null,8,["settings"]),v(St,{settings:e(s)},null,8,["settings"]),v(is,{settings:e(s)},null,8,["settings"]),v(ws,{settings:e(s)},null,8,["settings"]),v(Os,{settings:e(s)},null,8,["settings"]),v(ha,{settings:e(s),charId:y.id},null,8,["settings","charId"]),v(Ha,{settings:e(s)},null,8,["settings"]),v(rn,{settings:e(s)},null,8,["settings"]),v(vn,{settings:e(s)},null,8,["settings"]),v(Bn,{settings:e(s)},null,8,["settings"])]),v(Ke,{visible:e(s).showImageUploadModal.value,"onUpdate:visible":c[1]||(c[1]=r=>e(s).showImageUploadModal.value=r),type:"basic","biz-type":e(s).currentUploadTarget.value,title:e(s).uploadModalTitle.value,onPreviewReady:e(s).handleImagePreview,onUploadComplete:e(s).handleImageUploadConfirm},null,8,["visible","biz-type","title","onPreviewReady","onUploadComplete"]),v(j,{visible:e(s).showSummaryModal.value,"onUpdate:visible":c[6]||(c[6]=r=>e(s).showSummaryModal.value=r),title:e(s).t("chat.singleChat.settings.manualSummary")},{footer:U(()=>[t("button",{class:"modal-btn cancel",onClick:c[5]||(c[5]=r=>e(s).showSummaryModal.value=!1)},l(e(s).t("cancel")),1)]),default:U(()=>[t("div",Vn,[t("div",{class:"modal-option",onClick:c[2]||(c[2]=(...r)=>e(s).handleSummarizeRecent&&e(s).handleSummarizeRecent(...r))},[t("span",An,l(e(s).t("chat.singleChat.settings.summarizeRecent")),1)]),t("div",{class:"modal-option",onClick:c[3]||(c[3]=(...r)=>e(s).openRangeInputModal&&e(s).openRangeInputModal(...r))},[t("span",Tn,l(e(s).t("chat.singleChat.settings.summarizeRange")),1)]),t("div",{class:"modal-option",onClick:c[4]||(c[4]=(...r)=>e(s).handleSummarizeVideo&&e(s).handleSummarizeVideo(...r))},[t("span",Nn,l(e(s).t("chat.singleChat.settings.summarizeVideo")),1)])])]),_:1},8,["visible","title"]),v(j,{visible:e(s).showRangeInputModal.value,"onUpdate:visible":c[10]||(c[10]=r=>e(s).showRangeInputModal.value=r),title:e(s).t("chat.singleChat.settings.summarizeRange")},{footer:U(()=>[t("button",{class:"modal-btn cancel",onClick:c[8]||(c[8]=r=>e(s).showRangeInputModal.value=!1)},l(e(s).t("cancel")),1),t("button",{class:"modal-btn confirm",onClick:c[9]||(c[9]=(...r)=>e(s).handleSummarizeRange&&e(s).handleSummarizeRange(...r))},l(e(s).t("confirm")),1)]),default:U(()=>[I(t("input",{type:"text",class:"base-input","onUpdate:modelValue":c[7]||(c[7]=r=>e(s).summaryRangeInput.value=r),placeholder:e(s).t("chat.singleChat.settings.rangePlaceholder",{total:e(s).formState.msgCount})},null,8,Rn),[[P,e(s).summaryRangeInput.value]])]),_:1},8,["visible","title"]),v(j,{visible:e(s).showNpcScopeModal.value,"onUpdate:visible":c[12]||(c[12]=r=>e(s).showNpcScopeModal.value=r),title:e(s).t("chat.singleChat.settings.selectNpc"),bodyClass:"no-padding"},{footer:U(()=>[t("button",{class:"modal-btn confirm",onClick:c[11]||(c[11]=r=>e(s).showNpcScopeModal.value=!1)},l(e(s).t("confirm")),1)]),default:U(()=>[t("div",On,[e(s).singleStore.npcs.length===0?(h(),p("div",zn," 暂无NPC，请先在NPC管理页面添加 ")):L("",!0),(h(!0),p(te,null,se(e(s).singleStore.npcs,r=>(h(),p("div",{key:r.id,class:"scope-item",onClick:C=>e(s).toggleNpcScope(r.id)},[t("div",{class:w(["scope-checkbox",{checked:e(s).formState.linkedNpcs.includes(r.id)}])},[e(s).formState.linkedNpcs.includes(r.id)?(h(),p("svg",jn,[...c[16]||(c[16]=[t("polyline",{points:"20 6 9 17 4 12"},null,-1)])])):L("",!0)],2),t("span",Wn,l(r.name),1)],8,En))),128))])]),_:1},8,["visible","title"]),v(j,{visible:e(s).showCharScopeModal.value,"onUpdate:visible":c[14]||(c[14]=r=>e(s).showCharScopeModal.value=r),title:"选择关联角色",bodyClass:"no-padding"},{footer:U(()=>[t("button",{class:"modal-btn confirm",onClick:c[13]||(c[13]=r=>e(s).showCharScopeModal.value=!1)},l(e(s).t("confirm")),1)]),default:U(()=>[t("div",Fn,[e(s).availableCharacters.value.length===0?(h(),p("div",qn," 暂无其他角色可选 ")):L("",!0),(h(!0),p(te,null,se(e(s).availableCharacters.value,r=>(h(),p("div",{key:r.id,class:"scope-item",onClick:C=>e(s).toggleCharScope(r.id)},[t("div",{class:w(["scope-checkbox",{checked:e(s).formState.linkedCharacters.includes(r.id)}])},[e(s).formState.linkedCharacters.includes(r.id)?(h(),p("svg",Hn,[...c[17]||(c[17]=[t("polyline",{points:"20 6 9 17 4 12"},null,-1)])])):L("",!0)],2),t("span",Zn,l(r.name),1)],8,Kn))),128))])]),_:1},8,["visible"])]))}},Yn=D(Gn,[["__scopeId","data-v-3c124ea2"]]);export{Yn as default};
