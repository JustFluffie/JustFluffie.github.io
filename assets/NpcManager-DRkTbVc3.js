import{_ as M,m as D,u as R,s as $,a0 as W,r as C,c as E,d as l,e,g as k,f as _,F as z,C as F,B as d,P as q,o as i,t as p,n as f,S as H,i as L,w as h,D as j,A as y,a5 as G}from"./index-Bv46giou.js";const J={class:"npc-manager"},K={class:"npc-list"},O={key:0,class:"empty-state"},Q=["onClick"],X={class:"preview-info"},Y={class:"preview-avatar"},Z=["src"],ee={key:1,class:"avatar-placeholder"},te={class:"default-avatar-text"},se={class:"name-wrapper"},ae={class:"preview-name"},oe={class:"header-controls"},le={key:0,class:"item-content-wrapper"},ie={class:"item-content"},ne={class:"user-header-layout"},de=["onClick"],re=["src"],ce={key:1,class:"role-avatar-placeholder"},ue={class:"user-inputs-wrapper"},ve={class:"user-actions-row"},pe={class:"id-display"},me=["onClick"],ge=["onUpdate:modelValue","placeholder"],_e={class:"form-item-vertical"},he=["onUpdate:modelValue"],ye={class:"form-item-vertical"},be=["onUpdate:modelValue"],we={class:"settings-group",style:{"margin-top":"15px"}},Ce={class:"setting-item"},ke={class:"setting-label"},fe={key:0,class:"setting-warning"},xe=["onClick"],Ne={key:0,class:"setting-item"},Ue=["onUpdate:modelValue"],Ae={class:"setting-item"},Ie=["onClick"],Pe={__name:"NpcManager",setup(Se,{expose:U}){const{t:u}=D(),r=R(),m=$(),v=W(),n=C(null),g=C(!1),b=C(null),x=E(()=>r.npcs||[]),A=a=>{n.value===a?n.value=null:n.value=a};let w=null;const c=()=>{w&&clearTimeout(w),w=setTimeout(()=>{r.saveData()},1e3)};U({openAddModal:()=>{const a=r.addNpc("新NPC");n.value=a,setTimeout(()=>{const s=document.querySelector(".npc-manager");s&&(s.scrollTop=s.scrollHeight)},100)}});const I=a=>{m.showConfirm("删除NPC","确定要删除这个NPC吗？",()=>{r.deleteNpc(a),m.showToast("已删除"),n.value===a&&(n.value=null)})},P=a=>{b.value=a.id,g.value=!0},S=a=>{},T=a=>{const s=a.content,t=r.npcs.find(N=>N.id===b.value);t&&(t.avatar=s,r.saveData(),m.showToast(u("chat.singleChat.settings.toast.avatarUpdated"))),g.value=!1,b.value=null},V=a=>{if(!v.globalBackgroundActivity){m.showToast("请先在API设置中开启全局后台活动","warning");return}a.enableAutoReply=!a.enableAutoReply,c()},B=a=>{a.interactWithUser=!a.interactWithUser,c()};return(a,s)=>(i(),l("div",J,[e("div",K,[x.value.length===0?(i(),l("div",O,[...s[1]||(s[1]=[e("div",{class:"empty-text"},"暂无NPC",-1),e("div",{class:"empty-subtext"},"点击右上角添加",-1)])])):_("",!0),(i(!0),l(z,null,F(x.value,(t,N)=>(i(),l("div",{key:t.id,class:"npc-item"},[e("div",{class:"item-header",onClick:o=>A(t.id)},[e("div",X,[e("div",Y,[t.avatar?(i(),l("img",{key:0,src:t.avatar,alt:"Avatar"},null,8,Z)):(i(),l("div",ee,[e("span",te,p((t.name||"?")[0]),1)]))]),e("div",se,[e("span",ae,p(t.name||"未命名"),1)])]),e("div",oe,[e("div",{class:f(["collapse-arrow",{collapsed:n.value!==t.id}])},[k(H,{name:"chevron-down"})],2)])],8,Q),k(G,{name:"collapse"},{default:L(()=>[n.value===t.id?(i(),l("div",le,[e("div",ie,[e("div",ne,[e("div",{class:"user-avatar-wrapper",onClick:o=>P(t)},[t.avatar?(i(),l("img",{key:0,src:t.avatar,alt:"User",class:"role-avatar-img"},null,8,re)):(i(),l("div",ce,p(d(u)("chat.singleChat.settings.uploadAvatar")),1))],8,de),e("div",ue,[e("div",ve,[e("div",pe,"ID: "+p(t.id),1),e("button",{class:"btn btn-danger btn-mini",onClick:j(o=>I(t.id),["stop"])},p(d(u)("delete")),9,me)]),h(e("input",{type:"text","onUpdate:modelValue":o=>t.name=o,class:"base-input",placeholder:d(u)("chat.singleChat.settings.userNamePlaceholder"),onInput:c},null,40,ge),[[y,t.name]])])]),e("div",_e,[s[2]||(s[2]=e("div",{class:"label-main",style:{"margin-bottom":"5px"}},"简介",-1)),h(e("textarea",{"onUpdate:modelValue":o=>t.summary=o,class:"base-input",style:{height:"80px","min-height":"40px"},placeholder:"输入NPC简介...",onInput:c},null,40,he),[[y,t.summary]])]),e("div",ye,[s[3]||(s[3]=e("div",{class:"label-main",style:{"margin-bottom":"5px"}},"分组",-1)),h(e("input",{type:"text","onUpdate:modelValue":o=>t.group=o,class:"base-input",placeholder:"输入分组名称（相同分组可互动）",onInput:c},null,40,be),[[y,t.group]])]),e("div",we,[e("div",Ce,[e("div",ke,[s[4]||(s[4]=e("div",{class:"setting-title"},"独立后台活动",-1)),s[5]||(s[5]=e("div",{class:"setting-desc"},"开启后NPC将自动在后台互动",-1)),d(v).globalBackgroundActivity?_("",!0):(i(),l("div",fe,"需在API设置中开启全局后台活动"))]),e("div",{class:f(["toggle-switch",{active:t.enableAutoReply&&d(v).globalBackgroundActivity,disabled:!d(v).globalBackgroundActivity}]),onClick:o=>V(t)},null,10,xe)]),t.enableAutoReply&&d(v).globalBackgroundActivity?(i(),l("div",Ne,[s[6]||(s[6]=e("div",{class:"setting-label"},[e("div",{class:"setting-title"},"行动冷却时间 (分钟)")],-1)),h(e("input",{type:"number","onUpdate:modelValue":o=>t.replyCooldown=o,class:"base-input small-input",min:"1",onInput:c},null,40,Ue),[[y,t.replyCooldown,void 0,{number:!0}]])])):_("",!0),e("div",Ae,[s[7]||(s[7]=e("div",{class:"setting-label"},[e("div",{class:"setting-title"},"关联用户"),e("div",{class:"setting-desc"},"允许与用户朋友圈互动")],-1)),e("div",{class:f(["toggle-switch",{active:t.interactWithUser}]),onClick:o=>B(t)},null,10,Ie)])])])])):_("",!0)]),_:2},1024)]))),128))]),k(q,{visible:g.value,"onUpdate:visible":s[0]||(s[0]=t=>g.value=t),type:"basic","biz-type":"npcAvatar",title:d(u)("chat.singleChat.settings.toast.setUserAvatar"),onPreviewReady:S,onUploadComplete:T},null,8,["visible","title"])]))}},Be=M(Pe,[["__scopeId","data-v-5fe1f9fe"]]);export{Be as default};
