import{_ as I,a as tt,u as U,r as m,c as et,b as at,d as v,o as u,g as M,e as t,i as y,F as D,m as H,t as r,q as l,M as S,n as w,f as R,s as $,j as E,x as st,y as ot,z as nt,A as lt,B as it,w as z,C as A,D as T,E as rt,G as ct}from"./index-uGEQI7W6.js";const dt={class:"modal-options centered-text"},vt=["onClick"],ut={class:"option-text"},pt={class:"chat-bottom-nav"},ft={class:"nav-icon"},ht={class:"svg-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",style:{"stroke-width":"1.4"}},mt={key:0,class:"unread-badge"},yt={__name:"ChatBottomNav",setup(G){const N=at(),o=E(),k=tt(),g=U(),f=m(!1),d=et(()=>{const i=N.path;return i.includes("/moments")?"moments":i.includes("/npc")?"npc":i.includes("/favorites")?"favorites":i.includes("/profile")?"profile":"chat"}),p=i=>{if(i==="moments"&&k.setMomentsRead(),i==="favorites"){f.value=!0;return}const s={chat:"/chat/list",moments:"/chat/moments",npc:"/chat/npc",favorites:"/chat/favorites",profile:"/chat/profile"};o.push(s[i])},h=i=>{f.value=!1,o.push({name:"chat-favorites",params:{charId:i}})};return(i,s)=>(u(),v("div",null,[M(S,{visible:f.value,"onUpdate:visible":s[1]||(s[1]=c=>f.value=c),title:"选择角色查看收藏"},{footer:y(()=>[t("button",{class:"modal-btn cancel",onClick:s[0]||(s[0]=c=>f.value=!1)},"取消")]),default:y(()=>[t("div",dt,[(u(!0),v(D,null,H(l(g).characters,c=>(u(),v("div",{key:c.id,class:"modal-option",onClick:C=>h(c.id)},[t("span",ut,r(c.name),1)],8,vt))),128))])]),_:1},8,["visible"]),t("div",pt,[t("div",{class:w(["chat-nav-item",{active:d.value==="chat"}]),onClick:s[2]||(s[2]=c=>p("chat"))},[...s[7]||(s[7]=[t("span",{class:"nav-icon"},[t("svg",{class:"svg-icon",viewBox:"0 0 24 24"},[t("path",{d:"M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"})])],-1),t("span",{class:"nav-label"},"聊天",-1)])],2),t("div",{class:w(["chat-nav-item",{active:d.value==="moments"}]),onClick:s[3]||(s[3]=c=>p("moments"))},[t("span",ft,[(u(),v("svg",ht,[...s[8]||(s[8]=[$('<circle cx="12" cy="12" r="10" data-v-a4455af2></circle><line x1="14.31" y1="8" x2="2.83" y2="8" transform="rotate(0, 12, 12)" data-v-a4455af2></line><line x1="14.31" y1="8" x2="2.83" y2="8" transform="rotate(45, 12, 12)" data-v-a4455af2></line><line x1="14.31" y1="8" x2="2.83" y2="8" transform="rotate(90, 12, 12)" data-v-a4455af2></line><line x1="14.31" y1="8" x2="2.83" y2="8" transform="rotate(135, 12, 12)" data-v-a4455af2></line><line x1="14.31" y1="8" x2="2.83" y2="8" transform="rotate(180, 12, 12)" data-v-a4455af2></line><line x1="14.31" y1="8" x2="2.83" y2="8" transform="rotate(225, 12, 12)" data-v-a4455af2></line><line x1="14.31" y1="8" x2="2.83" y2="8" transform="rotate(270, 12, 12)" data-v-a4455af2></line><line x1="14.31" y1="8" x2="2.83" y2="8" transform="rotate(315, 12, 12)" data-v-a4455af2></line>',9)])])),l(k).unread?(u(),v("div",mt)):R("",!0)]),s[9]||(s[9]=t("span",{class:"nav-label"},"朋友圈",-1))],2),t("div",{class:w(["chat-nav-item",{active:d.value==="npc"}]),onClick:s[4]||(s[4]=c=>p("npc"))},[...s[10]||(s[10]=[$('<span class="nav-icon" data-v-a4455af2><svg class="svg-icon" viewBox="0 0 24 24" data-v-a4455af2><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" data-v-a4455af2></path><circle cx="9" cy="7" r="4" data-v-a4455af2></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87" data-v-a4455af2></path><path d="M16 3.13a4 4 0 0 1 0 7.75" data-v-a4455af2></path></svg></span><span class="nav-label" data-v-a4455af2>NPC</span>',2)])],2),t("div",{class:w(["chat-nav-item",{active:d.value==="favorites"}]),onClick:s[5]||(s[5]=c=>p("favorites"))},[...s[11]||(s[11]=[t("span",{class:"nav-icon"},[t("svg",{class:"svg-icon",viewBox:"0 0 24 24"},[t("polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"})])],-1),t("span",{class:"nav-label"},"收藏",-1)])],2),t("div",{class:w(["chat-nav-item",{active:d.value==="profile"}]),onClick:s[6]||(s[6]=c=>p("profile"))},[...s[12]||(s[12]=[$('<span class="nav-icon" data-v-a4455af2><svg class="svg-icon" viewBox="0 0 24 24" data-v-a4455af2><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" data-v-a4455af2></path><circle cx="12" cy="7" r="4" data-v-a4455af2></circle></svg></span><span class="nav-label" data-v-a4455af2>我</span>',2)])],2)])]))}},gt=I(yt,[["__scopeId","data-v-a4455af2"]]),Ct={class:"chat-page active"},xt={class:"chat-top-note"},_t=["placeholder"],wt={class:"chat-list"},kt={key:0,class:"empty-state"},bt={class:"empty-text"},Tt={class:"empty-text",style:{"font-size":"12px"}},Mt=["onMousedown","onMouseup","onTouchstart","onTouchend"],St=["src"],$t={key:1,class:"default-avatar-text"},Nt={class:"chat-info"},Bt={class:"chat-name"},Pt={class:"chat-preview"},Lt={class:"chat-meta"},Ft={class:"chat-time"},Vt={key:0,class:"chat-unread-badge"},zt={class:"modal-options centered-text"},At={class:"option-text"},It={class:"option-text",style:{color:"inherit"}},Ut={class:"modal-options centered-text"},Dt={class:"option-text"},Ht={class:"option-text"},Rt=["placeholder"],Et={__name:"ChatList",setup(G,{expose:N}){const{t:o}=st(),k=E(),g=ot(),f=U(),d=nt(),p=m(""),h=m(!1),i=m(!1),s=m(""),c=m(null),C=m(!1),_=m(null);let B=null,P=!0;lt(()=>{p.value=g.topNote}),it(i,n=>{n&&ct(()=>{var e;(e=c.value)==null||e.focus()})}),N({openAddModal:()=>{h.value=!0}});const j=()=>{g.saveTopNote(p.value)},W=n=>{const e=n.lastMessage;return e?e.type==="text"?e.content:e.type==="voice"?o("chat.messageTypes.voice"):e.type==="image"?o("chat.messageTypes.image"):e.type==="sticker"?o("chat.messageTypes.sticker"):e.type==="location"?o("chat.messageTypes.location"):e.type==="transfer"?o("chat.messageTypes.transfer"):e.type==="call_summary"?e.content:o("chat.messageTypes.unknown"):o("chat.start")},q=n=>{const e=n.lastMessage;if(!e)return"";const b=e.timestamp||e.time;if(!b)return"";const a=new Date(b);if(isNaN(a.getTime()))return"";const x=a.getHours().toString().padStart(2,"0"),Z=a.getMinutes().toString().padStart(2,"0");return`${x}:${Z}`},J=n=>{if(!n||!n.id){console.error("Attempted to open chat room with invalid session:",n),d.showToast(o("chat.toast.openChatFailed"),"error");return}n.type==="single"?k.push({name:"single-chat",params:{id:n.id}}):n.type==="group"&&d.showToast(o("chat.toast.groupChatWip"),"info")},K=()=>{h.value=!1,d.showToast(o("chat.toast.groupChatWip"),"info")},L=()=>{i.value=!1,s.value=""},O=()=>{const n=s.value.trim();if(!n){d.showToast(o("chat.enterCharacterName"),"info");return}const e=f.addCharacter(n);L(),k.push({name:"single-chat",params:{id:e}})},F=(n,e)=>{e.type==="mousedown"&&e.button!==0||(P=!0,B=setTimeout(()=>{P=!1,_.value=n,C.value=!0},800))},Q=()=>{_.value&&(g.togglePin(_.value.id),C.value=!1)},X=()=>{C.value=!1;const n=_.value;n&&d.showConfirm(o("chat.deleteCharacterTitle"),o("chat.deleteCharacterConfirm",{name:n.name}),()=>{n.type==="single"?(f.deleteCharacter(n.id),d.showToast(o("chat.toast.deleteSuccess"),"success")):d.showToast("群组删除功能暂未开放","info")},{messageStyle:{whiteSpace:"pre-wrap",color:"#FF3B30"},confirmText:"delete"})},V=n=>{clearTimeout(B),P&&J(n)},Y=()=>{clearTimeout(B)};return(n,e)=>{var b;return u(),v("div",Ct,[t("div",xt,[e[8]||(e[8]=$('<div class="chat-top-note-icon" data-v-319f6636><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" data-v-319f6636><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z" data-v-319f6636></path><polyline points="3.27 6.96 12 12.01 20.73 6.96" data-v-319f6636></polyline><line x1="12" y1="22.08" x2="12" y2="12" data-v-319f6636></line></svg></div>',1)),z(t("input",{type:"text",class:"chat-top-note-input",placeholder:l(o)("chat.topNotePlaceholder"),"onUpdate:modelValue":e[0]||(e[0]=a=>p.value=a),onBlur:j},null,40,_t),[[A,p.value]])]),t("div",wt,[l(g).sessionList.length===0?(u(),v("div",kt,[t("div",bt,r(l(o)("chat.empty")),1),t("div",Tt,r(l(o)("chat.emptyHint")),1)])):(u(!0),v(D,{key:1},H(l(g).sessionList,a=>(u(),v("div",{key:a.id,class:w(["chat-list-item",{pinned:a.isPinned}]),onMousedown:T(x=>F(a,x),["prevent"]),onMouseup:T(x=>V(a),["prevent"]),onMouseleave:T(Y,["prevent"]),onTouchstart:T(x=>F(a,x),["prevent"]),onTouchend:T(x=>V(a),["prevent"])},[t("div",{class:"chat-avatar",style:rt(a.avatar?"background: transparent;":"")},[a.avatar?(u(),v("img",{key:0,src:a.avatar,alt:""},null,8,St)):(u(),v("span",$t,r(a.name[0]||"?"),1))],4),t("div",Nt,[t("div",Bt,r(a.name),1),t("div",Pt,r(W(a)),1)]),t("div",Lt,[t("div",Ft,r(q(a)),1),a.unreadCount>0?(u(),v("div",Vt,r(a.unreadCount),1)):R("",!0)])],42,Mt))),128))]),M(gt),M(S,{visible:C.value,"onUpdate:visible":e[2]||(e[2]=a=>C.value=a),title:(b=_.value)==null?void 0:b.name},{footer:y(()=>[t("button",{class:"modal-btn cancel",onClick:e[1]||(e[1]=a=>C.value=!1)},r(l(o)("cancel")),1)]),default:y(()=>{var a;return[t("div",zt,[t("div",{class:"modal-option",onClick:Q},[t("span",At,r((a=_.value)!=null&&a.isPinned?l(o)("chat.unpin"):l(o)("chat.pin")),1)]),t("div",{class:"modal-option btn-danger",onClick:X},[t("span",It,r(l(o)("delete")),1)])])]}),_:1},8,["visible","title"]),M(S,{visible:h.value,"onUpdate:visible":e[5]||(e[5]=a=>h.value=a),title:l(o)("chat.newConversation")},{footer:y(()=>[t("button",{class:"modal-btn cancel",onClick:e[4]||(e[4]=a=>h.value=!1)},r(l(o)("cancel")),1)]),default:y(()=>[t("div",Ut,[t("div",{class:"modal-option",onClick:e[3]||(e[3]=a=>{i.value=!0,h.value=!1})},[t("span",Dt,r(l(o)("chat.createCharacter")),1)]),t("div",{class:"modal-option",onClick:K},[t("span",Ht,r(l(o)("chat.createGroup")),1)])])]),_:1},8,["visible","title"]),M(S,{visible:i.value,"onUpdate:visible":e[7]||(e[7]=a=>i.value=a),title:l(o)("chat.createCharacter")},{footer:y(()=>[t("button",{class:"modal-btn cancel",onClick:L},r(l(o)("cancel")),1),t("button",{class:"modal-btn confirm",onClick:O},r(l(o)("create")),1)]),default:y(()=>[z(t("input",{type:"text",class:"base-input","onUpdate:modelValue":e[6]||(e[6]=a=>s.value=a),placeholder:l(o)("chat.characterNamePlaceholder"),ref_key:"newCharInput",ref:c},null,8,Rt),[[A,s.value]])]),_:1},8,["visible","title"])])}}},jt=I(Et,[["__scopeId","data-v-319f6636"]]);export{jt as default};
