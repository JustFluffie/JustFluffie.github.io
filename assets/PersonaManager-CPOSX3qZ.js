import{_ as A,u as N,k as E,B,r as m,c as $,C as z,g as l,i as s,f as g,h as f,G as F,H,d,U as j,o as i,t as u,I as y,j as k,S as q,w as G,p as x,F as D,a6 as L}from"./index-BvwFm15D.js";const R={class:"persona-manager"},J={class:"persona-list"},K={key:0,class:"empty-state"},O=["onClick"],Q={class:"preview-info"},W={class:"preview-avatar"},X=["src"],Y={key:1,class:"avatar-placeholder"},Z={class:"default-avatar-text"},ee={class:"name-wrapper"},se={class:"preview-name"},te={key:0,class:"default-badge"},ae={class:"header-controls"},oe=["onClick"],ne={key:0,class:"item-content-wrapper"},le={class:"item-content"},ie={class:"user-header-layout"},re=["onClick"],ce=["src"],de={key:1,class:"role-avatar-placeholder"},ue={class:"user-inputs-wrapper"},ve={class:"user-actions-row"},he={class:"id-display"},_e=["onClick"],pe=["onUpdate:modelValue","placeholder"],me={class:"form-item-vertical"},ge={class:"label-main",style:{"margin-bottom":"5px"}},fe=["onUpdate:modelValue","placeholder"],we={__name:"PersonaManager",setup(Pe,{expose:b}){const{t:n}=N(),o=E(),h=B(),r=m(null),v=m(!1),_=m(null),w=$(()=>o.userPersonas||[]),I=t=>{r.value===t?r.value=null:r.value=t},U=t=>{o.userPersonas.forEach(a=>{a.isDefault=a.id===t}),o.saveData()};let p=null;const P=()=>{p&&clearTimeout(p),p=setTimeout(()=>{o.saveData()},1e3)};b({openAddModal:()=>{const t=Date.now().toString(),a={id:t,name:"新人设",description:"",avatar:"",videoImg:"",isDefault:o.userPersonas.length===0};o.userPersonas.push(a),o.saveData(),r.value=t,setTimeout(()=>{const e=document.querySelector(".persona-manager");e&&(e.scrollTop=e.scrollHeight)},100)}});const S=t=>{h.showConfirm(n("chat.singleChat.settings.toast.deletePersona"),n("chat.singleChat.settings.toast.confirmDeletePersona"),()=>{const a=o.userPersonas.findIndex(e=>e.id===t);a!==-1&&(o.userPersonas[a].isDefault,o.userPersonas.splice(a,1),o.characters.forEach(e=>{e.userPersona===t&&(e.userPersona="")}),o.saveData(),h.showToast(n("chat.singleChat.settings.toast.personaDeleted")||"已删除"),r.value===t&&(r.value=null))})},T=t=>{_.value=t.id,v.value=!0},M=t=>{},V=t=>{const a=t.content,e=o.userPersonas.find(C=>C.id===_.value);e&&(e.avatar=a,o.saveData(),h.showToast(n("chat.singleChat.settings.toast.avatarUpdated"))),v.value=!1,_.value=null};return z(()=>{}),(t,a)=>(i(),l("div",R,[s("div",J,[w.value.length===0?(i(),l("div",K,[...a[2]||(a[2]=[s("div",{class:"empty-text"},"暂无用户人设",-1),s("div",{class:"empty-subtext"},"点击右上角添加",-1)])])):f("",!0),(i(!0),l(F,null,H(w.value,(e,C)=>(i(),l("div",{key:e.id,class:"persona-item"},[s("div",{class:"item-header",onClick:c=>I(e.id)},[s("div",Q,[s("div",W,[e.avatar?(i(),l("img",{key:0,src:e.avatar,alt:"Avatar"},null,8,X)):(i(),l("div",Y,[s("span",Z,u((e.name||"?")[0]),1)]))]),s("div",ee,[s("span",se,u(e.name||"未命名"),1),e.isDefault?(i(),l("span",te,"默认")):f("",!0)])]),s("div",ae,[s("div",{class:"default-switch-wrapper",onClick:a[0]||(a[0]=y(()=>{},["stop"]))},[s("div",{class:k(["toggle-switch small",{active:e.isDefault}]),onClick:c=>U(e.id)},null,10,oe)]),s("div",{class:k(["collapse-arrow",{collapsed:r.value!==e.id}])},[g(q,{name:"chevron-down"})],2)])],8,O),g(L,{name:"collapse"},{default:G(()=>[r.value===e.id?(i(),l("div",ne,[s("div",le,[s("div",ie,[s("div",{class:"user-avatar-wrapper",onClick:c=>T(e)},[e.avatar?(i(),l("img",{key:0,src:e.avatar,alt:"User",class:"role-avatar-img"},null,8,ce)):(i(),l("div",de,u(d(n)("chat.singleChat.settings.uploadAvatar")),1))],8,re),s("div",ue,[s("div",ve,[s("div",he,"ID: "+u(e.id),1),s("button",{class:"btn btn-danger btn-mini",onClick:y(c=>S(e.id),["stop"])},u(d(n)("delete")),9,_e)]),x(s("input",{type:"text","onUpdate:modelValue":c=>e.name=c,class:"base-input",placeholder:d(n)("chat.singleChat.settings.userNamePlaceholder"),onInput:P},null,40,pe),[[D,e.name]])])]),s("div",me,[s("div",ge,u(d(n)("chat.singleChat.settings.userPersona")),1),x(s("textarea",{"onUpdate:modelValue":c=>e.description=c,class:"base-input",style:{height:"80px","min-height":"40px"},placeholder:d(n)("chat.singleChat.settings.userPersonaPlaceholder"),onInput:P},null,40,fe),[[D,e.description]])])])])):f("",!0)]),_:2},1024)]))),128))]),g(j,{visible:v.value,"onUpdate:visible":a[1]||(a[1]=e=>v.value=e),type:"basic","biz-type":"userPersonaAvatar",title:d(n)("chat.singleChat.settings.toast.setUserAvatar"),onPreviewReady:M,onUploadComplete:V},null,8,["visible","title"])]))}},ke=A(we,[["__scopeId","data-v-7f6cec90"]]);export{ke as default};
