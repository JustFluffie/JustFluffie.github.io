import{_ as Ut,k as xt,m as Bt,q as Vt,U as Tt,V as At,O as Ee,W as Mt,Q as Dt,r as i,c as P,t as je,s as $t,i as Lt,a as v,e,f as u,z as o,y as l,n as b,S as I,w as C,X as U,I as zt,M as We,o as g,b as k,v as h,x as p,C as Fe}from"./index-gMwCw4Iw.js";import{C as De}from"./CustomSelect-Cfj8DldZ.js";import{M as qe}from"./MultiSelect-BM1ckJTk.js";const Rt={class:"chat-settings active"},Nt={class:"app-header"},Ot={class:"title"},Et={class:"action-btn"},jt={class:"app-content settings-content"},Wt={class:"card"},Ft={key:"roleInfo"},qt={class:"card-content"},Ht={class:"role-header-layout"},Gt=["src"],Kt={key:1,class:"role-avatar-placeholder"},Jt={class:"role-inputs-wrapper"},Qt=["placeholder"],Xt=["placeholder"],Yt={class:"form-item-vertical"},Zt={class:"label-main",style:{"margin-bottom":"5px"}},es=["placeholder"],ts={class:"card"},ss={key:"userInfo"},as={class:"card-content"},ls={class:"settings-pure-item",style:{"border-bottom":"none"}},ns={class:"settings-pure-label"},os={class:"user-header-layout"},is=["src"],cs={key:1,class:"role-avatar-placeholder"},rs={class:"user-inputs-wrapper"},ds={class:"user-actions-row"},us=["placeholder"],vs={class:"form-item-vertical"},gs={class:"label-main",style:{"margin-bottom":"5px"}},hs=["placeholder"],ps={class:"card"},ms={class:"card-title-remark"},bs={key:"backgroundActivity"},_s={class:"card-content"},Cs={class:"settings-item-input"},fs={class:"label-col"},ys={class:"label-main"},ks={class:"settings-pure-value"},ws={class:"settings-item-input"},Ss={class:"label-col"},Ps={class:"label-main"},Is={class:"label-sub"},Us={class:"mode-selector"},xs={key:0},Bs={class:"settings-item-input"},Vs={class:"label-col"},Ts={class:"label-main"},As={class:"label-sub"},Ms={class:"settings-item-input"},Ds={class:"label-col"},$s={class:"label-main"},Ls={class:"label-sub"},zs={class:"settings-item-input"},Rs={class:"label-col"},Ns={class:"label-main"},Os={class:"label-sub"},Es={class:"settings-item-input"},js={class:"label-col"},Ws={class:"label-main"},Fs={class:"label-sub"},qs={class:"mode-selector"},Hs={key:0,class:"settings-item-input"},Gs={class:"label-col"},Ks={class:"label-main"},Js={class:"label-sub"},Qs={class:"card"},Xs={key:"modeSettings"},Ys={class:"card-content"},Zs={class:"settings-pure-item"},ea={class:"settings-pure-label"},ta={class:"mode-selector"},sa={key:0,class:"settings-pure-item"},aa={class:"settings-pure-label"},la={class:"settings-pure-item"},na={class:"settings-pure-label"},oa={class:"settings-item-input"},ia={class:"label-col"},ca={class:"label-main"},ra={class:"label-sub"},da={class:"reply-length-container"},ua=["placeholder"],va=["placeholder"],ga={class:"card"},ha={key:"realtimeSense"},pa={class:"card-content"},ma={class:"settings-item-input"},ba={class:"settings-item-input"},_a={class:"form-item-vertical"},Ca={class:"location-input-group"},fa={class:"location-display"},ya={class:"form-item-vertical"},ka={class:"location-input-group"},wa={class:"location-display"},Sa={class:"card"},Pa={key:"summarySettings"},Ia={class:"card-content"},Ua={class:"settings-item-input"},xa={class:"label-col"},Ba={class:"label-main"},Va={class:"label-sub"},Ta={class:"form-item-vertical"},Aa={class:"label-main",style:{"margin-bottom":"5px"}},Ma=["placeholder"],Da={class:"settings-item-input"},$a={class:"label-col"},La={class:"label-main"},za={class:"label-sub"},Ra={class:"settings-btn-row flex-distribute-children",style:{padding:"15px 0","border-bottom":"1px solid #f5f5f5"}},Na={class:"settings-item-input"},Oa={class:"label-col"},Ea={class:"label-main"},ja={class:"label-sub"},Wa={class:"settings-pure-item"},Fa={class:"settings-pure-label"},qa={class:"settings-pure-item"},Ha={class:"settings-pure-label"},Ga={class:"settings-pure-value"},Ka={class:"settings-pure-item"},Ja={class:"settings-pure-label"},Qa={class:"settings-pure-value"},Xa={class:"card"},Ya={key:"bubbleSettings"},Za={class:"card-content"},el={class:"settings-section-title"},tl={class:"settings-row-group"},sl={class:"settings-pure-label",style:{width:"60px"}},al={style:{flex:"1",margin:"0 10px"}},ll={class:"btn-group-mini"},nl=["disabled"],ol={class:"bubble-preview-container"},il={class:"bubble-preview-area"},cl={class:"preview-msg-row left"},rl={class:"preview-avatar char"},dl=["src"],ul={key:1,class:"default-avatar"},vl={class:"preview-msg-row right"},gl={class:"preview-avatar user"},hl=["src"],pl={key:1,class:"default-avatar"},ml={class:"settings-item-input"},bl={class:"label-col"},_l={class:"label-main"},Cl={class:"slider-container gray-slider"},fl={class:"slider-value"},yl={class:"form-item-vertical no-border"},kl={class:"label-main",style:{"margin-bottom":"5px"}},wl=["placeholder"],Sl={class:"settings-section-title"},Pl={class:"settings-item-avatar",style:{"border-bottom":"none","margin-bottom":"0"}},Il={class:"avatar-layout"},Ul={class:"avatar-controls",style:{width:"100%"}},xl={class:"card"},Bl={key:"videoSettings"},Vl={class:"card-content"},Tl={class:"video-settings-container"},Al={class:"video-setting-col"},Ml={class:"settings-item-label center"},Dl=["src"],$l={key:1,class:"default-avatar bg-placeholder"},Ll={class:"video-setting-col"},zl={class:"settings-item-label center"},Rl=["src"],Nl={key:1,class:"default-avatar bg-placeholder"},Ol={class:"card"},El={key:"advancedSettings"},jl={class:"card-content"},Wl={class:"settings-pure-item"},Fl={class:"settings-pure-label"},ql={class:"settings-pure-value"},Hl={class:"danger-zone"},Gl={class:"danger-btn-content"},Kl={class:"danger-btn-title"},Jl={class:"danger-btn-desc"},Ql={class:"danger-btn-content"},Xl={class:"danger-btn-title"},Yl={class:"danger-btn-desc"},Zl={class:"danger-btn-content"},en={class:"danger-btn-title"},tn={class:"danger-btn-desc"},sn={class:"modal-options centered-text"},an={class:"option-text"},ln={class:"option-text"},nn={class:"option-text"},on=["placeholder"],cn={__name:"SingleChatSettings",props:{id:{type:String,required:!0}},setup(He){const x=He,{t:s}=xt(),Ue=Lt(),d=Bt(),r=Vt(),$e=Tt(),Ge=At(),{sortedWorldBooks:Ke}=Ee(Ge),Je=Mt(),{sortedPresets:Qe}=Ee(Je),Xe=Dt(),m=i({roleInfo:!1,userInfo:!1,backgroundActivity:!1,modeSettings:!1,realtimeSense:!1,summarySettings:!1,bubbleSettings:!1,videoSettings:!1,advancedSettings:!1}),B=i(!1),L=i(""),ne=i(""),oe=i(""),ie=i(""),_=i("default"),E=i(""),W=i(""),V=i(""),w=i("default"),ce=i(5),re=i(30),de=i(10),z=i("always"),ue=i(15),R=i(!0),ve=i([]),ge=i([]),F=i(""),q=i(""),H=i(!1),G=i(!1),K=i(""),J=i(""),he=i(""),Q=i(""),X=i(""),pe=i(""),me=i(20),be=i(""),Y=i(!1),_e=i(10),N=i(!1),Z=i(!1),Ce=i(""),T=i(""),A=i(""),M=i(14),ee=i(""),te=i(""),O=i(""),xe=i("default"),Le=i(0),j=i(!1),Be=i(0),fe=i(0),D=P(()=>d.getCharacter(x.id)),ye=P(()=>{var n;return((n=D.value)==null?void 0:n.name)||s("chat.unknownCharacter")}),ke=P(()=>{var n;return(n=D.value)==null?void 0:n.avatar}),Ye=P(()=>[{value:"default",label:s("chat.singleChat.settings.defaultUserPersona")},...(d.userPersonas||[]).map(n=>({value:n.id,label:n.name}))]),Ze=P(()=>[{value:"default",label:s("chat.singleChat.settings.default")+"配置"},{value:"api1",label:"配置一"},{value:"api2",label:"配置二"}]),et=P(()=>[{value:"",label:s("chat.singleChat.settings.custom")},...(d.bubblePresets||[]).map(n=>({value:n.id,label:n.name}))]),tt=P(()=>w.value==="on"?!0:w.value==="off"?!1:$e.globalBackgroundActivity),ze=P(()=>{const n={fontSize:`${M.value}px`};if(!A.value)return n;const t={};return A.value.split(";").forEach(a=>{const c=a.split(":");if(c.length>=2){const f=c[0].trim(),y=c.slice(1).join(":").trim();f&&y&&(t[f]=y)}}),{...n,...t}}),st=P(()=>({avatar:s("chat.singleChat.settings.toast.setCharAvatar"),userPersonaAvatar:s("chat.singleChat.settings.toast.setUserAvatar"),chatBg:s("chat.singleChat.settings.toast.setChatBg"),videoBg:s("chat.singleChat.settings.toast.setCharImg"),userVideoImg:s("chat.singleChat.settings.toast.setUserImg")})[L.value]||s("chat.singleChat.settings.toast.upload"));je(_,n=>{n&&Ae(n)}),je(T,n=>{n&&vt(n)}),$t(()=>{if(!D.value){Ve();return}rt()});const S=n=>{m.value[n]=!m.value[n]},Ve=()=>{Ue.back()},at=()=>{Ue.push({name:"memory-bank",params:{charId:x.id}})},lt=()=>{L.value="avatar",B.value=!0},nt=()=>{L.value="userPersonaAvatar",B.value=!0},ot=()=>{L.value="chatBg",B.value=!0},it=()=>{L.value="videoBg",B.value=!0},ct=()=>{L.value="userVideoImg",B.value=!0},rt=()=>{var se,we,Se,$,Pe,Ie,ae;const n=D.value;ne.value=n.name,oe.value=n.nickname||"",ie.value=n.charPersona||"",_.value=n.userPersona||"default",Ae(_.value),w.value=n.backgroundActivityOverride||"default",ce.value=n.proactiveInterval||5,re.value=n.proactiveCooldown||30,de.value=n.proactiveDailyLimit||10,z.value=n.triggerMode||"always",ue.value=n.proactiveIdleTime||15,R.value=n.isOnline!==!1,ve.value=Array.isArray(n.preset)?n.preset:n.preset?[n.preset]:[],ge.value=n.worldbook||[];const[t,a]=(n.replyLength||(R.value?"10-50":"200-500")).split("-");F.value=t||"",q.value=a||"";const c=n.realtimeSettings||{timeEnabled:!1,weatherEnabled:!1,charLocation:{},userLocation:{}};H.value=c.timeEnabled,G.value=c.weatherEnabled,K.value=((se=c.charLocation)==null?void 0:se.real)||"",J.value=((we=c.charLocation)==null?void 0:we.virtual)||"",he.value=((Se=c.charLocation)==null?void 0:Se.display)||"",Q.value=(($=c.userLocation)==null?void 0:$.real)||"",X.value=((Pe=c.userLocation)==null?void 0:Pe.virtual)||"",pe.value=((Ie=c.userLocation)==null?void 0:Ie.display)||"",me.value=n.summaryRange||20,be.value=n.summaryPrompt||"",Y.value=n.autoSummary||!1,_e.value=n.memoryCount||10;const f=n.bubbleSettings||{};A.value=f.css||"",M.value=f.fontSize||14,ee.value=n.chatBackground||"",te.value=n.videoBg||"",O.value=n.userVideoImg||"",xe.value=n.api||"default",Le.value=((ae=n.npc)==null?void 0:ae.length)||0,j.value=n.isBlocked||!1;const y=d.messages[x.id]||[];fe.value=y.length,Be.value=Math.ceil(y.reduce((Oe,Me)=>{var le;return Oe+(((le=Me.content)==null?void 0:le.length)||0)},0)*1.5)},Te=()=>{const n=D.value;if(!n)return;const t=_.value;let a=d.userPersonas.find(c=>c.id===t);t==="default"&&(a||(a={id:"default",name:s("chat.singleChat.settings.defaultUserPersona"),avatar:"",description:"",videoImg:""},d.userPersonas.unshift(a))),a&&(a.id!=="default"&&E.value.trim()&&(a.name=E.value.trim()),a.description=W.value,a.avatar=V.value,a.videoImg=O.value),Object.assign(n,{name:ne.value.trim()||n.name,nickname:oe.value.trim(),charPersona:ie.value,userPersona:_.value,backgroundActivityOverride:w.value,proactiveInterval:ce.value,proactiveCooldown:re.value,proactiveDailyLimit:de.value,triggerMode:z.value,proactiveIdleTime:ue.value,isOnline:R.value,preset:ve.value,worldbook:ge.value,replyLength:`${F.value}-${q.value}`,realtimeSettings:{timeEnabled:H.value,weatherEnabled:G.value,charLocation:{real:K.value,virtual:J.value,display:he.value},userLocation:{real:Q.value,virtual:X.value,display:pe.value}},summaryRange:me.value,summaryPrompt:be.value,autoSummary:Y.value,memoryCount:_e.value,bubbleSettings:{css:A.value,fontSize:M.value},chatBackground:ee.value,videoBg:te.value,isBlocked:j.value}),d.saveData(),r.showToast(s("theme.toast.saveSuccess"))},Ae=n=>{const t=s("chat.singleChat.settings.defaultUserPersona");let a=d.userPersonas.find(c=>c.id===n)||{name:t,avatar:"",description:"",videoImg:""};E.value=a.name===t?"":a.name,W.value=a.description||"",V.value=a.avatar||"",n!=="default"&&(O.value=a.videoImg||"")},dt=()=>{const n=E.value.trim();if(!n)return r.showToast(s("chat.singleChat.settings.toast.personaNameRequired"),"error");const t={id:_.value==="default"?Date.now().toString():_.value,name:n,description:W.value,avatar:V.value,videoImg:O.value};if(_.value==="default")d.userPersonas.push(t),_.value=t.id,r.showToast(s("chat.singleChat.settings.toast.personaSaved"));else{const a=d.userPersonas.findIndex(c=>c.id===_.value);a!==-1&&(d.userPersonas[a]=t,r.showToast(s("chat.singleChat.settings.toast.personaUpdated")))}d.saveData()},ut=()=>{if(_.value==="default")return r.showToast(s("chat.singleChat.settings.toast.defaultPersonaDelete"),"error");r.showConfirm(s("chat.singleChat.settings.toast.deletePersona"),s("chat.singleChat.settings.toast.confirmDeletePersona"),()=>{d.userPersonas=d.userPersonas.filter(n=>n.id!==_.value),d.characters.forEach(n=>{n.userPersona===_.value&&(n.userPersona="default")}),_.value="default",Ae("default"),d.saveData()})},vt=n=>{if(!n)return;const t=d.bubblePresets.find(a=>a.id===n);t&&(A.value=t.css,M.value=t.fontSize)},gt=()=>{const n=prompt(s("chat.singleChat.settings.toast.presetNameRequired"));if(!n)return;const t={id:Date.now().toString(),name:n,css:A.value,fontSize:M.value};d.bubblePresets.push(t),d.saveData(),T.value=t.id,r.showToast(s("chat.singleChat.settings.toast.presetSaved"))},ht=()=>{T.value&&r.showConfirm(s("chat.singleChat.settings.toast.deleteBubblePreset"),s("chat.singleChat.settings.toast.confirmDeleteBubblePreset"),()=>{d.bubblePresets=d.bubblePresets.filter(n=>n.id!==T.value),d.saveData(),T.value="",r.showToast(s("chat.singleChat.settings.toast.presetDeleted"))})},pt=n=>{const t=typeof n=="string"?n:n.content,a=L.value;if(a==="avatar"||a==="chatBg"||a==="videoBg"){const c={avatar:{obj:D.value,key:"avatar",toast:s("chat.singleChat.settings.toast.avatarUpdated")},chatBg:{obj:D.value,key:"chatBackground",toast:s("chat.singleChat.settings.toast.backgroundUpdated"),localRef:ee},videoBg:{obj:D.value,key:"videoBg",toast:s("chat.singleChat.settings.toast.charImageUpdated"),localRef:te}};c[a]&&(c[a].obj[c[a].key]=t,c[a].localRef&&(c[a].localRef.value=t),d.saveData(),r.showToast(c[a].toast))}else(a==="userPersonaAvatar"||a==="userVideoImg")&&(a==="userPersonaAvatar"&&(V.value=t),a==="userVideoImg"&&(O.value=t),r.showToast(s("chat.singleChat.settings.toast.avatarUpdated")));B.value=!1},mt=()=>{if(!ee.value)return r.showToast(s("chat.singleChat.settings.toast.noBgToApply"));r.showConfirm(s("chat.singleChat.settings.toast.applyBgToAll"),s("chat.singleChat.settings.toast.confirmApplyBgToAll"),()=>{d.applyChatBackgroundToAll(ee.value),r.showToast(s("chat.singleChat.settings.toast.appliedToAll"))})},Re=n=>{R.value=n,[F.value,q.value]=n?["10","50"]:["200","500"]},bt=()=>{N.value=!0},_t=()=>{N.value=!1,Z.value=!0},Ct=async()=>{N.value=!1;const n=await d.summarizeMessages(x.id,{type:"recent"});r.showToast(n.message,n.success?"success":"error")},ft=async()=>{const[n,t]=Ce.value.split("-").map(y=>y.trim()),a=parseInt(n,10),c=parseInt(t,10);if(isNaN(a)||isNaN(c)||a<=0||c<=0||a>c){r.showToast(s("chat.singleChat.settings.toast.invalidRange"),"error");return}const f=await d.summarizeMessages(x.id,{type:"range",start:a,end:c});r.showToast(f.message,f.success?"success":"error"),f.success&&(Z.value=!1,Ce.value="")},yt=async()=>{N.value=!1;const n=await d.summarizeMessages(x.id,{type:"video"});r.showToast(n.message,n.success?"success":"error")},Ne=async n=>{const t=n==="char"?K.value:Q.value,a=n==="char"?J.value:X.value;if(!t){r.showToast("请输入真实地名","error");return}const c=Xe.getActivePreset();if(!c||!c.apiUrl){r.showToast("请先在API设置中配置有效的URL","error");return}const f=c.apiUrl.replace(/\/+$/,"");r.showLoading();try{const y=await fetch(`${f}/nominatim/search?q=${encodeURIComponent(t)}&format=json&addressdetails=1&limit=1`);if(!y.ok)throw new Error("Geocoding API request failed");const se=await y.json();if(se.length===0){r.showToast("找不到该位置","error");return}const{lat:we,lon:Se,address:$}=se[0],Pe=$.city||$.town||$.village||$.county||"",Ie=$.country||"",ae=await fetch(`${f}/geonames/timezoneJSON?lat=${we}&lng=${Se}&username=demo`);if(!ae.ok)throw new Error("Timezone API request failed");const Me=(await ae.json()).timezoneId||"N/A",le=`${a||t} (市: ${Pe}, 国家: ${Ie}, 时区: ${Me})`;n==="char"?he.value=le:pe.value=le,r.showToast("位置信息已更新","success")}catch(y){console.error("Failed to map location:",y),r.showToast("获取位置信息失败","error")}finally{r.hideLoading()}},kt=()=>{r.showConfirm(s("chat.singleChat.settings.confirmBlockTitle",{name:ye.value}),s("chat.singleChat.settings.confirmBlockMsg",{name:ye.value}),()=>{j.value=!0,Te(),r.showToast(s("chat.singleChat.settings.toast.blocked"))},{messageStyle:{color:"#FF3B30",whiteSpace:"pre-wrap"},confirmText:"chat.singleChat.settings.block"})},wt=()=>{j.value=!1,Te(),r.showToast(s("chat.singleChat.settings.toast.unblocked"))},St=()=>{r.showConfirm(s("chat.singleChat.settings.confirmClearTitle"),s("chat.singleChat.settings.confirmClearMsg",{name:ye.value}),()=>{d.clearChatHistory(x.id),r.showToast(s("chat.singleChat.settings.toast.historyCleared")),fe.value=0,Be.value=0},{messageStyle:{whiteSpace:"pre-wrap",color:"#FF3B30"},confirmText:"chat.singleChat.settings.clear"})},Pt=()=>{j.value?wt():kt()},It=()=>{r.showConfirm(s("chat.deleteCharacterTitle"),s("chat.deleteCharacterConfirm",{name:ye.value}),()=>{d.deleteCharacter(x.id),r.showToast(s("chat.toast.deleteSuccess"),"success"),Ve(),Ue.push({name:"chat-list"})},{messageStyle:{whiteSpace:"pre-wrap",color:"#FF3B30"},confirmText:"delete"})};return(n,t)=>(g(),v("div",Rt,[e("div",Nt,[e("div",{class:"back-btn",onClick:Ve},[...t[52]||(t[52]=[e("svg",{class:"svg-icon",viewBox:"0 0 24 24"},[e("polyline",{points:"15 18 9 12 15 6"})],-1)])]),e("div",Ot,o(l(s)("chat.singleChat.settings.title")),1),e("div",Et,[e("button",{class:"header-save-btn",onClick:Te},o(l(s)("save")),1)])]),e("div",jt,[e("div",Wt,[e("div",{class:"card-title",onClick:t[0]||(t[0]=a=>S("roleInfo"))},[e("span",null,o(l(s)("chat.singleChat.settings.roleInfo")),1),e("div",{class:b(["collapse-arrow",{collapsed:m.value.roleInfo}])},[u(I,{name:"chevron-down"})],2)]),u(U,{name:"collapse"},{default:C(()=>[m.value.roleInfo?k("",!0):(g(),v("div",Ft,[e("div",qt,[e("div",Ht,[e("div",{class:"role-avatar-wrapper",onClick:lt},[ke.value?(g(),v("img",{key:0,src:ke.value,alt:"头像",class:"role-avatar-img"},null,8,Gt)):(g(),v("div",Kt,o(l(s)("chat.singleChat.settings.uploadAvatar")),1))]),e("div",Jt,[h(e("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=a=>ne.value=a),class:"base-input",placeholder:l(s)("chat.singleChat.settings.roleNamePlaceholder")},null,8,Qt),[[p,ne.value]]),h(e("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=a=>oe.value=a),class:"base-input",placeholder:l(s)("chat.singleChat.settings.roleNicknamePlaceholder")},null,8,Xt),[[p,oe.value]])])]),e("div",Yt,[e("div",Zt,o(l(s)("chat.singleChat.settings.rolePersona")),1),h(e("textarea",{"onUpdate:modelValue":t[3]||(t[3]=a=>ie.value=a),class:"base-input",style:{height:"80px","min-height":"40px"},placeholder:l(s)("chat.singleChat.settings.rolePersonaPlaceholder")},null,8,es),[[p,ie.value]])])])]))]),_:1})]),e("div",ts,[e("div",{class:"card-title",onClick:t[4]||(t[4]=a=>S("userInfo"))},[e("span",null,o(l(s)("chat.singleChat.settings.userInfo")),1),e("div",{class:b(["collapse-arrow",{collapsed:m.value.userInfo}])},[u(I,{name:"chevron-down"})],2)]),u(U,{name:"collapse"},{default:C(()=>[m.value.userInfo?k("",!0):(g(),v("div",ss,[e("div",as,[e("div",ls,[e("div",ns,o(l(s)("chat.singleChat.settings.currentUserPersona")),1),u(De,{options:Ye.value,modelValue:_.value,"onUpdate:modelValue":t[5]||(t[5]=a=>_.value=a)},null,8,["options","modelValue"])]),e("div",os,[e("div",{class:"user-avatar-wrapper",onClick:nt},[V.value?(g(),v("img",{key:0,src:V.value,alt:"User",class:"role-avatar-img"},null,8,is)):(g(),v("div",cs,o(l(s)("chat.singleChat.settings.uploadAvatar")),1))]),e("div",rs,[e("div",ds,[e("button",{class:"btn btn-secondary btn-mini-grow",onClick:dt},o(l(s)("chat.singleChat.settings.savePersona")),1),e("button",{class:"btn btn-danger btn-mini-grow",onClick:ut},o(l(s)("chat.singleChat.settings.deletePersona")),1)]),h(e("input",{type:"text","onUpdate:modelValue":t[6]||(t[6]=a=>E.value=a),class:"base-input",placeholder:l(s)("chat.singleChat.settings.userNamePlaceholder")},null,8,us),[[p,E.value]])])]),e("div",vs,[e("div",gs,o(l(s)("chat.singleChat.settings.userPersona")),1),h(e("textarea",{"onUpdate:modelValue":t[7]||(t[7]=a=>W.value=a),class:"base-input",style:{height:"80px","min-height":"40px"},placeholder:l(s)("chat.singleChat.settings.userPersonaPlaceholder")},null,8,hs),[[p,W.value]])])])]))]),_:1})]),e("div",ps,[e("div",{class:"card-title",onClick:t[8]||(t[8]=a=>S("backgroundActivity"))},[e("span",null,o(l(s)("chat.singleChat.settings.backgroundActivity")),1),e("div",{class:b(["collapse-arrow",{collapsed:m.value.backgroundActivity}])},[u(I,{name:"chevron-down"})],2)]),e("div",ms,o(l(s)("chat.singleChat.settings.backgroundActivityWarning")),1),u(U,{name:"collapse"},{default:C(()=>[m.value.backgroundActivity?k("",!0):(g(),v("div",bs,[e("div",_s,[e("div",Cs,[e("div",fs,[e("div",ys,o(l(s)("chat.singleChat.settings.globalSettings")),1)]),e("div",ks,o(l($e).globalBackgroundActivity?l(s)("chat.singleChat.settings.globalOn"):l(s)("chat.singleChat.settings.globalOff")),1)]),e("div",ws,[e("div",Ss,[e("div",Ps,o(l(s)("chat.singleChat.settings.overrideGlobal")),1),e("div",Is,o(l(s)("chat.singleChat.settings.overrideGlobalDesc")),1)]),e("div",Us,[e("div",{class:b(["mode-option",{active:w.value==="default"}]),onClick:t[9]||(t[9]=a=>w.value="default")},o(l(s)("chat.singleChat.settings.default")),3),e("div",{class:b(["mode-option",{active:w.value==="on"}]),onClick:t[10]||(t[10]=a=>w.value="on")},o(l(s)("chat.singleChat.settings.on")),3),e("div",{class:b(["mode-option",{active:w.value==="off"}]),onClick:t[11]||(t[11]=a=>w.value="off")},o(l(s)("chat.singleChat.settings.off")),3)])]),tt.value?(g(),v("div",xs,[e("div",Bs,[e("div",Vs,[e("div",Ts,o(l(s)("chat.singleChat.settings.interval")),1),e("div",As,o(l(s)("chat.singleChat.settings.intervalDesc")),1)]),h(e("input",{type:"number","onUpdate:modelValue":t[12]||(t[12]=a=>ce.value=a),class:"base-input base-input-short",placeholder:"5"},null,512),[[p,ce.value,void 0,{number:!0}]])]),e("div",Ms,[e("div",Ds,[e("div",$s,o(l(s)("chat.singleChat.settings.cooldown")),1),e("div",Ls,o(l(s)("chat.singleChat.settings.cooldownDesc")),1)]),h(e("input",{type:"number","onUpdate:modelValue":t[13]||(t[13]=a=>re.value=a),class:"base-input base-input-short",placeholder:"30"},null,512),[[p,re.value,void 0,{number:!0}]])]),e("div",zs,[e("div",Rs,[e("div",Ns,o(l(s)("chat.singleChat.settings.dailyLimit")),1),e("div",Os,o(l(s)("chat.singleChat.settings.dailyLimitDesc")),1)]),h(e("input",{type:"number","onUpdate:modelValue":t[14]||(t[14]=a=>de.value=a),class:"base-input base-input-short",placeholder:"10"},null,512),[[p,de.value,void 0,{number:!0}]])]),e("div",Es,[e("div",js,[e("div",Ws,o(l(s)("chat.singleChat.settings.triggerMode")),1),e("div",Fs,o(l(s)("chat.singleChat.settings.triggerModeDesc")),1)]),e("div",qs,[e("div",{class:b(["mode-option",{active:z.value==="idle"}]),onClick:t[15]||(t[15]=a=>z.value="idle")},o(l(s)("chat.singleChat.settings.idleMode")),3),e("div",{class:b(["mode-option",{active:z.value==="always"}]),onClick:t[16]||(t[16]=a=>z.value="always")},o(l(s)("chat.singleChat.settings.alwaysMode")),3)])]),z.value==="idle"?(g(),v("div",Hs,[e("div",Gs,[e("div",Ks,o(l(s)("chat.singleChat.settings.idleTime")),1),e("div",Js,o(l(s)("chat.singleChat.settings.idleTimeDesc")),1)]),h(e("input",{type:"number","onUpdate:modelValue":t[17]||(t[17]=a=>ue.value=a),class:"base-input base-input-short",placeholder:"15"},null,512),[[p,ue.value,void 0,{number:!0}]])])):k("",!0)])):k("",!0)])]))]),_:1})]),e("div",Qs,[e("div",{class:"card-title",onClick:t[18]||(t[18]=a=>S("modeSettings"))},[e("span",null,o(l(s)("chat.singleChat.settings.mode")),1),e("div",{class:b(["collapse-arrow",{collapsed:m.value.modeSettings}])},[u(I,{name:"chevron-down"})],2)]),u(U,{name:"collapse"},{default:C(()=>[m.value.modeSettings?k("",!0):(g(),v("div",Xs,[e("div",Ys,[e("div",Zs,[e("div",ea,o(l(s)("chat.singleChat.settings.modeSelect")),1),e("div",ta,[e("div",{class:b(["mode-option",{active:R.value}]),onClick:t[19]||(t[19]=a=>Re(!0))},o(l(s)("chat.singleChat.settings.online")),3),e("div",{class:b(["mode-option",{active:!R.value}]),onClick:t[20]||(t[20]=a=>Re(!1))},o(l(s)("chat.singleChat.settings.offline")),3)])]),R.value?k("",!0):(g(),v("div",sa,[e("div",aa,o(l(s)("chat.singleChat.settings.linkPreset")),1),u(qe,{modelValue:ve.value,"onUpdate:modelValue":t[21]||(t[21]=a=>ve.value=a),options:l(Qe),labelKey:"title",valueKey:"id",childrenKey:"entries",textAlign:"right",selectorWidth:"auto",dropdownWidth:"200px"},null,8,["modelValue","options"])])),e("div",la,[e("div",na,o(l(s)("chat.singleChat.settings.linkWorldbook")),1),u(qe,{modelValue:ge.value,"onUpdate:modelValue":t[22]||(t[22]=a=>ge.value=a),options:l(Ke),"label-key":"title","value-key":"id","children-key":"entries",textAlign:"right",selectorWidth:"auto",dropdownWidth:"200px"},null,8,["modelValue","options"])]),e("div",oa,[e("div",ia,[e("div",ca,o(l(s)("chat.singleChat.settings.replyLength")),1),e("div",ra,o(l(s)("chat.singleChat.settings.replyLengthDesc")),1)]),e("div",da,[h(e("input",{type:"number","onUpdate:modelValue":t[23]||(t[23]=a=>F.value=a),class:"base-input base-input-mini",placeholder:l(s)("chat.singleChat.settings.min")},null,8,ua),[[p,F.value]]),t[53]||(t[53]=e("span",null,"-",-1)),h(e("input",{type:"number","onUpdate:modelValue":t[24]||(t[24]=a=>q.value=a),class:"base-input base-input-mini",placeholder:l(s)("chat.singleChat.settings.max")},null,8,va),[[p,q.value]])])])])]))]),_:1})]),e("div",ga,[e("div",{class:"card-title",onClick:t[25]||(t[25]=a=>S("realtimeSense"))},[t[54]||(t[54]=e("span",null,"实时感知",-1)),e("div",{class:b(["collapse-arrow",{collapsed:m.value.realtimeSense}])},[u(I,{name:"chevron-down"})],2)]),u(U,{name:"collapse"},{default:C(()=>[m.value.realtimeSense?k("",!0):(g(),v("div",ha,[e("div",pa,[e("div",ma,[t[55]||(t[55]=e("div",{class:"label-col"},[e("div",{class:"label-main"},"实时时间")],-1)),e("div",{class:b(["toggle-switch",{active:H.value}]),onClick:t[26]||(t[26]=a=>H.value=!H.value)},null,2)]),e("div",ba,[t[56]||(t[56]=e("div",{class:"label-col"},[e("div",{class:"label-main"},"实时天气")],-1)),e("div",{class:b(["toggle-switch",{active:G.value}]),onClick:t[27]||(t[27]=a=>G.value=!G.value)},null,2)]),e("div",_a,[t[57]||(t[57]=e("div",{class:"label-main",style:{"margin-bottom":"5px"}},"角色所在地",-1)),e("div",Ca,[h(e("input",{type:"text","onUpdate:modelValue":t[28]||(t[28]=a=>K.value=a),class:"base-input",placeholder:"真实地名"},null,512),[[p,K.value]]),h(e("input",{type:"text","onUpdate:modelValue":t[29]||(t[29]=a=>J.value=a),class:"base-input",placeholder:"虚拟地名 (可选)"},null,512),[[p,J.value]]),e("button",{class:"btn btn-secondary btn-sm",onClick:t[30]||(t[30]=a=>Ne("char"))},"确定")]),e("div",fa,o(he.value),1)]),e("div",ya,[t[58]||(t[58]=e("div",{class:"label-main",style:{"margin-bottom":"5px"}},"用户所在地",-1)),e("div",ka,[h(e("input",{type:"text","onUpdate:modelValue":t[31]||(t[31]=a=>Q.value=a),class:"base-input",placeholder:"真实地名"},null,512),[[p,Q.value]]),h(e("input",{type:"text","onUpdate:modelValue":t[32]||(t[32]=a=>X.value=a),class:"base-input",placeholder:"虚拟地名 (可选)"},null,512),[[p,X.value]]),e("button",{class:"btn btn-secondary btn-sm",onClick:t[33]||(t[33]=a=>Ne("user"))},"确定")]),e("div",wa,o(pe.value),1)])])]))]),_:1})]),e("div",Sa,[e("div",{class:"card-title",onClick:t[34]||(t[34]=a=>S("summarySettings"))},[e("span",null,o(l(s)("chat.singleChat.settings.summary")),1),e("div",{class:b(["collapse-arrow",{collapsed:m.value.summarySettings}])},[u(I,{name:"chevron-down"})],2)]),u(U,{name:"collapse"},{default:C(()=>[m.value.summarySettings?k("",!0):(g(),v("div",Pa,[e("div",Ia,[e("div",Ua,[e("div",xa,[e("div",Ba,o(l(s)("chat.singleChat.settings.summaryRange")),1),e("div",Va,o(l(s)("chat.singleChat.settings.summaryRangeDesc")),1)]),h(e("input",{type:"number","onUpdate:modelValue":t[35]||(t[35]=a=>me.value=a),class:"base-input base-input-short",placeholder:"20"},null,512),[[p,me.value,void 0,{number:!0}]])]),e("div",Ta,[e("div",Aa,o(l(s)("chat.singleChat.settings.summaryPrompt")),1),h(e("textarea",{"onUpdate:modelValue":t[36]||(t[36]=a=>be.value=a),class:"base-input",style:{height:"80px","min-height":"40px"},placeholder:l(s)("chat.singleChat.settings.summaryPromptPlaceholder")},null,8,Ma),[[p,be.value]])]),e("div",Da,[e("div",$a,[e("div",La,o(l(s)("chat.singleChat.settings.autoSummary")),1),e("div",za,o(l(s)("chat.singleChat.settings.autoSummaryDesc")),1)]),e("div",{class:b(["toggle-switch",{active:Y.value}]),onClick:t[37]||(t[37]=a=>Y.value=!Y.value)},null,2)]),e("div",Ra,[e("button",{class:"btn btn-secondary",onClick:bt},o(l(s)("chat.singleChat.settings.manualSummary")),1),e("button",{class:"btn btn-secondary",onClick:at},o(l(s)("chat.singleChat.settings.viewSummary")),1)]),e("div",Na,[e("div",Oa,[e("div",Ea,o(l(s)("chat.singleChat.settings.contextMemory")),1),e("div",ja,o(l(s)("chat.singleChat.settings.contextMemoryDesc")),1)]),h(e("input",{type:"number","onUpdate:modelValue":t[38]||(t[38]=a=>_e.value=a),class:"base-input base-input-short",placeholder:"10"},null,512),[[p,_e.value,void 0,{number:!0}]])]),e("div",Wa,[e("div",Fa,o(l(s)("chat.singleChat.settings.apiConfig")),1),u(De,{options:Ze.value,modelValue:xe.value,"onUpdate:modelValue":t[39]||(t[39]=a=>xe.value=a)},null,8,["options","modelValue"])]),e("div",qa,[e("div",Ha,o(l(s)("chat.singleChat.settings.tokenCount")),1),e("div",Ga,o(Be.value),1)]),e("div",Ka,[e("div",Ja,o(l(s)("chat.singleChat.settings.msgCount")),1),e("div",Qa,o(fe.value),1)])])]))]),_:1})]),e("div",Xa,[e("div",{class:"card-title",onClick:t[40]||(t[40]=a=>S("bubbleSettings"))},[e("span",null,o(l(s)("chat.singleChat.settings.beautification")),1),e("div",{class:b(["collapse-arrow",{collapsed:m.value.bubbleSettings}])},[u(I,{name:"chevron-down"})],2)]),u(U,{name:"collapse"},{default:C(()=>[m.value.bubbleSettings?k("",!0):(g(),v("div",Ya,[e("div",Za,[e("div",el,o(l(s)("chat.singleChat.settings.bubble")),1),e("div",tl,[e("div",sl,o(l(s)("chat.singleChat.settings.bubblePreset")),1),e("div",al,[u(De,{options:et.value,modelValue:T.value,"onUpdate:modelValue":t[41]||(t[41]=a=>T.value=a)},null,8,["options","modelValue"])]),e("div",ll,[e("button",{class:"btn btn-secondary btn-mini",onClick:gt},o(l(s)("save")),1),e("button",{class:"btn btn-danger btn-mini",disabled:!T.value,onClick:ht},o(l(s)("delete")),9,nl)])]),e("div",ol,[e("div",il,[e("div",cl,[e("div",rl,[ke.value?(g(),v("img",{key:0,src:ke.value,style:{width:"100%",height:"100%","object-fit":"cover"}},null,8,dl)):(g(),v("div",ul))]),e("div",{class:"preview-bubble char",style:Fe(ze.value)},o(l(s)("chat.singleChat.settings.bubblePreview")),5)]),e("div",vl,[e("div",{class:"preview-bubble user",style:Fe(ze.value)},o(l(s)("chat.singleChat.settings.bubblePreview")),5),e("div",gl,[V.value?(g(),v("img",{key:0,src:V.value,style:{width:"100%",height:"100%","object-fit":"cover"}},null,8,hl)):(g(),v("div",pl))])])])]),e("div",ml,[e("div",bl,[e("div",_l,o(l(s)("chat.singleChat.settings.fontSize")),1)]),e("div",Cl,[h(e("input",{type:"range","onUpdate:modelValue":t[42]||(t[42]=a=>M.value=a),min:"10",max:"30",step:"1"},null,512),[[p,M.value,void 0,{number:!0}]]),e("span",fl,o(M.value),1)])]),e("div",yl,[e("div",kl,o(l(s)("chat.singleChat.settings.bubbleCss")),1),h(e("textarea",{"onUpdate:modelValue":t[43]||(t[43]=a=>A.value=a),class:"base-input",placeholder:l(s)("chat.singleChat.settings.cssPlaceholder"),style:{"font-family":"monospace",height:"120px"}},null,8,wl),[[p,A.value]])]),t[59]||(t[59]=e("div",{class:"settings-divider"},null,-1)),e("div",Sl,o(l(s)("chat.singleChat.settings.chatBackground")),1),e("div",Pl,[e("div",Il,[e("div",Ul,[e("button",{class:"btn btn-secondary",onClick:ot},o(l(s)("chat.singleChat.settings.setChatBackground")),1),e("button",{class:"btn btn-secondary",onClick:mt,style:{"margin-top":"5px"}},o(l(s)("chat.singleChat.settings.applyToAll")),1)])])])])]))]),_:1})]),e("div",xl,[e("div",{class:"card-title",onClick:t[44]||(t[44]=a=>S("videoSettings"))},[e("span",null,o(l(s)("chat.singleChat.settings.videoCall")),1),e("div",{class:b(["collapse-arrow",{collapsed:m.value.videoSettings}])},[u(I,{name:"chevron-down"})],2)]),u(U,{name:"collapse"},{default:C(()=>[m.value.videoSettings?k("",!0):(g(),v("div",Bl,[e("div",Vl,[e("div",Tl,[e("div",Al,[e("div",Ml,o(l(s)("chat.singleChat.settings.characterImage")),1),e("div",{class:"video-preview",onClick:it},[te.value?(g(),v("img",{key:0,src:te.value,class:"bg-img"},null,8,Dl)):(g(),v("div",$l,o(l(s)("chat.singleChat.settings.setImage")),1))])]),e("div",Ll,[e("div",zl,o(l(s)("chat.singleChat.settings.userImage")),1),e("div",{class:"video-preview",onClick:ct},[O.value?(g(),v("img",{key:0,src:O.value,class:"bg-img"},null,8,Rl)):(g(),v("div",Nl,o(l(s)("chat.singleChat.settings.setImage")),1))])])])])]))]),_:1})]),e("div",Ol,[e("div",{class:"card-title",onClick:t[45]||(t[45]=a=>S("advancedSettings"))},[e("span",null,o(l(s)("chat.singleChat.settings.advanced")),1),e("div",{class:b(["collapse-arrow",{collapsed:m.value.advancedSettings}])},[u(I,{name:"chevron-down"})],2)]),u(U,{name:"collapse"},{default:C(()=>[m.value.advancedSettings?k("",!0):(g(),v("div",El,[e("div",jl,[e("div",Wl,[e("div",Fl,o(l(s)("chat.singleChat.settings.linkedNpc")),1),e("div",ql,o(l(s)("chat.singleChat.settings.npcCount",{count:Le.value})),1),t[60]||(t[60]=e("div",{class:"settings-pure-arrow"},"›",-1))])])]))]),_:1})]),e("div",Hl,[e("button",{class:"btn btn-danger big-btn",onClick:Pt},[e("div",Gl,[e("div",Kl,o(j.value?l(s)("chat.singleChat.settings.unblock"):l(s)("chat.singleChat.settings.blockCharacter")),1),e("div",Jl,o(l(s)("chat.singleChat.settings.blockCharacterDesc")),1)])]),e("button",{class:"btn btn-danger big-btn",onClick:St},[e("div",Ql,[e("div",Xl,o(l(s)("chat.singleChat.settings.clearHistory")),1),e("div",Yl,o(l(s)("chat.singleChat.settings.clearHistoryDesc")),1)])]),e("button",{class:"btn btn-danger big-btn",onClick:It},[e("div",Zl,[e("div",en,o(l(s)("chat.deleteCharacterTitle")),1),e("div",tn,o(l(s)("chat.deleteCharacterWarning")),1)])])])]),u(zt,{visible:B.value,"onUpdate:visible":t[46]||(t[46]=a=>B.value=a),type:"basic","biz-type":"avatar",title:st.value,onSendImage:pt},null,8,["visible","title"]),u(We,{visible:N.value,"onUpdate:visible":t[48]||(t[48]=a=>N.value=a),title:l(s)("chat.singleChat.settings.manualSummary")},{footer:C(()=>[e("button",{class:"modal-btn cancel",onClick:t[47]||(t[47]=a=>N.value=!1)},o(l(s)("cancel")),1)]),default:C(()=>[e("div",sn,[e("div",{class:"modal-option",onClick:Ct},[e("span",an,o(l(s)("chat.singleChat.settings.summarizeRecent")),1)]),e("div",{class:"modal-option",onClick:_t},[e("span",ln,o(l(s)("chat.singleChat.settings.summarizeRange")),1)]),e("div",{class:"modal-option",onClick:yt},[e("span",nn,o(l(s)("chat.singleChat.settings.summarizeVideo")),1)])])]),_:1},8,["visible","title"]),u(We,{visible:Z.value,"onUpdate:visible":t[51]||(t[51]=a=>Z.value=a),title:l(s)("chat.singleChat.settings.summarizeRange")},{footer:C(()=>[e("button",{class:"modal-btn cancel",onClick:t[50]||(t[50]=a=>Z.value=!1)},o(l(s)("cancel")),1),e("button",{class:"modal-btn confirm",onClick:ft},o(l(s)("confirm")),1)]),default:C(()=>[h(e("input",{type:"text",class:"base-input","onUpdate:modelValue":t[49]||(t[49]=a=>Ce.value=a),placeholder:l(s)("chat.singleChat.settings.rangePlaceholder",{total:fe.value})},null,8,on),[[p,Ce.value]])]),_:1},8,["visible","title"])]))}},vn=Ut(cn,[["__scopeId","data-v-d32fa30b"]]);export{vn as default};
