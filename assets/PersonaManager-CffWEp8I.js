import{_ as V,m as N,u as E,s as B,r as p,c as $,x as z,d as l,e as s,g,f,F,C as q,B as d,O as H,o as i,t as u,D as y,n as x,S as L,i as O,w as k,A as D,a4 as R}from"./index-LMiDZmIY.js";const j={class:"persona-manager"},G={class:"persona-list"},J={key:0,class:"empty-state"},K=["onClick"],Q={class:"preview-info"},W={class:"preview-avatar"},X=["src"],Y={key:1,class:"avatar-placeholder"},Z={class:"default-avatar-text"},ee={class:"name-wrapper"},se={class:"preview-name"},te={key:0,class:"default-badge"},ae={class:"header-controls"},oe=["onClick"],ne={key:0,class:"item-content-wrapper"},le={class:"item-content"},ie={class:"user-header-layout"},re=["onClick"],ce=["src"],de={key:1,class:"role-avatar-placeholder"},ue={class:"user-inputs-wrapper"},ve={class:"user-actions-row"},he={class:"id-display"},_e=["onClick"],me=["onUpdate:modelValue","placeholder"],pe={class:"form-item-vertical"},ge={class:"label-main",style:{"margin-bottom":"5px"}},fe=["onUpdate:modelValue","placeholder"],we={__name:"PersonaManager",setup(Pe,{expose:b}){const{t:n}=N(),o=E(),h=B(),r=p(null),v=p(!1),_=p(null),w=$(()=>o.userPersonas||[]),I=t=>{r.value===t?r.value=null:r.value=t},U=t=>{o.userPersonas.forEach(a=>{a.isDefault=a.id===t}),o.saveData()};let m=null;const P=()=>{m&&clearTimeout(m),m=setTimeout(()=>{o.saveData()},1e3)};b({openAddModal:()=>{const t=Date.now().toString(),a={id:t,name:"新人设",description:"",avatar:"",videoImg:"",isDefault:o.userPersonas.length===0};o.userPersonas.push(a),o.saveData(),r.value=t,setTimeout(()=>{const e=document.querySelector(".persona-manager");e&&(e.scrollTop=e.scrollHeight)},100)}});const S=t=>{h.showConfirm(n("chat.singleChat.settings.toast.deletePersona"),n("chat.singleChat.settings.toast.confirmDeletePersona"),()=>{const a=o.userPersonas.findIndex(e=>e.id===t);a!==-1&&(o.userPersonas[a].isDefault,o.userPersonas.splice(a,1),o.characters.forEach(e=>{e.userPersona===t&&(e.userPersona="")}),o.saveData(),h.showToast(n("chat.singleChat.settings.toast.personaDeleted")||"已删除"),r.value===t&&(r.value=null))})},T=t=>{_.value=t.id,v.value=!0},M=t=>{},A=t=>{const a=t.content,e=o.userPersonas.find(C=>C.id===_.value);e&&(e.avatar=a,o.saveData(),h.showToast(n("chat.singleChat.settings.toast.avatarUpdated"))),v.value=!1,_.value=null};return z(()=>{}),(t,a)=>(i(),l("div",j,[s("div",G,[w.value.length===0?(i(),l("div",J,[...a[2]||(a[2]=[s("div",{class:"empty-text"},"暂无用户人设",-1),s("div",{class:"empty-subtext"},"点击右上角添加",-1)])])):f("",!0),(i(!0),l(F,null,q(w.value,(e,C)=>(i(),l("div",{key:e.id,class:"persona-item"},[s("div",{class:"item-header",onClick:c=>I(e.id)},[s("div",Q,[s("div",W,[e.avatar?(i(),l("img",{key:0,src:e.avatar,alt:"Avatar"},null,8,X)):(i(),l("div",Y,[s("span",Z,u((e.name||"?")[0]),1)]))]),s("div",ee,[s("span",se,u(e.name||"未命名"),1),e.isDefault?(i(),l("span",te,"默认")):f("",!0)])]),s("div",ae,[s("div",{class:"default-switch-wrapper",onClick:a[0]||(a[0]=y(()=>{},["stop"]))},[s("div",{class:x(["toggle-switch small",{active:e.isDefault}]),onClick:c=>U(e.id)},null,10,oe)]),s("div",{class:x(["collapse-arrow",{collapsed:r.value!==e.id}])},[g(L,{name:"chevron-down"})],2)])],8,K),g(R,{name:"collapse"},{default:O(()=>[r.value===e.id?(i(),l("div",ne,[s("div",le,[s("div",ie,[s("div",{class:"user-avatar-wrapper",onClick:c=>T(e)},[e.avatar?(i(),l("img",{key:0,src:e.avatar,alt:"User",class:"role-avatar-img"},null,8,ce)):(i(),l("div",de,u(d(n)("chat.singleChat.settings.uploadAvatar")),1))],8,re),s("div",ue,[s("div",ve,[s("div",he,"ID: "+u(e.id),1),s("button",{class:"btn btn-danger btn-mini",onClick:y(c=>S(e.id),["stop"])},u(d(n)("delete")),9,_e)]),k(s("input",{type:"text","onUpdate:modelValue":c=>e.name=c,class:"base-input",placeholder:d(n)("chat.singleChat.settings.userNamePlaceholder"),onInput:P},null,40,me),[[D,e.name]])])]),s("div",pe,[s("div",ge,u(d(n)("chat.singleChat.settings.userPersona")),1),k(s("textarea",{"onUpdate:modelValue":c=>e.description=c,class:"base-input",style:{height:"80px","min-height":"40px"},placeholder:d(n)("chat.singleChat.settings.userPersonaPlaceholder"),onInput:P},null,40,fe),[[D,e.description]])])])])):f("",!0)]),_:2},1024)]))),128))]),g(H,{visible:v.value,"onUpdate:visible":a[1]||(a[1]=e=>v.value=e),type:"basic","biz-type":"userPersonaAvatar",title:d(n)("chat.singleChat.settings.toast.setUserAvatar"),onPreviewReady:M,onUploadComplete:A},null,8,["visible","title"])]))}},xe=V(we,[["__scopeId","data-v-7f6cec90"]]);export{xe as default};
