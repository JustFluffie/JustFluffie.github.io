import{_ as de,u as ue,W as ve,s as re,R as pe,r as u,c as J,y as T,a5 as ce,a7 as ke,G as ge,d as o,f as i,e as t,w as $,A as I,n as me,F as V,C as q,z as O,t as S,D as _,B as b,o as a,E as we}from"./index-BxA9hU5S.js";const fe={key:0,class:"post-moment-modal"},ye={class:"app-header"},be={class:"action-btn"},he=["disabled"],Ce={class:"modal-body"},xe=["onClick"],Se=["src"],_e=["onClick"],Me=["onClick"],$e=["onClick"],Ie={class:"option-list"},Be={class:"option-value"},Le={key:0,class:"expanded-input-container"},Ue={class:"option-value"},Te={class:"option-value"},Ve={class:"popup-option-wrapper"},Oe={key:0,class:"expanded-input-container new-input-style"},ze={class:"input-wrapper"},Ne={class:"popup-option-wrapper"},Pe={key:0,class:"expanded-input-container new-input-style"},Re={class:"input-wrapper"},je={class:"app-header"},Ae={class:"title"},Fe={key:0},Ge={key:1},De={class:"selector-body"},Ee={key:0},He={class:"custom-radio"},Je={key:0,class:"checked-icon",viewBox:"0 0 24 24"},qe={class:"custom-radio"},We={key:0,class:"checked-icon",viewBox:"0 0 24 24"},Ke={key:1,class:"character-list"},Qe=["onClick"],Xe={class:"custom-checkbox"},Ye={key:0,class:"checked-icon-inner",viewBox:"0 0 24 24"},Ze=["src"],et={__name:"PostMoment",props:{show:Boolean},emits:["close","post"],setup(W,{emit:K}){const B=K,Q=ue();ve();const X=re(),Y=pe(),{getImageUrl:z,preview:N}=Y,h=u(""),n=u([]),C=u(""),m=u([]),w=u({type:"public",allowed:[]}),M=u(!1),r=u(null),L=u(!1),p=u(!1),v=u(!1),c=u(""),k=u(""),f=u([]),d=u({type:"public",allowed:[]}),P=u([]),Z=J(()=>Q.characters.filter(l=>l.id!=="user")),R=J(()=>!h.value.trim()&&n.value.length===0);T(p,l=>{l&&(f.value=[...m.value])}),T(v,l=>{l&&(d.value=JSON.parse(JSON.stringify(w.value)))}),T(()=>n.value.length,(l,e)=>{if(e===1&&l>1)n.value.forEach(s=>{s.isTextGenerated&&(s.aspectRatio="square")});else if(e>1&&l===1){const s=n.value[0];s.isTextGenerated&&(s.aspectRatio="rectangle")}H()}),ce(()=>{H()});const ee=()=>{R.value||(B("post",{content:h.value,images:n.value,location:C.value,remind:m.value,visibility:w.value}),j(),B("close"))},te=()=>{j(),B("close")},j=()=>{h.value="",n.value=[],C.value="",m.value=[],w.value={type:"public",allowed:[]},g()},g=()=>{M.value=!1,r.value=null,p.value=!1,v.value=!1,c.value="",k.value=""},A=l=>{r.value=r.value===l?null:l},F=()=>{r.value==="url"&&(c.value=""),r.value==="description"&&(k.value="")},le=()=>{L.value=!L.value},{createImageFromText:se,triggerFileUpload:G}=ke({onComplete:oe});function oe(l){U(l),g()}const U=l=>{n.value.length<9&&n.value.push(l)},D=l=>{n.value.splice(l,1)},E=async()=>{if(r.value==="url"&&c.value){const l=new Image;l.onload=()=>{U({type:"url",content:c.value,width:l.naturalWidth,height:l.naturalHeight})},l.onerror=()=>{X.showToast("无效的图片链接","error")},l.src=c.value}else if(r.value==="description"&&k.value){const l={aspectRatio:n.value.length>0?"square":"rectangle"},e=await se(k.value,l);e&&U(e)}g()},ae=()=>{p.value&&(m.value=[...f.value]),v.value&&(d.value.type==="public"&&(d.value.allowed=[]),w.value=JSON.parse(JSON.stringify(d.value))),g()},ie=l=>p.value?f.value.includes(l):v.value&&d.value.type==="partial"?d.value.allowed.includes(l):!1,ne=l=>{if(p.value){const e=f.value.indexOf(l);e>-1?f.value.splice(e,1):f.value.push(l)}else if(v.value&&d.value.type==="partial"){const e=d.value.allowed.indexOf(l);e>-1?d.value.allowed.splice(e,1):d.value.allowed.push(l)}},H=()=>{ge(()=>{P.value.forEach(l=>{l&&l.classList.toggle("is-overflowing",l.scrollHeight>l.clientHeight)})})};return(l,e)=>W.show?(a(),o("div",fe,[t("div",{class:"modal-content",onClick:e[15]||(e[15]=_(()=>{},["stop"]))},[t("div",ye,[t("div",{class:"back-btn",onClick:te},[...e[16]||(e[16]=[t("svg",{class:"svg-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("path",{d:"M15 18l-6-6 6-6"})],-1)])]),e[17]||(e[17]=t("div",{class:"title"},"发表动态",-1)),t("div",be,[t("button",{onClick:ee,class:"header-save-btn",disabled:R.value},"发表",8,he)])]),t("div",Ce,[$(t("textarea",{"onUpdate:modelValue":e[0]||(e[0]=s=>h.value=s),placeholder:"这一刻的想法...",class:"post-moment-textarea"},null,512),[[I,h.value]]),t("div",{class:me(["publish-images",{"single-image":n.value.length===1}])},[(a(!0),o(V,null,q(n.value,(s,y)=>(a(),o(V,{key:y},[n.value.length===1&&!s.isTextGenerated?(a(),o("div",{key:0,class:"publish-single-image-adaptive",onClick:x=>b(N)(s)},[t("img",{src:b(z)(s),alt:"publish preview"},null,8,Se),t("div",{class:"remove-img",onClick:_(x=>D(y),["stop"])},"×",8,_e)],8,xe)):(a(),o("div",{key:1,class:"publish-image-item",style:we({backgroundImage:`url(${b(z)(s)})`}),onClick:x=>b(N)(s)},[s.isTextGenerated?(a(),o("div",{key:0,class:"description-placeholder",ref_for:!0,ref:x=>P.value[y]=x},S(n.value.length>1?`第${y+1}张图片`:"一张图片"),513)):i("",!0),t("div",{class:"remove-img",onClick:_(x=>D(y),["stop"])},"×",8,$e)],12,Me))],64))),128)),n.value.length<9?(a(),o("div",{key:0,class:"add-image-btn",onClick:e[1]||(e[1]=s=>M.value=!0)},[...e[18]||(e[18]=[t("span",null,"+",-1)])])):i("",!0)],2),e[25]||(e[25]=t("div",{class:"spacer"},null,-1)),t("div",Ie,[t("div",{class:"option-row",onClick:le},[e[19]||(e[19]=O('<div class="option-icon" data-v-036d50de><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-036d50de><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z" data-v-036d50de></path><circle cx="12" cy="10" r="3" data-v-036d50de></circle></svg></div><div class="option-label" data-v-036d50de>所在位置</div>',2)),t("div",Be,S(C.value||""),1),e[20]||(e[20]=t("div",{class:"option-arrow"},">",-1))]),L.value?(a(),o("div",Le,[$(t("input",{type:"text","onUpdate:modelValue":e[2]||(e[2]=s=>C.value=s),placeholder:"输入位置",class:"base-input"},null,512),[[I,C.value]])])):i("",!0),t("div",{class:"option-row",onClick:e[3]||(e[3]=s=>p.value=!0)},[e[21]||(e[21]=O('<div class="option-icon" data-v-036d50de><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-036d50de><circle cx="12" cy="12" r="4" data-v-036d50de></circle><path d="M16 8v5a3 3 0 0 0 6 0v-1a10 10 0 1 0-3.92 7.94" data-v-036d50de></path></svg></div><div class="option-label" data-v-036d50de>提醒谁看</div>',2)),t("div",Ue,S(m.value.length?`${m.value.length}个联系人`:""),1),e[22]||(e[22]=t("div",{class:"option-arrow"},">",-1))]),t("div",{class:"option-row",onClick:e[4]||(e[4]=s=>v.value=!0)},[e[23]||(e[23]=O('<div class="option-icon" data-v-036d50de><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-v-036d50de><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" data-v-036d50de></path><circle cx="9" cy="7" r="4" data-v-036d50de></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87" data-v-036d50de></path><path d="M16 3.13a4 4 0 0 1 0 7.75" data-v-036d50de></path></svg></div><div class="option-label" data-v-036d50de>谁可以看</div>',2)),t("div",Te,S(w.value.type==="public"?"公开":`${w.value.allowed.length}个联系人`),1),e[24]||(e[24]=t("div",{class:"option-arrow"},">",-1))])])]),M.value?(a(),o("div",{key:0,class:"popup-overlay",onClick:g},[t("div",{class:"popup-content",onClick:e[11]||(e[11]=_(()=>{},["stop"]))},[t("div",Ve,[t("div",{class:"popup-option",onClick:e[5]||(e[5]=s=>A("description"))},"文字描述"),r.value==="description"?(a(),o("div",Oe,[t("div",ze,[$(t("textarea",{"onUpdate:modelValue":e[6]||(e[6]=s=>k.value=s),placeholder:"输入描述...",class:"base-input"},null,512),[[I,k.value]]),k.value?(a(),o("button",{key:0,onClick:F,class:"clear-input-btn"},"×")):i("",!0)]),t("button",{onClick:E,class:"btn btn-secondary btn-sm"},"确定")])):i("",!0)]),t("div",{class:"popup-option",onClick:e[7]||(e[7]=(...s)=>b(G)&&b(G)(...s))},"从相册选择"),t("div",Ne,[t("div",{class:"popup-option",onClick:e[8]||(e[8]=s=>A("url"))},"输入图片链接"),r.value==="url"?(a(),o("div",Pe,[t("div",Re,[$(t("input",{type:"text","onUpdate:modelValue":e[9]||(e[9]=s=>c.value=s),placeholder:"https://...",class:"base-input"},null,512),[[I,c.value]]),c.value?(a(),o("button",{key:0,onClick:F,class:"clear-input-btn"},"×")):i("",!0)]),t("button",{onClick:E,class:"btn btn-secondary btn-sm"},"确定")])):i("",!0)]),e[26]||(e[26]=t("div",{class:"popup-separator"},null,-1)),t("div",{class:"popup-option",onClick:e[10]||(e[10]=s=>M.value=!1)},"取消")])])):i("",!0),p.value||v.value?(a(),o("div",{key:1,class:"popup-overlay selector-popup",onClick:g},[t("div",{class:"selector-content",onClick:e[14]||(e[14]=_(()=>{},["stop"]))},[t("div",je,[t("div",{class:"back-btn",onClick:g},[...e[27]||(e[27]=[t("svg",{class:"svg-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("path",{d:"M15 18l-6-6 6-6"})],-1)])]),t("div",Ae,[p.value?(a(),o("span",Fe,"选择提醒的人")):i("",!0),v.value?(a(),o("span",Ge,"选择可见范围")):i("",!0)]),t("div",{class:"action-btn"},[t("button",{onClick:ae,class:"header-save-btn"},"完成")])]),t("div",De,[v.value?(a(),o("div",Ee,[t("div",{class:"visibility-option",onClick:e[12]||(e[12]=s=>d.value.type="public")},[t("div",He,[d.value.type==="public"?(a(),o("svg",Je,[...e[28]||(e[28]=[t("path",{fill:"currentColor",d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"},null,-1)])])):i("",!0)]),e[29]||(e[29]=t("label",null,"公开",-1))]),t("div",{class:"visibility-option",onClick:e[13]||(e[13]=s=>d.value.type="partial")},[t("div",qe,[d.value.type==="partial"?(a(),o("svg",We,[...e[30]||(e[30]=[t("path",{fill:"currentColor",d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"},null,-1)])])):i("",!0)]),e[31]||(e[31]=t("label",null,"部分可见",-1))])])):i("",!0),!v.value||d.value.type==="partial"?(a(),o("div",Ke,[(a(!0),o(V,null,q(Z.value,s=>(a(),o("div",{key:s.id,class:"character-item",onClick:y=>ne(s.id)},[t("div",Xe,[ie(s.id)?(a(),o("svg",Ye,[...e[32]||(e[32]=[t("path",{fill:"white",d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"},null,-1)])])):i("",!0)]),t("img",{src:s.avatar,class:"char-avatar"},null,8,Ze),t("label",null,S(s.name),1)],8,Qe))),128))])):i("",!0)])])])):i("",!0)])])):i("",!0)}},lt=de(et,[["__scopeId","data-v-036d50de"]]);export{lt as default};
