import{u as Ne,k as Re,B as Oe,a2 as ze,a3 as je,s as Q,a as Ee,Z as We,a4 as Fe,a5 as X,r as R,c as U,D as Y,x as H,_ as V,g as p,o as h,i as t,f as m,t as l,d as e,j as w,S as A,w as x,h as M,p as I,F as P,a6 as T,n as ee,C as qe,U as Ke,M as E,G as te,H as se}from"./index-OpoVTFjf.js";import{C as G}from"./CustomSelect-2bKGsIuw.js";import{M as ae}from"./MultiSelect-Kup26btH.js";function He(y){const{t:i}=Ne(),n=H(),s=Re(),d=Oe(),f=ze(),c=je(),{sortedWorldBooks:r}=Q(c),_=Ee(),{sortedPresets:u}=Q(_),v=We(),{fetchLocationWeather:b}=Fe(),S=X({roleInfo:!1,userInfo:!1,backgroundActivity:!1,modeSettings:!1,realtimeSense:!1,summarySettings:!1,bubbleSettings:!1,videoSettings:!1,advancedSettings:!1}),j=R(!1),O=R(""),$=R(!1),L=R(!1),W=R(""),ne=R(!1),oe=R(!1),a=X({charNameInput:"",charNicknameInput:"",charPersonaInput:"",currentUserPersonaId:"default",userPersonaNameInput:"",userPersonaDescInput:"",userPersonaAvatar:"",backgroundActivityOverride:"default",proactiveInterval:5,proactiveCooldown:30,proactiveDailyLimit:10,triggerMode:"always",proactiveIdleTime:15,isOnline:!0,preset:[],worldbook:[],replyLengthMin:"",replyLengthMax:"",realtimeTimeEnabled:!1,realtimeWeatherEnabled:!1,charLocationReal:"",charLocationVirtual:"",charLocationDisplay:"",userLocationReal:"",userLocationVirtual:"",userLocationDisplay:"",charLocationData:{},userLocationData:{},summaryRange:20,summaryPrompt:"",autoSummary:!1,memoryCount:10,currentBubblePresetId:"",bubbleCss:"",bubbleFontSize:14,chatBackground:"",videoBg:"",userVideoImg:"",apiConfig:"default",linkedNpcs:[],linkedCharacters:[],isBlocked:!1,npcCount:0,linkedCharCount:0,tokenCount:0,msgCount:0}),D=U(()=>s.getCharacter(y.id)),z=U(()=>{var o;return((o=D.value)==null?void 0:o.name)||i("chat.unknownCharacter")}),ie=U(()=>{var o;return(o=D.value)==null?void 0:o.avatar}),le=U(()=>[{value:"new",label:i("chat.singleChat.settings.newUserPersona")},...(s.userPersonas||[]).map(o=>({value:o.id,label:o.name}))]),re=U(()=>[{value:"default",label:i("chat.singleChat.settings.default")},...v.presets.map(o=>({value:o.name,label:o.name}))]),ce=U(()=>[{value:"",label:i("chat.singleChat.settings.custom")},...(s.bubblePresets||[]).map(o=>({value:o.id,label:o.name}))]),de=U(()=>s.characters.filter(o=>o.id!==y.id)),ue=U(()=>a.backgroundActivityOverride==="on"?!0:a.backgroundActivityOverride==="off"?!1:f.globalBackgroundActivity),ge=U(()=>{const o={fontSize:`${a.bubbleFontSize}px`};if(!a.bubbleCss)return o;const g={};return a.bubbleCss.split(";").forEach(C=>{const k=C.split(":");if(k.length>=2){const B=k[0].trim(),N=k.slice(1).join(":").trim();B&&N&&(g[B]=N)}}),{...o,...g}}),pe=U(()=>({avatar:i("chat.singleChat.settings.toast.setCharAvatar"),userPersonaAvatar:i("chat.singleChat.settings.toast.setUserAvatar"),chatBg:i("chat.singleChat.settings.toast.setChatBg"),videoBg:i("chat.singleChat.settings.toast.setCharImg"),userVideoImg:i("chat.singleChat.settings.toast.setUserImg")})[O.value]||i("chat.singleChat.settings.toast.upload")),F=o=>{if(o==="new"){a.userPersonaNameInput="",a.userPersonaDescInput="",a.userPersonaAvatar="",a.userVideoImg="";return}let g=s.userPersonas.find(C=>C.id===o);g?(a.userPersonaNameInput=g.name,a.userPersonaDescInput=g.description||"",a.userPersonaAvatar=g.avatar||"",a.userVideoImg=g.videoImg||""):a.currentUserPersonaId!=="new"&&(a.currentUserPersonaId="new")},he=()=>{const o=a.userPersonaNameInput.trim();if(!o)return d.showToast(i("chat.singleChat.settings.toast.personaNameRequired"),"error");const g=a.currentUserPersonaId==="new",C={id:g?Date.now().toString():a.currentUserPersonaId,name:o,description:a.userPersonaDescInput,avatar:a.userPersonaAvatar,videoImg:a.userVideoImg,isDefault:s.userPersonas.length===0};if(g)s.userPersonas.push(C),a.currentUserPersonaId=C.id,d.showToast(i("chat.singleChat.settings.toast.personaSaved"));else{const k=s.userPersonas.findIndex(B=>B.id===a.currentUserPersonaId);k!==-1&&(C.isDefault=s.userPersonas[k].isDefault,s.userPersonas[k]=C,d.showToast(i("chat.singleChat.settings.toast.personaUpdated")))}s.saveData()},ve=()=>{a.currentUserPersonaId!=="new"&&d.showConfirm(i("chat.singleChat.settings.toast.deletePersona"),i("chat.singleChat.settings.toast.confirmDeletePersona"),()=>{s.userPersonas=s.userPersonas.filter(o=>o.id!==a.currentUserPersonaId),s.characters.forEach(o=>{o.userPersona===a.currentUserPersonaId&&(o.userPersona="")}),a.currentUserPersonaId="new",F("new"),s.saveData()})},me=o=>{if(!o)return;const g=s.bubblePresets.find(C=>C.id===o);g&&(a.bubbleCss=g.css,a.bubbleFontSize=g.fontSize)},be=()=>{const o=prompt(i("chat.singleChat.settings.toast.presetNameRequired"));if(!o)return;const g={id:Date.now().toString(),name:o,css:a.bubbleCss,fontSize:a.bubbleFontSize};s.bubblePresets.push(g),s.saveData(),a.currentBubblePresetId=g.id,d.showToast(i("chat.singleChat.settings.toast.presetSaved"))},Ce=()=>{a.currentBubblePresetId&&d.showConfirm(i("chat.singleChat.settings.toast.deleteBubblePreset"),i("chat.singleChat.settings.toast.confirmDeleteBubblePreset"),()=>{s.bubblePresets=s.bubblePresets.filter(o=>o.id!==a.currentBubblePresetId),s.saveData(),a.currentBubblePresetId="",d.showToast(i("chat.singleChat.settings.toast.presetDeleted"))})},_e=o=>{const g=o.content;switch(O.value){case"avatar":D.value&&(D.value.avatar=g);break;case"userPersonaAvatar":a.userPersonaAvatar=g;break;case"chatBg":a.chatBackground=g;break;case"videoBg":a.videoBg=g;break;case"userVideoImg":a.userVideoImg=g;break}},ye=o=>{const g=o.content,C=O.value,k={avatar:{obj:D.value,key:"avatar",toast:i("chat.singleChat.settings.toast.avatarUpdated")},chatBg:{obj:D.value,key:"chatBackground",toast:i("chat.singleChat.settings.toast.backgroundUpdated"),localKey:"chatBackground"},videoBg:{obj:D.value,key:"videoBg",toast:i("chat.singleChat.settings.toast.charImageUpdated"),localKey:"videoBg"},userPersonaAvatar:{obj:null,key:"userPersonaAvatar",toast:i("chat.singleChat.settings.toast.avatarUpdated")},userVideoImg:{obj:null,key:"userVideoImg",toast:i("chat.singleChat.settings.toast.userImageUpdated")}};if(k[C]){const B=k[C];B.obj?(B.obj[B.key]=g,B.localKey&&(a[B.localKey]=g)):(C==="userPersonaAvatar"&&(a.userPersonaAvatar=g),C==="userVideoImg"&&(a.userVideoImg=g)),s.saveData(),d.showToast(B.toast)}j.value=!1},fe=()=>{if(!a.chatBackground)return d.showToast(i("chat.singleChat.settings.toast.noBgToApply"));d.showConfirm(i("chat.singleChat.settings.toast.applyBgToAll"),i("chat.singleChat.settings.toast.confirmApplyBgToAll"),()=>{s.applyChatBackgroundToAll(a.chatBackground),d.showToast(i("chat.singleChat.settings.toast.appliedToAll"))})},ke=()=>{if(!a.chatBackground){d.showToast("当前没有聊天背景");return}d.showConfirm("清除背景","你确定要清除当前背景吗？",()=>{a.chatBackground="",D.value&&(D.value.chatBackground="",s.saveData(),d.showToast("背景已清除"))})},Se=o=>{a.isOnline=o;const[g,C]=o?["20","80"]:["150","300"];a.replyLengthMin=g,a.replyLengthMax=C,D.value&&(D.value.isOnline=o,s.saveData(),d.showToast(`${i(o?"chat.singleChat.settings.online":"chat.singleChat.settings.offline")}模式已开启`,"success"))},$e=()=>{$.value=!0},we=()=>{$.value=!1,L.value=!0},Ie=async()=>{$.value=!1,d.showToast("正在总结中，请稍候...","loading",2e3);const o=await s.summarizeMessages(y.id,{type:"recent"});d.showToast(o.message,o.success?"success":"error")},Pe=async()=>{const[o,g]=W.value.split("-").map(N=>N.trim()),C=parseInt(o,10),k=parseInt(g,10);if(isNaN(C)||isNaN(k)||C<=0||k<=0||C>k){d.showToast(i("chat.singleChat.settings.toast.invalidRange"),"error");return}L.value=!1,d.showToast("正在总结中，请稍候...","loading",2e3);const B=await s.summarizeMessages(y.id,{type:"range",start:C,end:k});d.showToast(B.message,B.success?"success":"error"),B.success&&(W.value="")},Be=async()=>{$.value=!1,d.showToast("正在总结中，请稍候...","loading",2e3);const o=await s.summarizeMessages(y.id,{type:"video"});d.showToast(o.message,o.success?"success":"error")},Ue=async o=>{const g=o==="char"?a.charLocationReal:a.userLocationReal,C=o==="char"?a.charLocationVirtual:a.userLocationVirtual,k=await b(g,C);k&&(o==="char"?(a.charLocationData=k,a.charLocationDisplay=k.shortDisplay):(a.userLocationData=k,a.userLocationDisplay=k.shortDisplay),d.showToast("位置和天气信息已更新","success"))},xe=o=>{const g=a.linkedNpcs.indexOf(o);g>-1?a.linkedNpcs.splice(g,1):a.linkedNpcs.push(o),a.npcCount=a.linkedNpcs.length},Le=o=>{const g=a.linkedCharacters.indexOf(o);g>-1?a.linkedCharacters.splice(g,1):a.linkedCharacters.push(o),a.linkedCharCount=a.linkedCharacters.length},Me=()=>{a.isBlocked?(a.isBlocked=!1,q(),d.showToast(i("chat.singleChat.settings.toast.unblocked"))):d.showConfirm(i("chat.singleChat.settings.confirmBlockTitle",{name:z.value}),i("chat.singleChat.settings.confirmBlockMsg",{name:z.value}),()=>{a.isBlocked=!0,q(),d.showToast(i("chat.singleChat.settings.toast.blocked"))},{messageStyle:{color:"#FF3B30",whiteSpace:"pre-wrap"},confirmText:"chat.singleChat.settings.block"})},De=()=>{d.showConfirm(i("chat.singleChat.settings.confirmClearTitle"),i("chat.singleChat.settings.confirmClearMsg",{name:z.value}),()=>{s.clearChatHistory(y.id),d.showToast(i("chat.singleChat.settings.toast.historyCleared")),a.msgCount=0,a.tokenCount=0},{messageStyle:{whiteSpace:"pre-wrap",color:"#FF3B30"},confirmText:"chat.singleChat.settings.clear"})},Ve=()=>{d.showConfirm(i("chat.deleteCharacterTitle"),i("chat.deleteCharacterConfirm",{name:z.value}),()=>{s.deleteCharacter(y.id),d.showToast(i("chat.toast.deleteSuccess"),"success"),n.back(),n.push({name:"chat-list"})},{messageStyle:{whiteSpace:"pre-wrap",color:"#FF3B30"},confirmText:"delete"})},Te=()=>{const o=D.value;if(!o)return;a.charNameInput=o.name,a.charNicknameInput=o.nickname||"",a.charPersonaInput=o.charPersona||"";const g=s.userPersonas.find(K=>K.id===o.userPersona);a.currentUserPersonaId=g?g.id:"new",F(a.currentUserPersonaId),a.backgroundActivityOverride=o.backgroundActivityOverride||"default",a.proactiveInterval=o.proactiveInterval||5,a.proactiveCooldown=o.proactiveCooldown||30,a.proactiveDailyLimit=o.proactiveDailyLimit||10,a.triggerMode=o.triggerMode||"always",a.proactiveIdleTime=o.proactiveIdleTime||15,a.isOnline=o.isOnline!==!1,a.preset=Array.isArray(o.preset)?o.preset:o.preset?[o.preset]:[],a.worldbook=o.worldbook||[];const[C,k]=(o.replyLength||(a.isOnline?"20-80":"150-300")).split("-");a.replyLengthMin=C||"",a.replyLengthMax=k||"";const B=o.realtimeSettings||{timeEnabled:!1,weatherEnabled:!1,charLocation:{},userLocation:{}};a.realtimeTimeEnabled=B.timeEnabled,a.realtimeWeatherEnabled=B.weatherEnabled,a.charLocationData=B.charLocation||{},a.userLocationData=B.userLocation||{},a.charLocationReal=a.charLocationData.real||"",a.charLocationVirtual=a.charLocationData.virtual||"",a.charLocationDisplay=a.charLocationData.shortDisplay||"",a.userLocationReal=a.userLocationData.real||"",a.userLocationVirtual=a.userLocationData.virtual||"",a.userLocationDisplay=a.userLocationData.shortDisplay||"",a.summaryRange=o.summaryRange||20,a.summaryPrompt=o.summaryPrompt||"",a.autoSummary=o.autoSummary||!1,a.memoryCount=o.memoryCount||10;const N=o.bubbleSettings||{};a.bubbleCss=N.css||"",a.bubbleFontSize=N.fontSize||14,a.chatBackground=o.chatBackground||"",a.videoBg=o.videoBg||"",a.userVideoImg=o.userVideoImg||"",a.apiConfig=o.api||"default",a.linkedNpcs=o.linkedNpcs||[],a.npcCount=a.linkedNpcs.length,a.linkedCharacters=o.linkedCharacters||[],a.linkedCharCount=a.linkedCharacters.length,a.isBlocked=o.isBlocked||!1;const Z=s.messages[y.id]||[];a.msgCount=Z.length,a.tokenCount=Math.ceil(Z.reduce((K,Ae)=>{var J;return K+(((J=Ae.content)==null?void 0:J.length)||0)},0)*1.5)},q=()=>{const o=D.value;if(!o)return;const g=a.currentUserPersonaId;let C=s.userPersonas.find(k=>k.id===g);g==="default"&&(C||(C={id:"default",name:i("chat.singleChat.settings.defaultUserPersona"),avatar:"",description:"",videoImg:""},s.userPersonas.unshift(C))),C&&(C.id!=="default"&&a.userPersonaNameInput.trim()&&(C.name=a.userPersonaNameInput.trim()),C.description=a.userPersonaDescInput,C.avatar=a.userPersonaAvatar,C.videoImg=a.userVideoImg),a.charLocationData.real=a.charLocationReal,a.charLocationData.virtual=a.charLocationVirtual,a.userLocationData.real=a.userLocationReal,a.userLocationData.virtual=a.userLocationVirtual,Object.assign(o,{name:a.charNameInput.trim()||o.name,nickname:a.charNicknameInput.trim(),charPersona:a.charPersonaInput,userPersona:a.currentUserPersonaId,backgroundActivityOverride:a.backgroundActivityOverride,proactiveInterval:a.proactiveInterval,proactiveCooldown:a.proactiveCooldown,proactiveDailyLimit:a.proactiveDailyLimit,triggerMode:a.triggerMode,proactiveIdleTime:a.proactiveIdleTime,isOnline:a.isOnline,preset:a.preset,worldbook:a.worldbook,replyLength:`${a.replyLengthMin}-${a.replyLengthMax}`,realtimeSettings:{timeEnabled:a.realtimeTimeEnabled,weatherEnabled:a.realtimeWeatherEnabled,charLocation:a.charLocationData,userLocation:a.userLocationData},summaryRange:a.summaryRange,summaryPrompt:a.summaryPrompt,autoSummary:a.autoSummary,memoryCount:a.memoryCount,bubbleSettings:{css:a.bubbleCss,fontSize:a.bubbleFontSize},chatBackground:a.chatBackground,videoBg:a.videoBg,api:a.apiConfig,linkedNpcs:a.linkedNpcs,linkedCharacters:a.linkedCharacters,isBlocked:a.isBlocked}),s.saveData(),d.showToast(i("theme.toast.saveSuccess"))};return Y(()=>a.currentUserPersonaId,o=>{o&&F(o)}),Y(()=>a.currentBubblePresetId,o=>{o&&me(o)}),{t:i,singleStore:s,themeStore:d,backgroundStore:f,sortedWorldBooks:r,sortedPresets:u,collapsedStates:S,showImageUploadModal:j,currentUploadTarget:O,showSummaryModal:$,showRangeInputModal:L,summaryRangeInput:W,showNpcScopeModal:ne,showCharScopeModal:oe,formState:a,character:D,charName:z,charAvatar:ie,userPersonaOptions:le,apiConfigOptions:re,bubblePresetOptions:ce,availableCharacters:de,isBackgroundActivityEffective:ue,previewStyle:ge,uploadModalTitle:pe,loadSettings:Te,saveSettings:q,saveUserPersona:he,deleteUserPersona:ve,saveBubblePreset:be,deleteBubblePreset:Ce,handleImagePreview:_e,handleImageUploadConfirm:ye,applyBgToAll:fe,clearChatBackground:ke,setMode:Se,triggerManualSummary:$e,openRangeInputModal:we,handleSummarizeRecent:Ie,handleSummarizeRange:Pe,handleSummarizeVideo:Be,mapLocation:Ue,toggleNpcScope:xe,toggleCharScope:Le,handleBlockOrUnblock:Me,handleClearHistory:De,handleDeleteCharacter:Ve}}const Ge={class:"card"},Ze={key:"roleInfo"},Je={class:"card-content"},Qe={class:"role-header-layout"},Xe=["src"],Ye={key:1,class:"role-avatar-placeholder"},et={class:"role-inputs-wrapper"},tt=["placeholder"],st=["placeholder"],at={class:"form-item-vertical"},nt={class:"label-main",style:{"margin-bottom":"5px"}},ot=["placeholder"],it={__name:"SettingsCharCard",props:{settings:{type:Object,required:!0}},setup(y){const i=y,{t:n,formState:s,charAvatar:d}=i.settings,f=U(()=>i.settings.collapsedStates.roleInfo),c=()=>{i.settings.collapsedStates.roleInfo=!i.settings.collapsedStates.roleInfo},r=()=>{i.settings.currentUploadTarget.value="avatar",i.settings.showImageUploadModal.value=!0};return(_,u)=>(h(),p("div",Ge,[t("div",{class:"card-title",onClick:c},[t("span",null,l(e(n)("chat.singleChat.settings.roleInfo")),1),t("div",{class:w(["collapse-arrow",{collapsed:f.value}])},[m(A,{name:"chevron-down"})],2)]),m(T,{name:"collapse"},{default:x(()=>[f.value?M("",!0):(h(),p("div",Ze,[t("div",Je,[t("div",Qe,[t("div",{class:"role-avatar-wrapper",onClick:r},[e(d)?(h(),p("img",{key:0,src:e(d),alt:"头像",class:"role-avatar-img"},null,8,Xe)):(h(),p("div",Ye,l(e(n)("chat.singleChat.settings.uploadAvatar")),1))]),t("div",et,[I(t("input",{type:"text","onUpdate:modelValue":u[0]||(u[0]=v=>e(s).charNameInput=v),class:"base-input",placeholder:e(n)("chat.singleChat.settings.roleNamePlaceholder")},null,8,tt),[[P,e(s).charNameInput]]),I(t("input",{type:"text","onUpdate:modelValue":u[1]||(u[1]=v=>e(s).charNicknameInput=v),class:"base-input",placeholder:e(n)("chat.singleChat.settings.roleNicknamePlaceholder")},null,8,st),[[P,e(s).charNicknameInput]])])]),t("div",at,[t("div",nt,l(e(n)("chat.singleChat.settings.rolePersona")),1),I(t("textarea",{"onUpdate:modelValue":u[2]||(u[2]=v=>e(s).charPersonaInput=v),class:"base-input",style:{height:"80px","min-height":"40px"},placeholder:e(n)("chat.singleChat.settings.rolePersonaPlaceholder")},null,8,ot),[[P,e(s).charPersonaInput]])])])]))]),_:1})]))}},lt=V(it,[["__scopeId","data-v-ca172f5e"]]),rt={class:"card"},ct={key:"userInfo"},dt={class:"card-content"},ut={class:"settings-pure-item",style:{"border-bottom":"none"}},gt={class:"settings-pure-label"},pt={class:"user-header-layout"},ht=["src"],vt={key:1,class:"role-avatar-placeholder"},mt={class:"user-inputs-wrapper"},bt={class:"user-actions-row"},Ct=["placeholder"],_t={class:"form-item-vertical"},yt={class:"label-main",style:{"margin-bottom":"5px"}},ft=["placeholder"],kt={__name:"SettingsUserCard",props:{settings:{type:Object,required:!0}},setup(y){const i=y,{t:n,formState:s,userPersonaOptions:d,saveUserPersona:f,deleteUserPersona:c}=i.settings,r=U(()=>i.settings.collapsedStates.userInfo),_=()=>{i.settings.collapsedStates.userInfo=!i.settings.collapsedStates.userInfo},u=()=>{i.settings.currentUploadTarget.value="userPersonaAvatar",i.settings.showImageUploadModal.value=!0};return(v,b)=>(h(),p("div",rt,[t("div",{class:"card-title",onClick:_},[t("span",null,l(e(n)("chat.singleChat.settings.userInfo")),1),t("div",{class:w(["collapse-arrow",{collapsed:r.value}])},[m(A,{name:"chevron-down"})],2)]),m(T,{name:"collapse"},{default:x(()=>[r.value?M("",!0):(h(),p("div",ct,[t("div",dt,[t("div",ut,[t("div",gt,l(e(n)("chat.singleChat.settings.currentUserPersona")),1),m(G,{options:e(d),modelValue:e(s).currentUserPersonaId,"onUpdate:modelValue":b[0]||(b[0]=S=>e(s).currentUserPersonaId=S)},null,8,["options","modelValue"])]),t("div",pt,[t("div",{class:"user-avatar-wrapper",onClick:u},[e(s).userPersonaAvatar?(h(),p("img",{key:0,src:e(s).userPersonaAvatar,alt:"User",class:"role-avatar-img"},null,8,ht)):(h(),p("div",vt,l(e(n)("chat.singleChat.settings.uploadAvatar")),1))]),t("div",mt,[t("div",bt,[t("button",{class:"btn btn-secondary btn-mini-grow",onClick:b[1]||(b[1]=(...S)=>e(f)&&e(f)(...S))},l(e(n)("chat.singleChat.settings.savePersona")),1),t("button",{class:"btn btn-danger btn-mini-grow",onClick:b[2]||(b[2]=(...S)=>e(c)&&e(c)(...S))},l(e(n)("chat.singleChat.settings.deletePersona")),1)]),I(t("input",{type:"text","onUpdate:modelValue":b[3]||(b[3]=S=>e(s).userPersonaNameInput=S),class:"base-input",placeholder:e(n)("chat.singleChat.settings.userNamePlaceholder")},null,8,Ct),[[P,e(s).userPersonaNameInput]])])]),t("div",_t,[t("div",yt,l(e(n)("chat.singleChat.settings.userPersona")),1),I(t("textarea",{"onUpdate:modelValue":b[4]||(b[4]=S=>e(s).userPersonaDescInput=S),class:"base-input",style:{height:"80px","min-height":"40px"},placeholder:e(n)("chat.singleChat.settings.userPersonaPlaceholder")},null,8,ft),[[P,e(s).userPersonaDescInput]])])])]))]),_:1})]))}},St=V(kt,[["__scopeId","data-v-784c9ba3"]]),$t={class:"card"},wt={class:"card-title-remark"},It={key:"backgroundActivity"},Pt={class:"card-content"},Bt={class:"settings-item-input"},Ut={class:"label-col"},xt={class:"label-main"},Lt={class:"settings-pure-value"},Mt={class:"settings-item-input"},Dt={class:"label-col"},Vt={class:"label-main"},Tt={class:"label-sub"},At={class:"mode-selector"},Nt={key:0},Rt={class:"settings-item-input"},Ot={class:"label-col"},zt={class:"label-main"},jt={class:"label-sub"},Et={class:"settings-item-input"},Wt={class:"label-col"},Ft={class:"label-main"},qt={class:"label-sub"},Kt={class:"settings-item-input"},Ht={class:"label-col"},Gt={class:"label-main"},Zt={class:"label-sub"},Jt={class:"settings-item-input"},Qt={class:"label-col"},Xt={class:"label-main"},Yt={class:"label-sub"},es={class:"mode-selector"},ts={key:0,class:"settings-item-input"},ss={class:"label-col"},as={class:"label-main"},ns={class:"label-sub"},os={__name:"SettingsBackgroundCard",props:{settings:{type:Object,required:!0}},setup(y){const i=y,{t:n,formState:s,backgroundStore:d,isBackgroundActivityEffective:f}=i.settings,c=U(()=>i.settings.collapsedStates.backgroundActivity),r=()=>{i.settings.collapsedStates.backgroundActivity=!i.settings.collapsedStates.backgroundActivity};return(_,u)=>(h(),p("div",$t,[t("div",{class:"card-title",onClick:r},[t("span",null,l(e(n)("chat.singleChat.settings.backgroundActivity")),1),t("div",{class:w(["collapse-arrow",{collapsed:c.value}])},[m(A,{name:"chevron-down"})],2)]),t("div",wt,l(e(n)("chat.singleChat.settings.backgroundActivityWarning")),1),m(T,{name:"collapse"},{default:x(()=>[c.value?M("",!0):(h(),p("div",It,[t("div",Pt,[t("div",Bt,[t("div",Ut,[t("div",xt,l(e(n)("chat.singleChat.settings.globalSettings")),1)]),t("div",Lt,l(e(d).globalBackgroundActivity?e(n)("chat.singleChat.settings.globalOn"):e(n)("chat.singleChat.settings.globalOff")),1)]),t("div",Mt,[t("div",Dt,[t("div",Vt,l(e(n)("chat.singleChat.settings.overrideGlobal")),1),t("div",Tt,l(e(n)("chat.singleChat.settings.overrideGlobalDesc")),1)]),t("div",At,[t("div",{class:w(["mode-option",{active:e(s).backgroundActivityOverride==="default"}]),onClick:u[0]||(u[0]=v=>e(s).backgroundActivityOverride="default")},l(e(n)("chat.singleChat.settings.default")),3),t("div",{class:w(["mode-option",{active:e(s).backgroundActivityOverride==="on"}]),onClick:u[1]||(u[1]=v=>e(s).backgroundActivityOverride="on")},l(e(n)("chat.singleChat.settings.on")),3),t("div",{class:w(["mode-option",{active:e(s).backgroundActivityOverride==="off"}]),onClick:u[2]||(u[2]=v=>e(s).backgroundActivityOverride="off")},l(e(n)("chat.singleChat.settings.off")),3)])]),e(f)?(h(),p("div",Nt,[t("div",Rt,[t("div",Ot,[t("div",zt,l(e(n)("chat.singleChat.settings.interval")),1),t("div",jt,l(e(n)("chat.singleChat.settings.intervalDesc")),1)]),I(t("input",{type:"number","onUpdate:modelValue":u[3]||(u[3]=v=>e(s).proactiveInterval=v),class:"base-input base-input-short",placeholder:"5"},null,512),[[P,e(s).proactiveInterval,void 0,{number:!0}]])]),t("div",Et,[t("div",Wt,[t("div",Ft,l(e(n)("chat.singleChat.settings.cooldown")),1),t("div",qt,l(e(n)("chat.singleChat.settings.cooldownDesc")),1)]),I(t("input",{type:"number","onUpdate:modelValue":u[4]||(u[4]=v=>e(s).proactiveCooldown=v),class:"base-input base-input-short",placeholder:"30"},null,512),[[P,e(s).proactiveCooldown,void 0,{number:!0}]])]),t("div",Kt,[t("div",Ht,[t("div",Gt,l(e(n)("chat.singleChat.settings.dailyLimit")),1),t("div",Zt,l(e(n)("chat.singleChat.settings.dailyLimitDesc")),1)]),I(t("input",{type:"number","onUpdate:modelValue":u[5]||(u[5]=v=>e(s).proactiveDailyLimit=v),class:"base-input base-input-short",placeholder:"10"},null,512),[[P,e(s).proactiveDailyLimit,void 0,{number:!0}]])]),t("div",Jt,[t("div",Qt,[t("div",Xt,l(e(n)("chat.singleChat.settings.triggerMode")),1),t("div",Yt,l(e(n)("chat.singleChat.settings.triggerModeDesc")),1)]),t("div",es,[t("div",{class:w(["mode-option",{active:e(s).triggerMode==="idle"}]),onClick:u[6]||(u[6]=v=>e(s).triggerMode="idle")},l(e(n)("chat.singleChat.settings.idleMode")),3),t("div",{class:w(["mode-option",{active:e(s).triggerMode==="always"}]),onClick:u[7]||(u[7]=v=>e(s).triggerMode="always")},l(e(n)("chat.singleChat.settings.alwaysMode")),3)])]),e(s).triggerMode==="idle"?(h(),p("div",ts,[t("div",ss,[t("div",as,l(e(n)("chat.singleChat.settings.idleTime")),1),t("div",ns,l(e(n)("chat.singleChat.settings.idleTimeDesc")),1)]),I(t("input",{type:"number","onUpdate:modelValue":u[8]||(u[8]=v=>e(s).proactiveIdleTime=v),class:"base-input base-input-short",placeholder:"15"},null,512),[[P,e(s).proactiveIdleTime,void 0,{number:!0}]])])):M("",!0)])):M("",!0)])]))]),_:1})]))}},is=V(os,[["__scopeId","data-v-f820107f"]]),ls={class:"card"},rs={key:"modeSettings"},cs={class:"card-content"},ds={class:"settings-pure-item"},us={class:"settings-pure-label"},gs={class:"mode-selector"},ps={key:0,class:"settings-pure-item"},hs={class:"settings-pure-label"},vs={class:"settings-pure-item"},ms={class:"settings-pure-label"},bs={class:"settings-item-input"},Cs={class:"label-col"},_s={class:"label-main"},ys={class:"label-sub"},fs={class:"reply-length-container"},ks=["placeholder"],Ss=["placeholder"],$s={__name:"SettingsModeCard",props:{settings:{type:Object,required:!0}},setup(y){const i=y,{t:n,formState:s,sortedPresets:d,sortedWorldBooks:f,setMode:c}=i.settings,r=U(()=>i.settings.collapsedStates.modeSettings),_=()=>{i.settings.collapsedStates.modeSettings=!i.settings.collapsedStates.modeSettings};return(u,v)=>(h(),p("div",ls,[t("div",{class:"card-title",onClick:_},[t("span",null,l(e(n)("chat.singleChat.settings.mode")),1),t("div",{class:w(["collapse-arrow",{collapsed:r.value}])},[m(A,{name:"chevron-down"})],2)]),m(T,{name:"collapse"},{default:x(()=>[r.value?M("",!0):(h(),p("div",rs,[t("div",cs,[t("div",ds,[t("div",us,l(e(n)("chat.singleChat.settings.modeSelect")),1),t("div",gs,[t("div",{class:w(["mode-option",{active:e(s).isOnline}]),onClick:v[0]||(v[0]=b=>e(c)(!0))},l(e(n)("chat.singleChat.settings.online")),3),t("div",{class:w(["mode-option",{active:!e(s).isOnline}]),onClick:v[1]||(v[1]=b=>e(c)(!1))},l(e(n)("chat.singleChat.settings.offline")),3)])]),e(s).isOnline?M("",!0):(h(),p("div",ps,[t("div",hs,l(e(n)("chat.singleChat.settings.linkPreset")),1),m(ae,{modelValue:e(s).preset,"onUpdate:modelValue":v[2]||(v[2]=b=>e(s).preset=b),options:e(d),labelKey:"title",valueKey:"id",childrenKey:"entries",textAlign:"right",selectorWidth:"auto",dropdownWidth:"200px"},null,8,["modelValue","options"])])),t("div",vs,[t("div",ms,l(e(n)("chat.singleChat.settings.linkWorldbook")),1),m(ae,{modelValue:e(s).worldbook,"onUpdate:modelValue":v[3]||(v[3]=b=>e(s).worldbook=b),options:e(f),"label-key":"title","value-key":"id","children-key":"entries",textAlign:"right",selectorWidth:"auto",dropdownWidth:"200px"},null,8,["modelValue","options"])]),t("div",bs,[t("div",Cs,[t("div",_s,l(e(n)("chat.singleChat.settings.replyLength")),1),t("div",ys,l(e(n)("chat.singleChat.settings.replyLengthDesc")),1)]),t("div",fs,[I(t("input",{type:"number","onUpdate:modelValue":v[4]||(v[4]=b=>e(s).replyLengthMin=b),class:"base-input base-input-mini",placeholder:e(n)("chat.singleChat.settings.min")},null,8,ks),[[P,e(s).replyLengthMin]]),v[6]||(v[6]=t("span",null,"-",-1)),I(t("input",{type:"number","onUpdate:modelValue":v[5]||(v[5]=b=>e(s).replyLengthMax=b),class:"base-input base-input-mini",placeholder:e(n)("chat.singleChat.settings.max")},null,8,Ss),[[P,e(s).replyLengthMax]])])])])]))]),_:1})]))}},ws=V($s,[["__scopeId","data-v-3b7fd186"]]),Is={class:"card"},Ps={key:"realtimeSense"},Bs={class:"card-content"},Us={class:"settings-item-input"},xs={class:"settings-item-input"},Ls={key:0},Ms={class:"form-item-vertical"},Ds={class:"location-input-group"},Vs={class:"location-display"},Ts={class:"form-item-vertical"},As={class:"location-input-group"},Ns={class:"location-display"},Rs={__name:"SettingsRealtimeCard",props:{settings:{type:Object,required:!0}},setup(y){const i=y,{formState:n,mapLocation:s}=i.settings,d=U(()=>i.settings.collapsedStates.realtimeSense),f=()=>{i.settings.collapsedStates.realtimeSense=!i.settings.collapsedStates.realtimeSense};return(c,r)=>(h(),p("div",Is,[t("div",{class:"card-title",onClick:f},[r[8]||(r[8]=t("span",null,"实时感知",-1)),t("div",{class:w(["collapse-arrow",{collapsed:d.value}])},[m(A,{name:"chevron-down"})],2)]),m(T,{name:"collapse"},{default:x(()=>[d.value?M("",!0):(h(),p("div",Ps,[t("div",Bs,[t("div",Us,[r[9]||(r[9]=t("div",{class:"label-col"},[t("div",{class:"label-main"},"实时时间")],-1)),t("div",{class:w(["toggle-switch",{active:e(n).realtimeTimeEnabled}]),onClick:r[0]||(r[0]=_=>e(n).realtimeTimeEnabled=!e(n).realtimeTimeEnabled)},null,2)]),t("div",xs,[r[10]||(r[10]=t("div",{class:"label-col"},[t("div",{class:"label-main"},"实时天气")],-1)),t("div",{class:w(["toggle-switch",{active:e(n).realtimeWeatherEnabled}]),onClick:r[1]||(r[1]=_=>e(n).realtimeWeatherEnabled=!e(n).realtimeWeatherEnabled)},null,2)]),m(T,{name:"collapse"},{default:x(()=>[e(n).realtimeWeatherEnabled?(h(),p("div",Ls,[t("div",Ms,[r[11]||(r[11]=t("div",{class:"label-main",style:{"margin-bottom":"5px"}},"角色所在地",-1)),t("div",Ds,[I(t("input",{type:"text","onUpdate:modelValue":r[2]||(r[2]=_=>e(n).charLocationReal=_),class:"base-input",placeholder:"真实地名"},null,512),[[P,e(n).charLocationReal]]),I(t("input",{type:"text","onUpdate:modelValue":r[3]||(r[3]=_=>e(n).charLocationVirtual=_),class:"base-input",placeholder:"虚拟地名 (可选)"},null,512),[[P,e(n).charLocationVirtual]]),t("button",{class:"btn btn-secondary btn-sm",onClick:r[4]||(r[4]=_=>e(s)("char"))},"确定")]),t("div",Vs,l(e(n).charLocationDisplay),1)]),t("div",Ts,[r[12]||(r[12]=t("div",{class:"label-main",style:{"margin-bottom":"5px"}},"用户所在地",-1)),t("div",As,[I(t("input",{type:"text","onUpdate:modelValue":r[5]||(r[5]=_=>e(n).userLocationReal=_),class:"base-input",placeholder:"真实地名"},null,512),[[P,e(n).userLocationReal]]),I(t("input",{type:"text","onUpdate:modelValue":r[6]||(r[6]=_=>e(n).userLocationVirtual=_),class:"base-input",placeholder:"虚拟地名 (可选)"},null,512),[[P,e(n).userLocationVirtual]]),t("button",{class:"btn btn-secondary btn-sm",onClick:r[7]||(r[7]=_=>e(s)("user"))},"确定")]),t("div",Ns,l(e(n).userLocationDisplay),1)])])):M("",!0)]),_:1})])]))]),_:1})]))}},Os=V(Rs,[["__scopeId","data-v-9c17a441"]]),zs={class:"card"},js={key:"summarySettings"},Es={class:"card-content"},Ws={class:"settings-item-input"},Fs={class:"label-col"},qs={class:"label-main"},Ks={class:"label-sub"},Hs={class:"form-item-vertical"},Gs={class:"label-main",style:{"margin-bottom":"5px"}},Zs=["placeholder"],Js={class:"settings-item-input"},Qs={class:"label-col"},Xs={class:"label-main"},Ys={class:"label-sub"},ea={class:"settings-btn-row flex-distribute-children",style:{padding:"15px 0","border-bottom":"1px solid #f5f5f5"}},ta={class:"settings-item-input"},sa={class:"label-col"},aa={class:"label-main"},na={class:"label-sub"},oa={class:"settings-pure-item"},ia={class:"settings-pure-label"},la={class:"settings-pure-item"},ra={class:"settings-pure-label"},ca={class:"settings-pure-value"},da={class:"settings-pure-item"},ua={class:"settings-pure-label"},ga={class:"settings-pure-value"},pa={__name:"SettingsSummaryCard",props:{settings:{type:Object,required:!0},charId:{type:String,required:!0}},setup(y){const i=y,{t:n,formState:s,apiConfigOptions:d,triggerManualSummary:f}=i.settings,c=H(),r=U(()=>i.settings.collapsedStates.summarySettings),_=()=>{i.settings.collapsedStates.summarySettings=!i.settings.collapsedStates.summarySettings},u=()=>{c.push({name:"memory-bank",params:{charId:i.charId}})};return(v,b)=>(h(),p("div",zs,[t("div",{class:"card-title",onClick:_},[t("span",null,l(e(n)("chat.singleChat.settings.summary")),1),t("div",{class:w(["collapse-arrow",{collapsed:r.value}])},[m(A,{name:"chevron-down"})],2)]),m(T,{name:"collapse"},{default:x(()=>[r.value?M("",!0):(h(),p("div",js,[t("div",Es,[t("div",Ws,[t("div",Fs,[t("div",qs,l(e(n)("chat.singleChat.settings.summaryRange")),1),t("div",Ks,l(e(n)("chat.singleChat.settings.summaryRangeDesc")),1)]),I(t("input",{type:"number","onUpdate:modelValue":b[0]||(b[0]=S=>e(s).summaryRange=S),class:"base-input base-input-short",placeholder:"20"},null,512),[[P,e(s).summaryRange,void 0,{number:!0}]])]),t("div",Hs,[t("div",Gs,l(e(n)("chat.singleChat.settings.summaryPrompt")),1),I(t("textarea",{"onUpdate:modelValue":b[1]||(b[1]=S=>e(s).summaryPrompt=S),class:"base-input",style:{height:"80px","min-height":"40px"},placeholder:e(n)("chat.singleChat.settings.summaryPromptPlaceholder")},null,8,Zs),[[P,e(s).summaryPrompt]])]),t("div",Js,[t("div",Qs,[t("div",Xs,l(e(n)("chat.singleChat.settings.autoSummary")),1),t("div",Ys,l(e(n)("chat.singleChat.settings.autoSummaryDesc")),1)]),t("div",{class:w(["toggle-switch",{active:e(s).autoSummary}]),onClick:b[2]||(b[2]=S=>e(s).autoSummary=!e(s).autoSummary)},null,2)]),t("div",ea,[t("button",{class:"btn btn-secondary",onClick:b[3]||(b[3]=(...S)=>e(f)&&e(f)(...S))},l(e(n)("chat.singleChat.settings.manualSummary")),1),t("button",{class:"btn btn-secondary",onClick:u},l(e(n)("chat.singleChat.settings.viewSummary")),1)]),t("div",ta,[t("div",sa,[t("div",aa,l(e(n)("chat.singleChat.settings.contextMemory")),1),t("div",na,l(e(n)("chat.singleChat.settings.contextMemoryDesc")),1)]),I(t("input",{type:"number","onUpdate:modelValue":b[4]||(b[4]=S=>e(s).memoryCount=S),class:"base-input base-input-short",placeholder:"10"},null,512),[[P,e(s).memoryCount,void 0,{number:!0}]])]),t("div",oa,[t("div",ia,l(e(n)("chat.singleChat.settings.apiConfig")),1),m(G,{options:e(d),modelValue:e(s).apiConfig,"onUpdate:modelValue":b[5]||(b[5]=S=>e(s).apiConfig=S)},null,8,["options","modelValue"])]),t("div",la,[t("div",ra,l(e(n)("chat.singleChat.settings.tokenCount")),1),t("div",ca,l(e(s).tokenCount),1)]),t("div",da,[t("div",ua,l(e(n)("chat.singleChat.settings.msgCount")),1),t("div",ga,l(e(s).msgCount),1)])])]))]),_:1})]))}},ha=V(pa,[["__scopeId","data-v-7597ef0f"]]),va={class:"card"},ma={key:"bubbleSettings"},ba={class:"card-content"},Ca={class:"settings-section-title"},_a={class:"settings-row-group"},ya={class:"settings-pure-label",style:{width:"60px"}},fa={style:{flex:"1",margin:"0 10px"}},ka={class:"btn-group-mini"},Sa=["disabled"],$a={class:"bubble-preview-container"},wa={class:"bubble-preview-area"},Ia={class:"preview-msg-row left"},Pa={class:"preview-avatar char"},Ba=["src"],Ua={key:1,class:"default-avatar"},xa={class:"preview-msg-row right"},La={class:"preview-avatar user"},Ma=["src"],Da={key:1,class:"default-avatar"},Va={class:"settings-item-input"},Ta={class:"label-col"},Aa={class:"label-main"},Na={class:"slider-container gray-slider"},Ra={class:"slider-value"},Oa={class:"form-item-vertical no-border"},za={class:"label-main",style:{"margin-bottom":"5px"}},ja=["placeholder"],Ea={class:"settings-section-title"},Wa={class:"settings-item-avatar",style:{"border-bottom":"none","margin-bottom":"0"}},Fa={class:"avatar-layout"},qa={class:"avatar-controls",style:{width:"100%"}},Ka={__name:"SettingsBeautifyCard",props:{settings:{type:Object,required:!0}},setup(y){const i=y,{t:n,formState:s,charAvatar:d,bubblePresetOptions:f,previewStyle:c,saveBubblePreset:r,deleteBubblePreset:_,applyBgToAll:u,clearChatBackground:v}=i.settings,b=U(()=>i.settings.collapsedStates.bubbleSettings),S=()=>{i.settings.collapsedStates.bubbleSettings=!i.settings.collapsedStates.bubbleSettings},j=()=>{i.settings.currentUploadTarget.value="chatBg",i.settings.showImageUploadModal.value=!0};return(O,$)=>(h(),p("div",va,[t("div",{class:"card-title",onClick:S},[t("span",null,l(e(n)("chat.singleChat.settings.beautification")),1),t("div",{class:w(["collapse-arrow",{collapsed:b.value}])},[m(A,{name:"chevron-down"})],2)]),m(T,{name:"collapse"},{default:x(()=>[b.value?M("",!0):(h(),p("div",ma,[t("div",ba,[t("div",Ca,l(e(n)("chat.singleChat.settings.bubble")),1),t("div",_a,[t("div",ya,l(e(n)("chat.singleChat.settings.bubblePreset")),1),t("div",fa,[m(G,{options:e(f),modelValue:e(s).currentBubblePresetId,"onUpdate:modelValue":$[0]||($[0]=L=>e(s).currentBubblePresetId=L)},null,8,["options","modelValue"])]),t("div",ka,[t("button",{class:"btn btn-secondary btn-mini",onClick:$[1]||($[1]=(...L)=>e(r)&&e(r)(...L))},l(e(n)("save")),1),t("button",{class:"btn btn-danger btn-mini",disabled:!e(s).currentBubblePresetId,onClick:$[2]||($[2]=(...L)=>e(_)&&e(_)(...L))},l(e(n)("delete")),9,Sa)])]),t("div",$a,[t("div",wa,[t("div",Ia,[t("div",Pa,[e(d)?(h(),p("img",{key:0,src:e(d),style:{width:"100%",height:"100%","object-fit":"cover"}},null,8,Ba)):(h(),p("div",Ua))]),t("div",{class:"preview-bubble char",style:ee(e(c))},l(e(n)("chat.singleChat.settings.bubblePreview")),5)]),t("div",xa,[t("div",{class:"preview-bubble user",style:ee(e(c))},l(e(n)("chat.singleChat.settings.bubblePreview")),5),t("div",La,[e(s).userPersonaAvatar?(h(),p("img",{key:0,src:e(s).userPersonaAvatar,style:{width:"100%",height:"100%","object-fit":"cover"}},null,8,Ma)):(h(),p("div",Da))])])])]),t("div",Va,[t("div",Ta,[t("div",Aa,l(e(n)("chat.singleChat.settings.fontSize")),1)]),t("div",Na,[I(t("input",{type:"range","onUpdate:modelValue":$[3]||($[3]=L=>e(s).bubbleFontSize=L),min:"10",max:"30",step:"1"},null,512),[[P,e(s).bubbleFontSize,void 0,{number:!0}]]),t("span",Ra,l(e(s).bubbleFontSize),1)])]),t("div",Oa,[t("div",za,l(e(n)("chat.singleChat.settings.bubbleCss")),1),I(t("textarea",{"onUpdate:modelValue":$[4]||($[4]=L=>e(s).bubbleCss=L),class:"base-input",placeholder:e(n)("chat.singleChat.settings.cssPlaceholder"),style:{"font-family":"monospace",height:"120px"}},null,8,ja),[[P,e(s).bubbleCss]])]),$[7]||($[7]=t("div",{class:"settings-divider"},null,-1)),t("div",Ea,l(e(n)("chat.singleChat.settings.chatBackground")),1),t("div",Wa,[t("div",Fa,[t("div",qa,[t("button",{class:"btn btn-secondary",onClick:j},l(e(n)("chat.singleChat.settings.setChatBackground")),1),t("button",{class:"btn btn-secondary",onClick:$[5]||($[5]=(...L)=>e(u)&&e(u)(...L)),style:{"margin-top":"5px"}},l(e(n)("chat.singleChat.settings.applyToAll")),1),t("button",{class:"btn btn-danger",onClick:$[6]||($[6]=(...L)=>e(v)&&e(v)(...L)),style:{"margin-top":"5px"}},"清除当前背景")])])])])]))]),_:1})]))}},Ha=V(Ka,[["__scopeId","data-v-bab8faef"]]),Ga={class:"card"},Za={key:"videoSettings"},Ja={class:"card-content"},Qa={class:"video-settings-container"},Xa={class:"video-setting-col"},Ya={class:"settings-item-label center"},en=["src"],tn={key:1,class:"default-avatar bg-placeholder"},sn={class:"video-setting-col"},an={class:"settings-item-label center"},nn=["src"],on={key:1,class:"default-avatar bg-placeholder"},ln={__name:"SettingsVideoCard",props:{settings:{type:Object,required:!0}},setup(y){const i=y,{t:n,formState:s}=i.settings,d=U(()=>i.settings.collapsedStates.videoSettings),f=()=>{i.settings.collapsedStates.videoSettings=!i.settings.collapsedStates.videoSettings},c=()=>{i.settings.currentUploadTarget.value="videoBg",i.settings.showImageUploadModal.value=!0},r=()=>{i.settings.currentUploadTarget.value="userVideoImg",i.settings.showImageUploadModal.value=!0};return(_,u)=>(h(),p("div",Ga,[t("div",{class:"card-title",onClick:f},[t("span",null,l(e(n)("chat.singleChat.settings.videoCall")),1),t("div",{class:w(["collapse-arrow",{collapsed:d.value}])},[m(A,{name:"chevron-down"})],2)]),m(T,{name:"collapse"},{default:x(()=>[d.value?M("",!0):(h(),p("div",Za,[t("div",Ja,[t("div",Qa,[t("div",Xa,[t("div",Ya,l(e(n)("chat.singleChat.settings.characterImage")),1),t("div",{class:"video-preview",onClick:c},[e(s).videoBg?(h(),p("img",{key:0,src:e(s).videoBg,class:"bg-img"},null,8,en)):(h(),p("div",tn,l(e(n)("chat.singleChat.settings.setImage")),1))])]),t("div",sn,[t("div",an,l(e(n)("chat.singleChat.settings.userImage")),1),t("div",{class:"video-preview",onClick:r},[e(s).userVideoImg?(h(),p("img",{key:0,src:e(s).userVideoImg,class:"bg-img"},null,8,nn)):(h(),p("div",on,l(e(n)("chat.singleChat.settings.setImage")),1))])])])])]))]),_:1})]))}},rn=V(ln,[["__scopeId","data-v-adb0dc45"]]),cn={class:"card"},dn={key:"advancedSettings"},un={class:"card-content"},gn={class:"settings-pure-label"},pn={class:"settings-pure-value"},hn={class:"settings-pure-value"},vn={__name:"SettingsAdvancedCard",props:{settings:{type:Object,required:!0}},setup(y){const i=y,{t:n,formState:s,showNpcScopeModal:d,showCharScopeModal:f}=i.settings,c=U(()=>i.settings.collapsedStates.advancedSettings),r=()=>{i.settings.collapsedStates.advancedSettings=!i.settings.collapsedStates.advancedSettings};return(_,u)=>(h(),p("div",cn,[t("div",{class:"card-title",onClick:r},[t("span",null,l(e(n)("chat.singleChat.settings.advanced")),1),t("div",{class:w(["collapse-arrow",{collapsed:c.value}])},[m(A,{name:"chevron-down"})],2)]),m(T,{name:"collapse"},{default:x(()=>[c.value?M("",!0):(h(),p("div",dn,[t("div",un,[t("div",{class:"settings-pure-item",onClick:u[0]||(u[0]=v=>e(d).value=!0)},[t("div",gn,l(e(n)("chat.singleChat.settings.linkedNpc")),1),t("div",pn,l(e(n)("chat.singleChat.settings.npcCount",{count:e(s).npcCount})),1),u[2]||(u[2]=t("div",{class:"settings-pure-arrow"},"›",-1))]),t("div",{class:"settings-pure-item",onClick:u[1]||(u[1]=v=>e(f).value=!0)},[u[3]||(u[3]=t("div",{class:"settings-pure-label"},"关联角色",-1)),t("div",hn,l(e(s).linkedCharCount)+"个",1),u[4]||(u[4]=t("div",{class:"settings-pure-arrow"},"›",-1))])])]))]),_:1})]))}},mn=V(vn,[["__scopeId","data-v-2a3162e9"]]),bn={class:"danger-zone"},Cn={class:"danger-btn-content"},_n={class:"danger-btn-title"},yn={class:"danger-btn-desc"},fn={class:"danger-btn-content"},kn={class:"danger-btn-title"},Sn={class:"danger-btn-desc"},$n={class:"danger-btn-content"},wn={class:"danger-btn-title"},In={class:"danger-btn-desc"},Pn={__name:"SettingsDangerZone",props:{settings:{type:Object,required:!0}},setup(y){const i=y,{t:n,formState:s,handleBlockOrUnblock:d,handleClearHistory:f,handleDeleteCharacter:c}=i.settings;return(r,_)=>(h(),p("div",bn,[t("button",{class:"btn btn-danger big-btn",onClick:_[0]||(_[0]=(...u)=>e(d)&&e(d)(...u))},[t("div",Cn,[t("div",_n,l(e(s).isBlocked?e(n)("chat.singleChat.settings.unblock"):e(n)("chat.singleChat.settings.blockCharacter")),1),t("div",yn,l(e(n)("chat.singleChat.settings.blockCharacterDesc")),1)])]),t("button",{class:"btn btn-danger big-btn",onClick:_[1]||(_[1]=(...u)=>e(f)&&e(f)(...u))},[t("div",fn,[t("div",kn,l(e(n)("chat.singleChat.settings.clearHistory")),1),t("div",Sn,l(e(n)("chat.singleChat.settings.clearHistoryDesc")),1)])]),t("button",{class:"btn btn-danger big-btn",onClick:_[2]||(_[2]=(...u)=>e(c)&&e(c)(...u))},[t("div",$n,[t("div",wn,l(e(n)("chat.deleteCharacterTitle")),1),t("div",In,l(e(n)("chat.deleteCharacterWarning")),1)])])]))}},Bn=V(Pn,[["__scopeId","data-v-81978127"]]),Un={class:"chat-settings active"},xn={class:"app-header"},Ln={class:"title"},Mn={class:"action-btn"},Dn={class:"app-content settings-content"},Vn={class:"modal-options centered-text"},Tn={class:"option-text"},An={class:"option-text"},Nn={class:"option-text"},Rn=["placeholder"],On={class:"scope-list",style:{"max-height":"300px","overflow-y":"auto"}},zn={key:0,class:"empty-state-mini"},jn=["onClick"],En={key:0,xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"3","stroke-linecap":"round","stroke-linejoin":"round"},Wn={class:"scope-name"},Fn={class:"scope-list",style:{"max-height":"300px","overflow-y":"auto"}},qn={key:0,class:"empty-state-mini"},Kn=["onClick"],Hn={key:0,xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"3","stroke-linecap":"round","stroke-linejoin":"round"},Gn={class:"scope-name"},Zn={__name:"SingleChatSettings",props:{id:{type:String,required:!0}},setup(y){const i=y,n=H(),s=He(i),d=()=>{n.back()};return qe(()=>{if(!s.character.value){d();return}s.loadSettings()}),(f,c)=>(h(),p("div",Un,[t("div",xn,[t("div",{class:"back-btn",onClick:d},[...c[15]||(c[15]=[t("svg",{class:"svg-icon",viewBox:"0 0 24 24"},[t("polyline",{points:"15 18 9 12 15 6"})],-1)])]),t("div",Ln,l(e(s).t("chat.singleChat.settings.title")),1),t("div",Mn,[t("button",{class:"header-save-btn",onClick:c[0]||(c[0]=(...r)=>e(s).saveSettings&&e(s).saveSettings(...r))},l(e(s).t("save")),1)])]),t("div",Dn,[m(lt,{settings:e(s)},null,8,["settings"]),m(St,{settings:e(s)},null,8,["settings"]),m(is,{settings:e(s)},null,8,["settings"]),m(ws,{settings:e(s)},null,8,["settings"]),m(Os,{settings:e(s)},null,8,["settings"]),m(ha,{settings:e(s),charId:y.id},null,8,["settings","charId"]),m(Ha,{settings:e(s)},null,8,["settings"]),m(rn,{settings:e(s)},null,8,["settings"]),m(mn,{settings:e(s)},null,8,["settings"]),m(Bn,{settings:e(s)},null,8,["settings"])]),m(Ke,{visible:e(s).showImageUploadModal.value,"onUpdate:visible":c[1]||(c[1]=r=>e(s).showImageUploadModal.value=r),type:"basic","biz-type":e(s).currentUploadTarget.value,title:e(s).uploadModalTitle.value,onPreviewReady:e(s).handleImagePreview,onUploadComplete:e(s).handleImageUploadConfirm},null,8,["visible","biz-type","title","onPreviewReady","onUploadComplete"]),m(E,{visible:e(s).showSummaryModal.value,"onUpdate:visible":c[6]||(c[6]=r=>e(s).showSummaryModal.value=r),title:e(s).t("chat.singleChat.settings.manualSummary")},{footer:x(()=>[t("button",{class:"modal-btn cancel",onClick:c[5]||(c[5]=r=>e(s).showSummaryModal.value=!1)},l(e(s).t("cancel")),1)]),default:x(()=>[t("div",Vn,[t("div",{class:"modal-option",onClick:c[2]||(c[2]=(...r)=>e(s).handleSummarizeRecent&&e(s).handleSummarizeRecent(...r))},[t("span",Tn,l(e(s).t("chat.singleChat.settings.summarizeRecent")),1)]),t("div",{class:"modal-option",onClick:c[3]||(c[3]=(...r)=>e(s).openRangeInputModal&&e(s).openRangeInputModal(...r))},[t("span",An,l(e(s).t("chat.singleChat.settings.summarizeRange")),1)]),t("div",{class:"modal-option",onClick:c[4]||(c[4]=(...r)=>e(s).handleSummarizeVideo&&e(s).handleSummarizeVideo(...r))},[t("span",Nn,l(e(s).t("chat.singleChat.settings.summarizeVideo")),1)])])]),_:1},8,["visible","title"]),m(E,{visible:e(s).showRangeInputModal.value,"onUpdate:visible":c[10]||(c[10]=r=>e(s).showRangeInputModal.value=r),title:e(s).t("chat.singleChat.settings.summarizeRange")},{footer:x(()=>[t("button",{class:"modal-btn cancel",onClick:c[8]||(c[8]=r=>e(s).showRangeInputModal.value=!1)},l(e(s).t("cancel")),1),t("button",{class:"modal-btn confirm",onClick:c[9]||(c[9]=(...r)=>e(s).handleSummarizeRange&&e(s).handleSummarizeRange(...r))},l(e(s).t("confirm")),1)]),default:x(()=>[I(t("input",{type:"text",class:"base-input","onUpdate:modelValue":c[7]||(c[7]=r=>e(s).summaryRangeInput.value=r),placeholder:e(s).t("chat.singleChat.settings.rangePlaceholder",{total:e(s).formState.msgCount})},null,8,Rn),[[P,e(s).summaryRangeInput.value]])]),_:1},8,["visible","title"]),m(E,{visible:e(s).showNpcScopeModal.value,"onUpdate:visible":c[12]||(c[12]=r=>e(s).showNpcScopeModal.value=r),title:e(s).t("chat.singleChat.settings.selectNpc"),bodyClass:"no-padding"},{footer:x(()=>[t("button",{class:"modal-btn confirm",onClick:c[11]||(c[11]=r=>e(s).showNpcScopeModal.value=!1)},l(e(s).t("confirm")),1)]),default:x(()=>[t("div",On,[e(s).singleStore.npcs.length===0?(h(),p("div",zn," 暂无NPC，请先在NPC管理页面添加 ")):M("",!0),(h(!0),p(te,null,se(e(s).singleStore.npcs,r=>(h(),p("div",{key:r.id,class:"scope-item",onClick:_=>e(s).toggleNpcScope(r.id)},[t("div",{class:w(["scope-checkbox",{checked:e(s).formState.linkedNpcs.includes(r.id)}])},[e(s).formState.linkedNpcs.includes(r.id)?(h(),p("svg",En,[...c[16]||(c[16]=[t("polyline",{points:"20 6 9 17 4 12"},null,-1)])])):M("",!0)],2),t("span",Wn,l(r.name),1)],8,jn))),128))])]),_:1},8,["visible","title"]),m(E,{visible:e(s).showCharScopeModal.value,"onUpdate:visible":c[14]||(c[14]=r=>e(s).showCharScopeModal.value=r),title:"选择关联角色",bodyClass:"no-padding"},{footer:x(()=>[t("button",{class:"modal-btn confirm",onClick:c[13]||(c[13]=r=>e(s).showCharScopeModal.value=!1)},l(e(s).t("confirm")),1)]),default:x(()=>[t("div",Fn,[e(s).availableCharacters.value.length===0?(h(),p("div",qn," 暂无其他角色可选 ")):M("",!0),(h(!0),p(te,null,se(e(s).availableCharacters.value,r=>(h(),p("div",{key:r.id,class:"scope-item",onClick:_=>e(s).toggleCharScope(r.id)},[t("div",{class:w(["scope-checkbox",{checked:e(s).formState.linkedCharacters.includes(r.id)}])},[e(s).formState.linkedCharacters.includes(r.id)?(h(),p("svg",Hn,[...c[17]||(c[17]=[t("polyline",{points:"20 6 9 17 4 12"},null,-1)])])):M("",!0)],2),t("span",Gn,l(r.name),1)],8,Kn))),128))])]),_:1},8,["visible"])]))}},Yn=V(Zn,[["__scopeId","data-v-3c124ea2"]]);export{Yn as default};
