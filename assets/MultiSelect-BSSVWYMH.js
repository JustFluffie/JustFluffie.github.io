import{_ as D,r as y,c as B,v as F,a3 as I,b as s,o as a,f as u,e as N,A as w,n as f,g as O,w as q,d as v,D as W,F as V,B as S,C as R,a0 as j,a6 as P,E as U}from"./index-DpsRkgyh.js";const H=["onClick"],J=["checked","onChange"],Q={class:"group-title"},X={key:0,class:"option-list"},Y=["onClick"],Z=["checked","onChange"],_=["onClick"],ee=["checked","onChange"],te={__name:"MultiSelect",props:{modelValue:{type:[Array,String,Number],required:!0,default:()=>[]},options:{type:Array,default:()=>[]},multiple:{type:Boolean,default:!0},textAlign:{type:String,default:"right"},selectorWidth:{type:String,default:"auto"},dropdownWidth:{type:String,default:"auto"},labelKey:{type:String,default:"title"},valueKey:{type:String,default:"id"},childrenKey:{type:String,default:"entries"},placeholder:{type:String,default:"未选择"}},emits:["update:modelValue"],setup(n,{emit:E}){const e=n,K=E,c=y(!1),p=y([]),h=y(null),b=y({}),x=y("body"),A=B(()=>e.options.length>0&&e.childrenKey in e.options[0]),L=B(()=>{if(e.multiple)return!Array.isArray(e.modelValue)||e.modelValue.length===0?e.placeholder:`已选择 ${e.modelValue.length} 个条目`;if(e.modelValue===null||e.modelValue===void 0||e.modelValue==="")return e.placeholder;if(A.value)for(const t of e.options){const i=(t[e.childrenKey]||[]).find(l=>l[e.valueKey]===e.modelValue);if(i)return i[e.labelKey]}else{const t=e.options.find(i=>i[e.valueKey]===e.modelValue);if(t)return t[e.labelKey]}return e.modelValue}),g=t=>e.multiple?Array.isArray(e.modelValue)&&e.modelValue.includes(t):e.modelValue===t,C=t=>p.value.includes(t),G=t=>{C(t)?p.value=p.value.filter(i=>i!==t):p.value.push(t)},z=t=>{const l=(t[e.childrenKey]||[]).map(o=>o[e.valueKey]);return l.length>0&&l.every(o=>e.modelValue.includes(o))},M=(t,i)=>{const o=(t[e.childrenKey]||[]).map(d=>d[e.valueKey]);let r=[...e.modelValue];i?o.forEach(d=>{r.includes(d)||r.push(d)}):r=r.filter(d=>!o.includes(d)),K("update:modelValue",r)},k=(t,i)=>{if(e.multiple){let l=Array.isArray(e.modelValue)?[...e.modelValue]:[];i?l.includes(t)||l.push(t):l=l.filter(o=>o!==t),K("update:modelValue",l)}else K("update:modelValue",t),c.value=!1},m=()=>{if(h.value){const t=h.value.getBoundingClientRect();let i={};if(x.value===".phone-frame"){const l=document.querySelector(".phone-frame");if(l){const o=l.getBoundingClientRect();i={position:"absolute",top:`${t.bottom-o.top+4}px`},e.textAlign==="right"?i.right=`${o.right-t.right}px`:i.left=`${t.left-o.left}px`}}else i={position:"fixed",top:`${t.bottom+4}px`},e.textAlign==="right"?i.right=`${window.innerWidth-t.right}px`:i.left=`${t.left}px`;b.value={...i,minWidth:e.dropdownWidth==="auto"?`${t.width}px`:"none",width:e.dropdownWidth,zIndex:9999}}},T=async()=>{if(c.value)c.value=!1;else{const t=document.querySelector(".phone-frame");x.value=t?".phone-frame":"body",c.value=!0,await U(),m()}},$=t=>{const i=h.value&&h.value.contains(t.target),l=t.target.closest(".custom-options");!i&&!l&&(c.value=!1)};return F(()=>{document.addEventListener("click",$,!0),window.addEventListener("scroll",m,!0),window.addEventListener("resize",m)}),I(()=>{document.removeEventListener("click",$,!0),window.removeEventListener("scroll",m,!0),window.removeEventListener("resize",m)}),(t,i)=>(a(),s("div",{class:"multi-select-wrapper",ref_key:"selectWrapper",ref:h,style:W({width:n.selectorWidth})},[u("div",{class:f(["custom-select-trigger",`text-${n.textAlign}`]),onClick:T},[u("span",null,w(L.value),1),u("div",{class:f(["arrow-icon",{open:c.value}])},[...i[1]||(i[1]=[u("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"3","stroke-linecap":"round","stroke-linejoin":"round"},[u("polyline",{points:"9 18 15 12 9 6"})],-1)])],2)],2),(a(),N(P,{to:x.value},[O(j,{name:"slide-fade"},{default:q(()=>[c.value?(a(),s("div",{key:0,class:"custom-options",style:W(b.value)},[A.value?(a(!0),s(V,{key:0},S(n.options,l=>(a(),s("div",{key:l[n.valueKey],class:"group-item"},[u("div",{class:"group-header",onClick:o=>G(l[n.valueKey])},[n.multiple?(a(),s("input",{key:0,type:"checkbox",checked:z(l),onChange:o=>M(l,o.target.checked),onClick:i[0]||(i[0]=R(()=>{},["stop"]))},null,40,J)):v("",!0),u("span",Q,w(l[n.labelKey]),1),(a(),s("svg",{class:f(["collapse-arrow",{collapsed:!C(l[n.valueKey])}]),xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"3","stroke-linecap":"round","stroke-linejoin":"round"},[...i[2]||(i[2]=[u("polyline",{points:"6 9 12 15 18 9"},null,-1)])],2))],8,H),C(l[n.valueKey])?(a(),s("div",X,[(a(!0),s(V,null,S(l[n.childrenKey],o=>(a(),s("div",{key:o[n.valueKey],class:f(["option-item",{"is-selected":g(o[n.valueKey]),clickable:!n.multiple}]),onClick:r=>!n.multiple&&k(o[n.valueKey])},[n.multiple?(a(),s("input",{key:0,type:"checkbox",checked:g(o[n.valueKey]),onChange:r=>k(o[n.valueKey],r.target.checked)},null,40,Z)):v("",!0),u("span",null,w(o[n.labelKey]),1)],10,Y))),128))])):v("",!0)]))),128)):(a(!0),s(V,{key:1},S(n.options,l=>(a(),s("div",{key:l[n.valueKey],class:f(["option-item flat-option",{"is-selected":g(l[n.valueKey]),clickable:!n.multiple}]),onClick:o=>!n.multiple&&k(l[n.valueKey])},[n.multiple?(a(),s("input",{key:0,type:"checkbox",checked:g(l[n.valueKey]),onChange:o=>k(l[n.valueKey],o.target.checked)},null,40,ee)):v("",!0),u("span",null,w(l[n.labelKey]),1)],10,_))),128))],4)):v("",!0)]),_:1})],8,["to"]))],4))}},ne=D(te,[["__scopeId","data-v-1ef86f36"]]);export{ne as M};
