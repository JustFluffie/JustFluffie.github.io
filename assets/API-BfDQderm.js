import{cf as he,r as b,cg as X,_ as be,q as me,X as ge,$ as fe,t as we,x as ke,H as _e,y as ye,c as z,z as O,l as xe,h as M,j as s,a7 as Pe,o as y,d as e,f as L,B as i,w as A,A as H,b as P,e as $,F as J,C as Z,c2 as Ce,n as I,M as Q,ch as Se}from"./index-C_v0MZVw.js";import{C as Y}from"./CustomSelect-Bv3x762y.js";const Te=he("backup",()=>{const w=b(""),o=b(""),h=b(!1),g=b(!1),u=b(null);function E(l={chat:!0,characters:!0,settings:!0,appearance:!0,worldbook:!0,presets:!0}){return new Promise(v=>{setTimeout(()=>{const p={},m=localStorage.getItem("aiPhoneSingleChatData");if(m)try{const r=X.decompressFromUTF16(m),c=JSON.parse(r||m),n={};let f=!1;if(l.chat&&(n.messages=c.messages,f=!0),l.characters&&(n.characters=c.characters,n.userPersonas=c.userPersonas,n.favorites=c.favorites,f=!0),l.appearance&&(n.bubblePresets=c.bubblePresets,n.stickers=c.stickers,f=!0),f){const T=JSON.stringify(n),U=X.compressToUTF16(T);p.aiPhoneSingleChatData=U}}catch(r){console.error("Error processing single chat data for backup",r)}if(l.chat){const r=localStorage.getItem("aiPhoneMomentsData");r&&(p.aiPhoneMomentsData=r)}l.settings&&["api_imageHostProvider","api_imgbbApiKey","api_catboxUserHash","aiPhoneGlobalBackgroundActivity","aiPhoneGlobalProactiveScope","aiPhoneGlobalProactiveInterval","aiPhoneGlobalProactiveCooldown","aiPhoneGlobalProactiveDailyLimit","aiPhoneGlobalTriggerMode","aiPhoneGlobalProactiveIdleTime"].forEach(c=>{const n=localStorage.getItem(c);n!==null&&(p[c]=n)}),l.appearance&&["aiPhoneThemePresets","aiPhoneCurrentThemePreset","aiPhoneFontPresets","aiPhoneCurrentFontPreset","aiPhoneCssPresets","aiPhoneCurrentCssPreset"].forEach(c=>{const n=localStorage.getItem(c);n!==null&&(p[c]=n)}),l.worldbook&&["worldBooks","worldBookNextId"].forEach(c=>{const n=localStorage.getItem(c);n!==null&&(p[c]=n)}),l.presets&&["api_presets","api_activePresetName"].forEach(c=>{const n=localStorage.getItem(c);n!==null&&(p[c]=n)}),v(JSON.stringify(p,null,2))},0)})}async function x(){if(w.value=localStorage.getItem("github_token")||"",!w.value){alert("请先设置 GitHub Token！");return}try{const l=await fetch("https://api.github.com/user/repos",{method:"POST",headers:{Authorization:`token ${w.value}`,Accept:"application/vnd.github.v3+json","Content-Type":"application/json"},body:JSON.stringify({name:"phone-backup",private:!0,description:"Backup for Phone Vue App"})});if(l.ok){const v=await l.json();o.value=v.full_name,alert(`仓库 ${v.full_name} 创建成功！即将开始备份...`),await B()}else{if(l.status===401){alert("创建仓库失败: GitHub Token 无效或过期 (401)。请检查设置。");return}const v=await l.json();if(v.errors&&v.errors[0].message==="name already exists on this account"){const p=await fetch("https://api.github.com/user",{headers:{Authorization:`token ${w.value}`}});if(p.ok){const m=await p.json();o.value=`${m.login}/phone-backup`,alert(`仓库已存在，已自动关联到 ${o.value}。即将开始备份...`),await B();return}}alert(`创建仓库失败: ${v.message}`)}}catch(l){console.error("Create repo failed:",l),alert(`创建仓库出错: ${l.message}`)}}async function S(){if(w.value=localStorage.getItem("github_token")||"",o.value=localStorage.getItem("github_repo")||"",!w.value)throw new Error("请先设置 GitHub Token！");if(!o.value)throw new Error("请先设置仓库地址！");try{const[l,v]=o.value.split("/");if(!l||!v)throw new Error("仓库地址格式不正确，应为 username/repo");const p=await fetch(`https://api.github.com/repos/${l}/${v}`,{headers:{Authorization:`token ${w.value}`,Accept:"application/vnd.github.v3+json"}});if(p.ok)return!0;throw p.status===401?new Error("GitHub Token 无效或过期 (401)"):p.status===404?new Error("仓库不存在或无权访问 (404)"):new Error(`验证失败: ${p.statusText}`)}catch(l){throw console.error("Verify repo failed:",l),l}}async function B(){if(w.value=localStorage.getItem("github_token")||"",o.value=localStorage.getItem("github_repo")||"",!w.value||!o.value){alert("请先设置 GitHub Token 和仓库地址！");return}if(h.value){alert("正在备份中，请稍候...");return}h.value=!0,alert("正在准备备份数据...");try{const l=await E();alert("数据准备完成，开始上传...");const v="phone_backup.json",[p,m]=o.value.split("/"),r=`https://api.github.com/repos/${p}/${m}/contents/${v}`;let c;try{const C=await fetch(r,{headers:{Authorization:`token ${w.value}`,Accept:"application/vnd.github.v3+json"}});if(C.status===401)throw new Error("GitHub Token 无效或过期 (401)。请检查设置。");C.status===404?console.log("备份文件不存在，将创建新文件。"):C.ok&&(c=(await C.json()).sha)}catch(C){if(C.message.includes("GitHub Token"))throw C}const n=`Backup from phone-vue-app: ${new Date().toISOString()}`,T=new TextEncoder().encode(l),U=Array.from(T).map(C=>String.fromCharCode(C)).join(""),N=btoa(U),R={message:n,content:N,sha:c},k=await fetch(r,{method:"PUT",headers:{Authorization:`token ${w.value}`,Accept:"application/vnd.github.v3+json","Content-Type":"application/json"},body:JSON.stringify(R)});if(k.ok)u.value=new Date,alert("备份成功！");else{if(k.status===401){alert("备份失败: GitHub Token 无效或过期 (401)。请检查设置。");return}const C=await k.json();console.error("GitHub API Error:",C),alert(`备份失败: ${C.message||"未知错误"}`)}}catch(l){console.error("Backup to GitHub failed:",l),alert(`备份过程中发生错误: ${l.message}`)}finally{h.value=!1}}async function j(){if(w.value=localStorage.getItem("github_token")||"",o.value=localStorage.getItem("github_repo")||"",!w.value||!o.value){alert("请先设置 GitHub Token 和仓库地址！");return}if(confirm("这将从 GitHub 覆盖所有当前数据，确定要恢复吗？此操作不可逆。")){g.value=!0,alert("正在从 GitHub 下载备份...");try{const l="phone_backup.json",[v,p]=o.value.split("/"),m=`https://api.github.com/repos/${v}/${p}/contents/${l}`,r=await fetch(m,{headers:{Authorization:`token ${w.value}`,Accept:"application/vnd.github.v3+json"}});if(r.status===401)throw new Error("GitHub Token 无效或过期 (401)。请检查设置。");if(r.status===404)throw new Error("在仓库中未找到备份文件 (phone_backup.json)。");if(!r.ok){const k=await r.json();throw new Error(`获取备份文件失败: ${k.message||"未知错误"}`)}const n=(await r.json()).content,f=atob(n),T=new Uint8Array(f.length);for(let k=0;k<f.length;k++)T[k]=f.charCodeAt(k);const N=new TextDecoder("utf-8").decode(T),R=JSON.parse(N);localStorage.clear();for(const k in R)Object.hasOwnProperty.call(R,k)&&localStorage.setItem(k,R[k]);alert("数据恢复成功！请刷新页面以应用更改。")}catch(l){console.error("Restore from GitHub failed:",l),alert(`恢复过程中发生错误: ${l.message}`)}finally{g.value=!1}}}async function D(l){try{alert("正在生成备份文件...");const v=await E(l),p=new Blob([v],{type:"application/json"}),m=URL.createObjectURL(p),r=document.createElement("a");r.href=m,r.download=`JF-Phone_backup_${new Date().toISOString().slice(0,10)}.json`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(m),alert("备份文件已开始下载！")}catch(v){console.error("Export backup failed:",v),alert(`导出备份文件时出错: ${v.message}`)}}function G(){const l=document.createElement("input");l.type="file",l.accept="application/json",l.onchange=v=>{const p=v.target.files[0];if(!p)return;const m=new FileReader;m.onload=r=>{try{const c=JSON.parse(r.target.result);if(confirm("这将覆盖所有当前数据，确定要导入吗？")){localStorage.clear();for(const n in c)Object.hasOwnProperty.call(c,n)&&localStorage.setItem(n,c[n]);alert("数据导入成功！请刷新页面以应用更改。")}}catch(c){console.error("Import backup failed:",c),alert(`导入失败，请确保文件格式正确: ${c.message}`)}},m.readAsText(p)},l.click()}return{githubToken:w,githubRepo:o,isBackingUp:h,isRestoring:g,lastBackupTime:u,backupToGitHub:B,restoreFromGitHub:j,exportBackupFile:D,importBackupFile:G,createBackupRepo:x,verifyBackupRepo:S}}),Be={class:"card"},Ae={class:"card-title"},$e={class:"card-content"},Ie={class:"api-item-row"},Ue={style:{flex:"1","min-width":"0"}},He={class:"api-item-col"},je={class:"form-label",for:"api-url"},Ge=["placeholder"],Ne={class:"api-item-col"},De={class:"form-label",for:"api-key"},Ee=["placeholder"],Re={class:"api-item-row"},Me={class:"list-item-title",style:{"font-weight":"normal","white-space":"nowrap"}},Fe={style:{flex:"1",display:"flex",gap:"10px","align-items":"center","min-width":"0"}},Oe={style:{flex:"1","min-width":"0",position:"relative"}},Ve={key:0,value:"",disabled:""},Ke=["value"],Le={class:"card"},ze={class:"card-title"},Je={class:"card-title-note",style:{padding:"0 16px 10px","margin-top":"-10px",color:"var(--danger-color)"}},qe={class:"card-content"},We={class:"api-item-row"},Xe={class:"list-item-content"},Ze={class:"list-item-title"},Qe={class:"list-item-subtitle"},Ye={class:"api-item-row"},et={class:"list-item-content"},tt={class:"list-item-title"},ot={class:"api-item-row"},st={class:"list-item-content"},at={class:"list-item-title"},it={class:"api-item-row"},lt={class:"list-item-content"},nt={class:"list-item-title"},rt={class:"api-item-row"},ct={class:"list-item-content"},dt={class:"list-item-title"},pt={class:"api-item-row"},ut={class:"list-item-content"},vt={class:"list-item-title"},ht={class:"list-item-subtitle"},bt={class:"mode-selector"},mt={key:0,class:"api-item-row"},gt={class:"list-item-content"},ft={class:"list-item-title"},wt={class:"list-item-subtitle"},kt={class:"card"},_t={class:"card-title"},yt={class:"card-content"},xt={class:"api-item-row"},Pt={class:"list-item-content"},Ct={class:"list-item-title"},St={class:"list-item-subtitle"},Tt={class:"api-item-row"},Bt={class:"list-item-content"},At={class:"list-item-title"},$t={class:"list-item-subtitle"},It={class:"card"},Ut={class:"card-title"},Ht={class:"card-content"},jt={class:"api-item-col"},Gt={class:"form-label",for:"github-token"},Nt={class:"input-hint"},Dt={style:{display:"flex",gap:"10px"}},Et=["placeholder"],Rt={class:"api-item-col"},Mt={class:"form-label",for:"github-repo"},Ft={style:{display:"flex",gap:"10px"}},Ot=["placeholder"],Vt=["disabled"],Kt={class:"api-item-row"},Lt=["disabled"],zt=["disabled"],Jt={key:0,style:{"font-size":"12px",color:"var(--text-tertiary)","margin-top":"10px"}},qt={class:"card"},Wt={class:"card-title"},Xt={class:"card-content"},Zt={class:"api-item-row"},Qt={class:"list-item-content",style:{flex:"1","min-width":"0"}},Yt={class:"list-item-title"},eo={class:"list-item-subtitle"},to={style:{width:"120px","flex-shrink":"0"}},oo={class:"api-item-col"},so={class:"form-label",for:"imgbb-api-key"},ao={class:"input-hint"},io={style:{display:"flex",gap:"10px"}},lo=["placeholder"],no={class:"api-item-col"},ro={class:"form-label",for:"catbox-hash"},co={class:"input-hint"},po={style:{display:"flex",gap:"10px"}},uo=["placeholder"],vo={class:"card"},ho={class:"card-title"},bo={class:"card-content"},mo={style:{"font-size":"13px",color:"var(--text-tertiary)","margin-bottom":"15px"}},go={class:"api-item-row",style:{"border-bottom":"none","padding-bottom":"0"}},fo={class:"scope-list"},wo={key:0,xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"3","stroke-linecap":"round","stroke-linejoin":"round"},ko={key:0,xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"3","stroke-linecap":"round","stroke-linejoin":"round"},_o={key:0,xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"3","stroke-linecap":"round","stroke-linejoin":"round"},yo={key:0,xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"3","stroke-linecap":"round","stroke-linejoin":"round"},xo={key:0,xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"3","stroke-linecap":"round","stroke-linejoin":"round"},Po={class:"scope-list",style:{"max-height":"300px","overflow-y":"auto"}},Co={key:0,xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"3","stroke-linecap":"round","stroke-linejoin":"round"},So={class:"scope-name"},To=["onClick"],Bo={key:0,xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"3","stroke-linecap":"round","stroke-linejoin":"round"},Ao={class:"scope-name"},$o={__name:"API",setup(w){const{t:o}=me(),h=ge(),g=fe(),u=Te(),E=we(),x=ke(),S=_e(),B=b(""),j=b(""),D=b(""),G=b(!1),l=b([]),v=b(5),p=b(30),m=b(10),r=b("always"),c=b(15),n=b(""),f=b(""),T=b("catbox"),U=b(""),N=b(""),R=b([{value:"none",label:"无"},{value:"catbox",label:"Catbox"},{value:"imgbb",label:"ImgBB"}]);ye(()=>{G.value=g.globalBackgroundActivity,l.value=[...g.globalProactiveScope||[]],v.value=g.globalProactiveInterval,p.value=g.globalProactiveCooldown,m.value=g.globalProactiveDailyLimit,r.value=g.globalTriggerMode,c.value=g.globalProactiveIdleTime,n.value=localStorage.getItem("github_token")||"",f.value=localStorage.getItem("github_repo")||"",T.value=h.imageHostProvider,U.value=h.imgbbApiKey,N.value=h.catboxUserHash});const k=z(()=>h.presets.find(d=>d.name===h.activePresetName)||null);O(k,d=>{d&&(B.value=d.apiKey,j.value=d.apiUrl,D.value=d.model)},{immediate:!0,deep:!0}),O([B,j,D],()=>{h.activePresetName&&h.addPreset(h.activePresetName,{apiKey:B.value,apiUrl:j.value,model:D.value})}),O([G,l,v,p,m,r,c],()=>{g.globalBackgroundActivity=G.value,g.globalProactiveScope=l.value,g.globalProactiveInterval=v.value,g.globalProactiveCooldown=p.value,g.globalProactiveDailyLimit=m.value,g.globalTriggerMode=r.value,g.globalProactiveIdleTime=c.value},{deep:!0}),O([n,f],()=>{u.githubToken=n.value,u.githubRepo=f.value,localStorage.setItem("github_token",n.value),localStorage.setItem("github_repo",f.value)}),O([T,U,N],()=>{h.imageHostProvider=T.value,h.imgbbApiKey=U.value,h.catboxUserHash=N.value},{deep:!0});function C(){x.showToast(o("api.toast.settingsSaved"))}function q(){x.showInput(o("api.prompt.saveAsPreset"),"",d=>{d&&(h.addPreset(d,{apiKey:B.value,apiUrl:j.value,model:D.value}),x.showToast(o("api.toast.presetSaved",{name:d})))},o("api.prompt.enterPresetName"))}function ee(){x.showConfirm(o("api.confirm.deletePreset"),o("api.confirm.deletePresetMsg",{name:h.activePresetName}),()=>{h.deletePreset(h.activePresetName),x.showToast(o("api.toast.presetDeleted"))})}async function te(){const d={apiUrl:j.value,apiKey:B.value};await h.fetchModels(d)}const oe=z(()=>{switch(S.permission){case"granted":return o("api.notificationsGranted");case"denied":return o("api.notificationsDenied");default:return o("api.notificationsDefault")}}),se=()=>{S.permission!=="granted"?S.requestPermission():S.desktopNotificationsEnabled=!S.desktopNotificationsEnabled},ae=()=>{if(!S.desktopNotificationsEnabled){x.showToast("请先开启“桌面通知”开关。","warning");return}if(S.permission!=="granted"){x.showToast("浏览器通知权限未授予，请点击开关重新授权。","warning");return}x.showToast("测试通知已发送，请检查系统通知。"),S.triggerNotification("测试通知","如果看到此消息，说明桌面通知功能正常。","/pwa-192x192.png",()=>{console.log("Test notification clicked!")})},ie=async()=>{u.githubToken=n.value,await u.createBackupRepo(),f.value=u.githubRepo},le=async()=>{u.githubToken=n.value,u.githubRepo=f.value,x.showToast(o("api.verifying"));try{await u.verifyBackupRepo(),x.showToast(o("api.verifySuccess"))}catch(d){x.showToast(d.message,"error")}},ne=async()=>{u.githubToken=n.value,u.githubRepo=f.value,await u.backupToGitHub()};function re(){window.open("https://github.com/settings/tokens/new?scopes=repo&description=Phone%20App%20Backup","_blank")}function ce(){window.open("https://api.imgbb.com/","_blank")}function de(){window.open("https://catbox.moe/user/","_blank")}function pe(){x.showConfirm("确认清除所有数据？","此操作将永久删除所有本地存储的数据（包括聊天记录、API设置、背景图片等）。应用将重置为初始状态。请确保您已备份重要数据。",async()=>{localStorage.clear();try{await Se.clear()}catch(d){console.error("Error clearing localforage:",d)}try{h.$reset(),g.$reset(),u.$reset(),E.$reset(),x.$reset(),S.$reset()}catch(d){console.error("Error resetting stores:",d)}window.location.reload()},{messageStyle:{color:"#FF3B30"},confirmText:"delete"})}const V=b(!1),_=b({chat:!0,characters:!0,settings:!0,appearance:!0,worldbook:!0,presets:!0});function F(d){if(d==="worldbook"){const t=!_.value.worldbook;_.value.worldbook=t,_.value.presets=t}else _.value[d]=!_.value[d]}function ue(){u.exportBackupFile(_.value),V.value=!1}const K=b(!1),ve=z(()=>{const d=l.value||[];return d.includes("all")?o("api.scopeAll"):d.length===0?o("api.scopeNone"):o("api.scopeSelected",{count:d.length})});function W(d){const t=l.value;if(d==="all")t.includes("all")?l.value=[]:l.value=["all"];else if(t.includes("all"))l.value=[d];else{const a=t.indexOf(d);a>-1?t.splice(a,1):t.push(d),E.characters.length>0&&t.length===E.characters.length&&(l.value=["all"])}}return(d,t)=>(y(),xe(Pe,{title:s(o)("api.title")},{action:M(()=>[e("button",{class:"header-save-btn",onClick:C},i(s(o)("save")),1)]),default:M(()=>[e("div",Be,[e("div",Ae,i(s(o)("api.globalConfig")),1),e("div",$e,[e("div",Ie,[e("div",Ue,[L(Y,{"model-value":s(h).activePresetName,options:s(h).presets.map(a=>({value:a.name,label:a.name})),"onUpdate:modelValue":t[0]||(t[0]=a=>s(h).switchPreset(a)),textAlign:"left",style:{width:"100%"}},null,8,["model-value","options"])]),e("button",{class:"btn btn-secondary btn-sm",onClick:q},i(s(o)("api.saveAs")),1),e("button",{class:"btn btn-danger-light btn-sm",onClick:ee},i(s(o)("delete")),1)]),e("div",He,[e("label",je,i(s(o)("api.apiUrl")),1),A(e("input",{type:"text",id:"api-url",class:"base-input","onUpdate:modelValue":t[1]||(t[1]=a=>j.value=a),placeholder:s(o)("api.apiUrlPlaceholder"),autocomplete:"new-password"},null,8,Ge),[[H,j.value]])]),e("div",Ne,[e("label",De,i(s(o)("api.apiKey")),1),A(e("input",{type:"password",id:"api-key",class:"base-input","onUpdate:modelValue":t[2]||(t[2]=a=>B.value=a),placeholder:s(o)("api.apiKeyPlaceholder"),autocomplete:"new-password"},null,8,Ee),[[H,B.value]])]),e("div",Re,[e("div",Me,i(s(o)("api.model")),1),e("div",Fe,[e("div",Oe,[A(e("select",{class:"native-select","onUpdate:modelValue":t[3]||(t[3]=a=>D.value=a)},[s(h).models.length===0?(y(),P("option",Ve,i(s(o)("api.modelPlaceholder")),1)):$("",!0),(y(!0),P(J,null,Z(s(h).models,a=>(y(),P("option",{key:a,value:a},i(a),9,Ke))),128))],512),[[Ce,D.value]]),t[29]||(t[29]=e("div",{class:"select-arrow"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("polyline",{points:"6 9 12 15 18 9"})])],-1))]),e("button",{class:"btn btn-secondary btn-sm",onClick:te,style:{"white-space":"nowrap"}},i(s(o)("api.fetch")),1)])])])]),e("div",Le,[e("div",ze,i(s(o)("api.backgroundActivity")),1),e("div",Je,i(s(o)("api.backgroundActivityWarning")),1),e("div",qe,[e("div",We,[e("div",Xe,[e("div",Ze,i(s(o)("api.proactiveMessages")),1),e("div",Qe,i(s(o)("api.proactiveMessagesDesc")),1)]),e("div",{class:I(["toggle-switch",{active:G.value}]),onClick:t[4]||(t[4]=a=>G.value=!G.value)},null,2)]),G.value?(y(),P(J,{key:0},[e("div",Ye,[e("div",et,[e("div",tt,i(s(o)("api.scope")),1)]),e("div",{class:"scope-selector",onClick:t[5]||(t[5]=a=>K.value=!0)},[e("span",null,i(ve.value),1),t[30]||(t[30]=e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("polyline",{points:"9 18 15 12 9 6"})],-1))])]),e("div",ot,[e("div",st,[e("div",at,i(s(o)("api.interval")),1)]),A(e("input",{type:"number","onUpdate:modelValue":t[6]||(t[6]=a=>v.value=a),class:"base-input base-input-short",placeholder:"5",autocomplete:"new-password"},null,512),[[H,v.value,void 0,{number:!0}]])]),e("div",it,[e("div",lt,[e("div",nt,i(s(o)("api.cooldown")),1)]),A(e("input",{type:"number","onUpdate:modelValue":t[7]||(t[7]=a=>p.value=a),class:"base-input base-input-short",placeholder:"30",autocomplete:"new-password"},null,512),[[H,p.value,void 0,{number:!0}]])]),e("div",rt,[e("div",ct,[e("div",dt,i(s(o)("api.dailyLimit")),1)]),A(e("input",{type:"number","onUpdate:modelValue":t[8]||(t[8]=a=>m.value=a),class:"base-input base-input-short",placeholder:"10",autocomplete:"new-password"},null,512),[[H,m.value,void 0,{number:!0}]])]),e("div",pt,[e("div",ut,[e("div",vt,i(s(o)("api.triggerMode")),1),e("div",ht,i(s(o)("api.triggerModeIdleHint")),1)]),e("div",bt,[e("div",{class:I(["mode-option",{active:r.value==="idle"}]),onClick:t[9]||(t[9]=a=>r.value="idle")},i(s(o)("api.triggerModeIdle")),3),e("div",{class:I(["mode-option",{active:r.value==="always"}]),onClick:t[10]||(t[10]=a=>r.value="always")},i(s(o)("api.triggerModeAlways")),3)])]),r.value==="idle"?(y(),P("div",mt,[e("div",gt,[e("div",ft,i(s(o)("api.idleTime")),1),e("div",wt,i(s(o)("api.idleTimeDesc")),1)]),A(e("input",{type:"number","onUpdate:modelValue":t[11]||(t[11]=a=>c.value=a),class:"base-input base-input-short",placeholder:"15",autocomplete:"new-password"},null,512),[[H,c.value,void 0,{number:!0}]])])):$("",!0)],64)):$("",!0)])]),e("div",kt,[e("div",_t,i(s(o)("api.notificationSettings")),1),e("div",yt,[e("div",xt,[e("div",Pt,[e("div",Ct,i(s(o)("api.desktopNotifications")),1),e("div",St,i(oe.value),1)]),e("div",{class:I(["toggle-switch",{active:s(S).desktopNotificationsEnabled}]),onClick:se},null,2)]),e("div",Tt,[e("div",Bt,[e("div",At,i(s(o)("api.testNotification")),1),e("div",$t,i(s(o)("api.testNotificationDesc")),1)]),e("button",{class:"btn btn-secondary btn-sm",onClick:ae},i(s(o)("api.test")),1)])])]),e("div",It,[e("div",Ut,i(s(o)("api.githubBackup")),1),e("div",Ht,[e("div",jt,[e("label",Gt,i(s(o)("api.githubToken")),1),e("div",Nt,i(s(o)("api.githubTokenHint")),1),e("div",Dt,[A(e("input",{type:"password",id:"github-token",class:"base-input small-placeholder","onUpdate:modelValue":t[12]||(t[12]=a=>n.value=a),placeholder:s(o)("api.githubTokenPlaceholder"),style:{flex:"1"},autocomplete:"new-password"},null,8,Et),[[H,n.value]]),e("button",{class:"btn btn-secondary btn-sm",onClick:re},i(s(o)("api.getToken")),1)])]),e("div",Rt,[e("label",Mt,i(s(o)("api.repoAddress")),1),e("div",Ft,[A(e("input",{type:"text",id:"github-repo",class:"base-input","onUpdate:modelValue":t[13]||(t[13]=a=>f.value=a),placeholder:s(o)("api.repoAddressPlaceholder"),style:{flex:"1","min-width":"0"},autocomplete:"new-password"},null,8,Ot),[[H,f.value]]),e("button",{class:"btn btn-secondary btn-sm",onClick:le,style:{"white-space":"nowrap"}},i(s(o)("confirm")),1),e("button",{class:"btn btn-secondary btn-sm",onClick:ie,disabled:!n.value,style:{"white-space":"nowrap"}},i(s(o)("api.createRepo")),9,Vt)])]),e("div",Kt,[e("button",{class:"btn btn-secondary",style:{flex:"1"},onClick:ne,disabled:s(u).isBackingUp||s(u).isRestoring},i(s(u).isBackingUp?s(o)("api.backingUp"):s(o)("api.backupNow")),9,Lt),e("button",{class:"btn btn-secondary",style:{flex:"1"},onClick:t[14]||(t[14]=(...a)=>s(u).restoreFromGitHub&&s(u).restoreFromGitHub(...a)),disabled:s(u).isBackingUp||s(u).isRestoring},i(s(u).isRestoring?s(o)("api.restoring"):s(o)("api.restoreBackup")),9,zt)]),s(u).lastBackupTime?(y(),P("p",Jt,i(s(o)("api.lastBackup"))+" "+i(new Date(s(u).lastBackupTime).toLocaleString()),1)):$("",!0)])]),e("div",qt,[e("div",Wt,i(s(o)("api.imageHost")),1),e("div",Xt,[e("div",Zt,[e("div",Qt,[e("div",Yt,i(s(o)("api.defaultImageHost")),1),e("div",eo,i(s(o)("api.defaultImageHostDesc")),1)]),e("div",to,[L(Y,{"model-value":T.value,options:R.value,"onUpdate:modelValue":t[15]||(t[15]=a=>T.value=a),textAlign:"right"},null,8,["model-value","options"])])]),e("div",oo,[e("label",so,i(s(o)("api.imgbbApiKey")),1),e("div",ao,i(s(o)("api.imgbbApiKeyHint")),1),e("div",io,[A(e("input",{type:"password",id:"imgbb-api-key",class:"base-input small-placeholder","onUpdate:modelValue":t[16]||(t[16]=a=>U.value=a),placeholder:s(o)("api.imgbbApiKeyPlaceholder"),style:{flex:"1"},autocomplete:"new-password"},null,8,lo),[[H,U.value]]),e("button",{class:"btn btn-secondary btn-sm",onClick:ce},i(s(o)("api.getImgbbApiKey")),1)])]),e("div",no,[e("label",ro,i(s(o)("api.catboxUserHash")),1),e("div",co,i(s(o)("api.catboxUserHashHint")),1),e("div",po,[A(e("input",{type:"text",id:"catbox-hash",class:"base-input small-placeholder","onUpdate:modelValue":t[17]||(t[17]=a=>N.value=a),placeholder:s(o)("api.catboxUserHashPlaceholder"),style:{flex:"1"},autocomplete:"new-password"},null,8,uo),[[H,N.value]]),e("button",{class:"btn btn-secondary btn-sm",onClick:de},i(s(o)("api.getCatboxUserHash")),1)])])])]),e("div",vo,[e("div",ho,i(s(o)("api.dataBackup")),1),e("div",bo,[e("p",mo,i(s(o)("api.dataBackupDesc")),1),e("div",go,[e("button",{class:"btn btn-secondary",style:{flex:"1"},onClick:t[18]||(t[18]=a=>V.value=!0)},i(s(o)("api.exportBackupFile")),1),e("button",{class:"btn btn-secondary",style:{flex:"1"},onClick:t[19]||(t[19]=(...a)=>s(u).importBackupFile&&s(u).importBackupFile(...a))},i(s(o)("api.importBackupFile")),1)])])]),e("div",{class:"danger-zone"},[e("button",{class:"btn btn-danger big-btn",onClick:pe},[...t[31]||(t[31]=[e("div",{class:"danger-btn-content"},[e("div",{class:"danger-btn-title"},"清除所有数据"),e("div",{class:"danger-btn-desc"},"此操作将清除所有聊天记录、设置和本地数据，且无法恢复")],-1)])])]),L(Q,{visible:V.value,"onUpdate:visible":t[25]||(t[25]=a=>V.value=a),title:"导出选项",bodyClass:"no-padding"},{footer:M(()=>[e("button",{class:"modal-btn confirm",onClick:ue},"确认导出")]),default:M(()=>[e("div",fo,[e("div",{class:"scope-item",onClick:t[20]||(t[20]=a=>F("chat"))},[e("div",{class:I(["scope-checkbox",{checked:_.value.chat}])},[_.value.chat?(y(),P("svg",wo,[...t[32]||(t[32]=[e("polyline",{points:"20 6 9 17 4 12"},null,-1)])])):$("",!0)],2),t[33]||(t[33]=e("div",{class:"scope-content"},[e("span",{class:"scope-name"},"聊天数据"),e("span",{class:"scope-desc"},"包含聊天记录和朋友圈")],-1))]),e("div",{class:"scope-item",onClick:t[21]||(t[21]=a=>F("characters"))},[e("div",{class:I(["scope-checkbox",{checked:_.value.characters}])},[_.value.characters?(y(),P("svg",ko,[...t[34]||(t[34]=[e("polyline",{points:"20 6 9 17 4 12"},null,-1)])])):$("",!0)],2),t[35]||(t[35]=e("div",{class:"scope-content"},[e("span",{class:"scope-name"},"角色数据"),e("span",{class:"scope-desc"},"包含角色卡片、用户人设和收藏")],-1))]),e("div",{class:"scope-item",onClick:t[22]||(t[22]=a=>F("settings"))},[e("div",{class:I(["scope-checkbox",{checked:_.value.settings}])},[_.value.settings?(y(),P("svg",_o,[...t[36]||(t[36]=[e("polyline",{points:"20 6 9 17 4 12"},null,-1)])])):$("",!0)],2),t[37]||(t[37]=e("div",{class:"scope-content"},[e("span",{class:"scope-name"},"应用设置"),e("span",{class:"scope-desc"},"包含图床、后台活动等设置")],-1))]),e("div",{class:"scope-item",onClick:t[23]||(t[23]=a=>F("appearance"))},[e("div",{class:I(["scope-checkbox",{checked:_.value.appearance}])},[_.value.appearance?(y(),P("svg",yo,[...t[38]||(t[38]=[e("polyline",{points:"20 6 9 17 4 12"},null,-1)])])):$("",!0)],2),t[39]||(t[39]=e("div",{class:"scope-content"},[e("span",{class:"scope-name"},"外观主题"),e("span",{class:"scope-desc"},"包含主题、字体、气泡样式")],-1))]),e("div",{class:"scope-item",onClick:t[24]||(t[24]=a=>F("worldbook"))},[e("div",{class:I(["scope-checkbox",{checked:_.value.worldbook}])},[_.value.worldbook?(y(),P("svg",xo,[...t[40]||(t[40]=[e("polyline",{points:"20 6 9 17 4 12"},null,-1)])])):$("",!0)],2),t[41]||(t[41]=e("div",{class:"scope-content"},[e("span",{class:"scope-name"},"世界书/预设"),e("span",{class:"scope-desc"},"包含世界书和API预设")],-1))])])]),_:1},8,["visible"]),L(Q,{visible:K.value,"onUpdate:visible":t[28]||(t[28]=a=>K.value=a),title:s(o)("api.selectScope"),bodyClass:"no-padding"},{footer:M(()=>[e("button",{class:"modal-btn confirm",onClick:t[27]||(t[27]=a=>K.value=!1)},i(s(o)("confirm")),1)]),default:M(()=>[e("div",Po,[e("div",{class:"scope-item",onClick:t[26]||(t[26]=a=>W("all"))},[e("div",{class:I(["scope-checkbox",{checked:l.value&&l.value.includes("all")}])},[l.value&&l.value.includes("all")?(y(),P("svg",Co,[...t[42]||(t[42]=[e("polyline",{points:"20 6 9 17 4 12"},null,-1)])])):$("",!0)],2),e("span",So,i(s(o)("api.scopeAll")),1)]),(y(!0),P(J,null,Z(s(E).characters,a=>(y(),P("div",{key:a.id,class:"scope-item",onClick:Io=>W(a.id)},[e("div",{class:I(["scope-checkbox",{checked:l.value&&l.value.includes(a.id)}])},[l.value&&l.value.includes(a.id)?(y(),P("svg",Bo,[...t[43]||(t[43]=[e("polyline",{points:"20 6 9 17 4 12"},null,-1)])])):$("",!0)],2),e("span",Ao,i(a.name),1)],8,To))),128))])]),_:1},8,["visible","title"])]),_:1},8,["title"]))}},jo=be($o,[["__scopeId","data-v-921f40f0"]]);export{jo as default};
