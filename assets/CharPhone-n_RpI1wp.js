import{_ as B,r as C,x as se,a6 as ne,c as M,d as m,o as c,e,g as U,f as A,E as P,t as w,w as G,A as V,D as J,O as Y,F as z,C as L,y as oe,ch as Z,S as E,by as Q,i as j,b as q,u as K,W as ee,k as H,n as le,V as X,m as pe,B as he,a9 as ve,a4 as me}from"./index-rQpTA9Jf.js";const ge={key:0,class:"upload-hint"},fe={class:"left-section"},be={key:0,class:"upload-hint"},ke={class:"date-info"},ye={class:"weekday"},De={class:"date"},_e={class:"right-section"},$e={class:"text-inputs-row"},Ce={class:"photos-row"},we={key:0,class:"upload-hint"},Se={key:0,class:"upload-hint"},Me={__name:"CharPhoneHeader",props:{widgetData:{type:Object,default:()=>({background:"",avatar:"",photos:["",""],photoTexts:["",""]})}},emits:["update:widgetData"],setup(a,{emit:g}){var p,n;const s=a,v=g,h=C(!1),d=C("background"),y=C(0),r=C([((p=s.widgetData.photoTexts)==null?void 0:p[0])||"",((n=s.widgetData.photoTexts)==null?void 0:n[1])||""]),b=C(""),i=C("");let D=null;const u=()=>{const o=new Date,t=(o.getMonth()+1).toString().padStart(2,"0"),l=o.getDate().toString().padStart(2,"0");b.value=`${t}.${l}`;const O=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];i.value=O[o.getDay()]};se(()=>{u(),D=setInterval(u,6e4)}),ne(()=>{D&&clearInterval(D)});const k=M(()=>s.widgetData.background?{backgroundImage:`url('${s.widgetData.background}')`,backgroundColor:"transparent"}:{backgroundColor:"#e0e0e0"}),$=M(()=>s.widgetData.avatar?{backgroundImage:`url('${s.widgetData.avatar}')`,backgroundColor:"transparent"}:{backgroundColor:"#e0e0e0"}),T=o=>s.widgetData.photos[o]?{backgroundImage:`url('${s.widgetData.photos[o]}')`,backgroundColor:"transparent"}:{backgroundColor:"#e0e0e0"},I=()=>{d.value="background",h.value=!0},N=()=>{d.value="avatar",h.value=!0},S=o=>{y.value=o,d.value=`photo${o}`,h.value=!0},_=o=>{const t={...s.widgetData};d.value==="background"?t.background=o.content:d.value==="avatar"?t.avatar=o.content:d.value.startsWith("photo")&&(t.photos=[...s.widgetData.photos],t.photos[y.value]=o.content),v("update:widgetData",t)},f=o=>{const t={...s.widgetData,photoTexts:[...r.value]};v("update:widgetData",t)};return(o,t)=>(c(),m("div",{class:"char-phone-header",onClick:J(I,["stop"])},[e("div",{class:"widget-background",style:P(k.value)},[a.widgetData.background?A("",!0):(c(),m("div",ge," 点击上传 "))],4),e("div",{class:"widget-content",onClick:t[8]||(t[8]=J(()=>{},["stop"]))},[e("div",fe,[e("div",{class:"avatar-circle",style:P($.value),onClick:N},[a.widgetData.avatar?A("",!0):(c(),m("div",be," 点击上传 "))],4),e("div",ke,[e("div",ye,w(i.value),1),e("div",De,w(b.value),1)])]),e("div",_e,[e("div",$e,[G(e("input",{"onUpdate:modelValue":t[0]||(t[0]=l=>r.value[0]=l),type:"text",class:"photo-text-input",placeholder:"点击输入文字",onBlur:t[1]||(t[1]=l=>f()),onClick:t[2]||(t[2]=J(()=>{},["stop"]))},null,544),[[V,r.value[0]]]),G(e("input",{"onUpdate:modelValue":t[3]||(t[3]=l=>r.value[1]=l),type:"text",class:"photo-text-input",placeholder:"点击输入文字",onBlur:t[4]||(t[4]=l=>f()),onClick:t[5]||(t[5]=J(()=>{},["stop"]))},null,544),[[V,r.value[1]]])]),e("div",Ce,[e("div",{class:"photo-item",style:P(T(0)),onClick:t[6]||(t[6]=l=>S(0))},[a.widgetData.photos[0]?A("",!0):(c(),m("div",we," 点击上传 "))],4),e("div",{class:"photo-item",style:P(T(1)),onClick:t[7]||(t[7]=l=>S(1))},[a.widgetData.photos[1]?A("",!0):(c(),m("div",Se," 点击上传 "))],4)])])]),U(Y,{visible:h.value,"onUpdate:visible":t[9]||(t[9]=l=>h.value=l),type:"basic","biz-type":d.value,onUploadComplete:_},null,8,["visible","biz-type"])]))}},xe=B(Me,[["__scopeId","data-v-baafc6b9"]]),Ue={class:"char-phone-middle-widget"},Te={class:"photo-section"},Ie={class:"photo-wrapper"},Ae={key:0,class:"upload-hint"},Ne={class:"app-section"},Pe={class:"app-grid-wrapper"},Be={class:"app-grid"},Oe=["onClick"],Re={class:"app-label"},Fe={__name:"CharPhoneMiddleWidget",props:{widgetData:{type:Object,default:()=>({photo:"",apps:[]})}},emits:["update:widgetData","app-click"],setup(a,{emit:g}){const s=a,v=g,h=C(!1),d=M(()=>s.widgetData.photo?{backgroundImage:`url('${s.widgetData.photo}')`,backgroundColor:"transparent"}:{backgroundColor:"rgba(255, 255, 255, 0.3)"}),y=()=>{h.value=!0},r=i=>{v("app-click",i)},b=i=>{const D={...s.widgetData};D.photo=i.content,v("update:widgetData",D)};return(i,D)=>(c(),m("div",Ue,[e("div",Te,[e("div",Ie,[e("div",{class:"photo-container",style:P(d.value),onClick:y},[a.widgetData.photo?A("",!0):(c(),m("div",Ae," 点击上传 "))],4)])]),e("div",Ne,[e("div",Pe,[e("div",Be,[(c(!0),m(z,null,L(a.widgetData.apps,(u,k)=>(c(),m("div",{key:k,class:"app-item",onClick:$=>r(u)},[e("div",{class:"app-icon",style:P({background:u.color})},null,4),e("div",Re,w(u.label),1)],8,Oe))),128))])])]),U(Y,{visible:h.value,"onUpdate:visible":D[0]||(D[0]=u=>h.value=u),type:"basic","biz-type":"photo",onUploadComplete:b},null,8,["visible"])]))}},We=B(Fe,[["__scopeId","data-v-1ed9bd3c"]]),He={class:"char-phone-bottom-widget"},Je={class:"app-section"},je={class:"app-grid-wrapper"},Ee={class:"app-grid"},ze=["onClick"],Le={class:"app-label"},Ge={class:"photo-section"},Ve={class:"photo-wrapper"},Ye={key:0,class:"upload-hint"},qe={class:"text-inputs"},Ke={__name:"CharPhoneBottomWidget",props:{widgetData:{type:Object,default:()=>({photo:"",text1:"",text2:"",apps:[]})}},emits:["update:widgetData"],setup(a,{emit:g}){const s=a,v=g,h=C(!1),d=M(()=>s.widgetData.photo?{backgroundImage:`url('${s.widgetData.photo}')`,backgroundColor:"transparent"}:{backgroundColor:"rgba(255, 255, 255, 0.3)"}),y=()=>{h.value=!0},r=D=>{console.log("打开应用:",D.label)},b=D=>{const u={...s.widgetData};u.photo=D.content,v("update:widgetData",u)},i=()=>{v("update:widgetData",{...s.widgetData})};return(D,u)=>(c(),m("div",He,[e("div",Je,[e("div",je,[e("div",Ee,[(c(!0),m(z,null,L(a.widgetData.apps,(k,$)=>(c(),m("div",{key:$,class:"app-item",onClick:T=>r(k)},[e("div",{class:"app-icon",style:P({background:k.color})},null,4),e("div",Le,w(k.label),1)],8,ze))),128))])])]),e("div",Ge,[e("div",Ve,[e("div",{class:"photo-container",style:P(d.value),onClick:y},[a.widgetData.photo?A("",!0):(c(),m("div",Ye," 点击上传 "))],4),e("div",qe,[G(e("input",{type:"text",class:"custom-input","onUpdate:modelValue":u[0]||(u[0]=k=>a.widgetData.text1=k),placeholder:"输入文本1",onInput:i},null,544),[[V,a.widgetData.text1]]),G(e("input",{type:"text",class:"custom-input","onUpdate:modelValue":u[1]||(u[1]=k=>a.widgetData.text2=k),placeholder:"输入文本2",onInput:i},null,544),[[V,a.widgetData.text2]])])])]),U(Y,{visible:h.value,"onUpdate:visible":u[2]||(u[2]=k=>h.value=k),type:"basic","biz-type":"photo",onUploadComplete:b},null,8,["visible"])]))}},Qe=B(Ke,[["__scopeId","data-v-97a53399"]]),Xe={class:"char-phone-widget-container"},Ze={class:"widget-item top-widget"},et={class:"widget-item middle-widget"},tt={class:"widget-item bottom-widget"},at={__name:"CharPhoneWidgetContainer",props:{headerData:{type:Object,required:!0},middleData:{type:Object,required:!0},bottomData:{type:Object,required:!0}},emits:["update:headerData","update:middleData","update:bottomData","app-click"],setup(a,{emit:g}){const s=g,v=r=>{s("update:headerData",r)},h=r=>{s("update:middleData",r)},d=r=>{s("update:bottomData",r)},y=r=>{s("app-click",r)};return(r,b)=>(c(),m("div",Xe,[e("div",Ze,[U(xe,{"widget-data":a.headerData,"onUpdate:widgetData":v},null,8,["widget-data"])]),e("div",et,[U(We,{"widget-data":a.middleData,"onUpdate:widgetData":h,onAppClick:y},null,8,["widget-data"])]),e("div",tt,[U(Qe,{"widget-data":a.bottomData,"onUpdate:widgetData":d},null,8,["widget-data"])])]))}},ot=B(at,[["__scopeId","data-v-94277424"]]),st={class:"char-phone-dock"},nt={class:"message-row other-message"},lt={key:0,class:"upload-hint"},it=["data-placeholder"],rt={class:"message-row my-message"},dt=["data-placeholder"],ct={key:0,class:"upload-hint"},ut={__name:"CharPhoneDock",props:{dockData:{type:Object,default:()=>({avatars:{other:"",mine:""},messages:{other:"",mine:""}})}},emits:["update:dockData"],setup(a,{emit:g}){var _,f;const s=a,v=g,h=C(!1),d=C("avatar-other"),y=C({other:((_=s.dockData.messages)==null?void 0:_.other)||"",mine:((f=s.dockData.messages)==null?void 0:f.mine)||""}),r=C(!1),b=C(null),i=C(null);oe(()=>y.value.other,p=>{b.value&&b.value.textContent!==p&&(b.value.textContent=p)},{immediate:!0}),oe(()=>y.value.mine,p=>{i.value&&i.value.textContent!==p&&(i.value.textContent=p)},{immediate:!0});const D=()=>{r.value=!0},u=(p,n)=>{r.value=!1,y.value[n]=p.target.textContent},k=(p,n)=>{r.value||(y.value[n]=p.target.textContent)},$=(p,n)=>{y.value[n]=p.target.textContent,S()},T=p=>{var o;const n=(o=s.dockData.avatars)==null?void 0:o[p];return n?{backgroundImage:`url('${n}')`,backgroundSize:"cover",backgroundPosition:"center",backgroundColor:"transparent"}:{backgroundColor:"rgba(255, 255, 255, 0.9)"}},I=p=>{d.value=`avatar-${p}`,h.value=!0},N=p=>{const n={...s.dockData,avatars:{...s.dockData.avatars}};d.value==="avatar-other"?n.avatars.other=p.content:d.value==="avatar-mine"&&(n.avatars.mine=p.content),v("update:dockData",n)},S=p=>{const n={...s.dockData,messages:{...y.value}};v("update:dockData",n)};return(p,n)=>(c(),m("div",st,[e("div",nt,[e("div",{class:"avatar",style:P(T("other")),onClick:n[0]||(n[0]=o=>I("other"))},[a.dockData.avatars.other?A("",!0):(c(),m("div",lt," 点击上传 "))],4),e("div",{ref_key:"bubbleOtherRef",ref:b,class:"bubble bubble-other",onClick:n[1]||(n[1]=J(()=>{},["stop"])),contenteditable:"true",onCompositionstart:D,onCompositionend:n[2]||(n[2]=o=>u(o,"other")),onInput:n[3]||(n[3]=o=>k(o,"other")),onBlur:n[4]||(n[4]=o=>$(o,"other")),"data-placeholder":y.value.other?"":"点击输入文字"},null,40,it)]),e("div",rt,[e("div",{ref_key:"bubbleMineRef",ref:i,class:"bubble bubble-mine",onClick:n[5]||(n[5]=J(()=>{},["stop"])),contenteditable:"true",onCompositionstart:D,onCompositionend:n[6]||(n[6]=o=>u(o,"mine")),onInput:n[7]||(n[7]=o=>k(o,"mine")),onBlur:n[8]||(n[8]=o=>$(o,"mine")),"data-placeholder":y.value.mine?"":"点击输入文字"},null,40,dt),e("div",{class:"avatar",style:P(T("mine")),onClick:n[9]||(n[9]=o=>I("mine"))},[a.dockData.avatars.mine?A("",!0):(c(),m("div",ct," 点击上传 "))],4)]),U(Y,{visible:h.value,"onUpdate:visible":n[10]||(n[10]=o=>h.value=o),type:"basic","biz-type":d.value,onUploadComplete:N},null,8,["visible","biz-type"])]))}},pt=B(ut,[["__scopeId","data-v-0f4f42af"]]),ht=Z("diary",{state:()=>({diaries:{}}),actions:{addDiary(a,g){this.diaries[a]||(this.diaries[a]=[]),this.diaries[a].unshift({id:Date.now().toString(),content:g,timestamp:Date.now()})},getDiaries(a){return this.diaries[a]||[]},deleteDiary(a,g){if(this.diaries[a]){const s=this.diaries[a].findIndex(v=>v.id===g);s!==-1&&this.diaries[a].splice(s,1)}},clearDiaries(a){this.diaries[a]&&delete this.diaries[a]}},persist:!0}),vt={class:"c-phone-app-header"},mt={class:"title"},gt={class:"header-actions"},ft={__name:"CPhoneAppHeader",props:{title:{type:String,default:""},showClear:{type:Boolean,default:!1},showRefresh:{type:Boolean,default:!1}},emits:["back","clear","refresh"],setup(a,{emit:g}){const s=g,v=()=>{s("back")};return(h,d)=>(c(),m("header",vt,[e("div",{class:"back-btn",onClick:v},[U(E,{name:"back-btn",class:"back-icon"})]),e("h1",mt,w(a.title),1),e("div",gt,[a.showClear?(c(),m("div",{key:0,class:"action-btn",onClick:d[0]||(d[0]=y=>s("clear"))},[U(E,{name:"trash"})])):A("",!0),a.showRefresh?(c(),m("div",{key:1,class:"action-btn",onClick:d[1]||(d[1]=y=>s("refresh"))},[U(E,{name:"refresh"})])):A("",!0),Q(h.$slots,"action",{},void 0,!0)])]))}},bt=B(ft,[["__scopeId","data-v-05bc6111"]]),kt={class:"app-container"},yt={__name:"CPhoneAppsLayout",props:{title:{type:String,default:""},background:{type:String,default:"#ffffff"},color:{type:String,default:"#000000"},themeColor:{type:String,default:"#000000"},showClear:{type:Boolean,default:!1},showRefresh:{type:Boolean,default:!1}},emits:["close","clear","refresh"],setup(a,{emit:g}){const s=g,v=()=>{s("close")};return(h,d)=>(c(),m("div",{class:"c-phone-app-layout",style:P({"--app-bg":a.background,"--app-text":a.color,"--app-theme":a.themeColor})},[U(bt,{title:a.title,"show-clear":a.showClear,"show-refresh":a.showRefresh,onBack:v,onClear:d[0]||(d[0]=y=>s("clear")),onRefresh:d[1]||(d[1]=y=>s("refresh"))},{action:j(()=>[Q(h.$slots,"action",{},void 0,!0)]),_:3},8,["title","show-clear","show-refresh"]),e("div",kt,[Q(h.$slots,"default",{},void 0,!0)])],4))}},te=B(yt,[["__scopeId","data-v-9de005de"]]),Dt={key:0,class:"diary-notebook-container"},_t={class:"open-book-leather"},$t={class:"paper-stack"},Ct={class:"paper-sheet"},wt={key:0,class:"polaroid"},St={class:"photo-frame"},Mt=["src"],xt={class:"photo-name"},Ut={class:"paper-content"},Tt={class:"diary-header"},It={class:"date-group"},At={class:"day"},Nt={class:"month-year-group"},Pt={class:"month"},Bt={class:"year"},Ot={class:"weekday-badge"},Rt={class:"diary-body"},Ft={key:0,class:"generating-container"},Wt={class:"fountain-pen-loading"},Ht={key:1,class:"handwritten-text"},Jt={class:"page-number"},jt={class:"cover-texture"},Et={class:"cover-label"},zt={class:"label-border"},Lt={class:"book-subtitle"},Gt={class:"owner-name"},Vt={__name:"CharDiary",emits:["close"],setup(a,{emit:g}){const s=g,v=q(),h=K(),d=ht(),y=ee(),r=v.params.charId,b=C(!1),i=M(()=>h.getCharacter(r)),D=M(()=>i.value?`${i.value.name}的日记`:"日记"),u=M(()=>d.getDiaries(r)),k=M(()=>u.value.length>0?u.value[0]:null),$=M(()=>{var t;return b.value?Date.now():((t=k.value)==null?void 0:t.timestamp)||Date.now()}),T=M(()=>{var t;return(t=k.value)!=null&&t.content?k.value.content.split(`
`).filter(l=>l.trim()):[]}),I=t=>new Date(Number(t)).getDate().toString().padStart(2,"0"),N=t=>["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"][new Date(Number(t)).getMonth()],S=t=>new Date(Number(t)).getFullYear(),_=t=>["Sun.","Mon.","Tue.","Wed.","Thu.","Fri.","Sat."][new Date(Number(t)).getDay()],f=t=>{t.target.style.display="none",t.target.parentElement.style.backgroundColor="#eee"},p=()=>{s("close")},n=()=>{k.value&&confirm("确定要撕掉这页日记吗？")&&d.deleteDiary(r,k.value.id)},o=async()=>{if(!b.value){b.value=!0;try{const t=h.getCharacter(r);if(!t)return;const O=h.getFormattedRecentMessages(r,20).map(W=>`${W.role==="user"?"用户":"我"}: ${W.content}`).join(`
`),F=`你现在是${t.name}。请根据以下最近的聊天记录，写一篇简短的日记（100-200字）。
日记应该以第一人称“我”的视角，记录最近发生的事情、你的心情和对用户的想法。
请直接输出日记内容，不要包含任何其他解释或格式。

聊天记录：
${O}

日记内容：`;let x=null;t.api&&t.api!=="default"&&(x=y.presets.find(W=>W.name===t.api));const R=await y.getGenericCompletion([{role:"user",content:F}],x);R&&d.addDiary(r,R.trim())}catch(t){console.error("Failed to generate diary:",t)}finally{b.value=!1}}};return(t,l)=>(c(),H(te,{title:D.value,"show-clear":!0,"show-refresh":!0,onClose:p,onClear:n,onRefresh:o,background:"#f8f6f3",color:"#37474f",themeColor:"#555"},{default:j(()=>{var O,F;return[e("div",{class:le(["diary-container",{"is-open":k.value||b.value}])},[l[10]||(l[10]=e("div",{class:"desktop-texture"},null,-1)),k.value||b.value?(c(),m("div",Dt,[e("div",_t,[l[2]||(l[2]=e("div",{class:"bookmark-ribbon"},null,-1)),e("div",$t,[e("div",Ct,[i.value?(c(),m("div",wt,[e("div",St,[e("img",{src:i.value.avatar,alt:"char",onError:f},null,40,Mt)]),e("div",xt,w(i.value.name),1)])):A("",!0),e("div",Ut,[e("div",Tt,[e("div",It,[e("span",At,w(I($.value)),1),e("div",Nt,[e("span",Pt,w(N($.value)),1),e("span",Bt,w(S($.value)),1)]),e("div",Ot,w(_($.value)),1)]),l[0]||(l[0]=e("div",{class:"stamp-mark"},[e("div",{class:"stamp-inner"},"CONFIDENTIAL")],-1))]),l[1]||(l[1]=e("div",{class:"diary-divider"},null,-1)),e("div",Rt,[b.value?(c(),m("div",Ft,[e("div",Wt,[U(E,{name:"pencil",class:"pen-icon"}),e("span",null,w(((O=i.value)==null?void 0:O.name)||"Ta")+" 正在提笔...",1)])])):(c(),m("div",Ht,[(c(!0),m(z,null,L(T.value,(x,R)=>(c(),m("p",{key:R},w(x),1))),128))]))]),e("div",Jt,"- "+w(new Date(Number($.value)).getDate())+" -",1)])])])])])):(c(),m("div",{key:1,class:"diary-book-cover",onClick:o},[l[9]||(l[9]=e("div",{class:"book-spine"},null,-1)),e("div",jt,[l[7]||(l[7]=e("div",{class:"stitching-border"},null,-1)),e("div",Et,[e("div",zt,[l[4]||(l[4]=e("h2",{class:"book-title"},"DIARY",-1)),e("div",Lt,[e("span",Gt,w(((F=i.value)==null?void 0:F.name)||"Character"),1),l[3]||(l[3]=e("span",{class:"of-word"},"'s",-1))]),l[5]||(l[5]=e("div",{class:"label-line"},null,-1)),l[6]||(l[6]=e("div",{class:"book-hint"},"打开日记本",-1))])]),l[8]||(l[8]=e("div",{class:"elastic-band"},null,-1))])]))],2)]}),_:1},8,["title"]))}},Yt=B(Vt,[["__scopeId","data-v-8dbdc24d"]]),qt=Z("memo",{state:()=>({memos:{}}),actions:{addMemo(a,g){this.memos[a]||(this.memos[a]=[]);const s=g.map(v=>({id:Date.now().toString()+Math.random(),content:v,timestamp:Date.now()}));this.memos[a].unshift(...s)},updateMemo(a,g,s){if(!this.memos[a])return;const v=this.memos[a].find(h=>h.id===g);v&&(v.content=s)},getMemos(a){return this.memos[a]||[]},deleteMemo(a,g){if(this.memos[a]){const s=this.memos[a].findIndex(v=>v.id===g);s!==-1&&this.memos[a].splice(s,1)}},clearMemos(a){this.memos[a]&&(this.memos[a]=[])}},persist:!0}),Kt={key:0,class:"memo-list cork-board"},Qt={key:0,class:"generating-overlay"},Xt={class:"memo-item"},Zt={class:"memo-content"},ea={class:"memo-footer"},ta={class:"memo-date"},aa=["onClick"],oa={key:1,class:"empty-state cork-board"},sa={__name:"CharMemo",emits:["close"],setup(a,{emit:g}){const s=g,v=q(),h=K(),d=qt(),y=ee(),r=v.params.charId,b=C(!1),i=M(()=>h.getCharacter(r)),D=M(()=>d.getMemos(r)),u=M(()=>i.value?`${i.value.name}的备忘录`:"备忘录"),k=()=>{s("close")},$=S=>S?new Date(S).toLocaleDateString("en-CA"):"",T=S=>{d.deleteMemo(r,S)},I=()=>{D.value.length>0&&confirm("确定要清空所有备忘录吗？")&&d.clearMemos(r)},N=async()=>{if(!b.value){b.value=!0;try{if(!i.value)return;const _=h.getFormattedRecentMessages(r,15).map(o=>`${o.role==="user"?"用户":"我"}: ${o.content}`).join(`
`),f=`角色: ${i.value.name}
任务: 你正在写一些私密的备忘录便利贴。请基于你的人设的日常琐事（如工作、爱好、生活习惯）以及最近和用户的聊天内容，写5-8条简短的备忘录。

规则:
1.  输出5-8条备忘录，每条字数控制在10-30字。
2.  每条备忘录都是独立的、零散的想法。
3.  内容可以关于你的日常生活、不为人知的小秘密、对用户的真实想法、或和用户聊天中产生的想法。
4.  风格要口语化、生活化，就像随手写下的笔记，体现角色性格和生活气息。
5.  每条内容占一行，不要带序号或任何标记。

参考聊天记录:
${_}

备忘录内容:`;let p=null;i.value.api&&i.value.api!=="default"&&(p=y.presets.find(o=>o.name===i.value.api));const n=await y.getGenericCompletion([{role:"user",content:f}],p);if(n){const o=n.split(`
`).map(t=>t.trim()).filter(t=>t.length>0);o.length>0&&d.addMemo(r,o)}}catch(S){console.error("Failed to generate memos:",S)}finally{b.value=!1}}};return(S,_)=>(c(),H(te,{title:u.value,"show-clear":!0,"show-refresh":!0,onClose:k,onClear:I,onRefresh:N,background:"#ba9e76",color:"#3e2723",themeColor:"#795548"},{default:j(()=>[D.value.length>0||b.value?(c(),m("div",Kt,[b.value?(c(),m("div",Qt,[..._[0]||(_[0]=[e("div",{class:"generating-text"},"正在写备忘录...",-1)])])):A("",!0),(c(!0),m(z,null,L(D.value,f=>(c(),m("div",{key:f.id,class:"memo-item-wrapper"},[e("div",Xt,[_[1]||(_[1]=e("div",{class:"pin"},null,-1)),e("p",Zt,w(f.content),1),e("div",ea,[e("span",ta,w($(f.timestamp)),1),e("div",{class:"delete-btn",onClick:p=>T(f.id)},[U(E,{name:"delete",class:"delete-icon"})],8,aa)])])]))),128))])):(c(),m("div",oa,[..._[2]||(_[2]=[e("div",{class:"empty-hint"},[X(" 备忘录是空的... "),e("br"),e("small",null,"点击右上角，让我写点东西吧")],-1)])]))]),_:1},8,["title"]))}},na=B(sa,[["__scopeId","data-v-70878ab1"]]),la=Z("schedule",{state:()=>({schedules:{}}),actions:{addSchedule(a,g){this.schedules[a]||(this.schedules[a]=[]),this.schedules[a].unshift({id:Date.now().toString(),content:g,timestamp:Date.now()})},updateSchedule(a,g,s){if(!this.schedules[a])return;const v=this.schedules[a].find(h=>h.id===g);v&&(v.content=s)},getSchedules(a){return this.schedules[a]||[]},deleteSchedule(a,g){if(this.schedules[a]){const s=this.schedules[a].findIndex(v=>v.id===g);s!==-1&&this.schedules[a].splice(s,1)}},clearSchedules(a){this.schedules[a]&&delete this.schedules[a]}},persist:!0}),ia={key:0,class:"schedule-paper"},ra={class:"paper-content"},da={class:"schedule-header"},ca={class:"date-stamp"},ua={class:"schedule-body"},pa={key:0,class:"generating-text"},ha={key:1,class:"handwritten-text"},va={class:"time-col"},ma={class:"event-col"},ga={key:1,class:"empty-state"},fa={__name:"CharSchedule",emits:["close"],setup(a,{emit:g}){const s=g,v=q(),h=K(),d=la(),y=ee(),r=v.params.charId,b=C(!1),i=M(()=>h.getCharacter(r)),D=M(()=>d.getSchedules(r)),u=M(()=>D.value.length>0?D.value[0]:null),k=M(()=>i.value?`${i.value.name}的行程`:"行程表"),$=()=>{s("close")},T=_=>{const f=new Date(Number(_)),p=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];return`${f.getFullYear()}.${(f.getMonth()+1).toString().padStart(2,"0")}.${f.getDate().toString().padStart(2,"0")} ${p[f.getDay()]}`},I=()=>{u.value&&confirm("确定要撕掉这张行程表吗？")&&d.deleteSchedule(r,u.value.id)},N=_=>_?_.split(`
`).map(f=>{if(f=f.trim(),!f)return null;const p=f.match(/^(\d{1,2}:\d{2})/);if(p){const n=p[1];let o=f.substring(n.length).trim();return(o.startsWith(":")||o.startsWith("：")||o.startsWith("-"))&&(o=o.substring(1).trim()),{time:n,event:o}}else return{time:"",event:f}}).filter(f=>f!==null):[],S=async()=>{if(!b.value){b.value=!0;try{if(!i.value)return;const f=h.getFormattedRecentMessages(r,10).map(x=>`${x.role==="user"?"用户":"我"}: ${x.content}`).join(`
`),p=new Date,n=`${p.getFullYear()}.${(p.getMonth()+1).toString().padStart(2,"0")}.${p.getDate().toString().padStart(2,"0")}`;let o=null;if(u.value){const x=new Date(Number(u.value.timestamp));`${x.getFullYear()}.${(x.getMonth()+1).toString().padStart(2,"0")}.${x.getDate().toString().padStart(2,"0")}`===n&&(o=u.value)}const t=`${p.getHours().toString().padStart(2,"0")}:${p.getMinutes().toString().padStart(2,"0")}`;let l="";o?l=`角色:${i.value.name}
当前时间:${n} ${t}
任务:以角色的口吻补充现有行程表(仅补充${t}之前未记录的)。

规则:
1.严禁包含晚于${t}的时间点。
2.格式:HH:MM 事件内容
3.输出完整列表(含旧数据)，按时间排序。
4.内容基于角色人设的日常（如工作、爱好、生活习惯），体现角色性格和生活气息，要有真实感。
5.每条字数控制在10-20字。

现有行程:
${o.content}

完整行程:`:l=`角色:${i.value.name}
当前时间:${n} ${t}
任务:根据参考聊天和角色设定，以角色的口吻生成截止到目前的今日行程(已发生的事)。

规则:
1.严禁包含晚于${t}的时间点。
2.格式:HH:MM 事件内容
3.内容基于角色人设的日常（如工作、爱好、生活习惯），体现角色性格和生活气息，要有真实感。
4.每条字数控制在10-20字。

参考聊天:
${f}

行程:`;let O=null;i.value.api&&i.value.api!=="default"&&(O=y.presets.find(x=>x.name===i.value.api));const F=await y.getGenericCompletion([{role:"user",content:l}],O);if(F){const x=F.split(`
`).filter(R=>{const W=R.trim().match(/^(\d{1,2}:\d{2})/);if(W){const[ae,ie]=W[1].split(":").map(Number),re=ae*60+ie,[de,ce]=t.split(":").map(Number),ue=de*60+ce;return re<=ue}return!0}).join(`
`);o?d.updateSchedule(r,o.id,x.trim()):d.addSchedule(r,x.trim())}}catch(_){console.error("Failed to generate schedule:",_)}finally{b.value=!1}}};return(_,f)=>(c(),H(te,{title:k.value,"show-clear":!0,"show-refresh":!0,onClose:$,onClear:I,onRefresh:S,background:"#f0f4f8",color:"#37474f",themeColor:"#546e7a"},{default:j(()=>[u.value||b.value?(c(),m("div",ia,[e("div",ra,[e("div",da,[f[0]||(f[0]=e("div",{class:"clip"},null,-1)),e("div",ca,w(b.value?T(Date.now()):T(u.value.timestamp)),1)]),e("div",ua,[b.value?(c(),m("div",pa,"正在确认行程...")):(c(),m("div",ha,[(c(!0),m(z,null,L(N(u.value.content),(p,n)=>(c(),m("div",{key:n,class:"schedule-item"},[e("div",va,w(p.time),1),e("div",ma,w(p.event),1)]))),128))]))])])])):(c(),m("div",ga,[...f[1]||(f[1]=[e("div",{class:"empty-hint"},[X("行程表是空的..."),e("br"),X("点击右上角，看看我今天做了什么吧")],-1)])]))]),_:1},8,["title"]))}},ba=B(fa,[["__scopeId","data-v-ba3515c3"]]),ka={class:"char-phone-container"},ya={class:"char-phone-frame"},Da={class:"char-phone-screen"},_a={class:"char-status-bar"},$a={class:"time"},Ca={class:"char-content"},wa={__name:"CharPhone",setup(a){const{t:g}=pe(),s=q();K();const v=s.params.charId,h=C("");let d=null;const y=()=>{const o=new Date,t=o.getHours().toString().padStart(2,"0"),l=o.getMinutes().toString().padStart(2,"0");h.value=`${t}:${l}`};se(()=>{y(),d=setInterval(y,1e3),T()}),ne(()=>{d&&clearInterval(d)});const r=C({background:"",avatar:"",photos:["",""],photoTexts:["",""]}),b=[{label:"微信",color:"rgba(255, 255, 255, 0.9)",route:"/chat"},{label:"行程表",color:"rgba(255, 255, 255, 0.9)",route:"/schedule"},{label:"日记",color:"rgba(255, 255, 255, 0.9)",route:"/diary"},{label:"备忘录",color:"rgba(255, 255, 255, 0.9)",route:"/memo"}],i=C({photo:"",apps:JSON.parse(JSON.stringify(b))}),D=[{label:"购买记录",color:"rgba(255, 255, 255, 0.9)",route:"/purchase"},{label:"搜索记录",color:"rgba(255, 255, 255, 0.9)",route:"/search"},{label:"主题",color:"rgba(255, 255, 255, 0.9)",route:"/theme"},{label:"app1",color:"rgba(255, 255, 255, 0.9)",route:"/app1"}],u=C({photo:"",text1:"",text2:"",apps:JSON.parse(JSON.stringify(D))}),k=C({avatars:{other:"",mine:""},messages:{other:"",mine:""}}),$=C(null),T=()=>{const o=`charphone_${v}`,t=localStorage.getItem(o);if(t)try{const l=JSON.parse(t);l.header&&(r.value={...r.value,...l.header}),l.middle&&(i.value={...i.value,...l.middle},(!i.value.apps||i.value.apps.length===0||!i.value.apps[0].label)&&(i.value.apps=JSON.parse(JSON.stringify(b)))),l.bottom&&(u.value={...u.value,...l.bottom},(!u.value.apps||u.value.apps.length===0||!u.value.apps[0].label)&&(u.value.apps=JSON.parse(JSON.stringify(D)))),l.dock&&(k.value={...k.value,...l.dock})}catch(l){console.error("Failed to load char phone data:",l)}},I=()=>{const o=`charphone_${v}`,t={header:r.value,middle:i.value,bottom:u.value,dock:k.value};localStorage.setItem(o,JSON.stringify(t))},N=o=>{r.value=o,I()},S=o=>{i.value=o,I()},_=o=>{u.value=o,I()},f=o=>{k.value=o,I()},p=o=>{console.log("App clicked:",o),o.label==="日记"||o.route==="/diary"?$.value="diary":o.label==="备忘录"||o.route==="/memo"?$.value="memo":(o.label==="行程"||o.route==="/schedule")&&($.value="schedule")},n=()=>{$.value=null};return(o,t)=>(c(),H(ve,{title:he(g)("charPhone.title","查看手机"),"no-padding":"",class:le({"hide-back-btn":$.value})},{default:j(()=>[e("div",ka,[e("div",ya,[t[2]||(t[2]=e("div",{class:"char-notch"},null,-1)),e("div",Da,[e("div",_a,[e("span",$a,w(h.value),1),t[0]||(t[0]=e("div",{class:"icons"},[e("span",null,"5G"),e("div",{class:"battery-icon"})],-1))]),e("div",Ca,[U(ot,{"header-data":r.value,"middle-data":i.value,"bottom-data":u.value,"onUpdate:headerData":N,"onUpdate:middleData":S,"onUpdate:bottomData":_,onAppClick:p},null,8,["header-data","middle-data","bottom-data"])]),U(pt,{"dock-data":k.value,"onUpdate:dockData":f},null,8,["dock-data"]),U(me,{name:"app-fade"},{default:j(()=>[$.value==="diary"?(c(),H(Yt,{key:0,onClose:n})):$.value==="memo"?(c(),H(na,{key:1,onClose:n})):$.value==="schedule"?(c(),H(ba,{key:2,onClose:n})):A("",!0)]),_:1}),t[1]||(t[1]=e("div",{class:"char-home-indicator"},null,-1))]),t[3]||(t[3]=e("div",{class:"char-btn-power"},null,-1)),t[4]||(t[4]=e("div",{class:"char-btn-volume-up"},null,-1)),t[5]||(t[5]=e("div",{class:"char-btn-volume-down"},null,-1))])])]),_:1},8,["title","class"]))}},Ma=B(wa,[["__scopeId","data-v-28eb0f0d"]]);export{Ma as default};
