import{_ as R,m as W,q,s as J,t as K,r as c,v as O,x as Q,b as d,f as s,g as x,i as X,y as V,z as $,j as n,A as l,F as Y,B as Z,w as m,M as b,k as tt,o as u,C as y,n as et,D as at,d as st,E as ot}from"./index-DpsRkgyh.js";const nt={class:"chat-page active"},lt={class:"chat-top-note"},it=["placeholder"],rt={class:"chat-list"},ct={key:0,class:"empty-state"},dt={class:"empty-text"},ut={class:"empty-text",style:{"font-size":"12px"}},pt=["onMousedown","onMouseup","onTouchstart","onTouchend"],ht=["src"],vt={key:1,class:"default-avatar-text"},mt={class:"chat-info"},ft={class:"chat-name"},_t={class:"chat-preview"},gt={class:"chat-meta"},yt={class:"chat-time"},Ct={key:0,class:"chat-unread-badge"},wt={class:"modal-options centered-text"},kt={class:"option-text"},Tt={class:"option-text",style:{color:"inherit"}},xt={class:"modal-options centered-text"},bt={class:"option-text"},Mt={class:"option-text"},St=["placeholder"],Nt={__name:"ChatList",setup(Pt,{expose:A}){const{t:a}=W(),M=tt(),f=q(),S=J(),i=K(),C=c(""),p=c(!1),_=c(!1),w=c(""),N=c(null),h=c(!1),v=c(null);let k=null,T=!0;O(()=>{C.value=f.topNote}),Q(_,o=>{o&&ot(()=>{var t;(t=N.value)==null||t.focus()})}),A({openAddModal:()=>{p.value=!0}});const z=()=>{f.saveTopNote(C.value)},D=o=>{const t=o.lastMessage;return t?t.type==="text"?t.content:t.type==="voice"?a("chat.messageTypes.voice"):t.type==="image"?a("chat.messageTypes.image"):t.type==="sticker"?a("chat.messageTypes.sticker"):t.type==="location"?a("chat.messageTypes.location"):t.type==="transfer"?a("chat.messageTypes.transfer"):t.type==="call_summary"?t.content:a("chat.messageTypes.unknown"):a("chat.start")},F=o=>{const t=o.lastMessage;if(!t)return"";const g=new Date(t.time),e=g.getHours().toString().padStart(2,"0"),r=g.getMinutes().toString().padStart(2,"0");return`${e}:${r}`},I=o=>{if(!o||!o.id){console.error("Attempted to open chat room with invalid session:",o),i.showToast(a("chat.toast.openChatFailed"),"error");return}o.type==="single"?M.push({name:"single-chat",params:{id:o.id}}):o.type==="group"&&i.showToast(a("chat.toast.groupChatWip"),"info")},U=()=>{p.value=!1,i.showToast(a("chat.toast.groupChatWip"),"info")},P=()=>{_.value=!1,w.value=""},E=()=>{const o=w.value.trim();if(!o){i.showToast(a("chat.enterCharacterName"),"info");return}const t=S.addCharacter(o);P(),M.push({name:"single-chat",params:{id:t}})},B=(o,t)=>{t.type==="mousedown"&&t.button!==0||(T=!0,k=setTimeout(()=>{T=!1,v.value=o,h.value=!0},800))},j=()=>{v.value&&(f.togglePin(v.value.id),h.value=!1)},G=()=>{h.value=!1;const o=v.value;o&&i.showConfirm(a("chat.deleteCharacterTitle"),a("chat.deleteCharacterConfirm",{name:o.name}),()=>{o.type==="single"?(S.deleteCharacter(o.id),i.showToast(a("chat.toast.deleteSuccess"),"success")):i.showToast("群组删除功能暂未开放","info")},{messageStyle:{whiteSpace:"pre-wrap",color:"#FF3B30"},confirmText:"delete"})},L=o=>{clearTimeout(k),T&&I(o)},H=()=>{clearTimeout(k)};return(o,t)=>{var g;return u(),d("div",nt,[s("div",lt,[t[8]||(t[8]=X('<div class="chat-top-note-icon" data-v-9254d355><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" data-v-9254d355><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z" data-v-9254d355></path><polyline points="3.27 6.96 12 12.01 20.73 6.96" data-v-9254d355></polyline><line x1="12" y1="22.08" x2="12" y2="12" data-v-9254d355></line></svg></div>',1)),V(s("input",{type:"text",class:"chat-top-note-input",placeholder:n(a)("chat.topNotePlaceholder"),"onUpdate:modelValue":t[0]||(t[0]=e=>C.value=e),onBlur:z},null,40,it),[[$,C.value]])]),s("div",rt,[n(f).sessionList.length===0?(u(),d("div",ct,[s("div",dt,l(n(a)("chat.empty")),1),s("div",ut,l(n(a)("chat.emptyHint")),1)])):(u(!0),d(Y,{key:1},Z(n(f).sessionList,e=>(u(),d("div",{key:e.id,class:et(["chat-list-item",{pinned:e.isPinned}]),onMousedown:y(r=>B(e,r),["prevent"]),onMouseup:y(r=>L(e),["prevent"]),onMouseleave:y(H,["prevent"]),onTouchstart:y(r=>B(e,r),["prevent"]),onTouchend:y(r=>L(e),["prevent"])},[s("div",{class:"chat-avatar",style:at(e.avatar?"background: transparent;":"")},[e.avatar?(u(),d("img",{key:0,src:e.avatar,alt:""},null,8,ht)):(u(),d("span",vt,l(e.name[0]||"?"),1))],4),s("div",mt,[s("div",ft,l(e.name),1),s("div",_t,l(D(e)),1)]),s("div",gt,[s("div",yt,l(F(e)),1),e.unreadCount>0?(u(),d("div",Ct,l(e.unreadCount),1)):st("",!0)])],42,pt))),128))]),x(b,{visible:h.value,"onUpdate:visible":t[2]||(t[2]=e=>h.value=e),title:(g=v.value)==null?void 0:g.name},{footer:m(()=>[s("button",{class:"modal-btn cancel",onClick:t[1]||(t[1]=e=>h.value=!1)},l(n(a)("cancel")),1)]),default:m(()=>{var e;return[s("div",wt,[s("div",{class:"modal-option",onClick:j},[s("span",kt,l((e=v.value)!=null&&e.isPinned?n(a)("chat.unpin"):n(a)("chat.pin")),1)]),s("div",{class:"modal-option btn-danger",onClick:G},[s("span",Tt,l(n(a)("delete")),1)])])]}),_:1},8,["visible","title"]),x(b,{visible:p.value,"onUpdate:visible":t[5]||(t[5]=e=>p.value=e),title:n(a)("chat.newConversation")},{footer:m(()=>[s("button",{class:"modal-btn cancel",onClick:t[4]||(t[4]=e=>p.value=!1)},l(n(a)("cancel")),1)]),default:m(()=>[s("div",xt,[s("div",{class:"modal-option",onClick:t[3]||(t[3]=e=>{_.value=!0,p.value=!1})},[s("span",bt,l(n(a)("chat.createCharacter")),1)]),s("div",{class:"modal-option",onClick:U},[s("span",Mt,l(n(a)("chat.createGroup")),1)])])]),_:1},8,["visible","title"]),x(b,{visible:_.value,"onUpdate:visible":t[7]||(t[7]=e=>_.value=e),title:n(a)("chat.createCharacter")},{footer:m(()=>[s("button",{class:"modal-btn cancel",onClick:P},l(n(a)("cancel")),1),s("button",{class:"modal-btn confirm",onClick:E},l(n(a)("create")),1)]),default:m(()=>[V(s("input",{type:"text",class:"base-input","onUpdate:modelValue":t[6]||(t[6]=e=>w.value=e),placeholder:n(a)("chat.characterNamePlaceholder"),ref_key:"newCharInput",ref:N},null,8,St),[[$,w.value]])]),_:1},8,["visible","title"])])}}},Lt=R(Nt,[["__scopeId","data-v-9254d355"]]);export{Lt as default};
